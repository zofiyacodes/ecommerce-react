{"version":3,"file":"341.js","mappings":"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","sources":["webpack://grafana-lokiexplore-app/./Components/FilterButton.tsx","webpack://grafana-lokiexplore-app/./Components/GrotError.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/InterceptBanner.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/GiveFeedbackButton.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/CustomVariableValueSelectors.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/PatternTag.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/PatternControls.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/VariableLayoutScene.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/LayoutScene.tsx","webpack://grafana-lokiexplore-app/./services/TagValuesProviders.ts","webpack://grafana-lokiexplore-app/./services/TagKeysProviders.ts","webpack://grafana-lokiexplore-app/./services/Mousetrap.ts","webpack://grafana-lokiexplore-app/./services/KeybindingSet.ts","webpack://grafana-lokiexplore-app/./services/keyboardShortcuts.ts","webpack://grafana-lokiexplore-app/./Components/NoLokiSplash.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/IndexScene.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/LevelsVariableScene.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/LineFilterVariable.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/LineFilterVariablesScene.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/ShowLogsButtonScene.tsx","webpack://grafana-lokiexplore-app/./Components/IndexScene/ToolbarScene.tsx","webpack://grafana-lokiexplore-app/./Components/Pages.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/AddToInvestigationButton.tsx","webpack://grafana-lokiexplore-app/./Components/Panels/PanelMenu.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/GoToExploreButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/AddToFiltersButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/BreakdownSearchScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/ByFrameRepeater.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/EmptyLayoutScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldSelector.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldValuesBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldsAggregatedBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/FieldsBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LabelsAggregatedBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LabelBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LabelValuesBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LayoutSwitcher.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/NoMatchingLabelsScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Panels/ValueSummary.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/SearchInput.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/NumericFilterPopoverScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/SelectLabelActionScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/SortByScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/StatusWrapper.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/TimeSeriesLimit.ts","webpack://grafana-lokiexplore-app/./services/mixins.ts","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LineFilter/RegexIconButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LineFilter/LineFilterCaseSensitivityButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/LineFilterInput.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LineFilter/LineFilterEditor.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogOptionsScene.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Context/TableColumnsContext.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Context/TableCellContext.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Context/TableHeaderContext.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsColumnSearch.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableEmptyFields.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableNavField.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableActiveFields.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableAvailableFields.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/LogsTableMultiSelect.tsx","webpack://grafana-lokiexplore-app/./Components/Table/ColumnSelection/ColumnSelectionDrawerWrap.tsx","webpack://grafana-lokiexplore-app/./Components/Table/DefaultCellWrapComponent.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Context/QueryContext.tsx","webpack://grafana-lokiexplore-app/./Components/Table/CellContextMenu.tsx","webpack://grafana-lokiexplore-app/./Components/Table/constants.ts","webpack://grafana-lokiexplore-app/./Components/Table/DefaultPill.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LineActionIcons.tsx","webpack://grafana-lokiexplore-app/./Components/Table/DefaultCellComponent.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogLinePill.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Scroller.tsx","webpack://grafana-lokiexplore-app/./Components/Table/RawLogLineText.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogLineCellComponent.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogsTableHeader.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogsTableHeaderWrap.tsx","webpack://grafana-lokiexplore-app/./Components/Table/Table.tsx","webpack://grafana-lokiexplore-app/./Components/Table/TableWrap.tsx","webpack://grafana-lokiexplore-app/./Components/Table/TableProvider.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsTableScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LineFilter/LineFilterScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsListScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/CopyLinkButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsPanelError.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsPanelScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsVolumeActions.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/LogsVolumePanel.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/FilterByPatternsButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternFieldLabelStatsRow.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternFieldLabelStats.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternNameLabel.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsLogsSampleScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsTableExpandedRow.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsViewTableScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsFrameScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsViewTextSearch.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsNotDetected.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/Breakdowns/Patterns/PatternsBreakdownScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/BreakdownViews.ts","webpack://grafana-lokiexplore-app/./Components/IndexScene/ShareButtonScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceScene/ActionBarScene.tsx","webpack://grafana-lokiexplore-app/./services/migrations.ts","webpack://grafana-lokiexplore-app/./Components/ServiceScene/ServiceScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/FavoriteServiceHeaderActionScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/SelectServiceButton.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/ConfigureVolumeError.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/NoServiceSearchResults.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/TabPopoverScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/ServiceSelectionTabsScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/NoServiceVolume.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/AddLabelToFiltersHeaderActionScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/ServiceSelectionPaginationScene.tsx","webpack://grafana-lokiexplore-app/./Components/ServiceSelectionScene/ServiceSelectionScene.tsx","webpack://grafana-lokiexplore-app/./Components/Table/LogsHeaderActions.tsx","webpack://grafana-lokiexplore-app/./services/CustomConstantVariable.ts","webpack://grafana-lokiexplore-app/./services/ExpressionBuilder.ts","webpack://grafana-lokiexplore-app/./services/analytics.ts","webpack://grafana-lokiexplore-app/./services/comparison.ts","webpack://grafana-lokiexplore-app/./services/logql.ts","webpack://grafana-lokiexplore-app/./services/combineResponses.ts","webpack://grafana-lokiexplore-app/./services/shardQuerySplitting.ts","webpack://grafana-lokiexplore-app/./services/datasource.ts","webpack://grafana-lokiexplore-app/./services/expressions.ts","webpack://grafana-lokiexplore-app/./services/favorites.ts","webpack://grafana-lokiexplore-app/./services/fields.ts","webpack://grafana-lokiexplore-app/./services/filters.ts","webpack://grafana-lokiexplore-app/./services/labels.ts","webpack://grafana-lokiexplore-app/./services/levels.ts","webpack://grafana-lokiexplore-app/./services/logsFrame.ts","webpack://grafana-lokiexplore-app/./services/metadata.ts","webpack://grafana-lokiexplore-app/./services/navigate.ts","webpack://grafana-lokiexplore-app/./services/LogsSceneQueryRunner.ts","webpack://grafana-lokiexplore-app/./services/panel.ts","webpack://grafana-lokiexplore-app/./services/plugin.ts","webpack://grafana-lokiexplore-app/./services/query.ts","webpack://grafana-lokiexplore-app/./services/routing.ts","webpack://grafana-lokiexplore-app/./services/scenes.ts","webpack://grafana-lokiexplore-app/./services/search.ts","webpack://grafana-lokiexplore-app/./services/sorting.ts","webpack://grafana-lokiexplore-app/./services/store.ts","webpack://grafana-lokiexplore-app/./services/testIds.ts","webpack://grafana-lokiexplore-app/./services/text.ts","webpack://grafana-lokiexplore-app/./services/variableGetters.ts","webpack://grafana-lokiexplore-app/./services/variableHelpers.ts"],"sourcesContent":["import { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { testIds } from 'services/testIds';\n\ntype Props = {\n  onInclude: () => void;\n  onClear: () => void;\n  isIncluded: boolean;\n  onExclude: () => void;\n  isExcluded: boolean;\n  buttonFill: 'solid' | 'outline' | 'text';\n  titles?: {\n    include: string;\n    exclude: string;\n  };\n  hideExclude?: boolean;\n};\n\nexport const FilterButton = (props: Props) => {\n  const { isExcluded, isIncluded, onInclude, onExclude, onClear, titles, buttonFill, hideExclude } = props;\n  const styles = useStyles2(getStyles, isIncluded, isExcluded, hideExclude);\n  return (\n    <div className={styles.container}>\n      <Button\n        variant={isIncluded ? 'primary' : 'secondary'}\n        fill={buttonFill}\n        size=\"sm\"\n        aria-selected={isIncluded}\n        className={styles.includeButton}\n        onClick={isIncluded ? onClear : onInclude}\n        data-testid={testIds.exploreServiceDetails.buttonFilterInclude}\n        title={titles?.include}\n      >\n        Include\n      </Button>\n      {!hideExclude && (\n        <Button\n          variant={isExcluded ? 'primary' : 'secondary'}\n          fill={buttonFill}\n          size=\"sm\"\n          aria-selected={isExcluded}\n          className={styles.excludeButton}\n          onClick={isExcluded ? onClear : onExclude}\n          title={titles?.exclude}\n          data-testid={testIds.exploreServiceDetails.buttonFilterExclude}\n        >\n          Exclude\n        </Button>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2, isIncluded: boolean, isExcluded: boolean, hideExclude?: boolean) => {\n  return {\n    container: css({\n      display: 'flex',\n      justifyContent: 'center',\n    }),\n    includeButton: css({\n      borderRadius: 0,\n      borderRight: isIncluded || hideExclude ? undefined : 'none',\n    }),\n    excludeButton: css({\n      borderRadius: `0 ${theme.shape.radius.default} ${theme.shape.radius.default} 0`,\n      borderLeft: isExcluded ? undefined : 'none',\n    }),\n  };\n};\n","import React from 'react';\n\nimport { css } from '@emotion/css';\nimport SVG from 'react-inlinesvg';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2, useTheme2, Text } from '@grafana/ui';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    graphicContainer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      margin: '0 auto',\n    }),\n    graphic: css({ width: '200px', height: '120px', padding: theme.spacing(1) }),\n    text: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n    }),\n    wrap: css({\n      margin: '0 auto',\n    }),\n  };\n};\n\ntype Props = {\n  children?: React.ReactNode;\n};\n\nexport const GrotError = ({ children }: React.PropsWithChildren<Props>) => {\n  const styles = useStyles2(getStyles);\n  const theme = useTheme2();\n  return (\n    <div className={styles.wrap}>\n      <div className={styles.graphicContainer}>\n        <SVG\n          className={styles.graphic}\n          src={\n            theme.isDark\n              ? `/public/plugins/grafana-lokiexplore-app/img/grot_err.svg`\n              : `/public/plugins/grafana-lokiexplore-app/img/grot_err_light.svg`\n          }\n        />\n      </div>\n      <div className={styles.text}>\n        <Text textAlignment=\"center\" color=\"primary\" element=\"span\">\n          {children ? children : 'An error occurred'}\n        </Text>\n      </div>\n    </div>\n  );\n};\n","import { Alert, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nexport function InterceptBanner(props: { onRemove: () => void }) {\n  const styles = useStyles2(getStyles);\n  return (\n    <>\n      <Alert\n        className={styles.alert}\n        severity={'info'}\n        title={'Welcome to Grafana Logs Drilldown!'}\n        onRemove={props.onRemove}\n      >\n        <div>\n          Check out our{' '}\n          <a\n            className=\"external-link\"\n            target=\"_blank\"\n            href=\"https://grafana.com/docs/grafana-cloud/visualizations/simplified-exploration/logs/\"\n            rel=\"noreferrer\"\n          >\n            Get started doc\n          </a>\n          , or see{' '}\n          <a\n            className=\"external-link\"\n            target=\"_blank\"\n            href=\"https://github.com/grafana/explore-logs/releases\"\n            rel=\"noreferrer\"\n          >\n            recent changes\n          </a>\n          .<br />\n          Help us shape the future of the app.{' '}\n          <a className=\"external-link\" target=\"_blank\" href=\"https://forms.gle/1sYWCTPvD72T1dPH9\" rel=\"noreferrer\">\n            Send us feedback\n          </a>{' '}\n          or engage with us on{' '}\n          <a\n            className=\"external-link\"\n            target=\"_blank\"\n            href=\"https://github.com/grafana/explore-logs/?tab=readme-ov-file#explore-logs\"\n            rel=\"noreferrer\"\n          >\n            GitHub\n          </a>\n          .\n        </div>\n      </Alert>\n    </>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    alert: css({\n      flex: 'none',\n    }),\n  };\n}\n","import React from 'react';\nimport { Icon, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nexport const GiveFeedbackButton = () => {\n  const styles = useStyles2(getStyles);\n  return (\n    <div className={styles.wrapper}>\n      <a\n        href=\"https://forms.gle/1sYWCTPvD72T1dPH9\"\n        className={styles.feedback}\n        title=\"Share your thoughts about Logs in Grafana.\"\n        target=\"_blank\"\n        rel=\"noreferrer noopener\"\n      >\n        <Icon name=\"comment-alt-message\" /> Give feedback\n      </a>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css({\n      display: 'flex',\n      marginLeft: 'auto',\n      gap: theme.spacing(1),\n      position: 'relative',\n      top: theme.spacing(-1),\n    }),\n    feedback: css({\n      alignSelf: 'center',\n      color: theme.colors.text.secondary,\n      fontSize: theme.typography.bodySmall.fontSize,\n      '&:hover': {\n        color: theme.colors.text.link,\n      },\n    }),\n  };\n};\n","import {\n  ControlsLayout,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VariableValueSelectWrapper,\n} from '@grafana/scenes';\nimport React from 'react';\n\nexport interface VariableValueSelectorsState extends SceneObjectState {\n  layout?: ControlsLayout;\n  include?: string[];\n  exclude?: string[];\n}\n\nexport class CustomVariableValueSelectors extends SceneObjectBase<VariableValueSelectorsState> {\n  public static Component = CustomVariableValueSelectorsRenderer;\n}\n\nfunction CustomVariableValueSelectorsRenderer({ model }: SceneComponentProps<CustomVariableValueSelectors>) {\n  const variablesSetState = sceneGraph.getVariables(model).useState();\n  let variables = variablesSetState.variables;\n\n  if (model.state.include?.length) {\n    variables = variablesSetState.variables.filter((variable) =>\n      model.state.include?.includes(variable.state.name ?? '')\n    );\n  }\n  if (model.state.exclude?.length) {\n    variables = variablesSetState.variables.filter(\n      (variable) => !model.state.exclude?.includes(variable.state.name ?? '')\n    );\n  }\n\n  return (\n    <>\n      {variables.map((variable) => (\n        <VariableValueSelectWrapper key={variable.state.key} variable={variable} layout={model.state.layout} />\n      ))}\n    </>\n  );\n}\n","import { css } from '@emotion/css';\nimport { Button, Icon, Tag, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport React, { useState } from 'react';\nimport { testIds } from 'services/testIds';\n\ninterface Props {\n  onRemove(): void;\n  pattern: string;\n  size?: PatternSize;\n}\n\ntype PatternSize = 'sm' | 'lg';\n\nexport const PatternTag = ({ onRemove, pattern, size = 'lg' }: Props) => {\n  const styles = useStyles2(getStyles);\n  const [expanded, setExpanded] = useState(false);\n  return (\n    <div className={styles.pattern} onClick={() => setExpanded(!expanded)} onMouseLeave={() => setExpanded(false)}>\n      <Tag\n        title={pattern}\n        key={pattern}\n        name={expanded ? pattern : getPatternPreview(pattern, size)}\n        className={styles.tag}\n      />\n      <Button\n        aria-label=\"Remove pattern\"\n        data-testid={testIds.exploreServiceDetails.buttonRemovePattern}\n        variant=\"secondary\"\n        size=\"sm\"\n        className={styles.removeButton}\n        onClick={onRemove}\n      >\n        <Icon name=\"times\" />\n      </Button>\n    </div>\n  );\n};\n\nconst PREVIEW_WIDTH: Record<PatternSize, number> = {\n  sm: 50,\n  lg: Math.round(window.innerWidth / 8),\n};\n\nfunction getPatternPreview(pattern: string, size: PatternSize) {\n  const length = pattern.length;\n  if (length < PREVIEW_WIDTH[size]) {\n    return pattern;\n  }\n\n  const substringLength = Math.round(PREVIEW_WIDTH[size] * 0.4);\n\n  return `${pattern.substring(0, substringLength)}  ${pattern.substring(length - substringLength)}`;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    pattern: css({\n      display: 'flex',\n      fontFamily: 'monospace',\n      gap: theme.spacing(0.25),\n      cursor: 'pointer',\n      overflow: 'hidden',\n    }),\n    tag: css({\n      borderTopRightRadius: 0,\n      borderBottomRightRadius: 0,\n      backgroundColor: theme.colors.secondary.main,\n      border: `solid 1px ${theme.colors.secondary.border}`,\n      color: theme.colors.secondary.text,\n      boxSizing: 'border-box',\n      padding: theme.spacing(0.25, 0.75),\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n    }),\n    removeButton: css({\n      paddingLeft: 2.5,\n      paddingRight: 2.5,\n    }),\n  };\n};\n","import React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { PatternTag } from './PatternTag';\nimport { css } from '@emotion/css';\nimport { useStyles2, Text } from '@grafana/ui';\nimport { USER_EVENTS_ACTIONS, USER_EVENTS_PAGES, reportAppInteraction } from 'services/analytics';\nimport { testIds } from 'services/testIds';\nimport { AppliedPattern } from '../../services/variables';\nimport { addCurrentUrlToHistory } from '../../services/navigate';\n\ntype Props = {\n  patterns: AppliedPattern[] | undefined;\n  onRemove: (patterns: AppliedPattern[]) => void;\n};\nexport const PatternControls = ({ patterns, onRemove }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  if (!patterns || patterns.length === 0) {\n    return null;\n  }\n\n  const includePatterns = patterns.filter((pattern) => pattern.type === 'include');\n  const excludePatterns = patterns.filter((pattern) => pattern.type !== 'include');\n\n  const onRemovePattern = (pattern: AppliedPattern) => {\n    addCurrentUrlToHistory();\n    onRemove(patterns.filter((pat) => pat !== pattern));\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.pattern_removed, {\n      includePatternsLength: includePatterns.length - (pattern?.type === 'include' ? 1 : 0),\n      excludePatternsLength: excludePatterns.length - (pattern?.type !== 'include' ? 1 : 0),\n      type: pattern.type,\n    });\n  };\n\n  return (\n    <div>\n      {includePatterns.length > 0 && (\n        <div className={styles.patternsContainer}>\n          <Text variant=\"bodySmall\" weight=\"bold\" data-testid={testIds.patterns.buttonIncludedPattern}>\n            Included pattern{patterns.length > 1 ? 's' : ''}\n          </Text>\n          <div className={styles.patterns}>\n            {includePatterns.map((p) => (\n              <PatternTag key={p.pattern} pattern={p.pattern} size=\"lg\" onRemove={() => onRemovePattern(p)} />\n            ))}\n          </div>\n        </div>\n      )}\n      {excludePatterns.length > 0 && (\n        <div className={styles.patternsContainer}>\n          <Text variant=\"bodySmall\" weight=\"bold\" data-testid={testIds.patterns.buttonExcludedPattern}>\n            Excluded pattern{excludePatterns.length > 1 ? 's' : ''}:\n          </Text>\n          <div className={styles.patterns}>\n            {excludePatterns.map((p) => (\n              <PatternTag\n                key={p.pattern}\n                pattern={p.pattern}\n                size={excludePatterns.length > 1 ? 'sm' : 'lg'}\n                onRemove={() => onRemovePattern(p)}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    patternsContainer: css({\n      overflow: 'hidden',\n    }),\n    patterns: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n      alignItems: 'center',\n      flexWrap: 'wrap',\n    }),\n  };\n}\n","import { SceneComponentProps, SceneFlexLayout, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React from 'react';\nimport { css, cx } from '@emotion/css';\nimport { GiveFeedbackButton } from './GiveFeedbackButton';\nimport { CustomVariableValueSelectors } from './CustomVariableValueSelectors';\nimport { PatternControls } from './PatternControls';\nimport { IndexScene } from './IndexScene';\nimport { CONTROLS_VARS_DATASOURCE, CONTROLS_VARS_FIELDS_COMBINED, LayoutScene } from './LayoutScene';\nimport { useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { AppliedPattern } from '../../services/variables';\n\ninterface VariableLayoutSceneState extends SceneObjectState {}\nexport class VariableLayoutScene extends SceneObjectBase<VariableLayoutSceneState> {\n  static Component = ({ model }: SceneComponentProps<VariableLayoutScene>) => {\n    const indexScene = sceneGraph.getAncestor(model, IndexScene);\n    const { controls, patterns } = indexScene.useState();\n\n    const layoutScene = sceneGraph.getAncestor(model, LayoutScene);\n    const { lineFilterRenderer, levelsRenderer } = layoutScene.useState();\n\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.controlsContainer}>\n        <>\n          {/* First row - datasource, timepicker, refresh, labels, button */}\n          {controls && (\n            <div className={styles.controlsFirstRowContainer}>\n              <div className={styles.filtersWrap}>\n                <div className={cx(styles.filters, styles.firstRowWrapper)}>\n                  {controls.map((control) => {\n                    return control instanceof SceneFlexLayout ? (\n                      <control.Component key={control.state.key} model={control} />\n                    ) : null;\n                  })}\n                </div>\n              </div>\n              <div className={styles.controlsWrapper}>\n                <GiveFeedbackButton />\n                <div className={styles.timeRangeDatasource}>\n                  {controls.map((control) => {\n                    return control.state.key === CONTROLS_VARS_DATASOURCE ? (\n                      <control.Component key={control.state.key} model={control} />\n                    ) : null;\n                  })}\n\n                  <div className={styles.timeRange}>\n                    {controls.map((control) => {\n                      return !(control instanceof CustomVariableValueSelectors) &&\n                        !(control instanceof SceneFlexLayout) ? (\n                        <control.Component key={control.state.key} model={control} />\n                      ) : null;\n                    })}\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Second row - Levels - custom renderer */}\n          <div className={styles.controlsRowContainer}>\n            {levelsRenderer && <levelsRenderer.Component model={levelsRenderer} />}\n          </div>\n\n          {/* 3rd row - Combined fields (fields + metadata)  */}\n          <div className={styles.controlsRowContainer}>\n            {controls && (\n              <div className={styles.filtersWrap}>\n                <div className={styles.filters}>\n                  {controls.map((control) => {\n                    return control instanceof CustomVariableValueSelectors &&\n                      control.state.key === CONTROLS_VARS_FIELDS_COMBINED ? (\n                      <control.Component key={control.state.key} model={control} />\n                    ) : null;\n                  })}\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* 4th row - Patterns */}\n          <div className={styles.controlsRowContainer}>\n            <PatternControls\n              patterns={patterns}\n              onRemove={(patterns: AppliedPattern[]) => indexScene.setState({ patterns })}\n            />\n          </div>\n\n          {/* 5th row - Line filters - custom renderer */}\n          <div className={styles.controlsRowContainer}>\n            {lineFilterRenderer && <lineFilterRenderer.Component model={lineFilterRenderer} />}\n          </div>\n        </>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    firstRowWrapper: css({\n      '& > div > div': {\n        gap: '16px',\n        label: 'first-row-wrapper',\n\n        [theme.breakpoints.down('lg')]: {\n          flexDirection: 'column',\n        },\n      },\n    }),\n    bodyContainer: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n    }),\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n      padding: theme.spacing(2),\n      maxWidth: '100vw',\n    }),\n    body: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n    }),\n    controlsFirstRowContainer: css({\n      label: 'controls-first-row',\n      display: 'flex',\n      gap: theme.spacing(2),\n      justifyContent: 'space-between',\n      alignItems: 'flex-start',\n    }),\n    controlsRowContainer: css({\n      '&:empty': {\n        display: 'none',\n      },\n      label: 'controls-row',\n      display: 'flex',\n      // @todo add custom renderers for all variables, this currently results in 2 \"empty\" rows that always take up space\n      gap: theme.spacing(1),\n      alignItems: 'flex-start',\n      paddingLeft: theme.spacing(2),\n    }),\n    controlsContainer: css({\n      label: 'controlsContainer',\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n    }),\n    filters: css({\n      label: 'filters',\n      display: 'flex',\n    }),\n    filtersWrap: css({\n      label: 'filtersWrap',\n      display: 'flex',\n      gap: theme.spacing(2),\n      width: 'calc(100% - 450)',\n      flexWrap: 'wrap',\n      alignItems: 'flex-end',\n    }),\n    controlsWrapper: css({\n      label: 'controlsWrapper',\n      display: 'flex',\n      flexDirection: 'column',\n      marginTop: theme.spacing(0.375),\n    }),\n    timeRangeDatasource: css({\n      label: 'timeRangeDatasource',\n      display: 'flex',\n      gap: theme.spacing(1),\n      flexWrap: 'wrap',\n      justifyContent: 'flex-end',\n    }),\n    timeRange: css({\n      label: 'timeRange',\n      display: 'flex',\n      flexDirection: 'row',\n      gap: theme.spacing(1),\n    }),\n    controls: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n    }),\n    feedback: css({\n      textAlign: 'end',\n    }),\n    rotateIcon: css({\n      svg: { transform: 'rotate(180deg)' },\n    }),\n  };\n}\n","import { GrafanaTheme2 } from '@grafana/data';\nimport { SceneComponentProps, sceneGraph, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { IndexScene } from './IndexScene';\nimport { css } from '@emotion/css';\nimport { InterceptBanner } from './InterceptBanner';\n\nimport { PLUGIN_ID } from '../../services/plugin';\nimport { logger } from '../../services/logger';\nimport { LineFilterVariablesScene } from './LineFilterVariablesScene';\nimport { VariableLayoutScene } from './VariableLayoutScene';\nimport { LevelsVariableScene } from './LevelsVariableScene';\n\ninterface LayoutSceneState extends SceneObjectState {\n  interceptDismissed: boolean;\n  lineFilterRenderer?: LineFilterVariablesScene;\n  levelsRenderer?: LevelsVariableScene;\n  variableLayout?: SceneObject;\n}\n\nconst interceptBannerStorageKey = `${PLUGIN_ID}.interceptBannerStorageKey`;\n\nexport const CONTROLS_VARS_FIRST_ROW_KEY = 'vars-row__datasource-labels-timepicker-button';\nexport const CONTROLS_VARS_METADATA_ROW_KEY = 'vars-metadata';\nexport const CONTROLS_VARS_LEVELS_ROW_KEY = 'vars-levels';\nexport const CONTROLS_VARS_FIELDS = 'vars-fields';\nexport const CONTROLS_VARS_FIELDS_COMBINED = 'vars-fields-metadata';\nexport const CONTROLS_VARS_TIMEPICKER = 'vars-timepicker';\nexport const CONTROLS_VARS_REFRESH = 'vars-refresh';\nexport const CONTROLS_VARS_TOOLBAR = 'vars-toolbar';\nexport const CONTROLS_VARS_DATASOURCE = 'vars-ds';\nexport const CONTROLS_VARS_LABELS = 'vars-labels';\n\nexport class LayoutScene extends SceneObjectBase<LayoutSceneState> {\n  constructor(state: Partial<LayoutSceneState>) {\n    super({\n      ...state,\n      interceptDismissed: !!localStorage.getItem(interceptBannerStorageKey),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  static Component = ({ model }: SceneComponentProps<LayoutScene>) => {\n    const indexScene = sceneGraph.getAncestor(model, IndexScene);\n    const { contentScene } = indexScene.useState();\n    const { interceptDismissed, variableLayout } = model.useState();\n\n    if (!contentScene) {\n      logger.warn('content scene not defined');\n      return null;\n    }\n\n    const styles = useStyles2(getStyles);\n    return (\n      <div className={styles.bodyContainer}>\n        <div className={styles.container}>\n          {!interceptDismissed && (\n            <InterceptBanner\n              onRemove={() => {\n                model.dismiss();\n              }}\n            />\n          )}\n\n          {variableLayout && <variableLayout.Component model={variableLayout} />}\n\n          {/* Final \"row\" - body */}\n          <div className={styles.body}>{contentScene && <contentScene.Component model={contentScene} />}</div>\n        </div>\n      </div>\n    );\n  };\n\n  public onActivate() {\n    this.setState({\n      lineFilterRenderer: new LineFilterVariablesScene({}),\n      levelsRenderer: new LevelsVariableScene({}),\n      variableLayout: new VariableLayoutScene({}),\n    });\n  }\n\n  public dismiss() {\n    this.setState({\n      interceptDismissed: true,\n    });\n    localStorage.setItem(interceptBannerStorageKey, 'true');\n  }\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    bodyContainer: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n    }),\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n      padding: theme.spacing(2),\n      maxWidth: '100vw',\n    }),\n    body: css({\n      label: 'body-wrapper',\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n    }),\n    controlsContainer: css({\n      label: 'controlsContainer',\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n    }),\n  };\n}\n","import { AdHocFiltersVariable, AdHocFilterWithLabels, SceneObject } from '@grafana/scenes';\nimport { DataSourceGetTagValuesOptions, GetTagResponse, MetricFindValue, ScopedVars, TimeRange } from '@grafana/data';\nimport { BackendSrvRequest, DataSourceWithBackend, getDataSourceSrv } from '@grafana/runtime';\nimport { getDataSource } from './scenes';\nimport { logger } from './logger';\nimport { LokiDatasource, LokiQuery } from './lokiQuery';\nimport { getDataSourceVariable, getValueFromFieldsFilter } from './variableGetters';\nimport { AdHocFiltersWithLabelsAndMeta, DetectedFieldType, VAR_LEVELS } from './variables';\nimport { isArray } from 'lodash';\nimport { FilterOp } from './filterTypes';\nimport { getFavoriteLabelValuesFromStorage } from './store';\nimport { UIVariableFilterType } from '../Components/ServiceScene/Breakdowns/AddToFiltersButton';\nimport { ExpressionBuilder } from './ExpressionBuilder';\nimport { isOperatorInclusive, isOperatorRegex } from './operatorHelpers';\n\ntype FetchDetectedLabelValuesOptions = {\n  expr?: string;\n  timeRange?: TimeRange;\n  limit?: number;\n  scopedVars?: ScopedVars;\n  throwError: boolean;\n};\n\nexport type FetchDetectedFieldsOptions = {\n  expr: string;\n  timeRange?: TimeRange;\n  limit?: number;\n  scopedVars?: ScopedVars;\n};\n\nexport type DetectedFieldsResult = Array<{\n  label: string;\n  type: DetectedFieldType;\n  cardinality: number;\n  parsers: Array<'logfmt' | 'json'> | null;\n}>;\n\nexport interface LokiLanguageProviderWithDetectedLabelValues {\n  fetchDetectedLabelValues: (\n    labelName: string,\n    queryOptions?: FetchDetectedLabelValuesOptions,\n    requestOptions?: Partial<BackendSrvRequest>\n  ) => Promise<string[] | Error>;\n\n  fetchDetectedFields: (\n    queryOptions?: FetchDetectedFieldsOptions,\n    requestOptions?: Partial<BackendSrvRequest>\n  ) => Promise<DetectedFieldsResult | Error>;\n}\n\nexport const getDetectedFieldValuesTagValuesProvider = async (\n  filter: AdHocFiltersWithLabelsAndMeta,\n  variable: AdHocFiltersVariable,\n  expr: string,\n  sceneRef: SceneObject,\n  timeRange: TimeRange,\n  variableType: UIVariableFilterType\n): Promise<{\n  replace?: boolean;\n  values: MetricFindValue[];\n}> => {\n  const datasourceUnknownType = await getDataSourceSrv().get(getDataSource(sceneRef));\n  // Narrow the DataSourceApi type to DataSourceWithBackend\n  if (!(datasourceUnknownType instanceof DataSourceWithBackend)) {\n    logger.error(new Error('getTagValuesProvider: Invalid datasource!'));\n    throw new Error('Invalid datasource!');\n  }\n\n  // Assert datasource is Loki\n  const lokiDatasource = datasourceUnknownType as LokiDatasource;\n  // Assert language provider is LokiLanguageProvider\n  const languageProvider = lokiDatasource.languageProvider as LokiLanguageProviderWithDetectedLabelValues;\n\n  let values: MetricFindValue[] = [];\n\n  if (languageProvider && languageProvider.fetchDetectedLabelValues) {\n    const options: FetchDetectedLabelValuesOptions = {\n      expr,\n      limit: 1000,\n      timeRange,\n      throwError: true,\n    };\n\n    const requestOptions: Partial<BackendSrvRequest> = {\n      showErrorAlert: false,\n    };\n\n    try {\n      let results = await languageProvider.fetchDetectedLabelValues(filter.key, options, requestOptions);\n      if (results && isArray(results)) {\n        // Always return all level values\n        if (variableType === VAR_LEVELS) {\n          return { replace: true, values: results.map((key) => ({ text: key })) };\n        }\n\n        const currentFilters = variable.state.filters;\n\n        // Remove values that are already used, if an exact match is found\n        let valuesToRemove: string[] = [];\n        currentFilters.forEach((filter) => {\n          const value = filter.valueLabels?.[0] ?? filter.value;\n          if (isOperatorRegex(filter.operator)) {\n            value.split('|').forEach((v) => valuesToRemove.push(v));\n          } else {\n            valuesToRemove.push(value);\n          }\n        });\n\n        const filteredResults = results.filter((value) => {\n          return !valuesToRemove.includes(value);\n        });\n\n        if (filter.meta?.parser !== 'structuredMetadata') {\n          if (filter.value) {\n            const valueDecoded = getValueFromFieldsFilter(filter, variableType);\n            return {\n              replace: true,\n              values: filteredResults.map((v) => ({\n                text: v,\n                value: JSON.stringify({\n                  value: v,\n                  parser: valueDecoded.parser,\n                }),\n              })),\n            };\n          } else {\n            // if the filter is wip, we trust that the parser was returned in the getTagKeys method, and added to the meta prop on the filter\n            return {\n              replace: true,\n              values: filteredResults.map((v) => ({\n                text: v,\n                value: JSON.stringify({\n                  value: v,\n                  parser: filter.meta?.parser ?? 'mixed',\n                }),\n              })),\n            };\n          }\n        } else {\n          values = filteredResults.map((r) => ({ text: r }));\n        }\n      } else {\n        values = [];\n        logger.error(results, { msg: 'fetchDetectedLabelValues error!' });\n      }\n    } catch (e) {\n      logger.error(e, {\n        msg: 'getDetectedFieldValuesTagValuesProvider: loki missing detected_field/.../values endpoint. Upgrade to Loki 3.3.0 or higher.',\n      });\n      values = [];\n    }\n  } else {\n    logger.warn(\n      'getDetectedFieldValuesTagValuesProvider: fetchDetectedLabelValues is not defined in Loki datasource. Upgrade to Grafana 11.4 or higher.'\n    );\n    values = [];\n  }\n\n  return { replace: true, values };\n};\n\nexport function tagValuesFilterAdHocFilters(\n  existingFilters: AdHocFilterWithLabels[],\n  filter: AdHocFilterWithLabels<{}>\n) {\n  let oldFiltersFiltered = existingFilters.filter(\n    (f) => !(isOperatorInclusive(filter.operator) && f.key === filter.key)\n  );\n\n  // If there aren't any inclusive filters, we need to ignore the exclusive ones as well, or Loki will throw an error\n  if (!oldFiltersFiltered.some((filter) => isOperatorInclusive(filter.operator))) {\n    oldFiltersFiltered = [];\n  }\n\n  return oldFiltersFiltered;\n}\n\nexport async function getLabelsTagValuesProvider(\n  variable: AdHocFiltersVariable,\n  filter: AdHocFilterWithLabels\n): Promise<{\n  replace?: boolean;\n  values: GetTagResponse | MetricFindValue[];\n}> {\n  const datasource_ = await getDataSourceSrv().get(getDataSource(variable));\n  if (!(datasource_ instanceof DataSourceWithBackend)) {\n    logger.error(new Error('getTagValuesProvider: Invalid datasource!'));\n    throw new Error('Invalid datasource!');\n  }\n  const datasource = datasource_ as LokiDatasource;\n\n  if (datasource && datasource.getTagValues) {\n    // Filter out other values for this key so users can include other values for this label\n    const filterTransformer = new ExpressionBuilder(variable.state.filters);\n    const filters = filterTransformer.getJoinedLabelsFilters();\n    const filtersFiltered = tagValuesFilterAdHocFilters(filters, filter);\n\n    const options: DataSourceGetTagValuesOptions<LokiQuery> = {\n      key: filter.key,\n      filters: filtersFiltered,\n    };\n\n    let results = await datasource.getTagValues(options);\n\n    if (isArray(results)) {\n      results = results.filter((result) => {\n        // Filter out values that we already have added as filters\n        return !variable.state.filters\n          .filter((f) => f.key === filter.key)\n          .some((f) => {\n            if (isOperatorRegex(f.operator)) {\n              const values = f.value.split('|');\n              return values.some((value) => value === result.text);\n            } else {\n              // If true, the results should be filtered out\n              return f.operator === FilterOp.Equal && f.value === result.text;\n            }\n          });\n      });\n      const favoriteValuesArray = getFavoriteLabelValuesFromStorage(\n        getDataSourceVariable(variable).getValue()?.toString(),\n        filter.key\n      );\n      const favoriteValuesSet = new Set(favoriteValuesArray);\n      if (favoriteValuesArray.length) {\n        results.sort((a, b) => {\n          return (favoriteValuesSet.has(b.text) ? 1 : -1) - (favoriteValuesSet.has(a.text) ? 1 : -1);\n        });\n      }\n    }\n\n    return { replace: true, values: results };\n  } else {\n    logger.error(new Error('getTagValuesProvider: missing or invalid datasource!'));\n    return { replace: true, values: [] };\n  }\n}\n","import { logger } from './logger';\nimport { LokiDatasource, LokiQuery } from './lokiQuery';\nimport {\n  DataSourceGetTagKeysOptions,\n  getDefaultTimeRange,\n  GetTagResponse,\n  KeyValue,\n  MetricFindValue,\n  ScopedVars,\n  TimeRange,\n} from '@grafana/data';\nimport { AdHocFiltersVariable, SceneObject } from '@grafana/scenes';\nimport { BackendSrvRequest, DataSourceWithBackend, getDataSourceSrv } from '@grafana/runtime';\nimport { getDataSource } from './scenes';\nimport { LABELS_TO_REMOVE } from './filters';\nimport { DetectedFieldsResult, LokiLanguageProviderWithDetectedLabelValues } from './TagValuesProviders';\nimport { LEVEL_VARIABLE_VALUE, ParserType, VAR_FIELDS_AND_METADATA, VAR_LEVELS } from './variables';\nimport { UIVariableFilterType } from '../Components/ServiceScene/Breakdowns/AddToFiltersButton';\nimport { ExpressionBuilder } from './ExpressionBuilder';\n\nexport async function getLabelsTagKeysProvider(variable: AdHocFiltersVariable): Promise<{\n  replace?: boolean;\n  values: GetTagResponse | MetricFindValue[];\n}> {\n  const datasource_ = await getDataSourceSrv().get(getDataSource(variable));\n  if (!(datasource_ instanceof DataSourceWithBackend)) {\n    logger.error(new Error('getTagKeysProvider: Invalid datasource!'));\n    throw new Error('Invalid datasource!');\n  }\n  const datasource = datasource_ as LokiDatasource;\n\n  if (datasource && datasource.getTagKeys) {\n    const filtersTransformer = new ExpressionBuilder(variable.state.filters);\n    const filters = filtersTransformer.getJoinedLabelsFilters();\n\n    const options: DataSourceGetTagKeysOptions<LokiQuery> = {\n      filters,\n    };\n\n    const tagKeys = await datasource.getTagKeys(options);\n    const result: MetricFindValue[] = Array.isArray(tagKeys) ? tagKeys : [];\n    const filteredResult = result.filter((key) => !LABELS_TO_REMOVE.includes(key.text));\n\n    return { replace: true, values: filteredResult };\n  } else {\n    logger.error(new Error('getTagKeysProvider: missing or invalid datasource!'));\n    return { replace: true, values: [] };\n  }\n}\n\ntype DetectedFieldQueryOptions = {\n  expr: string;\n  timeRange?: TimeRange;\n  limit?: number;\n  scopedVars?: ScopedVars;\n  sceneRef: SceneObject;\n  variableType: UIVariableFilterType;\n};\n\nexport async function getFieldsKeysProvider({\n  limit,\n  timeRange,\n  scopedVars,\n  expr,\n  sceneRef,\n  variableType,\n}: DetectedFieldQueryOptions): Promise<{\n  replace?: boolean;\n  values: MetricFindValue[];\n}> {\n  const datasource_ = await getDataSourceSrv().get(getDataSource(sceneRef));\n  if (!(datasource_ instanceof DataSourceWithBackend)) {\n    logger.error(new Error('getTagKeysProvider: Invalid datasource!'));\n    throw new Error('Invalid datasource!');\n  }\n  const datasource = datasource_ as LokiDatasource;\n  const languageProvider = datasource.languageProvider as LokiLanguageProviderWithDetectedLabelValues;\n\n  const options: DetectedFieldQueryOptions = {\n    expr,\n    timeRange,\n    scopedVars,\n    variableType,\n    sceneRef,\n    limit,\n  };\n\n  // @todo delete after min supported grafana is upgraded to >=11.6\n  // see ced526b3e37baded9082ffc3c2378a21201801b6 before this all got messed up\n  const fetchDetectedFieldsFn =\n    (datasource &&\n      typeof languageProvider.fetchDetectedFields === 'function' &&\n      languageProvider.fetchDetectedFields.bind(languageProvider)) ||\n    function (opts: DetectedFieldQueryOptions) {\n      return fetchDetectedFields(datasource, opts);\n    };\n\n  // fetchDetectedFields did not make the 11.5 cutoff, so is only available in 11.6, to keep this PR from needing to wait for 2 months before release, we're going to copy over the implementation into Grafana Logs Drilldown\n  if (fetchDetectedFieldsFn && typeof fetchDetectedFieldsFn === 'function') {\n    const tagKeys: DetectedFieldsResult | Error = await fetchDetectedFieldsFn(options);\n\n    if (tagKeys instanceof Error) {\n      logger.error(tagKeys, { msg: 'Failed to fetch detected fields' });\n      throw tagKeys;\n    }\n\n    const result: MetricFindValue[] = tagKeys\n      .filter((field) => {\n        if (variableType === VAR_LEVELS) {\n          return field.label === LEVEL_VARIABLE_VALUE;\n        }\n\n        if (variableType === VAR_FIELDS_AND_METADATA && field.label !== LEVEL_VARIABLE_VALUE) {\n          return true;\n        }\n\n        return field.parsers !== null;\n      })\n      .map((field) => {\n        if (variableType === VAR_FIELDS_AND_METADATA) {\n          let parser: ParserType = field.parsers?.length === 1 ? field.parsers[0] : 'mixed';\n          if (field.parsers === null) {\n            parser = 'structuredMetadata';\n          }\n\n          const type = field.type;\n\n          return {\n            text: field.label,\n            value: field.label,\n            group: parser,\n            meta: {\n              parser,\n              type,\n            },\n          };\n        }\n\n        return { text: field.label, value: field.label };\n      });\n\n    result.sort((a, b) => {\n      if (a.group === 'structuredMetadata' && b.group !== 'structuredMetadata') {\n        return -1;\n      }\n      if (a.group !== 'structuredMetadata' && b.group === 'structuredMetadata') {\n        return 1;\n      }\n      return 0;\n    });\n\n    return { replace: true, values: result };\n  } else {\n    logger.error(new Error('getTagKeysProvider: missing or invalid datasource!'));\n    return { replace: true, values: [] };\n  }\n}\n\nconst EMPTY_SELECTOR = '{}';\n// @todo delete after min supported grafana is upgraded to >=11.6\nasync function fetchDetectedFields(\n  datasource: LokiDatasource,\n  queryOptions: DetectedFieldQueryOptions,\n  requestOptions?: Partial<BackendSrvRequest>\n): Promise<DetectedFieldsResult | Error> {\n  if (!('interpolateString' in datasource) || typeof datasource?.interpolateString !== 'function') {\n    throw new Error('Datasource missing interpolateString method');\n  }\n\n  const interpolatedExpr =\n    queryOptions.expr && queryOptions.expr !== EMPTY_SELECTOR\n      ? datasource.interpolateString(queryOptions.expr, queryOptions.scopedVars)\n      : undefined;\n\n  if (!interpolatedExpr) {\n    throw new Error('fetchDetectedFields requires query expression');\n  }\n\n  const url = `detected_fields`;\n  const range = queryOptions?.timeRange ?? getDefaultTimeRange();\n  const rangeParams = datasource.getTimeRangeParams(range);\n  const { start, end } = rangeParams;\n  const params: KeyValue<string | number> = { start, end, limit: queryOptions?.limit ?? 1000 };\n  params.query = interpolatedExpr;\n\n  return new Promise(async (resolve, reject) => {\n    try {\n      const data: { limit: number; fields: DetectedFieldsResult } = await datasource.getResource(\n        url,\n        params,\n        requestOptions\n      );\n      resolve(data.fields);\n    } catch (error) {\n      console.error('error', error);\n      reject(error);\n    }\n  });\n}\n","/**\n * Originally from https://github.com/ccampbell/mousetrap\n *\n * Copyright 2012-2017 Craig Campbell\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * Mousetrap is a simple keyboard shortcut library for Javascript with\n * no external dependencies\n *\n * @version 1.6.5\n * @url craig.is/killing/mice\n */\n\ninterface ExtendedKeyboardEvent extends KeyboardEvent {\n  returnValue: boolean; // IE returnValue\n}\n\ntype MousetrapCallback = (e: ExtendedKeyboardEvent, combo: string) => boolean | void;\n\ninterface KeyInfo {\n  key: string;\n  modifiers: string[];\n  action: string;\n}\n\ninterface CallbackInfo {\n  /**\n   * Modifiers (such as `ctrl`) involved in this binding\n   */\n  modifiers: string[];\n\n  /**\n   * A single key press binding, such as `t` (for `t v`) or  `ctrl + z`\n   */\n  combo: string;\n\n  /**\n   * If this binding is a part of a sequence (`t v`, but not `ctrl + z`), this is the full sequence\n   */\n  seq?: string;\n\n  /**\n   * The event type, such as keydown, keyup, or keypress\n   */\n  action: string;\n  level: number | undefined;\n  callback: MousetrapCallback;\n}\n\n/**\n * mapping of special keycodes to their corresponding keys\n *\n * everything in this dictionary cannot use keypress events\n * so it has to be here to map to the correct keycodes for\n * keyup/keydown events\n */\nlet MAP: Record<string, string> = {\n  8: 'backspace',\n  9: 'tab',\n  13: 'enter',\n  16: 'shift',\n  17: 'ctrl',\n  18: 'alt',\n  20: 'capslock',\n  27: 'esc',\n  32: 'space',\n  33: 'pageup',\n  34: 'pagedown',\n  35: 'end',\n  36: 'home',\n  37: 'left',\n  38: 'up',\n  39: 'right',\n  40: 'down',\n  45: 'ins',\n  46: 'del',\n  91: 'meta',\n  93: 'meta',\n  224: 'meta',\n};\n\n/**\n * mapping for special characters so they can support\n *\n * this dictionary is only used incase you want to bind a\n * keyup or keydown event to one of these keys\n */\nlet KEYCODE_MAP: Record<string, string> = {\n  106: '*',\n  107: '+',\n  109: '-',\n  110: '.',\n  111: '/',\n  186: ';',\n  187: '=',\n  188: ',',\n  189: '-',\n  190: '.',\n  191: '/',\n  192: '`',\n  219: '[',\n  220: '\\\\',\n  221: ']',\n  222: \"'\",\n};\n\n/**\n * this is a mapping of keys that require shift on a US keypad\n * back to the non shift equivalents\n *\n * this is so you can use keyup events with these keys\n *\n * note that this will only work reliably on US keyboards\n */\nlet SHIFT_MAP: Record<string, string> = {\n  '~': '`',\n  '!': '1',\n  '@': '2',\n  '#': '3',\n  $: '4',\n  '%': '5',\n  '^': '6',\n  '&': '7',\n  '*': '8',\n  '(': '9',\n  ')': '0',\n  _: '-',\n  '+': '=',\n  ':': ';',\n  '\"': \"'\",\n  '<': ',',\n  '>': '.',\n  '?': '/',\n  '|': '\\\\',\n};\n\n/**\n * this is a list of special strings you can use to map\n * to modifier keys when you specify your keyboard shortcuts\n */\nlet SPECIAL_ALIASES: Record<string, string> = {\n  option: 'alt',\n  command: 'meta',\n  return: 'enter',\n  escape: 'esc',\n  plus: '+',\n  mod: /Mac|iPod|iPhone|iPad/.test(navigator.platform) ? 'meta' : 'ctrl',\n};\n\n/**\n * variable to store the flipped version of _MAP from above\n * needed to check if we should use keypress or not when no action\n * is specified\n */\nlet REVERSE_MAP: Record<string, string> | null = null;\n\n/**\n * loop through the f keys, f1 to f19 and add them to the map\n * programmatically\n */\nfor (let i = 1; i < 20; ++i) {\n  MAP[111 + i] = 'f' + i;\n}\n\n/**\n * loop through to map numbers on the numeric keypad\n */\nfor (let i = 0; i <= 9; ++i) {\n  // This needs to use a string cause otherwise since 0 is falsey\n  // mousetrap will never fire for numpad 0 pressed as part of a keydown\n  // event.\n  //\n  // @see https://github.com/ccampbell/mousetrap/pull/258\n  MAP[i + 96] = i.toString();\n}\n\n/**\n * takes the event and returns the key character\n */\nfunction characterFromEvent(event: KeyboardEvent): string {\n  // for keypress events we should return the character as is\n  if (event.type === 'keypress') {\n    let character = String.fromCharCode(event.which);\n\n    // if the shift key is not pressed then it is safe to assume\n    // that we want the character to be lowercase.  this means if\n    // you accidentally have caps lock on then your key bindings\n    // will continue to work\n    //\n    // the only side effect that might not be desired is if you\n    // bind something like 'A' cause you want to trigger an\n    // event when capital A is pressed caps lock will no longer\n    // trigger the event.  shift+a will though.\n    if (!event.shiftKey) {\n      character = character.toLowerCase();\n    }\n\n    return character;\n  }\n\n  // for non keypress events the special maps are needed\n  if (MAP[event.which]) {\n    return MAP[event.which];\n  }\n\n  if (KEYCODE_MAP[event.which]) {\n    return KEYCODE_MAP[event.which];\n  }\n\n  // if it is not in the special map\n\n  // with keydown and keyup events the character seems to always\n  // come in as an uppercase character whether you are pressing shift\n  // or not.  we should make sure it is always lowercase for comparisons\n  return String.fromCharCode(event.which).toLowerCase();\n}\n\n/**\n * checks if two arrays are equal\n */\nfunction modifiersMatch(modifiers1: string[], modifiers2: string[]): boolean {\n  return modifiers1.sort().join(',') === modifiers2.sort().join(',');\n}\n\n/**\n * takes a key event and figures out what the modifiers are\n */\nfunction eventModifiers(event: KeyboardEvent): string[] {\n  let modifiers = [];\n\n  if (event.shiftKey) {\n    modifiers.push('shift');\n  }\n\n  if (event.altKey) {\n    modifiers.push('alt');\n  }\n\n  if (event.ctrlKey) {\n    modifiers.push('ctrl');\n  }\n\n  if (event.metaKey) {\n    modifiers.push('meta');\n  }\n\n  return modifiers;\n}\n\n/**\n * prevents default for this event\n */\nfunction preventDefault(event: KeyboardEvent): void {\n  if (event.preventDefault) {\n    event.preventDefault();\n    return;\n  }\n\n  event.returnValue = false;\n}\n\n/**\n * stops propagation for this event\n */\nfunction stopPropagation(event: KeyboardEvent): void {\n  if (event.stopPropagation) {\n    event.stopPropagation();\n    return;\n  }\n\n  event.cancelBubble = true;\n}\n\n/**\n * determines if the keycode specified is a modifier key or not\n */\nfunction isModifier(key: string): boolean {\n  return key === 'shift' || key === 'ctrl' || key === 'alt' || key === 'meta';\n}\n\n/**\n * reverses the map lookup so that we can look for specific keys\n * to see what can and can't use keypress\n */\nfunction getReverseMap() {\n  if (!REVERSE_MAP) {\n    REVERSE_MAP = {};\n    for (let key in MAP) {\n      const keyNumber = parseInt(key, 10);\n      // pull out the numeric keypad from here cause keypress should\n      // be able to detect the keys from the character\n      if (keyNumber > 95 && keyNumber < 112) {\n        continue;\n      }\n\n      if (MAP.hasOwnProperty(key)) {\n        REVERSE_MAP[MAP[key]] = key;\n      }\n    }\n  }\n  return REVERSE_MAP;\n}\n\n/**\n * picks the best action based on the key combination\n */\nfunction pickBestAction(key: string, modifiers: string[], action?: string): string {\n  // if no action was picked in we should try to pick the one\n  // that we think would work best for this key\n  if (!action) {\n    action = getReverseMap()[key] ? 'keydown' : 'keypress';\n  }\n\n  // modifier keys don't work as expected with keypress,\n  // switch to keydown\n  if (action === 'keypress' && modifiers.length) {\n    action = 'keydown';\n  }\n\n  return action;\n}\n\n/**\n * Converts from a string key combination to an array\n */\nfunction keysFromString(combination: string): string[] {\n  if (combination === '+') {\n    return ['+'];\n  }\n\n  combination = combination.replace(/\\+{2}/g, '+plus');\n  return combination.split('+');\n}\n\n/**\n * Gets info for a specific key combination\n */\nfunction getKeyInfo(combination: string, action?: string): KeyInfo {\n  let keys;\n  let key;\n  let i;\n  let modifiers = [];\n\n  // take the keys from this pattern and figure out what the actual\n  // pattern is all about\n  keys = keysFromString(combination);\n\n  for (i = 0; i < keys.length; ++i) {\n    key = keys[i];\n\n    // normalize key names\n    if (SPECIAL_ALIASES[key]) {\n      key = SPECIAL_ALIASES[key];\n    }\n\n    // if this is not a keypress event then we should\n    // be smart about using shift keys\n    // this will only work for US keyboards however\n    if (action && action !== 'keypress' && SHIFT_MAP[key]) {\n      key = SHIFT_MAP[key];\n      modifiers.push('shift');\n    }\n\n    // if this key is a modifier then add it to the list of modifiers\n    if (isModifier(key)) {\n      modifiers.push(key);\n    }\n  }\n\n  if (!key) {\n    throw new Error('Unable to get key');\n  }\n\n  // depending on what the key combination is\n  // we will try to pick the best event for it\n  action = pickBestAction(key, modifiers, action);\n\n  return {\n    key: key,\n    modifiers: modifiers,\n    action: action,\n  };\n}\n\nfunction belongsTo(element: null | ParentNode | Element | Document, ancestor: Element | Document): boolean {\n  if (element === null || element === document) {\n    return false;\n  }\n\n  if (element === ancestor) {\n    return true;\n  }\n\n  return belongsTo(element.parentNode, ancestor);\n}\n\nexport class Mousetrap {\n  target: HTMLElement | Document;\n\n  /**\n   * a list of all the callbacks setup via Mousetrap.bind()\n   */\n  _callbacks: Record<string, CallbackInfo[]> = {};\n\n  /**\n   * direct map of string combinations to callbacks used for trigger()\n   */\n  _directMap: Record<string, Function> = {};\n\n  /**\n   * keeps track of what level each sequence is at since multiple\n   * sequences can start out with the same sequence\n   */\n  _sequenceLevels: Record<string, number> = {};\n\n  /**\n   * variable to store the setTimeout call\n   */\n  _resetTimer: undefined | number = undefined;\n\n  /**\n   * temporary state where we will ignore the next keyup\n   */\n  _ignoreNextKeyup: boolean | string = false;\n\n  /**\n   * temporary state where we will ignore the next keypress\n   */\n  _ignoreNextKeypress = false;\n\n  /**\n   * are we currently inside of a sequence?\n   * type of action (\"keyup\" or \"keydown\" or \"keypress\") or false\n   */\n  _nextExpectedAction: boolean | string = false;\n\n  _globalCallbacks: Record<string, boolean> = {};\n\n  constructor(el: HTMLElement | Document) {\n    this.target = el;\n\n    this.target.addEventListener('keypress', (event) => {\n      if (event instanceof KeyboardEvent) {\n        this._handleKeyEvent(event);\n      }\n    });\n    this.target.addEventListener('keydown', (event) => {\n      if (event instanceof KeyboardEvent) {\n        this._handleKeyEvent(event);\n      }\n    });\n    this.target.addEventListener('keyup', (event) => {\n      if (event instanceof KeyboardEvent) {\n        this._handleKeyEvent(event);\n      }\n    });\n  }\n\n  /**\n   * resets all sequence counters except for the ones passed in\n   */\n  private _resetSequences = (doNotReset: Record<string, number>): void => {\n    doNotReset = doNotReset || {};\n\n    let activeSequences = false,\n      key;\n\n    for (key in this._sequenceLevels) {\n      if (doNotReset[key]) {\n        activeSequences = true;\n        continue;\n      }\n      this._sequenceLevels[key] = 0;\n    }\n\n    if (!activeSequences) {\n      this._nextExpectedAction = false;\n    }\n  };\n\n  /**\n   * finds all callbacks that match based on the keycode, modifiers,\n   * and action\n   */\n  private _getMatches = (\n    character: string,\n    modifiers: string[],\n    event: Pick<KeyboardEvent, 'type' | 'metaKey' | 'ctrlKey'>,\n    sequenceName?: string,\n    combination?: string,\n    level?: number\n  ): CallbackInfo[] => {\n    let i;\n    let callback;\n    let matches = [];\n    let action = event.type;\n\n    // if there are no events related to this keycode\n    if (!this._callbacks[character]) {\n      return [];\n    }\n\n    // if a modifier key is coming up on its own we should allow it\n    if (action === 'keyup' && isModifier(character)) {\n      modifiers = [character];\n    }\n\n    // loop through all callbacks for the key that was pressed\n    // and see if any of them match\n    for (i = 0; i < this._callbacks[character].length; ++i) {\n      callback = this._callbacks[character][i];\n\n      // if a sequence name is not specified, but this is a sequence at\n      // the wrong level then move onto the next match\n      if (!sequenceName && callback.seq && this._sequenceLevels[callback.seq] !== callback.level) {\n        continue;\n      }\n\n      // if the action we are looking for doesn't match the action we got\n      // then we should keep going\n      if (action !== callback.action) {\n        continue;\n      }\n\n      // if this is a keypress event and the meta key and control key\n      // are not pressed that means that we need to only look at the\n      // character, otherwise check the modifiers as well\n      //\n      // chrome will not fire a keypress if meta or control is down\n      // safari will fire a keypress if meta or meta+shift is down\n      // firefox will fire a keypress if meta or control is down\n      if (\n        (action === 'keypress' && !event.metaKey && !event.ctrlKey) ||\n        modifiersMatch(modifiers, callback.modifiers)\n      ) {\n        // when you bind a combination or sequence a second time it\n        // should overwrite the first one.  if a sequenceName or\n        // combination is specified in this call it does just that\n        //\n        // @todo make deleting its own method?\n        let deleteCombo = !sequenceName && callback.combo === combination;\n        let deleteSequence = sequenceName && callback.seq === sequenceName && callback.level === level;\n        if (deleteCombo || deleteSequence) {\n          this._callbacks[character].splice(i, 1);\n        }\n\n        matches.push(callback);\n      }\n    }\n\n    return matches;\n  };\n\n  /**\n   * actually calls the callback function\n   *\n   * if your callback function returns false this will use the jquery\n   * convention - prevent default and stop propagation on the event\n   *\n   * @param combo Is the key binding that triggered this callback. When a sequence is triggered, this is the whole sequence. Otherwise, it's the intermediate keys\n   * @param sequence Is the 'parent sequence' of the combo. When the whole sequence is triggered, this is undefined.\n   */\n  private _fireCallback = (callback: Function, e: KeyboardEvent, combo: string, sequence?: string) => {\n    // if this event should not happen stop here\n    const target = e.target || e.srcElement;\n    if (target && target instanceof HTMLElement && this.stopCallback(e, target, combo, sequence)) {\n      return;\n    }\n\n    if (callback(e, combo) === false) {\n      preventDefault(e);\n      stopPropagation(e);\n    }\n  };\n\n  /**\n   * handles a character key event\n   */\n  private _handleKey = (character: string, modifiers: string[], e: KeyboardEvent) => {\n    let callbacks = this._getMatches(character, modifiers, e);\n    let i;\n    let doNotReset: Record<string, number> = {};\n    let maxLevel = 0;\n    let processedSequenceCallback = false;\n\n    // Calculate the maxLevel for sequences so we can only execute the longest callback sequence\n    for (i = 0; i < callbacks.length; ++i) {\n      if (callbacks[i].seq) {\n        maxLevel = Math.max(maxLevel, callbacks[i].level ?? 0);\n      }\n    }\n\n    // loop through matching callbacks for this key event\n    for (i = 0; i < callbacks.length; ++i) {\n      // fire for all sequence callbacks\n      // this is because if for example you have multiple sequences\n      // bound such as \"g i\" and \"g t\" they both need to fire the\n      // callback for matching g cause otherwise you can only ever\n      // match the first one\n      const seq = callbacks[i].seq;\n      if (seq) {\n        // only fire callbacks for the maxLevel to prevent\n        // subsequences from also firing\n        //\n        // for example 'a option b' should not cause 'option b' to fire\n        // even though 'option b' is part of the other sequence\n        //\n        // any sequences that do not match here will be discarded\n        // below by the _resetSequences call\n        if (callbacks[i].level !== maxLevel) {\n          continue;\n        }\n\n        processedSequenceCallback = true;\n\n        // keep a list of which sequences were matches for later\n        doNotReset[seq] = 1;\n        this._fireCallback(callbacks[i].callback, e, callbacks[i].combo, seq);\n\n        // When matching a callback, don't reset other callbacks that starts with this prefix\n        // This allows chaining of multiple shortcuts that share a prefix. e.g. if we have\n        // `t left` and `t right`, allow user to hit `t left`, `right` without resetting the sequence\n        const suffixPrefixIndex = seq.lastIndexOf(character);\n        const sequencePrefix = seq.slice(0, suffixPrefixIndex);\n        for (const [seq, level] of Object.entries(this._sequenceLevels)) {\n          if (level > 0 && seq.startsWith(sequencePrefix)) {\n            doNotReset[seq] = 1;\n          }\n        }\n\n        continue;\n      }\n\n      // if there were no sequence matches but we are still here\n      // that means this is a regular match so we should fire that\n      if (!processedSequenceCallback) {\n        this._fireCallback(callbacks[i].callback, e, callbacks[i].combo);\n      }\n    }\n\n    // Don't reset a sequence if this character is the start of a sequence that has already progressed.\n    // This allows `t left` to be hit immediately after a `t right`\n    for (const callback of this._callbacks[character] ?? []) {\n      if (callback.action === e.type && callback.seq && callback.level === 0) {\n        doNotReset[callback.seq] = 1;\n      }\n    }\n\n    // if the key you pressed matches the type of sequence without\n    // being a modifier (ie \"keyup\" or \"keypress\") then we should\n    // reset all sequences that were not matched by this event\n    //\n    // this is so, for example, if you have the sequence \"h a t\" and you\n    // type \"h e a r t\" it does not match.  in this case the \"e\" will\n    // cause the sequence to reset\n    //\n    // modifier keys are ignored because you can have a sequence\n    // that contains modifiers such as \"enter ctrl+space\" and in most\n    // cases the modifier key will be pressed before the next key\n    //\n    // also if you have a sequence such as \"ctrl+b a\" then pressing the\n    // \"b\" key will trigger a \"keypress\" and a \"keydown\"\n    //\n    // the \"keydown\" is expected when there is a modifier, but the\n    // \"keypress\" ends up matching the _nextExpectedAction since it occurs\n    // after and that causes the sequence to reset\n    //\n    // we ignore keypresses in a sequence that directly follow a keydown\n    // for the same character\n    let ignoreThisKeypress = e.type === 'keypress' && this._ignoreNextKeypress;\n    if (e.type === this._nextExpectedAction && !isModifier(character) && !ignoreThisKeypress) {\n      this._resetSequences(doNotReset);\n    }\n\n    this._ignoreNextKeypress = processedSequenceCallback && e.type === 'keydown';\n  };\n\n  /**\n   * handles a keydown event\n   */\n  private _handleKeyEvent = (rawEvent: Event) => {\n    if (!(rawEvent instanceof KeyboardEvent)) {\n      throw new Error(\"Didn't get a KeyboardEvent\");\n    }\n    const event: KeyboardEvent = rawEvent;\n\n    // Don't trigger shortcuts when a key is just held down\n    if (event.repeat) {\n      return;\n    }\n\n    // normalize e.which for key events\n    // @see http://stackoverflow.com/questions/4285627/javascript-keycode-vs-charcode-utter-confusion\n    if (typeof event.which !== 'number') {\n      // @ts-expect-error - TODO: determine what to do with this compat\n      event.which = event.keyCode;\n    }\n\n    let character = characterFromEvent(event);\n\n    // no character found then stop\n    if (!character) {\n      return;\n    }\n\n    // need to use === for the character check because the character can be 0\n    if (event.type === 'keyup' && this._ignoreNextKeyup === character) {\n      this._ignoreNextKeyup = false;\n      return;\n    }\n\n    this.handleKey(character, eventModifiers(event), event);\n  };\n\n  /**\n   * called to set a 1 second timeout on the specified sequence\n   *\n   * this is so after each key press in the sequence you have 1 second\n   * to press the next key before you have to start over\n   */\n  private _resetSequenceTimer = () => {\n    clearTimeout(this._resetTimer);\n    this._resetTimer = setTimeout(this._resetSequences, 1000);\n  };\n\n  /**\n   * binds a key sequence to an event\n   */\n  private _bindSequence = (combo: string, keys: string[], callback: MousetrapCallback, action?: string): void => {\n    // start off by adding a sequence level record for this combination\n    // and setting the level to 0\n    this._sequenceLevels[combo] = 0;\n\n    /**\n     * callback to increase the sequence level for this sequence and reset\n     * all other sequences that were active\n     */\n    const _increaseSequence = (nextAction: string): MousetrapCallback => {\n      return () => {\n        this._nextExpectedAction = nextAction;\n        ++this._sequenceLevels[combo];\n        this._resetSequenceTimer();\n      };\n    };\n\n    /**\n     * wraps the specified callback inside of another function in order\n     * to reset all sequence counters as soon as this sequence is done\n     */\n    const _callbackAndReset = (e: KeyboardEvent): void => {\n      this._fireCallback(callback, e, combo);\n\n      // we should ignore the next key up if the action is key down\n      // or keypress.  this is so if you finish a sequence and\n      // release the key the final key will not trigger a keyup\n      if (action !== 'keyup') {\n        this._ignoreNextKeyup = characterFromEvent(e);\n      }\n\n      // Reset the sequence timer and allow for this shortcut to be\n      // triggered again just by repeating the last key\n      this._resetSequenceTimer();\n    };\n\n    // loop through keys one at a time and bind the appropriate callback\n    // function.  for any key leading up to the final one it should\n    // increase the sequence. after the final, it should reset all sequences\n    //\n    // if an action is specified in the original bind call then that will\n    // be used throughout.  otherwise we will pass the action that the\n    // next key in the sequence should match.  this allows a sequence\n    // to mix and match keypress and keydown events depending on which\n    // ones are better suited to the key provided\n    for (let i = 0; i < keys.length; ++i) {\n      let isFinal = i + 1 === keys.length;\n      let wrappedCallback = isFinal ? _callbackAndReset : _increaseSequence(action || getKeyInfo(keys[i + 1]).action);\n      this._bindSingle(keys[i], wrappedCallback, action, combo, i);\n    }\n  };\n\n  /**\n   * binds a single keyboard combination\n   */\n  private _bindSingle = (\n    combination: string,\n    callback: MousetrapCallback,\n    action?: string,\n    sequenceName?: string,\n    level?: number\n  ): void => {\n    // store a direct mapped reference for use with Mousetrap.trigger\n    this._directMap[combination + ':' + action] = callback;\n\n    // make sure multiple spaces in a row become a single space\n    combination = combination.replace(/\\s+/g, ' ');\n\n    let sequence = combination.split(' ');\n    let info;\n\n    // if this pattern is a sequence of keys then run through this method\n    // to reprocess each pattern one key at a time\n    if (sequence.length > 1) {\n      this._bindSequence(combination, sequence, callback, action);\n      return;\n    }\n\n    info = getKeyInfo(combination, action);\n\n    // make sure to initialize array if this is the first time\n    // a callback is added for this key\n    this._callbacks[info.key] = this._callbacks[info.key] || [];\n\n    // remove an existing match if there is one\n    const eventLike = { type: info.action, metaKey: false, ctrlKey: false };\n    this._getMatches(info.key, info.modifiers, eventLike, sequenceName, combination, level);\n\n    const callbackInfo: CallbackInfo = {\n      callback: callback,\n      modifiers: info.modifiers,\n      action: info.action,\n      seq: sequenceName,\n      level: level,\n      combo: combination,\n    };\n\n    // add this call back to the array\n    // if it is a sequence put it at the beginning\n    // if not put it at the end\n    //\n    // this is important because the way these are processed expects\n    // the sequence ones to come first\n    this._callbacks[info.key][sequenceName ? 'unshift' : 'push'](callbackInfo);\n  };\n\n  /**\n   * binds multiple combinations to the same callback\n   */\n  private _bindMultiple = (combinations: string[], callback: MousetrapCallback, action: string | undefined): void => {\n    for (let i = 0; i < combinations.length; ++i) {\n      this._bindSingle(combinations[i], callback, action);\n    }\n  };\n\n  /**\n   * binds an event to mousetrap\n   *\n   * can be a single key, a combination of keys separated with +,\n   * an array of keys, or a sequence of keys separated by spaces\n   *\n   * be sure to list the modifier keys first to make sure that the\n   * correct key ends up getting bound (the last key in the pattern)\n   */\n  bind = (keys: string | string[], callback: MousetrapCallback, action?: string) => {\n    keys = keys instanceof Array ? keys : [keys];\n    this._bindMultiple(keys, callback, action);\n    return self;\n  };\n\n  /**\n   * unbinds an event to mousetrap\n   *\n   * the unbinding sets the callback function of the specified key combo\n   * to an empty function and deletes the corresponding key in the\n   * _directMap dict.\n   *\n   * TODO: actually remove this from the _callbacks dictionary instead\n   * of binding an empty function\n   *\n   * the keycombo+action has to be exactly the same as\n   * it was defined in the bind method\n   */\n  unbind = (keys: string | string[], action?: string) => {\n    return this.bind(keys, function () {}, action);\n  };\n\n  // From bind-global plugin\n  // https://github.com/Elvynia/mousetrap-global-bind/blob/master/mousetrap-global-bind.js#L28\n  bindGlobal = (keys: string | string[], callback: MousetrapCallback, action?: string) => {\n    this.bind(keys, callback, action);\n\n    if (keys instanceof Array) {\n      for (let i = 0; i < keys.length; i++) {\n        this._globalCallbacks[keys[i]] = true;\n      }\n      return;\n    }\n\n    this._globalCallbacks[keys] = true;\n  };\n\n  // From bind-global plugin\n  // https://github.com/Elvynia/mousetrap-global-bind/blob/master/mousetrap-global-bind.js#L42\n  unbindGlobal = (keys: string | string[], action?: string) => {\n    this.unbind(keys, action);\n\n    if (keys instanceof Array) {\n      for (let i = 0; i < keys.length; i++) {\n        this._globalCallbacks[keys[i]] = false;\n      }\n      return;\n    }\n\n    this._globalCallbacks[keys] = false;\n  };\n\n  /**\n   * triggers an event that has already been bound\n   */\n  trigger = (keys: string, action: string | undefined) => {\n    let self = this;\n    if (self._directMap[keys + ':' + action]) {\n      self._directMap[keys + ':' + action]({}, keys);\n    }\n    return self;\n  };\n\n  /**\n   * resets the library back to its initial state.  this is useful\n   * if you want to clear out the current keyboard shortcuts and bind\n   * new ones - for example if you switch to another page\n   */\n  reset = () => {\n    this._callbacks = {};\n    this._directMap = {};\n    return this;\n  };\n\n  /**\n   * should we stop this event before firing off callbacks\n   */\n  stopCallback = (e: Event, element: HTMLElement, combo: string, sequence?: string): boolean => {\n    // From global bind plugin https://github.com/Elvynia/mousetrap-global-bind/blob/master/mousetrap-global-bind.js\n    if (this._globalCallbacks[combo] || (sequence && this._globalCallbacks[sequence])) {\n      return false;\n    }\n\n    // if the element has the class \"mousetrap\" then no need to stop\n    if ((' ' + element.className + ' ').indexOf(' mousetrap ') > -1) {\n      return false;\n    }\n\n    if (belongsTo(element, this.target)) {\n      return false;\n    }\n\n    // Events originating from a shadow DOM are re-targetted and `e.target` is the shadow host,\n    // not the initial event target in the shadow tree. Note that not all events cross the\n    // shadow boundary.\n    // For shadow trees with `mode: 'open'`, the initial event target is the first element in\n    // the events composed path. For shadow trees with `mode: 'closed'`, the initial event\n    // target cannot be obtained.\n    if ('composedPath' in e && typeof e.composedPath === 'function') {\n      // For open shadow trees, update `element` so that the following check works.\n      let initialEventTarget = e.composedPath()[0];\n      if (initialEventTarget !== e.target && initialEventTarget instanceof HTMLElement) {\n        element = initialEventTarget;\n      }\n    }\n\n    // stop for input, select, and textarea\n    return Boolean(\n      element.tagName === 'INPUT' ||\n        element.tagName === 'SELECT' ||\n        element.tagName === 'TEXTAREA' ||\n        ('isContentEditable' in element && element.isContentEditable)\n    );\n  };\n\n  /**\n   * exposes _handleKey publicly so it can be overwritten by extensions\n   */\n  handleKey: typeof this._handleKey = (...args) => {\n    return this._handleKey(...args);\n  };\n\n  /**\n   * allow custom key mappings\n   */\n  addKeycodes = (object: Record<string, string>) => {\n    for (let key in object) {\n      if (object.hasOwnProperty(key)) {\n        MAP[key] = object[key];\n      }\n    }\n    REVERSE_MAP = null;\n  };\n}\n","import { Mousetrap } from './Mousetrap';\n\nexport const mousetrap = new Mousetrap(document);\n\nexport interface KeyBindingItem {\n  /** Key or key pattern like mod+o */\n  key: string;\n  /** Defaults to keydown */\n  type?: string;\n  /** The handler callback */\n  onTrigger: () => void;\n}\n\n/**\n * Small util to make it easier to add and unbind Mousetrap keybindings\n */\nexport class KeybindingSet {\n  private _binds: KeyBindingItem[] = [];\n\n  addBinding(item: KeyBindingItem) {\n    mousetrap.bind(\n      item.key,\n      (evt) => {\n        evt.preventDefault();\n        evt.stopPropagation();\n        evt.returnValue = false;\n        item.onTrigger();\n      },\n      'keydown'\n    );\n    this._binds.push(item);\n  }\n\n  removeAll() {\n    this._binds.forEach((item) => {\n      mousetrap.unbind(item.key, item.type);\n    });\n    this._binds = [];\n  }\n}\n","import { IndexScene } from '../Components/IndexScene/IndexScene';\nimport { KeybindingSet } from './KeybindingSet';\nimport { getAppEvents, locationService } from '@grafana/runtime';\nimport { BusEventBase, BusEventWithPayload, RawTimeRange, SetPanelAttentionEvent } from '@grafana/data';\nimport { sceneGraph, SceneObject, VizPanel } from '@grafana/scenes';\nimport { getExploreLink } from '../Components/Panels/PanelMenu';\nimport { getTimePicker } from './scenes';\nimport { OptionsWithLegend } from '@grafana/ui';\nimport { narrowTimeRange } from './narrowing';\n\nconst appEvents = getAppEvents();\n\nexport function setupKeyboardShortcuts(scene: IndexScene) {\n  const keybindings = new KeybindingSet();\n  let vizPanelKey: string | null = null;\n\n  const panelAttentionSubscription = appEvents.subscribe(SetPanelAttentionEvent, (event) => {\n    if (typeof event.payload.panelId === 'string') {\n      vizPanelKey = event.payload.panelId;\n    }\n  });\n\n  function withFocusedPanel(scene: IndexScene, fn: (vizPanel: VizPanel) => void) {\n    return () => {\n      const vizPanel = sceneGraph.findObject(scene, (o) => o.state.key === vizPanelKey && o.isActive);\n      if (vizPanel && vizPanel instanceof VizPanel) {\n        fn(vizPanel);\n        return;\n      }\n    };\n  }\n\n  function withAllPanels(scene: IndexScene, fn: (vizPanel: VizPanel) => void) {\n    return () => {\n      const vizPanels = sceneGraph.findAllObjects(scene, (o) => o instanceof VizPanel && o.isActive);\n      vizPanels.forEach((vizPanel) => {\n        if (vizPanel && vizPanel instanceof VizPanel) {\n          fn(vizPanel);\n        }\n      });\n    };\n  }\n\n  // Toggle legend\n  keybindings.addBinding({\n    key: 'p l',\n    onTrigger: withFocusedPanel(scene, toggleVizPanelLegend),\n  });\n\n  // Toggle all legend\n  keybindings.addBinding({\n    key: 'a l',\n    onTrigger: withAllPanels(scene, toggleVizPanelLegend),\n  });\n\n  // Go to Explore for panel\n  keybindings.addBinding({\n    key: 'p x',\n    onTrigger: withFocusedPanel(scene, async (vizPanel: VizPanel) => {\n      const url = getExploreLink(vizPanel);\n      if (url) {\n        locationService.push(url);\n      }\n    }),\n  });\n\n  // Copy time range\n  keybindings.addBinding({\n    key: 't c',\n    onTrigger: () => {\n      const timeRange = sceneGraph.getTimeRange(scene);\n      setWindowGrafanaSceneContext(timeRange);\n      appEvents.publish(new CopyTimeEvent());\n    },\n  });\n\n  // Paste time range\n  keybindings.addBinding({\n    key: 't v',\n    onTrigger: () => {\n      const event = new PasteTimeEvent({ updateUrl: false });\n      scene.publishEvent(event);\n      appEvents.publish(event);\n    },\n  });\n\n  // Refresh\n  keybindings.addBinding({\n    key: 'd r',\n    onTrigger: () => sceneGraph.getTimeRange(scene).onRefresh(),\n  });\n\n  // Zoom out\n  keybindings.addBinding({\n    key: 't z',\n    onTrigger: () => {\n      handleZoomOut(scene);\n    },\n  });\n\n  // Zoom out alias\n  keybindings.addBinding({\n    key: 'ctrl+z',\n    onTrigger: () => {\n      handleZoomOut(scene);\n    },\n  });\n\n  // Relative -> Absolute time range\n  keybindings.addBinding({\n    key: 't a',\n    onTrigger: () => {\n      const timePicker = getTimePicker(scene);\n      timePicker?.toAbsolute();\n    },\n  });\n\n  keybindings.addBinding({\n    key: 't left',\n    onTrigger: () => {\n      handleTimeRangeShift(scene, 'left');\n    },\n  });\n  keybindings.addBinding({\n    key: 't right',\n    onTrigger: () => {\n      handleTimeRangeShift(scene, 'right');\n    },\n  });\n  return () => {\n    keybindings.removeAll();\n    panelAttentionSubscription.unsubscribe();\n  };\n}\n\nfunction handleZoomOut(scene: IndexScene) {\n  const timePicker = getTimePicker(scene);\n  timePicker?.onZoom();\n}\n\nfunction handleTimeRangeShift(scene: IndexScene, direction: 'left' | 'right') {\n  const timePicker = getTimePicker(scene);\n\n  if (!timePicker) {\n    return;\n  }\n\n  if (direction === 'left') {\n    timePicker.onMoveBackward();\n  }\n  if (direction === 'right') {\n    timePicker.onMoveForward();\n  }\n}\n\nexport function toggleVizPanelLegend(vizPanel: VizPanel): void {\n  const options = vizPanel.state.options;\n  if (hasLegendOptions(options) && typeof options.legend.showLegend === 'boolean') {\n    vizPanel.onOptionsChange({\n      legend: {\n        showLegend: options.legend.showLegend ? false : true,\n      },\n    });\n  }\n}\n\nfunction hasLegendOptions(optionsWithLegend: unknown): optionsWithLegend is OptionsWithLegend {\n  return optionsWithLegend != null && typeof optionsWithLegend === 'object' && 'legend' in optionsWithLegend;\n}\n\n// Copied from https://github.com/grafana/grafana/blob/main/public/app/types/events.ts\n// @todo export from core grafana\nexport class CopyTimeEvent extends BusEventBase {\n  static type = 'copy-time';\n}\n\n// Copied from https://github.com/grafana/grafana/blob/main/public/app/types/events.ts\n// @todo export from core grafana\ninterface PasteTimeEventPayload {\n  updateUrl?: boolean;\n  timeRange?: string;\n}\n\n// Copied from https://github.com/grafana/grafana/blob/main/public/app/types/events.ts\n// @todo export from core grafana\nexport class PasteTimeEvent extends BusEventWithPayload<PasteTimeEventPayload> {\n  static type = 'paste-time';\n}\n\n/**\n * Adds the scene object to the global window state so that templateSrv in core can interpolate strings using the scene interpolation engine with the scene as scope.\n * This is needed for old datasources that call templateSrv.replace without passing scopedVars. For example in DataSourceAPI.metricFindQuery.\n *\n * This is also used from TimeSrv to access scene time range.\n *\n * @todo delete after https://github.com/grafana/scenes/pull/999 is available\n */\nexport function setWindowGrafanaSceneContext(activeScene: SceneObject) {\n  const prevScene = (window as any).__grafanaSceneContext;\n\n  (window as any).__grafanaSceneContext = activeScene;\n\n  return () => {\n    if ((window as any).__grafanaSceneContext === activeScene) {\n      (window as any).__grafanaSceneContext = prevScene;\n    }\n  };\n}\n\n// taken from /Users/galen/projects/grafana/grafana/public/app/core/utils/timePicker.ts\ntype CopiedTimeRangeResult = { range: RawTimeRange; isError: false } | { range: string; isError: true };\n// modified to narrow types from clipboard\nexport async function getCopiedTimeRange(): Promise<CopiedTimeRangeResult> {\n  const raw = await navigator.clipboard.readText();\n  let unknownRange: unknown;\n\n  try {\n    unknownRange = JSON.parse(raw);\n    const range = narrowTimeRange(unknownRange);\n    if (range) {\n      return { isError: false, range };\n    }\n  } catch (e) {}\n  return { range: raw, isError: true };\n}\n","import React from 'react';\nimport { useStyles2, useTheme2 } from '@grafana/ui';\nimport SVG from 'react-inlinesvg';\nimport { GrafanaTheme2, locationUtil } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nexport const NoLokiSplash = () => {\n  const styles = useStyles2(getStyles);\n  const theme = useTheme2();\n  return (\n    <div className={styles.wrap}>\n      <div className={styles.graphicContainer}>\n        <SVG\n          src={\n            theme.isDark\n              ? `/public/plugins/grafana-lokiexplore-app/img/grot_loki.svg`\n              : `/public/plugins/grafana-lokiexplore-app/img/grot_loki.svg`\n          }\n        />\n      </div>\n      <div className={styles.text}>\n        <h3 className={styles.title}>Welcome to Grafana Logs Drilldown</h3>\n\n        <p>\n          We noticed there is no Loki datasource configured.\n          <br />\n          Add a{' '}\n          <a className={'external-link'} href={locationUtil.assureBaseUrl(`/connections/datasources/new`)}>\n            Loki datasource\n          </a>{' '}\n          to view logs.\n        </p>\n\n        <br />\n\n        <p>\n          Click{' '}\n          <a\n            href={'https://grafana.com/docs/grafana/latest/explore/simplified-exploration/logs/'}\n            target={'_blank'}\n            className={'external-link'}\n            rel=\"noreferrer\"\n          >\n            here\n          </a>{' '}\n          to learn more...\n        </p>\n      </div>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    graphicContainer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      margin: '0 auto',\n      width: '200px',\n      height: '250px',\n      padding: theme.spacing(1),\n      [theme.breakpoints.up('md')]: {\n        alignSelf: 'flex-end',\n        width: '300px',\n        height: 'auto',\n        padding: theme.spacing(1),\n      },\n      [theme.breakpoints.up('lg')]: {\n        alignSelf: 'flex-end',\n        width: '400px',\n        height: 'auto',\n        padding: theme.spacing(1),\n      },\n    }),\n\n    text: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      flexDirection: 'column',\n    }),\n    title: css({\n      marginBottom: '1.5rem',\n    }),\n    wrap: css({\n      [theme.breakpoints.up('md')]: {\n        margin: '4rem auto auto auto',\n        flexDirection: 'row',\n      },\n      padding: '2rem',\n      margin: '0 auto auto auto',\n      display: 'flex',\n      alignItems: 'center',\n      flexDirection: 'column',\n      textAlign: 'center',\n    }),\n  };\n};\n","import React from 'react';\n\nimport { AdHocVariableFilter, AppEvents, AppPluginMeta, rangeUtil } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  AdHocFilterWithLabels,\n  CustomVariable,\n  DataSourceVariable,\n  SceneComponentProps,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  SceneTimeRangeLike,\n  SceneTimeRangeState,\n  SceneVariableSet,\n} from '@grafana/scenes';\nimport {\n  AppliedPattern,\n  AdHocFiltersWithLabelsAndMeta,\n  EXPLORATION_DS,\n  MIXED_FORMAT_EXPR,\n  PENDING_FIELDS_EXPR,\n  PENDING_METADATA_EXPR,\n  VAR_DATASOURCE,\n  VAR_FIELDS,\n  VAR_FIELDS_AND_METADATA,\n  VAR_LABELS,\n  VAR_LEVELS,\n  VAR_LINE_FILTER,\n  VAR_LINE_FILTERS,\n  VAR_LOGS_FORMAT,\n  VAR_METADATA,\n  VAR_PATTERNS,\n} from 'services/variables';\n\nimport { addLastUsedDataSourceToStorage, getLastUsedDataSourceFromStorage } from 'services/store';\nimport { ServiceScene } from '../ServiceScene/ServiceScene';\nimport {\n  CONTROLS_VARS_DATASOURCE,\n  CONTROLS_VARS_FIELDS,\n  CONTROLS_VARS_FIELDS_COMBINED,\n  CONTROLS_VARS_FIRST_ROW_KEY,\n  CONTROLS_VARS_LABELS,\n  CONTROLS_VARS_METADATA_ROW_KEY,\n  CONTROLS_VARS_REFRESH,\n  CONTROLS_VARS_TIMEPICKER,\n  CONTROLS_VARS_TOOLBAR,\n  LayoutScene,\n} from './LayoutScene';\nimport { getDrilldownSlug, PageSlugs } from '../../services/routing';\nimport { ServiceSelectionScene } from '../ServiceSelectionScene/ServiceSelectionScene';\nimport { LoadingPlaceholder } from '@grafana/ui';\nimport { config, getAppEvents, locationService } from '@grafana/runtime';\nimport {\n  onAddCustomAdHocValue,\n  onAddCustomFieldValue,\n  renderLevelsFilter,\n  renderLogQLFieldFilters,\n  renderLogQLLabelFilters,\n  renderLogQLLineFilter,\n  renderLogQLMetadataFilters,\n} from 'services/query';\nimport { VariableHide } from '@grafana/schema';\nimport { CustomConstantVariable } from '../../services/CustomConstantVariable';\nimport {\n  getDataSourceVariable,\n  getFieldsAndMetadataVariable,\n  getFieldsVariable,\n  getLabelsVariable,\n  getLevelsVariable,\n  getMetadataVariable,\n  getPatternsVariable,\n  getUrlParamNameForVariable,\n} from '../../services/variableGetters';\nimport { ToolbarScene } from './ToolbarScene';\nimport { DEFAULT_TIME_RANGE, OptionalRouteMatch } from '../Pages';\nimport { plugin } from '../../module';\nimport { JsonData } from '../AppConfig/AppConfig';\nimport { reportAppInteraction } from '../../services/analytics';\nimport { getDetectedFieldValuesTagValuesProvider, getLabelsTagValuesProvider } from '../../services/TagValuesProviders';\nimport { logger } from '../../services/logger';\nimport { getFieldsKeysProvider, getLabelsTagKeysProvider } from '../../services/TagKeysProviders';\nimport { getLokiDatasource } from '../../services/scenes';\nimport { ShowLogsButtonScene } from './ShowLogsButtonScene';\nimport { CustomVariableValueSelectors } from './CustomVariableValueSelectors';\nimport { getCopiedTimeRange, PasteTimeEvent, setupKeyboardShortcuts } from '../../services/keyboardShortcuts';\nimport { LokiDatasource } from '../../services/lokiQuery';\nimport { lineFilterOperators, operators } from '../../services/operators';\nimport { operatorFunction } from '../../services/variableHelpers';\nimport { FilterOp } from '../../services/filterTypes';\nimport { areArraysEqual } from '../../services/comparison';\nimport { isFilterMetadata } from '../../services/filters';\nimport { getFieldsTagValuesExpression } from '../../services/expressions';\nimport { isOperatorInclusive } from '../../services/operatorHelpers';\nimport { renderPatternFilters } from '../../services/renderPatternFilters';\nimport { NoLokiSplash } from '../NoLokiSplash';\n\nexport const showLogsButtonSceneKey = 'showLogsButtonScene';\n\nexport interface IndexSceneState extends SceneObjectState {\n  // contentScene is the scene that is displayed in the main body of the index scene - it can be either the service selection or service scene\n  contentScene?: SceneObject;\n  controls: SceneObject[];\n  body?: LayoutScene;\n  initialFilters?: AdHocVariableFilter[];\n  patterns?: AppliedPattern[];\n  routeMatch?: OptionalRouteMatch;\n  ds?: LokiDatasource;\n}\n\nexport class IndexScene extends SceneObjectBase<IndexSceneState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['patterns'] });\n\n  public constructor(state: Partial<IndexSceneState>) {\n    const { variablesScene, unsub } = getVariableSet(\n      getLastUsedDataSourceFromStorage() ?? 'grafanacloud-logs',\n      state.initialFilters\n    );\n\n    const controls: SceneObject[] = [\n      new SceneFlexLayout({\n        key: CONTROLS_VARS_FIRST_ROW_KEY,\n        direction: 'row',\n        children: [\n          new SceneFlexItem({\n            body: new CustomVariableValueSelectors({\n              key: CONTROLS_VARS_LABELS,\n              layout: 'vertical',\n              include: [VAR_LABELS],\n            }),\n          }),\n          new ShowLogsButtonScene({\n            key: showLogsButtonSceneKey,\n            disabled: true,\n          }),\n        ],\n      }),\n      new CustomVariableValueSelectors({\n        key: CONTROLS_VARS_METADATA_ROW_KEY,\n        layout: 'vertical',\n        include: [VAR_METADATA],\n      }),\n      new CustomVariableValueSelectors({\n        key: CONTROLS_VARS_FIELDS,\n        layout: 'vertical',\n        include: [VAR_FIELDS],\n      }),\n      new CustomVariableValueSelectors({\n        key: CONTROLS_VARS_DATASOURCE,\n        layout: 'horizontal',\n        include: [VAR_DATASOURCE],\n      }),\n      new CustomVariableValueSelectors({\n        key: CONTROLS_VARS_FIELDS_COMBINED,\n        layout: 'vertical',\n        include: [VAR_FIELDS_AND_METADATA],\n      }),\n      new SceneTimePicker({ key: CONTROLS_VARS_TIMEPICKER }),\n      new SceneRefreshPicker({ key: CONTROLS_VARS_REFRESH }),\n    ];\n\n    if (getDrilldownSlug() === 'explore' && config.featureToggles.exploreLogsAggregatedMetrics) {\n      controls.push(\n        new ToolbarScene({\n          key: CONTROLS_VARS_TOOLBAR,\n          isOpen: false,\n        })\n      );\n    }\n\n    super({\n      $timeRange: state.$timeRange ?? new SceneTimeRange({}),\n      $variables: state.$variables ?? variablesScene,\n      controls: state.controls ?? controls,\n      // Need to clear patterns state when the class in constructed\n      patterns: [],\n      ...state,\n      body: new LayoutScene({}),\n    });\n\n    this._subs.add(unsub);\n    this.addActivationHandler(this.onActivate.bind(this));\n\n    getLokiDatasource(this).then((ds) => {\n      this.setState({ ds });\n    });\n  }\n\n  static Component = ({ model }: SceneComponentProps<IndexScene>) => {\n    const { body } = model.useState();\n\n    const dsVar = getDataSourceVariable(model);\n    if (!dsVar.state.options.length) {\n      return <NoLokiSplash />;\n    }\n\n    if (body) {\n      return <body.Component model={body} />;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n\n  public onActivate() {\n    const stateUpdate: Partial<IndexSceneState> = {};\n    this.setVariableProviders();\n\n    // Show \"show logs\" button\n    const showLogsButton = sceneGraph.findByKeyAndType(this, showLogsButtonSceneKey, ShowLogsButtonScene);\n    showLogsButton.setState({ hidden: false });\n\n    if (!this.state.contentScene) {\n      stateUpdate.contentScene = getContentScene(this.state.routeMatch?.params.breakdownLabel);\n    }\n    this.setTagProviders();\n    this.setState(stateUpdate);\n\n    this.updatePatterns(this.state, getPatternsVariable(this));\n    this.resetVariablesIfNotInUrl(getFieldsVariable(this), getUrlParamNameForVariable(VAR_FIELDS));\n    this.resetVariablesIfNotInUrl(getLevelsVariable(this), getUrlParamNameForVariable(VAR_LEVELS));\n\n    this._subs.add(\n      this.subscribeToState((newState) => {\n        this.updatePatterns(newState, getPatternsVariable(this));\n      })\n    );\n\n    const timeRange = sceneGraph.getTimeRange(this);\n\n    this._subs.add(timeRange.subscribeToState(this.limitMaxInterval(timeRange)));\n    this._subs.add(this.subscribeToEvent(PasteTimeEvent, this.subscribeToPasteTimeEvent));\n\n    const fieldFilters = getFieldsVariable(this).state.filters;\n    const metadataFilters = getMetadataVariable(this).state.filters;\n\n    const fieldsAndMetadataVariable = getFieldsAndMetadataVariable(this);\n\n    // Sync fields in query variables to support existing urls\n    fieldsAndMetadataVariable.updateFilters([...metadataFilters, ...fieldFilters]);\n\n    // Update the fields/metadata filters when the combined variable is changed in the variable UI.\n    this._subs.add(fieldsAndMetadataVariable.subscribeToState(this.subscribeToCombinedFieldsVariable));\n\n    const clearKeyBindings = setupKeyboardShortcuts(this);\n\n    return () => {\n      clearKeyBindings();\n    };\n  }\n\n  private subscribeToCombinedFieldsVariable = (\n    newState: AdHocFiltersVariable['state'],\n    prevState?: AdHocFiltersVariable['state']\n  ) => {\n    if (!areArraysEqual(newState.filters, prevState?.filters)) {\n      const metadataFilters = newState.filters.filter((f: AdHocFiltersWithLabelsAndMeta) => isFilterMetadata(f));\n      const fieldFilters = newState.filters.filter((f: AdHocFiltersWithLabelsAndMeta) => !isFilterMetadata(f));\n\n      getFieldsVariable(this).updateFilters(fieldFilters);\n      getMetadataVariable(this).updateFilters(metadataFilters);\n    }\n  };\n\n  private setTagProviders() {\n    this.setLabelsProviders();\n  }\n\n  private setLabelsProviders() {\n    const labelsVar = getLabelsVariable(this);\n\n    labelsVar._getOperators = () => operatorFunction(labelsVar);\n\n    labelsVar.setState({\n      getTagKeysProvider: getLabelsTagKeysProvider,\n      getTagValuesProvider: getLabelsTagValuesProvider,\n    });\n  }\n\n  private subscribeToPasteTimeEvent = async () => {\n    const copiedRange = await getCopiedTimeRange();\n\n    if (copiedRange.isError) {\n      return;\n    }\n\n    const timeRange = sceneGraph.getTimeRange(this);\n    const to = typeof copiedRange.range.to === 'string' ? copiedRange.range.to : undefined;\n    const from = typeof copiedRange.range.from === 'string' ? copiedRange.range.from : undefined;\n    const newRange = rangeUtil.convertRawToRange(copiedRange.range);\n\n    if (timeRange && newRange) {\n      timeRange.setState({\n        value: newRange,\n        to,\n        from,\n      });\n    } else {\n      logger.error(new Error('Invalid time range from clipboard'), {\n        msg: 'Invalid time range from clipboard',\n        sceneTimeRange: typeof timeRange,\n        to: to ?? '',\n        from: from ?? '',\n      });\n    }\n  };\n\n  /**\n   * If user selects a time range longer then the max configured interval, show toast and set the previous time range.\n   * @param timeRange\n   * @private\n   */\n  private limitMaxInterval(timeRange: SceneTimeRangeLike) {\n    return (newState: SceneTimeRangeState, prevState: SceneTimeRangeState) => {\n      const { jsonData } = plugin.meta as AppPluginMeta<JsonData>;\n      if (jsonData?.interval) {\n        try {\n          const maxInterval = rangeUtil.intervalToSeconds(jsonData?.interval ?? '');\n          if (!maxInterval) {\n            return;\n          }\n          const timeRangeInterval = newState.value.to.diff(newState.value.from, 'seconds');\n          if (timeRangeInterval > maxInterval) {\n            const prevInterval = prevState.value.to.diff(prevState.value.from, 'seconds');\n            if (timeRangeInterval <= prevInterval) {\n              timeRange.setState({\n                value: prevState.value,\n                from: prevState.from,\n                to: prevState.to,\n              });\n            } else {\n              const defaultRange = new SceneTimeRange(DEFAULT_TIME_RANGE);\n              timeRange.setState({\n                value: defaultRange.state.value,\n                from: defaultRange.state.from,\n                to: defaultRange.state.to,\n              });\n            }\n\n            const appEvents = getAppEvents();\n            appEvents.publish({\n              type: AppEvents.alertWarning.name,\n              payload: [`Time range interval exceeds maximum interval configured by the administrator.`],\n            });\n\n            reportAppInteraction('all', 'interval_too_long', {\n              attempted_duration_seconds: timeRangeInterval,\n              configured_max_interval: maxInterval,\n            });\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    };\n  }\n\n  private setVariableProviders() {\n    const levelsVariable = getLevelsVariable(this);\n    const fieldsCombinedVariable = getFieldsAndMetadataVariable(this);\n\n    fieldsCombinedVariable._getOperators = () => operatorFunction(fieldsCombinedVariable);\n\n    levelsVariable.setState({\n      getTagValuesProvider: this.getLevelsTagValuesProvider(),\n      getTagKeysProvider: this.getLevelsTagKeysProvider(),\n    });\n\n    fieldsCombinedVariable.setState({\n      getTagKeysProvider: this.getCombinedFieldsTagKeysProvider(),\n      getTagValuesProvider: this.getCombinedFieldsTagValuesProvider(),\n    });\n  }\n\n  /**\n   * Get tag keys (label names) for the combined fields variable\n   */\n  private getCombinedFieldsTagKeysProvider() {\n    return (variable: AdHocFiltersVariable, currentKey: string | null) => {\n      // Current key seems to always be null, I think it's only supported for other variable types that allow editing the key without first removing the value/operator?\n      const metadataVar = getMetadataVariable(this);\n      const fieldVar = getFieldsVariable(this);\n\n      const uninterpolatedExpression = getFieldsTagValuesExpression(VAR_FIELDS_AND_METADATA);\n\n      const metadataFilters = metadataVar.state.filters.filter((f) => f.key !== currentKey);\n      const fieldFilters = fieldVar.state.filters.filter((f) => f.key !== currentKey);\n      const otherFiltersString = this.renderVariableFilters(VAR_FIELDS, fieldFilters);\n      const otherMetadataString = this.renderVariableFilters(VAR_METADATA, metadataFilters);\n      const expr = uninterpolatedExpression\n        .replace(PENDING_FIELDS_EXPR, otherFiltersString)\n        .replace(PENDING_METADATA_EXPR, otherMetadataString);\n      const interpolated = sceneGraph.interpolate(this, expr);\n\n      return getFieldsKeysProvider({\n        expr: interpolated,\n        sceneRef: this,\n        timeRange: sceneGraph.getTimeRange(this).state.value,\n        variableType: VAR_FIELDS_AND_METADATA,\n      });\n    };\n  }\n\n  /**\n   * Get tag values (label values) for combined fields variable\n   */\n  private getCombinedFieldsTagValuesProvider() {\n    return (variable: AdHocFiltersVariable, filter: AdHocFilterWithLabels) => {\n      const uninterpolatedExpression = getFieldsTagValuesExpression(VAR_FIELDS_AND_METADATA);\n      const metadataVar = getMetadataVariable(this);\n      const fieldVar = getFieldsVariable(this);\n\n      const metadataFilters = metadataVar.state.filters.filter(\n        (f) => f.key !== filter.key && isOperatorInclusive(f.operator)\n      );\n      const fieldFilters = fieldVar.state.filters.filter(\n        (f) => f.key !== filter.key && isOperatorInclusive(f.operator)\n      );\n\n      const otherFiltersString = this.renderVariableFilters(VAR_FIELDS, fieldFilters);\n      const otherMetadataString = this.renderVariableFilters(VAR_METADATA, metadataFilters);\n\n      const expr = uninterpolatedExpression\n        .replace(PENDING_FIELDS_EXPR, otherFiltersString)\n        .replace(PENDING_METADATA_EXPR, otherMetadataString);\n      const interpolated = sceneGraph.interpolate(this, expr);\n\n      return getDetectedFieldValuesTagValuesProvider(\n        filter,\n        variable,\n        interpolated,\n        this,\n        sceneGraph.getTimeRange(this).state.value,\n        VAR_FIELDS_AND_METADATA\n      );\n    };\n  }\n\n  /**\n   * Get tag keys (label names) for levels variable\n   */\n  private getLevelsTagKeysProvider() {\n    return (variable: AdHocFiltersVariable, currentKey: string | null) => {\n      // Current key seems to always be null, I think it's only supported for other variable types that allow editing the key without first removing the value/operator?\n      const filters = variable.state.filters.filter((f) => f.key !== currentKey);\n      const otherFiltersString = this.renderVariableFilters(VAR_LEVELS, filters);\n      const uninterpolatedExpression = getFieldsTagValuesExpression(VAR_LEVELS);\n      const expr = uninterpolatedExpression.replace(PENDING_FIELDS_EXPR, otherFiltersString);\n      const interpolated = sceneGraph.interpolate(this, expr);\n      return getFieldsKeysProvider({\n        expr: interpolated,\n        sceneRef: this,\n        timeRange: sceneGraph.getTimeRange(this).state.value,\n        variableType: VAR_LEVELS,\n      });\n    };\n  }\n\n  /**\n   * Get tag values (label values) for levels variable\n   */\n  private getLevelsTagValuesProvider() {\n    return (variable: AdHocFiltersVariable, filter: AdHocFilterWithLabels) => {\n      // Don't add equals operations to the query, the user might want to select more than one value\n      const filters = variable.state.filters.filter((f) => f.key !== filter.key && f.operator === FilterOp.Equal);\n      const otherFiltersString = this.renderVariableFilters(VAR_LEVELS, filters);\n      const uninterpolatedExpression = getFieldsTagValuesExpression(VAR_LEVELS);\n      const expr = uninterpolatedExpression.replace(PENDING_FIELDS_EXPR, otherFiltersString);\n      const interpolated = sceneGraph.interpolate(this, expr);\n\n      return getDetectedFieldValuesTagValuesProvider(\n        filter,\n        variable,\n        interpolated,\n        this,\n        sceneGraph.getTimeRange(this).state.value,\n        VAR_LEVELS\n      );\n    };\n  }\n\n  private renderVariableFilters(\n    variableType: typeof VAR_FIELDS | typeof VAR_METADATA | typeof VAR_LEVELS,\n    filters: AdHocFilterWithLabels[]\n  ) {\n    if (variableType === VAR_FIELDS) {\n      return renderLogQLFieldFilters(filters);\n    } else if (variableType === VAR_METADATA) {\n      return renderLogQLMetadataFilters(filters);\n    } else if (variableType === VAR_LEVELS) {\n      return renderLogQLMetadataFilters(filters);\n    } else {\n      const error = new Error('getFieldsTagValuesProvider only supports fields, metadata, and levels');\n      logger.error(error);\n      throw error;\n    }\n  }\n\n  /**\n   * @todo why do we need to manually sync fields and levels, but not other ad hoc variables?\n   * @param variable\n   * @param urlParamName\n   * @private\n   */\n  private resetVariablesIfNotInUrl(variable: AdHocFiltersVariable, urlParamName: string) {\n    const location = locationService.getLocation();\n    const search = new URLSearchParams(location.search);\n    const filtersFromUrl = search.get(urlParamName);\n\n    // If the filters aren't in the URL, then they're coming from the cache, set the state to sync with url\n    if (filtersFromUrl === null) {\n      variable.setState({ filters: [] });\n    }\n  }\n\n  private updatePatterns(newState: IndexSceneState, patternsVariable: CustomVariable) {\n    const patternsLine = renderPatternFilters(newState.patterns ?? []);\n    patternsVariable.changeValueTo(patternsLine);\n  }\n\n  getUrlState() {\n    return {\n      patterns: JSON.stringify(this.state.patterns),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<IndexSceneState> = {};\n\n    if (values.patterns && typeof values.patterns === 'string') {\n      stateUpdate.patterns = JSON.parse(values.patterns) as AppliedPattern[];\n    }\n\n    this.setState(stateUpdate);\n  }\n}\n\nfunction getContentScene(drillDownLabel?: string) {\n  const slug = getDrilldownSlug();\n  if (slug === PageSlugs.explore) {\n    return new ServiceSelectionScene({});\n  }\n\n  return new ServiceScene({\n    drillDownLabel,\n  });\n}\n\nfunction getVariableSet(initialDatasourceUid: string, initialFilters?: AdHocVariableFilter[]) {\n  const labelVariable = new AdHocFiltersVariable({\n    name: VAR_LABELS,\n    datasource: EXPLORATION_DS,\n    layout: 'combobox',\n    label: 'Labels',\n    allowCustomValue: true,\n    filters: initialFilters ?? [],\n    expressionBuilder: renderLogQLLabelFilters,\n    hide: VariableHide.dontHide,\n    key: 'adhoc_service_filter',\n    onAddCustomValue: onAddCustomAdHocValue,\n  });\n\n  labelVariable._getOperators = function () {\n    return operators;\n  };\n\n  const fieldsVariable = new AdHocFiltersVariable({\n    name: VAR_FIELDS,\n    label: 'Detected fields',\n    applyMode: 'manual',\n    layout: 'combobox',\n    expressionBuilder: renderLogQLFieldFilters,\n    hide: VariableHide.hideVariable,\n    allowCustomValue: true,\n  });\n\n  fieldsVariable._getOperators = () => {\n    return operators;\n  };\n\n  const metadataVariable = new AdHocFiltersVariable({\n    name: VAR_METADATA,\n    label: 'Metadata',\n    applyMode: 'manual',\n    layout: 'combobox',\n    expressionBuilder: (filters: AdHocFilterWithLabels[]) => renderLogQLMetadataFilters(filters),\n    hide: VariableHide.hideVariable,\n    allowCustomValue: true,\n  });\n\n  metadataVariable._getOperators = () => {\n    return operators;\n  };\n\n  /**\n   * Not used in interpolation, used as \"proxy\" variable that routes filters added in the variable UI\n   * to the fields and metadata variables which are interpolated but not present in the UI.\n   *\n   * Not saved in the URL state, as on init we pull the values from the fields/metadata variables\n   */\n  const fieldsAndMetadataVariable = new AdHocFiltersVariable({\n    name: VAR_FIELDS_AND_METADATA,\n    label: 'Fields',\n    applyMode: 'manual',\n    layout: 'combobox',\n    hide: VariableHide.hideVariable,\n    allowCustomValue: true,\n    onAddCustomValue: onAddCustomFieldValue,\n    skipUrlSync: true,\n  });\n\n  const levelsVariable = new AdHocFiltersVariable({\n    name: VAR_LEVELS,\n    label: 'Error levels',\n    applyMode: 'manual',\n    layout: 'vertical',\n    expressionBuilder: renderLevelsFilter,\n    hide: VariableHide.hideVariable,\n    supportsMultiValueOperators: true,\n  });\n\n  const lineFiltersVariable = new AdHocFiltersVariable({\n    name: VAR_LINE_FILTERS,\n    hide: VariableHide.hideVariable,\n    getTagKeysProvider: () => Promise.resolve({ replace: true, values: [] }),\n    getTagValuesProvider: () => Promise.resolve({ replace: true, values: [] }),\n    expressionBuilder: renderLogQLLineFilter,\n    layout: 'horizontal',\n  });\n\n  lineFiltersVariable._getOperators = () => {\n    return lineFilterOperators;\n  };\n\n  const dsVariable = new DataSourceVariable({\n    name: VAR_DATASOURCE,\n    label: 'Data source',\n    value: initialDatasourceUid,\n    pluginId: 'loki',\n  });\n\n  const unsub = dsVariable.subscribeToState((newState) => {\n    const dsValue = `${newState.value}`;\n    newState.value && addLastUsedDataSourceToStorage(dsValue);\n  });\n\n  return {\n    variablesScene: new SceneVariableSet({\n      variables: [\n        dsVariable,\n        labelVariable,\n        fieldsVariable,\n        levelsVariable,\n        metadataVariable,\n        fieldsAndMetadataVariable,\n        new CustomVariable({\n          name: VAR_PATTERNS,\n          value: '',\n          hide: VariableHide.hideVariable,\n        }),\n        new AdHocFiltersVariable({\n          name: VAR_LINE_FILTER,\n          hide: VariableHide.hideVariable,\n          expressionBuilder: renderLogQLLineFilter,\n        }),\n        lineFiltersVariable,\n\n        // This variable is a hack to get logs context working, this variable should never be used or updated\n        new CustomConstantVariable({\n          name: VAR_LOGS_FORMAT,\n          value: MIXED_FORMAT_EXPR,\n          skipUrlSync: true,\n          hide: VariableHide.hideVariable,\n          options: [{ value: MIXED_FORMAT_EXPR, label: MIXED_FORMAT_EXPR }],\n        }),\n      ],\n    }),\n    unsub,\n  };\n}\n","import {\n  ControlsLabel,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneVariableValueChangedEvent,\n} from '@grafana/scenes';\nimport React from 'react';\nimport { getLevelsVariable } from '../../services/variableGetters';\nimport { GrafanaTheme2, MetricFindValue, SelectableValue } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { Icon, MultiSelect, useStyles2 } from '@grafana/ui';\nimport { LEVEL_VARIABLE_VALUE } from '../../services/variables';\nimport { FilterOp } from '../../services/filterTypes';\nimport { testIds } from '../../services/testIds';\nimport { addCurrentUrlToHistory } from '../../services/navigate';\n\ntype ChipOption = MetricFindValue & { selected?: boolean };\nexport interface LevelsVariableSceneState extends SceneObjectState {\n  options?: ChipOption[];\n  isLoading: boolean;\n  visible: boolean;\n  isOpen: boolean;\n}\nexport const LEVELS_VARIABLE_SCENE_KEY = 'levels-var-custom-renderer';\nexport class LevelsVariableScene extends SceneObjectBase<LevelsVariableSceneState> {\n  constructor(state: Partial<LevelsVariableSceneState>) {\n    super({ ...state, isLoading: false, visible: false, key: LEVELS_VARIABLE_SCENE_KEY, isOpen: false });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.onFilterChange();\n\n    this._subs.add(\n      getLevelsVariable(this).subscribeToEvent(SceneVariableValueChangedEvent, () => {\n        this.onFilterChange();\n      })\n    );\n  }\n\n  public onFilterChange() {\n    const levelsVar = getLevelsVariable(this);\n    this.setState({\n      options: levelsVar.state.filters.map((filter) => ({\n        text: filter.valueLabels?.[0] ?? filter.value,\n        selected: true,\n        value: filter.value,\n      })),\n    });\n  }\n\n  getTagValues = () => {\n    this.setState({ isLoading: true });\n    const levelsVar = getLevelsVariable(this);\n    const levelsKeys = levelsVar?.state?.getTagValuesProvider?.(\n      levelsVar,\n      levelsVar.state.filters[0] ?? { key: LEVEL_VARIABLE_VALUE }\n    );\n    levelsKeys?.then((response) => {\n      if (Array.isArray(response.values)) {\n        this.setState({\n          isLoading: false,\n          options: response.values.map((value) => {\n            return {\n              text: value.text,\n              value: value.value ?? value.text,\n              selected: levelsVar.state.filters.some((filter) => filter.value === value.text),\n            };\n          }),\n        });\n      }\n    });\n  };\n\n  updateFilters = (skipPublish: boolean, forcePublish?: boolean) => {\n    const levelsVar = getLevelsVariable(this);\n    const filterOptions = this.state.options?.filter((opt) => opt.selected);\n\n    levelsVar.updateFilters(\n      filterOptions?.map((filterOpt) => ({\n        key: LEVEL_VARIABLE_VALUE,\n        operator: FilterOp.Equal,\n        value: filterOpt.text,\n      })) ?? [],\n      { skipPublish, forcePublish }\n    );\n  };\n\n  onChangeOptions = (options: SelectableValue[]) => {\n    // Save current url to history before the filter change\n    addCurrentUrlToHistory();\n\n    this.setState({\n      options: this.state.options?.map((value) => {\n        if (options.some((opt) => opt.value === value.value)) {\n          return { ...value, selected: true };\n        }\n        return { ...value, selected: false };\n      }),\n    });\n\n    if (!this.state.isOpen) {\n      this.updateFilters(false);\n    } else {\n      this.updateFilters(true);\n    }\n  };\n\n  openSelect = (isOpen: boolean) => {\n    this.setState({ isOpen });\n  };\n\n  onCloseMenu = () => {\n    this.openSelect(false);\n    // Update filters and run queries on close\n    this.updateFilters(false, true);\n  };\n\n  static Component = ({ model }: SceneComponentProps<LevelsVariableScene>) => {\n    const { options, isLoading, visible, isOpen } = model.useState();\n    const styles = useStyles2(getStyles);\n    const levelsVar = getLevelsVariable(model);\n    levelsVar.useState();\n\n    if (!visible) {\n      return null;\n    }\n\n    return (\n      <div data-testid={testIds.variables.levels.inputWrap}>\n        <ControlsLabel layout=\"vertical\" label={'Log levels'} />\n        <MultiSelect\n          aria-label={'Log level filters'}\n          prefix={<Icon size={'lg'} name={'filter'} />}\n          placeholder={'All levels'}\n          className={styles.flex}\n          onChange={model.onChangeOptions}\n          onCloseMenu={() => model.onCloseMenu()}\n          onOpenMenu={model.getTagValues}\n          onFocus={() => model.openSelect(true)}\n          menuShouldPortal={true}\n          isOpen={isOpen}\n          isLoading={isLoading}\n          isClearable={true}\n          blurInputOnSelect={false}\n          closeMenuOnSelect={false}\n          openMenuOnFocus={true}\n          showAllSelectedWhenOpen={true}\n          hideSelectedOptions={false}\n          value={options?.filter((v) => v.selected)}\n          options={options?.map((val) => ({\n            value: val.value,\n            label: val.text,\n          }))}\n        />\n      </div>\n    );\n  };\n}\nexport function syncLevelsVariable(sceneRef: SceneObject) {\n  const levelsVariableScene = sceneGraph.findObject(sceneRef, (obj) => obj instanceof LevelsVariableScene);\n  if (levelsVariableScene instanceof LevelsVariableScene) {\n    levelsVariableScene.onFilterChange();\n  }\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  flex: css({\n    flex: '1',\n  }),\n});\n","import { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { LineFilterEditor } from '../ServiceScene/LineFilter/LineFilterEditor';\nimport React, { ChangeEvent, KeyboardEvent, useState } from 'react';\nimport { IconButton, useStyles2 } from '@grafana/ui';\nimport { LineFilterCaseSensitive } from '../../services/filterTypes';\nimport { RegexInputValue } from '../ServiceScene/LineFilter/RegexIconButton';\n\nexport interface LineFilterProps {\n  exclusive: boolean;\n  lineFilter: string;\n  caseSensitive: boolean;\n  regex: boolean;\n  setExclusive: (exclusive: boolean) => void;\n  onInputChange: (e: ChangeEvent<HTMLInputElement>) => void;\n  onCaseSensitiveToggle: (caseSensitive: LineFilterCaseSensitive) => void;\n  onRegexToggle: (regex: RegexInputValue) => void;\n  updateFilter: (lineFilter: string, debounced: boolean) => void;\n  handleEnter: (e: KeyboardEvent<HTMLInputElement>, lineFilter: string) => void;\n  onSubmitLineFilter?: () => void;\n  onClearLineFilter?: () => void;\n}\n\nexport function LineFilterVariable({ onClick, props }: { onClick: () => void; props: LineFilterProps }) {\n  const [focus, setFocus] = useState(false);\n  const styles = useStyles2(getLineFilterStyles);\n  return (\n    <>\n      <span>\n        <div className={styles.titleWrap}>\n          <span>Line filter</span>\n          <IconButton onClick={onClick} name={'times'} size={'xs'} aria-label={'Remove line filter'} />\n        </div>\n        <span className={styles.collapseWrap}>\n          <LineFilterEditor {...props} focus={focus} setFocus={setFocus} type={'variable'} />\n          {focus && (\n            <IconButton\n              className={styles.collapseBtn}\n              tooltip={'Collapse'}\n              size={'lg'}\n              aria-label={'Collapse filter'}\n              onClick={() => setFocus(false)}\n              name={'table-collapse-all'}\n            />\n          )}\n        </span>\n      </span>\n    </>\n  );\n}\n\nconst getLineFilterStyles = (theme: GrafanaTheme2) => ({\n  titleWrap: css({\n    display: 'flex',\n    fontSize: theme.typography.bodySmall.fontSize,\n    marginBottom: theme.spacing(0.5),\n    gap: theme.spacing(1),\n  }),\n  collapseWrap: css({\n    display: 'flex',\n  }),\n  collapseBtn: css({\n    marginLeft: theme.spacing(1),\n  }),\n});\n","import { AdHocFilterWithLabels, SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React, { ChangeEvent, KeyboardEvent } from 'react';\nimport { getLineFiltersVariable } from '../../services/variableGetters';\nimport { LineFilterCaseSensitive, LineFilterOp } from '../../services/filterTypes';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { debounce } from 'lodash';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { useStyles2 } from '@grafana/ui';\nimport { LineFilterProps, LineFilterVariable } from './LineFilterVariable';\nimport { addCurrentUrlToHistory } from '../../services/navigate';\n\ninterface LineFilterRendererState extends SceneObjectState {}\n\n/**\n * The scene for the submitted line filter that is rendered up top with the other variables.\n * @todo refactor into new directory with other custom variable renderers and/or layout scenes\n */\nexport class LineFilterVariablesScene extends SceneObjectBase<LineFilterRendererState> {\n  static Component = ({ model }: SceneComponentProps<LineFilterVariablesScene>) => {\n    const lineFilterVar = getLineFiltersVariable(model);\n    const { filters } = lineFilterVar.useState();\n    const styles = useStyles2(getStyles);\n    sortLineFilters(filters);\n\n    if (!filters.length) {\n      return null;\n    }\n\n    return (\n      <div className={styles.lineFiltersWrap}>\n        {filters.map((filter) => {\n          const props: LineFilterProps = {\n            lineFilter: filter.value,\n            regex: filter.operator === LineFilterOp.regex || filter.operator === LineFilterOp.negativeRegex,\n            caseSensitive: filter.key === LineFilterCaseSensitive.caseSensitive,\n            exclusive: model.isFilterExclusive(filter),\n            handleEnter: (e, lineFilter) => model.handleEnter(e, filter.value, filter),\n            setExclusive: () => model.onToggleExclusive(filter),\n            updateFilter: (lineFilter, debounced) =>\n              model.updateFilter(\n                filter,\n                {\n                  ...filter,\n                  value: lineFilter,\n                },\n                debounced\n              ),\n            onRegexToggle: () => model.onRegexToggle(filter),\n            onInputChange: (e) => model.onInputChange(e, filter),\n            onCaseSensitiveToggle: () => model.onCaseSensitiveToggle(filter),\n          };\n          return <LineFilterVariable key={filter.keyLabel} onClick={() => model.removeFilter(filter)} props={props} />;\n        })}\n      </div>\n    );\n  };\n  /**\n   * Submit on enter\n   */\n  handleEnter = (e: KeyboardEvent<HTMLInputElement>, lineFilter: string, filter: AdHocFilterWithLabels) => {\n    if (e.key === 'Enter') {\n      // Add the current url to browser history before the state is changed so the user can revert their change.\n      addCurrentUrlToHistory();\n      this.updateVariableLineFilter(filter, { ...filter, value: lineFilter });\n    }\n  };\n\n  isFilterExclusive({ operator }: AdHocFilterWithLabels): boolean {\n    return operator === LineFilterOp.negativeMatch || operator === LineFilterOp.negativeRegex;\n  }\n\n  /**\n   * Updates filter operator when user toggles regex\n   */\n  onRegexToggle = (filter: AdHocFilterWithLabels) => {\n    let newOperator: LineFilterOp;\n    // Set value to scene state\n    switch (filter.operator) {\n      case LineFilterOp.match: {\n        newOperator = LineFilterOp.regex;\n        break;\n      }\n      case LineFilterOp.negativeMatch: {\n        newOperator = LineFilterOp.negativeRegex;\n        break;\n      }\n      case LineFilterOp.regex: {\n        newOperator = LineFilterOp.match;\n        break;\n      }\n      case LineFilterOp.negativeRegex: {\n        newOperator = LineFilterOp.negativeMatch;\n        break;\n      }\n      default: {\n        throw new Error('Invalid operator!');\n      }\n    }\n\n    this.updateFilter(filter, { ...filter, operator: newOperator }, false);\n  };\n\n  /**\n   * Updates filter operator when user toggles exclusion\n   */\n  onToggleExclusive = (filter: AdHocFilterWithLabels) => {\n    let newOperator: string;\n    switch (filter.operator) {\n      case LineFilterOp.match: {\n        newOperator = LineFilterOp.negativeMatch;\n        break;\n      }\n      case LineFilterOp.negativeMatch: {\n        newOperator = LineFilterOp.match;\n        break;\n      }\n      case LineFilterOp.regex: {\n        newOperator = LineFilterOp.negativeRegex;\n        break;\n      }\n      case LineFilterOp.negativeRegex: {\n        newOperator = LineFilterOp.regex;\n        break;\n      }\n      default: {\n        throw new Error('Invalid operator!');\n      }\n    }\n\n    this.updateFilter(filter, { ...filter, operator: newOperator }, false);\n  };\n\n  /**\n   * Updates filter key when user toggles case sensitivity\n   */\n  onCaseSensitiveToggle = (filter: AdHocFilterWithLabels) => {\n    const caseSensitive =\n      filter.key === LineFilterCaseSensitive.caseSensitive\n        ? LineFilterCaseSensitive.caseInsensitive\n        : LineFilterCaseSensitive.caseSensitive;\n    this.updateFilter(filter, { ...filter, key: caseSensitive }, false);\n  };\n\n  /**\n   * Updates existing line filter ad-hoc variable filter\n   */\n  updateFilter(existingFilter: AdHocFilterWithLabels, filterUpdate: AdHocFilterWithLabels, debounced = true) {\n    if (debounced) {\n      // We want to update the UI right away, which uses the filter state as the UI state, but we don't want to execute the query immediately\n      this.updateVariableLineFilter(existingFilter, filterUpdate, true);\n      // Run the debounce to force the event emit, as the prior setState will have already set the filterExpression, which will otherwise prevent the emit of the event which will trigger the query\n      this.updateVariableDebounced(existingFilter, filterUpdate, false, true);\n    } else {\n      this.updateVariableLineFilter(existingFilter, filterUpdate);\n    }\n  }\n\n  /**\n   * Line filter input onChange helper method\n   */\n  onInputChange = (e: ChangeEvent<HTMLInputElement>, filter: AdHocFilterWithLabels) => {\n    this.updateFilter(filter, { ...filter, value: e.target.value }, true);\n  };\n\n  /**\n   * Remove a filter, will trigger query\n   */\n  removeFilter = (filter: AdHocFilterWithLabels) => {\n    addCurrentUrlToHistory();\n    const variable = getLineFiltersVariable(this);\n    const otherFilters = variable.state.filters.filter(\n      (f) => f.keyLabel !== undefined && f.keyLabel !== filter.keyLabel\n    );\n\n    variable.setState({\n      filters: otherFilters,\n    });\n  };\n\n  /**\n   * Update existing line filter ad-hoc variable\n   */\n  private updateVariableLineFilter = (\n    existingFilter: AdHocFilterWithLabels,\n    filterUpdate: AdHocFilterWithLabels,\n    skipPublish = false,\n    forcePublish = false\n  ) => {\n    const variable = getLineFiltersVariable(this);\n    const otherFilters = variable.state.filters.filter(\n      (f) => f.keyLabel !== undefined && f.keyLabel !== existingFilter.keyLabel\n    );\n\n    variable.updateFilters(\n      [\n        {\n          keyLabel: existingFilter.keyLabel,\n          key: filterUpdate.key,\n          operator: filterUpdate.operator,\n          value: filterUpdate.value,\n        },\n        ...otherFilters,\n      ],\n      { skipPublish, forcePublish }\n    );\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.search_string_in_variables_changed,\n      {\n        searchQueryLength: existingFilter.value.length,\n        containsLevel: existingFilter.value.toLowerCase().includes('level'),\n        operator: filterUpdate.operator,\n        caseSensitive: filterUpdate.key,\n      }\n    );\n  };\n\n  /**\n   * Debounce line-filter ad-hoc variable update\n   */\n  private updateVariableDebounced = debounce(\n    (\n      existingFilter: AdHocFilterWithLabels,\n      filterUpdate: AdHocFilterWithLabels,\n      skipPublish = false,\n      forcePublish = false\n    ) => {\n      this.updateVariableLineFilter(existingFilter, filterUpdate, skipPublish, forcePublish);\n    },\n    1000\n  );\n}\n\n/**\n * Sort line filters by keyLabel, i.e. the order the line filter was added\n */\nexport function sortLineFilters(filters: AdHocFilterWithLabels[]) {\n  filters.sort((a, b) => parseInt(a.keyLabel ?? '0', 10) - parseInt(b.keyLabel ?? '0', 10));\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    lineFiltersWrap: css({\n      label: 'lineFiltersWrap',\n      display: 'flex',\n      flexWrap: 'wrap',\n      gap: `${theme.spacing(0.25)} ${theme.spacing(2)}`,\n    }),\n  };\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { LinkButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { getDrillDownIndexLink } from '../../services/navigate';\nimport { getLabelsVariable } from '../../services/variableGetters';\nimport { testIds } from '../../services/testIds';\n\nimport { isOperatorInclusive } from '../../services/operatorHelpers';\n\nexport interface ShowLogsButtonSceneState extends SceneObjectState {\n  disabled?: boolean;\n  hidden?: boolean;\n}\nexport class ShowLogsButtonScene extends SceneObjectBase<ShowLogsButtonSceneState> {\n  constructor(state: Partial<ShowLogsButtonSceneState>) {\n    super({\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const labelsVar = getLabelsVariable(this);\n    const hasPositiveFilter = labelsVar.state.filters.some((f) => isOperatorInclusive(f.operator));\n    this.setState({\n      disabled: !hasPositiveFilter,\n    });\n\n    labelsVar.subscribeToState((newState) => {\n      const hasPositiveFilter = newState.filters.some((f) => isOperatorInclusive(f.operator));\n      this.setState({\n        disabled: !hasPositiveFilter,\n      });\n    });\n  }\n\n  getLink = () => {\n    const labelsVar = getLabelsVariable(this);\n    const positiveFilter = labelsVar.state.filters.find((f) => isOperatorInclusive(f.operator));\n\n    if (positiveFilter) {\n      return getDrillDownIndexLink(positiveFilter.key, positiveFilter.value);\n    }\n\n    return '';\n  };\n\n  static Component = ({ model }: SceneComponentProps<ShowLogsButtonScene>) => {\n    const { disabled, hidden } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    if (hidden === true) {\n      return null;\n    }\n\n    const link = model.getLink();\n\n    return (\n      <LinkButton\n        data-testid={testIds.index.header.showLogsButton}\n        disabled={disabled || !link}\n        fill={'outline'}\n        className={styles.button}\n        href={link}\n      >\n        Show logs\n      </LinkButton>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    button: css({\n      [theme.breakpoints.down('lg')]: {\n        alignSelf: 'flex-end',\n      },\n      [theme.breakpoints.down('md')]: {\n        marginTop: theme.spacing(1),\n        alignSelf: 'flex-start',\n      },\n\n      alignSelf: 'flex-start',\n      marginTop: '22px',\n    }),\n  };\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Dropdown, Switch, ToolbarButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { config } from '@grafana/runtime';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { AGGREGATED_METRIC_START_DATE } from '../ServiceSelectionScene/ServiceSelectionScene';\nimport pluginJson from '../../plugin.json';\nimport { testIds } from '../../services/testIds';\nconst AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY = `${pluginJson.id}.serviceSelection.aggregatedMetrics`;\n\nexport interface ToolbarSceneState extends SceneObjectState {\n  isOpen: boolean;\n  options: {\n    aggregatedMetrics: {\n      active: boolean;\n      userOverride: boolean;\n      disabled: boolean;\n    };\n  };\n}\nexport class ToolbarScene extends SceneObjectBase<ToolbarSceneState> {\n  constructor(state: Partial<ToolbarSceneState>) {\n    const userOverride = localStorage.getItem(AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY);\n    const active = config.featureToggles.exploreLogsAggregatedMetrics && userOverride !== 'false';\n\n    super({\n      isOpen: false,\n      options: {\n        aggregatedMetrics: {\n          active: active ?? false,\n          userOverride: userOverride === 'true' ?? false,\n          disabled: false,\n        },\n      },\n      ...state,\n    });\n  }\n\n  public toggleAggregatedMetricsOverride = () => {\n    const active = !this.state.options.aggregatedMetrics.active;\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_selection,\n      USER_EVENTS_ACTIONS.service_selection.aggregated_metrics_toggled,\n      {\n        enabled: active,\n      }\n    );\n\n    localStorage.setItem(AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY, active.toString());\n\n    this.setState({\n      options: {\n        aggregatedMetrics: {\n          active,\n          disabled: this.state.options.aggregatedMetrics.disabled,\n          userOverride: active,\n        },\n      },\n    });\n  };\n\n  public onToggleOpen = (isOpen: boolean) => {\n    this.setState({ isOpen });\n  };\n\n  static Component = ({ model }: SceneComponentProps<ToolbarScene>) => {\n    const { isOpen, options } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const renderPopover = () => {\n      return (\n        <div className={styles.popover} onClick={(evt) => evt.stopPropagation()}>\n          <div className={styles.heading}>Query options</div>\n          <div className={styles.options}>\n            <div\n              title={\n                'Aggregated metrics will return service queries results much more quickly, but with lower resolution'\n              }\n            >\n              Aggregated metrics\n            </div>\n            <span\n              title={\n                options.aggregatedMetrics.disabled\n                  ? `Aggregated metrics can only be enabled for queries starting after ${AGGREGATED_METRIC_START_DATE.toLocaleString()}`\n                  : ''\n              }\n            >\n              <Switch\n                label={'Toggle aggregated metrics'}\n                data-testid={testIds.index.aggregatedMetricsToggle}\n                value={options.aggregatedMetrics.active}\n                disabled={options.aggregatedMetrics.disabled}\n                onChange={model.toggleAggregatedMetricsOverride}\n              />\n            </span>\n          </div>\n        </div>\n      );\n    };\n\n    if (options.aggregatedMetrics) {\n      return (\n        <Dropdown overlay={renderPopover} placement=\"bottom\" onVisibleChange={model.onToggleOpen}>\n          <ToolbarButton\n            icon=\"cog\"\n            variant=\"canvas\"\n            isOpen={isOpen}\n            data-testid={testIds.index.aggregatedMetricsMenu}\n          />\n        </Dropdown>\n      );\n    }\n\n    return <></>;\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    popover: css({\n      display: 'flex',\n      padding: theme.spacing(2),\n      flexDirection: 'column',\n      background: theme.colors.background.primary,\n      boxShadow: theme.shadows.z3,\n      borderRadius: theme.shape.radius.default,\n      border: `1px solid ${theme.colors.border.weak}`,\n      zIndex: 1,\n      marginRight: theme.spacing(2),\n    }),\n    heading: css({\n      fontWeight: theme.typography.fontWeightMedium,\n      paddingBottom: theme.spacing(2),\n    }),\n    options: css({\n      display: 'grid',\n      gridTemplateColumns: '1fr 50px',\n      rowGap: theme.spacing(1),\n      columnGap: theme.spacing(2),\n      alignItems: 'center',\n    }),\n  };\n}\n","import {\n  EmbeddedScene,\n  SceneAppPage,\n  SceneAppPageLike,\n  SceneFlexLayout,\n  SceneRouteMatch,\n  SceneTimeRange,\n} from '@grafana/scenes';\nimport {\n  CHILD_ROUTE_DEFINITIONS,\n  ChildDrilldownSlugs,\n  DRILLDOWN_URL_KEYS,\n  extractValuesFromRoute,\n  PageSlugs,\n  ParentDrilldownSlugs,\n  ROUTE_DEFINITIONS,\n  ROUTES,\n  SERVICE_URL_KEYS,\n  SUB_ROUTES,\n  ValueSlugs,\n} from '../services/routing';\nimport { PageLayoutType } from '@grafana/data';\nimport { IndexScene } from './IndexScene/IndexScene';\nimport { navigateToIndex } from '../services/navigate';\nimport { logger } from '../services/logger';\nimport { capitalizeFirstLetter } from '../services/text';\nimport { PLUGIN_BASE_URL, prefixRoute } from '../services/plugin';\n\nexport type RouteProps = { labelName: string; labelValue: string; breakdownLabel?: string };\nexport type RouteMatch = SceneRouteMatch<RouteProps>;\ntype Optional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\nexport type OptionalRouteProps = Optional<RouteProps, 'labelName' | 'labelValue'>;\nexport type OptionalRouteMatch = SceneRouteMatch<OptionalRouteProps>;\n\nexport const DEFAULT_TIME_RANGE = { from: 'now-15m', to: 'now' };\nfunction getServicesScene(routeMatch: OptionalRouteMatch) {\n  return new EmbeddedScene({\n    body: new IndexScene({\n      $timeRange: new SceneTimeRange(DEFAULT_TIME_RANGE),\n      routeMatch,\n    }),\n  });\n}\n\n// Index page\nexport function makeIndexPage() {\n  return new SceneAppPage({\n    // Top level breadcrumb\n    title: 'Grafana Logs Drilldown',\n    url: prefixRoute(PageSlugs.explore),\n    layout: PageLayoutType.Custom,\n    preserveUrlKeys: SERVICE_URL_KEYS,\n    routePath: prefixRoute(PageSlugs.explore),\n    getScene: (routeMatch) => getServicesScene(routeMatch),\n    drilldowns: [\n      {\n        routePath: ROUTE_DEFINITIONS.logs,\n        getPage: (routeMatch, parent) => makeBreakdownPage(routeMatch, parent, PageSlugs.logs),\n        defaultRoute: true,\n      },\n      {\n        routePath: ROUTE_DEFINITIONS.labels,\n        getPage: (routeMatch, parent) => makeBreakdownPage(routeMatch, parent, PageSlugs.labels),\n      },\n      {\n        routePath: ROUTE_DEFINITIONS.patterns,\n        getPage: (routeMatch, parent) => makeBreakdownPage(routeMatch, parent, PageSlugs.patterns),\n      },\n      {\n        routePath: ROUTE_DEFINITIONS.fields,\n        getPage: (routeMatch, parent) => makeBreakdownPage(routeMatch, parent, PageSlugs.fields),\n      },\n      {\n        routePath: CHILD_ROUTE_DEFINITIONS.label,\n        getPage: (routeMatch, parent) => makeBreakdownValuePage(routeMatch, parent, ValueSlugs.label),\n      },\n      {\n        routePath: CHILD_ROUTE_DEFINITIONS.field,\n        getPage: (routeMatch: RouteMatch, parent) => makeBreakdownValuePage(routeMatch, parent, ValueSlugs.field),\n      },\n      {\n        routePath: '*',\n        getPage: () => makeRedirectPage(),\n      },\n    ],\n  });\n}\n\n// Redirect page back to index\nexport function makeRedirectPage() {\n  return new SceneAppPage({\n    title: '',\n    url: PLUGIN_BASE_URL,\n    getScene: makeEmptyScene(),\n    hideFromBreadcrumbs: true,\n    routePath: '*',\n    $behaviors: [\n      () => {\n        navigateToIndex();\n      },\n    ],\n  });\n}\n\nfunction makeEmptyScene(): (routeMatch: SceneRouteMatch) => EmbeddedScene {\n  return () =>\n    new EmbeddedScene({\n      body: new SceneFlexLayout({\n        direction: 'column',\n        children: [],\n      }),\n    });\n}\n\nexport function makeBreakdownPage(\n  routeMatch: RouteMatch,\n  parent: SceneAppPageLike,\n  slug: ParentDrilldownSlugs\n): SceneAppPage {\n  const { labelName, labelValue } = extractValuesFromRoute(routeMatch);\n  return new SceneAppPage({\n    title: capitalizeFirstLetter(slug),\n    layout: PageLayoutType.Custom,\n    url: ROUTES[slug](labelValue, labelName),\n    preserveUrlKeys: DRILLDOWN_URL_KEYS,\n    getParentPage: () => parent,\n    getScene: (routeMatch) => getServicesScene(routeMatch),\n  });\n}\n\nexport function makeBreakdownValuePage(\n  routeMatch: RouteMatch,\n  parent: SceneAppPageLike,\n  slug: ChildDrilldownSlugs\n): SceneAppPage {\n  const { labelName, labelValue, breakdownLabel } = extractValuesFromRoute(routeMatch);\n\n  if (!breakdownLabel) {\n    const e = new Error('Breakdown value missing!');\n    logger.error(e, {\n      msg: 'makeBreakdownValuePage: Breakdown value missing!',\n      labelName,\n      labelValue,\n      breakdownLabel: breakdownLabel ?? '',\n    });\n    throw e;\n  }\n\n  return new SceneAppPage({\n    title: capitalizeFirstLetter(breakdownLabel),\n    layout: PageLayoutType.Custom,\n    url: SUB_ROUTES[slug](labelValue, labelName, breakdownLabel),\n    preserveUrlKeys: DRILLDOWN_URL_KEYS,\n    getParentPage: () => parent,\n    getScene: (routeMatch) => getServicesScene(routeMatch),\n  });\n}\n","import { DataFrame, FieldConfig, FieldConfigSource, TimeRange } from '@grafana/data';\nimport { usePluginLinks } from '@grafana/runtime';\nimport {\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VizPanel,\n} from '@grafana/scenes';\nimport { DataSourceRef } from '@grafana/schema';\nimport { IconButton } from '@grafana/ui';\nimport React from 'react';\nimport { ExtensionPoints } from 'services/extensions/links';\nimport { findObjectOfType, getLokiDatasource } from 'services/scenes';\n\nimport LokiLogo from '../../../img/logo.svg';\nimport { LokiDatasource, LokiQuery } from '../../../services/lokiQuery';\n\nexport interface AddToInvestigationButtonState extends SceneObjectState {\n  frame?: DataFrame;\n  labelName?: string;\n  fieldName?: string;\n  ds?: LokiDatasource;\n  context?: ExtensionContext;\n  queries: LokiQuery[];\n  type?: 'timeseries' | 'logs' | undefined;\n}\n\ntype ExtensionContext = {\n  timeRange: TimeRange;\n  queries: LokiQuery[];\n  datasource: DataSourceRef;\n  origin: string;\n  url: string;\n  type: string;\n  title: string;\n  id: string;\n  logoPath: string;\n  note?: string;\n  drillDownLabel?: string;\n  fieldConfig?: FieldConfigSource;\n};\n\nexport class AddToInvestigationButton extends SceneObjectBase<AddToInvestigationButtonState> {\n  constructor(state: Omit<AddToInvestigationButtonState, 'queries'>) {\n    super({ ...state, queries: [] });\n    this.addActivationHandler(this.onActivate);\n  }\n\n  private onActivate = () => {\n    getLokiDatasource(this).then((ds) => {\n      this.setState({ ds });\n    });\n\n    this._subs.add(\n      this.subscribeToState((newState, prevState) => {\n        if (!this.state.queries.length) {\n          this.getQueries();\n        }\n\n        if (!this.state.context && this.state.queries.length) {\n          this.getContext();\n        }\n      })\n    );\n  };\n\n  private getQueries = () => {\n    const data = sceneGraph.getData(this);\n    const queryRunner = findObjectOfType(data, (o) => o instanceof SceneQueryRunner, SceneQueryRunner);\n\n    if (queryRunner) {\n      const filter = this.state.frame ? getFilter(this.state.frame) : null;\n      const queries = queryRunner.state.queries.map((q) => ({\n        ...q,\n        expr: sceneGraph.interpolate(queryRunner, q.expr),\n        legendFormat: filter?.name ? `{{ ${filter.name} }}` : sceneGraph.interpolate(queryRunner, q.legendFormat),\n        datasource: q.datasource ?? undefined,\n      }));\n\n      if (JSON.stringify(queries) !== JSON.stringify(this.state.queries)) {\n        this.setState({ queries });\n      }\n    }\n  };\n\n  private getFieldConfig = () => {\n    const panel = findObjectOfType(this, (o) => o instanceof VizPanel, VizPanel);\n    const data = sceneGraph.getData(this);\n    const frames = data?.state.data?.series;\n    let fieldConfig = panel?.state.fieldConfig;\n    if (fieldConfig && frames?.length) {\n      for (const frame of frames) {\n        for (const field of frame.fields) {\n          const configKeys = Object.keys(field.config);\n          const properties = configKeys.map((key) => ({\n            id: key,\n            value: field.config[key as keyof FieldConfig],\n          }));\n\n          // check if the override already exists\n          const existingOverride = fieldConfig.overrides.find(\n            (o) =>\n              o.matcher.options === (field.config.displayNameFromDS ?? field.config.displayName ?? field.name) &&\n              o.matcher.id === 'byName'\n          );\n          if (!existingOverride) {\n            // add as first override\n            fieldConfig.overrides.unshift({\n              matcher: {\n                id: 'byName',\n                options: field.config.displayNameFromDS ?? field.config.displayName ?? field.name,\n              },\n              properties,\n            });\n          }\n\n          if (existingOverride && JSON.stringify(existingOverride.properties) !== JSON.stringify(properties)) {\n            existingOverride.properties = properties;\n          }\n        }\n      }\n    }\n    return fieldConfig;\n  };\n\n  private getContext = () => {\n    const fieldConfig = this.getFieldConfig();\n    const { queries, ds, labelName, fieldName, type } = this.state;\n    const timeRange = sceneGraph.getTimeRange(this);\n\n    if (!timeRange || !queries || !ds?.uid) {\n      return;\n    }\n    const ctx = {\n      origin: 'Grafana Logs Drilldown',\n      type: type ?? 'timeseries',\n      queries,\n      timeRange: { ...timeRange.state.value },\n      datasource: { uid: ds.uid },\n      url: window.location.href,\n      id: `${JSON.stringify(queries)}${labelName}${fieldName}`,\n      title: `${labelName}${fieldName ? ` > ${fieldName}` : ''}`,\n      logoPath: LokiLogo,\n      drillDownLabel: fieldName,\n      fieldConfig: fieldConfig,\n    };\n    if (JSON.stringify(ctx) !== JSON.stringify(this.state.context)) {\n      this.setState({ context: ctx });\n    }\n  };\n\n  public static Component = ({ model }: SceneComponentProps<AddToInvestigationButton>) => {\n    const { context } = model.useState();\n    const { links } = usePluginLinks({ extensionPointId: ExtensionPoints.MetricInvestigation, context });\n\n    return (\n      <>\n        {links\n          .filter((link) => link.pluginId === 'grafana-investigations-app' && link.onClick)\n          .map((link) => (\n            <IconButton\n              tooltip={link.description}\n              aria-label=\"extension-link-to-open-exploration\"\n              key={link.id}\n              name={link.icon ?? 'panel-add'}\n              onClick={(e) => {\n                if (link.onClick) {\n                  link.onClick(e);\n                }\n              }}\n            />\n          ))}\n      </>\n    );\n  };\n}\n\nconst getFilter = (frame: DataFrame) => {\n  const filterNameAndValueObj = frame.fields[1]?.labels ?? {};\n  if (Object.keys(filterNameAndValueObj).length !== 1) {\n    return;\n  }\n  const name = Object.keys(filterNameAndValueObj)[0];\n  return { name, value: filterNameAndValueObj[name] };\n};\n","import { DataFrame, GrafanaTheme2, PanelMenuItem } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VizPanel,\n  VizPanelMenu,\n} from '@grafana/scenes';\nimport React from 'react';\nimport { onExploreLinkClick } from '../ServiceScene/GoToExploreButton';\nimport { IndexScene } from '../IndexScene/IndexScene';\nimport { findObjectOfType, getQueryRunnerFromChildren } from '../../services/scenes';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { logger } from '../../services/logger';\nimport { AddToInvestigationButton } from '../ServiceScene/Breakdowns/AddToInvestigationButton';\nimport { getPluginLinkExtensions } from '@grafana/runtime';\nimport { ExtensionPoints } from '../../services/extensions/links';\nimport { setLevelColorOverrides } from '../../services/panel';\nimport { setPanelOption } from '../../services/store';\nimport { FieldsAggregatedBreakdownScene } from '../ServiceScene/Breakdowns/FieldsAggregatedBreakdownScene';\nimport { setValueSummaryHeight } from '../ServiceScene/Breakdowns/Panels/ValueSummary';\nimport { FieldValuesBreakdownScene } from '../ServiceScene/Breakdowns/FieldValuesBreakdownScene';\nimport { LabelValuesBreakdownScene } from '../ServiceScene/Breakdowns/LabelValuesBreakdownScene';\nimport { css } from '@emotion/css';\n\nconst ADD_TO_INVESTIGATION_MENU_TEXT = 'Add to investigation';\nconst ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT = 'investigations_divider'; // Text won't be visible\nconst ADD_TO_INVESTIGATION_MENU_GROUP_TEXT = 'Investigations';\n\nexport enum AvgFieldPanelType {\n  'timeseries' = 'timeseries',\n  'histogram' = 'histogram',\n}\n\nexport enum CollapsablePanelText {\n  collapsed = 'Collapse',\n  expanded = 'Expand',\n}\n\ninterface InvestigationOptions {\n  labelName?: string;\n  fieldName?: string;\n  frame?: DataFrame;\n  type?: 'timeseries' | 'logs';\n  getLabelName?: () => string;\n}\n\ninterface PanelMenuState extends SceneObjectState {\n  body?: VizPanelMenu;\n  addInvestigationsLink?: boolean;\n  investigationsButton?: AddToInvestigationButton;\n  panelType?: AvgFieldPanelType;\n\n  investigationOptions?: InvestigationOptions;\n}\n\n/**\n * @todo the VizPanelMenu interface is overly restrictive, doesn't allow any member functions on this class, so everything is currently inlined\n */\nexport class PanelMenu extends SceneObjectBase<PanelMenuState> implements VizPanelMenu, SceneObject {\n  constructor(state: Partial<PanelMenuState>) {\n    super({ ...state, addInvestigationsLink: state.addInvestigationsLink ?? true });\n    this.addActivationHandler(() => {\n      // Navigation options (all panels)\n      const items: PanelMenuItem[] = [\n        {\n          text: 'Navigation',\n          type: 'group',\n        },\n        {\n          text: 'Explore',\n          iconClassName: 'compass',\n          href: getExploreLink(this),\n          onClick: () => onExploreLinkClickTracking(),\n          shortcut: 'p x',\n        },\n      ];\n\n      let viz;\n      try {\n        viz = sceneGraph.getAncestor(this, VizPanel);\n      } catch (e) {\n        // If we can't find the viz panel, we can't add the Explore item. Currently the case for logs table.\n        this.setState({\n          body: new VizPanelMenu({\n            items,\n          }),\n        });\n        return;\n      }\n\n      this.setState({\n        investigationsButton: new AddToInvestigationButton({\n          labelName: this.state.investigationOptions?.getLabelName\n            ? this.state.investigationOptions?.getLabelName()\n            : this.state.investigationOptions?.labelName,\n          fieldName: this.state.investigationOptions?.fieldName,\n          frame: this.state.investigationOptions?.frame,\n          type: this.state.investigationOptions?.type,\n        }),\n      });\n\n      if (this.state.addInvestigationsLink) {\n        // @todo rewrite the AddToExplorationButton\n        // Manually activate scene\n        this.state.investigationsButton?.activate();\n      }\n\n      // Visualization options\n      if (this.state.panelType || viz?.state.collapsible) {\n        addVisualizationHeader(items, this);\n      }\n\n      if (viz?.state.collapsible) {\n        addCollapsableItem(items, this);\n      }\n\n      if (this.state.panelType) {\n        addHistogramItem(items, this);\n      }\n\n      this.setState({\n        body: new VizPanelMenu({\n          items,\n        }),\n      });\n\n      this._subs.add(\n        this.state.investigationsButton?.subscribeToState(() => {\n          subscribeToAddToInvestigation(this);\n        })\n      );\n    });\n  }\n\n  addItem(item: PanelMenuItem): void {\n    if (this.state.body) {\n      this.state.body.addItem(item);\n    }\n  }\n  setItems(items: PanelMenuItem[]): void {\n    if (this.state.body) {\n      this.state.body.setItems(items);\n    }\n  }\n\n  public static Component = ({ model }: SceneComponentProps<PanelMenu>) => {\n    const { body } = model.useState();\n\n    if (body) {\n      return <body.Component model={body} />;\n    }\n\n    return <></>;\n  };\n}\n\nfunction addVisualizationHeader(items: PanelMenuItem[], sceneRef: PanelMenu) {\n  items.push({\n    text: '',\n    type: 'divider',\n  });\n  items.push({\n    text: 'Visualization',\n    type: 'group',\n  });\n}\n\nfunction addCollapsableItem(items: PanelMenuItem[], menu: PanelMenu) {\n  const viz = sceneGraph.getAncestor(menu, VizPanel);\n  items.push({\n    text: viz.state.collapsed ? CollapsablePanelText.expanded : CollapsablePanelText.collapsed,\n    iconClassName: viz.state.collapsed ? 'table-collapse-all' : 'table-expand-all',\n    onClick: () => {\n      const newCollapsableState = viz.state.collapsed ? CollapsablePanelText.expanded : CollapsablePanelText.collapsed;\n\n      // Update the viz\n      const vizPanelFlexLayout = sceneGraph.getAncestor(menu, SceneFlexLayout);\n      setValueSummaryHeight(vizPanelFlexLayout, newCollapsableState);\n\n      // Set state and update local storage\n      viz.setState({\n        collapsed: !viz.state.collapsed,\n      });\n      setPanelOption('collapsed', newCollapsableState);\n    },\n  });\n}\n\nfunction addHistogramItem(items: PanelMenuItem[], sceneRef: PanelMenu) {\n  items.push({\n    text: sceneRef.state.panelType !== AvgFieldPanelType.histogram ? 'Histogram' : 'Time series',\n    iconClassName: sceneRef.state.panelType !== AvgFieldPanelType.histogram ? 'graph-bar' : 'chart-line',\n\n    onClick: () => {\n      const gridItem = sceneGraph.getAncestor(sceneRef, SceneCSSGridItem);\n      const viz = sceneGraph.getAncestor(sceneRef, VizPanel).clone();\n      const $data = sceneGraph.getData(sceneRef).clone();\n      const menu = sceneRef.clone();\n      const headerActions = Array.isArray(viz.state.headerActions)\n        ? viz.state.headerActions.map((o) => o.clone())\n        : viz.state.headerActions;\n      let body;\n\n      if (sceneRef.state.panelType !== AvgFieldPanelType.histogram) {\n        body = PanelBuilders.timeseries().setOverrides(setLevelColorOverrides);\n      } else {\n        body = PanelBuilders.histogram();\n      }\n\n      gridItem.setState({\n        body: body.setMenu(menu).setTitle(viz.state.title).setHeaderActions(headerActions).setData($data).build(),\n      });\n\n      const newPanelType =\n        sceneRef.state.panelType !== AvgFieldPanelType.timeseries\n          ? AvgFieldPanelType.timeseries\n          : AvgFieldPanelType.histogram;\n      setPanelOption('panelType', newPanelType);\n      menu.setState({ panelType: newPanelType });\n\n      const fieldsAggregatedBreakdownScene = findObjectOfType(\n        gridItem,\n        (o) => o instanceof FieldsAggregatedBreakdownScene,\n        FieldsAggregatedBreakdownScene\n      );\n      if (fieldsAggregatedBreakdownScene) {\n        fieldsAggregatedBreakdownScene.rebuildAvgFields();\n      }\n\n      onSwitchVizTypeTracking(newPanelType);\n    },\n  });\n}\n\nexport const getExploreLink = (sceneRef: SceneObject) => {\n  const indexScene = sceneGraph.getAncestor(sceneRef, IndexScene);\n  const $data = sceneGraph.getData(sceneRef);\n  let queryRunner = $data instanceof SceneQueryRunner ? $data : getQueryRunnerFromChildren($data)[0];\n\n  // If we don't have a query runner, then our panel is within a SceneCSSGridItem, we need to get the query runner from there\n  if (!queryRunner) {\n    const breakdownScene = sceneGraph.findObject(\n      sceneRef,\n      (o) => o instanceof FieldValuesBreakdownScene || o instanceof LabelValuesBreakdownScene\n    );\n    if (breakdownScene) {\n      const queryProvider = sceneGraph.getData(breakdownScene);\n\n      if (queryProvider instanceof SceneQueryRunner) {\n        queryRunner = queryProvider;\n      } else {\n        queryRunner = getQueryRunnerFromChildren(queryProvider)[0];\n      }\n    } else {\n      logger.error(new Error('Unable to locate query runner!'), {\n        msg: 'PanelMenu - getExploreLink: Unable to locate query runner!',\n      });\n    }\n  }\n  const uninterpolatedExpr: string | undefined = queryRunner.state.queries[0].expr;\n  const expr = sceneGraph.interpolate(sceneRef, uninterpolatedExpr);\n\n  return onExploreLinkClick(indexScene, expr);\n};\n\nconst onExploreLinkClickTracking = () => {\n  reportAppInteraction(USER_EVENTS_PAGES.all, USER_EVENTS_ACTIONS.all.open_in_explore_menu_clicked);\n};\n\nconst onSwitchVizTypeTracking = (newVizType: AvgFieldPanelType) => {\n  reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.change_viz_type, {\n    newVizType,\n  });\n};\n\nconst getInvestigationLink = (addToInvestigation: AddToInvestigationButton) => {\n  const links = getPluginLinkExtensions({\n    extensionPointId: ExtensionPoints.MetricInvestigation,\n    context: addToInvestigation.state.context,\n  });\n\n  return links.extensions[0];\n};\n\nconst onAddToInvestigationClick = (event: React.MouseEvent, addToInvestigation: AddToInvestigationButton) => {\n  const link = getInvestigationLink(addToInvestigation);\n  if (link && link.onClick) {\n    link.onClick(event);\n  }\n};\n\nfunction subscribeToAddToInvestigation(exploreLogsVizPanelMenu: PanelMenu) {\n  const addToInvestigationButton = exploreLogsVizPanelMenu.state.investigationsButton;\n  if (addToInvestigationButton) {\n    const link = getInvestigationLink(addToInvestigationButton);\n\n    const existingMenuItems = exploreLogsVizPanelMenu.state.body?.state.items ?? [];\n\n    const existingAddToExplorationLink = existingMenuItems.find((item) => item.text === ADD_TO_INVESTIGATION_MENU_TEXT);\n\n    if (link) {\n      if (!existingAddToExplorationLink) {\n        exploreLogsVizPanelMenu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT,\n          type: 'divider',\n        });\n        exploreLogsVizPanelMenu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_GROUP_TEXT,\n          type: 'group',\n        });\n        exploreLogsVizPanelMenu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_TEXT,\n          iconClassName: 'plus-square',\n          onClick: (e) => onAddToInvestigationClick(e, addToInvestigationButton),\n        });\n      } else {\n        if (existingAddToExplorationLink) {\n          exploreLogsVizPanelMenu.state.body?.setItems(\n            existingMenuItems.filter(\n              (item) =>\n                [\n                  ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT,\n                  ADD_TO_INVESTIGATION_MENU_GROUP_TEXT,\n                  ADD_TO_INVESTIGATION_MENU_TEXT,\n                ].includes(item.text) === false\n            )\n          );\n        }\n      }\n    }\n  }\n}\n\nexport const getPanelWrapperStyles = (theme: GrafanaTheme2) => {\n  return {\n    panelWrapper: css({\n      width: '100%',\n      height: '100%',\n      label: 'panel-wrapper',\n      position: 'absolute',\n      display: 'flex',\n\n      // @todo remove this wrapper and styles when core changes are introduced in 11.5\n      // Need more specificity to override core style\n      'button.show-on-hover': {\n        opacity: 1,\n        visibility: 'visible',\n        background: 'none',\n        '&:hover': {\n          background: theme.colors.secondary.shade,\n        },\n      },\n    }),\n  };\n};\n","import React from 'react';\n\nimport { toURLRange, urlUtil } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { sceneGraph } from '@grafana/scenes';\nimport { ToolbarButton } from '@grafana/ui';\n\nimport { getDataSource, getQueryExpr } from 'services/scenes';\nimport { testIds } from 'services/testIds';\nimport { IndexScene } from 'Components/IndexScene/IndexScene';\nimport { USER_EVENTS_ACTIONS, USER_EVENTS_PAGES, reportAppInteraction } from 'services/analytics';\nimport { getDisplayedFields, getLogsVisualizationType } from 'services/store';\nimport { unknownToStrings } from '../../services/narrowing';\nimport { DATAPLANE_LABELS_NAME } from '../../services/logsFrame';\ninterface GoToExploreButtonState {\n  exploration: IndexScene;\n}\n\nexport const GoToExploreButton = ({ exploration }: GoToExploreButtonState) => {\n  const onClick = () => {\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.open_in_explore_clicked\n    );\n    onExploreLinkClick(exploration, undefined, true);\n  };\n\n  return (\n    <ToolbarButton\n      data-testid={testIds.exploreServiceDetails.openExplore}\n      variant={'canvas'}\n      icon={'compass'}\n      onClick={onClick}\n    >\n      Open in Explore\n    </ToolbarButton>\n  );\n};\n\nexport const onExploreLinkClick = (indexScene: IndexScene, expr?: string, open = false) => {\n  if (!expr) {\n    expr = getQueryExpr(indexScene);\n  }\n\n  expr = expr.replace(/\\s+/g, ' ').trimEnd();\n\n  const datasource = getDataSource(indexScene);\n  const timeRange = sceneGraph.getTimeRange(indexScene).state.value;\n  const displayedFields = getDisplayedFields(indexScene);\n  const visualisationType = getLogsVisualizationType();\n  const columns = getUrlColumns();\n  const exploreState = JSON.stringify({\n    ['loki-explore']: {\n      range: toURLRange(timeRange.raw),\n      queries: [{ refId: 'logs', expr, datasource }],\n      panelsState: {\n        logs: {\n          displayedFields,\n          visualisationType,\n          columns,\n          labelFieldName: visualisationType === 'table' ? DATAPLANE_LABELS_NAME : undefined,\n        },\n      },\n      datasource,\n    },\n  });\n  const subUrl = config.appSubUrl ?? '';\n  const link = urlUtil.renderUrl(`${subUrl}/explore`, { panes: exploreState, schemaVersion: 1 });\n  if (open) {\n    window.open(link, '_blank');\n  }\n\n  return link;\n};\n\nfunction getUrlColumns() {\n  const params = new URLSearchParams(window.location.search);\n  const urlColumns = params.get('urlColumns');\n  if (urlColumns) {\n    try {\n      const columns = unknownToStrings(JSON.parse(urlColumns));\n      let columnsParam: Record<number, string> = {};\n      for (const key in columns) {\n        columnsParam[key] = columns[key];\n      }\n      return columnsParam;\n    } catch (e) {\n      console.error(e);\n    }\n  }\n  return undefined;\n}\n","import React from 'react';\n\nimport { AdHocVariableFilter, BusEventBase, DataFrame } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  SceneComponentProps,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n} from '@grafana/scenes';\nimport { VariableHide } from '@grafana/schema';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport {\n  LEVEL_VARIABLE_VALUE,\n  VAR_FIELDS,\n  VAR_FIELDS_AND_METADATA,\n  VAR_LABELS,\n  VAR_LABELS_REPLICA,\n  VAR_LEVELS,\n  VAR_METADATA,\n} from 'services/variables';\nimport { FilterButton } from 'Components/FilterButton';\nimport { getDetectedLabelsFrame } from '../ServiceScene';\nimport { getParserForField } from '../../../services/fields';\nimport {\n  getAdHocFiltersVariable,\n  getFieldsAndMetadataVariable,\n  getValueFromAdHocVariableFilter,\n} from '../../../services/variableGetters';\nimport { FilterOp, NumericFilterOp } from '../../../services/filterTypes';\n\nimport { addToFavorites } from '../../../services/favorites';\nimport { areArraysEqual } from '../../../services/comparison';\nimport { logger } from '../../../services/logger';\nimport { isFilterMetadata } from '../../../services/filters';\nimport { addCurrentUrlToHistory } from '../../../services/navigate';\n\nexport interface AddToFiltersButtonState extends SceneObjectState {\n  frame: DataFrame;\n  variableName: InterpolatedFilterType;\n  hideExclude?: boolean;\n  isIncluded?: boolean;\n  isExcluded?: boolean;\n}\n\nexport class AddFilterEvent extends BusEventBase {\n  constructor(\n    public source: 'legend' | 'filterButton' | 'variable',\n    public operator: FilterType | NumericFilterType,\n    public key: string,\n    public value?: string\n  ) {\n    super();\n  }\n  public static type = 'add-filter';\n}\n\nexport class ClearFilterEvent extends BusEventBase {\n  constructor(public key: string, public value?: string, public operator?: FilterType) {\n    super();\n  }\n  public static type = 'add-filter';\n}\n\nexport type NumericFilterType = NumericFilterOp.gt | NumericFilterOp.gte | NumericFilterOp.lt | NumericFilterOp.lte;\n\n/**\n * Filter types:\n * - include/exclude: add a negative or positive filter\n * - clear: remove filter if exists\n * - toggle: if the filter does not exist, add as include; if exists, remove\n */\nexport type FilterType = 'include' | 'clear' | 'exclude' | 'toggle';\n\nexport function addAdHocFilter(filter: AdHocVariableFilter, scene: SceneObject, variableType: InterpolatedFilterType) {\n  const type: FilterType = filter.operator === '=' ? 'include' : 'exclude';\n  addToFilters(filter.key, filter.value, type, scene, variableType);\n}\n\nexport type InterpolatedFilterType = typeof VAR_LABELS | typeof VAR_FIELDS | typeof VAR_LEVELS | typeof VAR_METADATA;\nexport type UIVariableFilterType = typeof VAR_LEVELS | typeof VAR_FIELDS_AND_METADATA;\nexport type AdHocFilterTypes = InterpolatedFilterType | typeof VAR_LABELS_REPLICA | typeof VAR_FIELDS_AND_METADATA;\n\nexport function clearFilters(\n  key: string,\n  scene: SceneObject,\n  variableType: InterpolatedFilterType,\n  value?: string,\n  operator?: FilterType\n) {\n  const variable = getUIAdHocVariable(variableType, key, scene);\n\n  let filters = variable.state.filters.filter((filter) => {\n    const fieldValue = getValueFromAdHocVariableFilter(variableType, filter);\n    if (value && operator) {\n      return !(filter.key === key && fieldValue.value === value && filter.operator === operator);\n    }\n    if (value) {\n      return !(filter.key === key && fieldValue.value === value);\n    }\n    if (operator) {\n      return !(filter.key === key && filter.operator === operator);\n    }\n\n    return !(filter.key === key);\n  });\n\n  scene.publishEvent(new ClearFilterEvent(key, value, operator), true);\n\n  variable.setState({\n    filters,\n  });\n}\n\ntype OperatorType = 'greater' | 'lesser';\nconst getNumericOperatorType = (op: NumericFilterType | string): OperatorType | undefined => {\n  if (op === FilterOp.gt || op === FilterOp.gte) {\n    return 'greater';\n  }\n  if (op === FilterOp.lt || op === FilterOp.lte) {\n    return 'lesser';\n  }\n  return undefined;\n};\n\nexport function removeNumericFilter(\n  key: string,\n  scene: SceneObject,\n  operator?: NumericFilterType,\n  variableType?: InterpolatedFilterType\n) {\n  if (!variableType) {\n    variableType = resolveVariableTypeForField(key, scene);\n  }\n  const variable = getUIAdHocVariable(variableType, key, scene);\n  const operatorType = operator ? getNumericOperatorType(operator) : undefined;\n\n  let filters = variable.state.filters.filter((filter) => {\n    return !(\n      filter.key === key &&\n      (getNumericOperatorType(filter.operator) === operatorType || filter.operator === FilterOp.NotEqual)\n    );\n  });\n\n  variable.setState({\n    filters,\n  });\n}\n\nexport function addNumericFilter(\n  key: string,\n  value: string,\n  operator: NumericFilterType,\n  scene: SceneObject,\n  variableType?: InterpolatedFilterType\n) {\n  const operatorType = getNumericOperatorType(operator);\n\n  if (!variableType) {\n    variableType = resolveVariableTypeForField(key, scene);\n  }\n  const variable = getUIAdHocVariable(variableType, key, scene);\n\n  let valueObject: string | undefined = undefined;\n  if (variableType === VAR_FIELDS) {\n    valueObject = JSON.stringify({\n      value,\n      parser: getParserForField(key, scene),\n    });\n  }\n\n  let filters = variable.state.filters.filter((filter) => {\n    return !(\n      filter.key === key &&\n      (getNumericOperatorType(filter.operator) === operatorType || filter.operator === FilterOp.NotEqual)\n    );\n  });\n\n  filters = [\n    ...filters,\n    {\n      key,\n      operator: operator,\n      value: valueObject ? valueObject : value,\n      valueLabels: [value],\n    },\n  ];\n\n  variable.setState({\n    filters,\n  });\n\n  scene.publishEvent(new AddFilterEvent('filterButton', operator, key, value), true);\n}\n\n/**\n * Helper for buttons in the UI\n * toggles an ad hoc filter to a given variable type\n */\nexport function addToFilters(\n  key: string,\n  value: string,\n  operator: FilterType,\n  scene: SceneObject,\n  variableType: InterpolatedFilterType\n) {\n  // Add the current url to browser history before the state is changed so the user can revert their change.\n  addCurrentUrlToHistory();\n\n  if (variableType === VAR_LABELS) {\n    addToFavorites(key, value, scene);\n  }\n\n  const variable = getUIAdHocVariable(variableType, key, scene);\n\n  let valueObject: string | undefined = undefined;\n  let valueLabel = value;\n  if (variableType === VAR_FIELDS) {\n    valueObject = JSON.stringify({\n      value,\n      parser: getParserForField(key, scene),\n    });\n  } else if (variableType === VAR_LEVELS && operator === 'exclude') {\n    valueLabel = `!${value}`;\n  }\n\n  // If the filter exists, filter it\n  let filters = variable.state.filters.filter((filter) => {\n    const fieldValue = getValueFromAdHocVariableFilter(variableType, filter);\n\n    // if we're including, we want to remove all filters that have this key\n    if (operator === 'include') {\n      return !(filter.key === key && filter.operator === FilterOp.NotEqual);\n    }\n    if (operator === 'exclude') {\n      return !(filter.key === key && filter.operator === FilterOp.Equal);\n    }\n\n    return !(filter.key === key && fieldValue.value === value);\n  });\n\n  const filterExists = filters.length !== variable.state.filters.length;\n\n  if (operator === 'include' || operator === 'exclude' || (!filterExists && operator === 'toggle')) {\n    filters = [\n      ...filters,\n      {\n        key,\n        operator: operator === 'exclude' ? FilterOp.NotEqual : FilterOp.Equal,\n        value: valueObject ? valueObject : value,\n        valueLabels: [valueLabel],\n      },\n    ];\n  }\n\n  // Variable needs to be updated before event is published!\n  variable.setState({\n    filters,\n  });\n\n  scene.publishEvent(new AddFilterEvent('filterButton', operator, key, value), true);\n}\n\nexport function replaceFilter(\n  key: string,\n  value: string,\n  operator: Extract<FilterType, 'include' | 'exclude'>,\n  scene: SceneObject,\n  variableType: InterpolatedFilterType\n) {\n  const variable = getUIAdHocVariable(variableType, key, scene);\n\n  variable.setState({\n    filters: [\n      {\n        key,\n        operator: operator === 'exclude' ? FilterOp.NotEqual : FilterOp.Equal,\n        value,\n      },\n    ],\n    hide: VariableHide.hideLabel,\n  });\n}\n\nexport function validateVariableNameForField(field: string, variableName: InterpolatedFilterType) {\n  // Special case: If the key is LEVEL_VARIABLE_VALUE, we need to use the VAR_FIELDS.\n  if (field === LEVEL_VARIABLE_VALUE) {\n    return VAR_LEVELS;\n  }\n  return variableName;\n}\n\nfunction resolveVariableTypeForField(field: string, scene: SceneObject): InterpolatedFilterType {\n  const indexedLabel = getDetectedLabelsFrame(scene)?.fields?.find((label) => label.name === field);\n  return indexedLabel ? VAR_LABELS : VAR_FIELDS;\n}\n\nexport class AddToFiltersButton extends SceneObjectBase<AddToFiltersButtonState> {\n  constructor(state: AddToFiltersButtonState) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const filter = getFilter(this.state.frame);\n    if (filter) {\n      const variable = getUIAdHocVariable(this.state.variableName, filter.name, this);\n      this.setFilterState(variable);\n\n      this._subs.add(\n        variable.subscribeToState((newState, prevState) => {\n          if (!areArraysEqual(newState.filters, prevState.filters)) {\n            this.setFilterState(variable);\n          }\n        })\n      );\n    }\n  }\n\n  private setFilterState(variable: AdHocFiltersVariable) {\n    const filter = getFilter(this.state.frame);\n    if (!filter) {\n      this.setState({\n        isIncluded: false,\n        isExcluded: false,\n      });\n      return;\n    }\n\n    // Check if the filter is already there\n    const filterInSelectedFilters = variable.state.filters.find((f) => {\n      const isMetadata = isFilterMetadata(filter);\n      const value = getValueFromAdHocVariableFilter(isMetadata ? VAR_METADATA : VAR_FIELDS, f);\n      return f.key === filter.name && value.value === filter.value;\n    });\n\n    if (!filterInSelectedFilters) {\n      this.setState({\n        isIncluded: false,\n        isExcluded: false,\n      });\n      return;\n    }\n\n    this.setState({\n      isIncluded: filterInSelectedFilters.operator === FilterOp.Equal,\n      isExcluded: filterInSelectedFilters.operator === FilterOp.NotEqual,\n    });\n  }\n\n  public onClick = (type: FilterType) => {\n    const filter = getFilter(this.state.frame);\n    if (!filter) {\n      return;\n    }\n\n    addToFilters(filter.name, filter.value, type, this, this.state.variableName);\n    const variable = getUIAdHocVariable(this.state.variableName, filter.name, this);\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.add_to_filters_in_breakdown_clicked,\n      {\n        filterType: this.state.variableName,\n        key: filter.name,\n        action: type,\n        filtersLength: variable?.state.filters.length || 0,\n      }\n    );\n  };\n\n  public static Component = ({ model }: SceneComponentProps<AddToFiltersButton>) => {\n    const { hideExclude, isExcluded, isIncluded } = model.useState();\n    return (\n      <FilterButton\n        buttonFill={'outline'}\n        isIncluded={isIncluded ?? false}\n        isExcluded={isExcluded ?? false}\n        onInclude={() => model.onClick('include')}\n        onClear={() => model.onClick('clear')}\n        onExclude={() => model.onClick('exclude')}\n        hideExclude={hideExclude}\n      />\n    );\n  };\n}\n\nconst getFilter = (frame: DataFrame) => {\n  // current filter name and value is format {name: value}\n  const filterNameAndValueObj = frame.fields[1]?.labels ?? {};\n  // Sanity check - filter should have only one key-value pair\n  if (Object.keys(filterNameAndValueObj).length !== 1) {\n    logger.warn('getFilter: unexpected empty labels');\n    return;\n  }\n  const name = Object.keys(filterNameAndValueObj)[0];\n  const value = filterNameAndValueObj[name];\n  return { name, value };\n};\n\nconst getUIAdHocVariable = (variableType: InterpolatedFilterType, key: string, scene: SceneObject) => {\n  return variableType === VAR_FIELDS || variableType === VAR_METADATA\n    ? getFieldsAndMetadataVariable(scene)\n    : getAdHocFiltersVariable(validateVariableNameForField(key, variableType), scene);\n};\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React, { ChangeEvent } from 'react';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { SearchInput } from './SearchInput';\nimport { LabelBreakdownScene } from './LabelBreakdownScene';\nimport { FieldsBreakdownScene } from './FieldsBreakdownScene';\nimport { BusEventBase } from '@grafana/data';\nimport { logger } from '../../../services/logger';\n\nexport class BreakdownSearchReset extends BusEventBase {\n  public static type = 'breakdown-search-reset';\n}\n\nexport interface BreakdownSearchSceneState extends SceneObjectState {\n  filter?: string;\n}\n\nconst recentFilters: Record<string, string> = {};\n\nexport class BreakdownSearchScene extends SceneObjectBase<BreakdownSearchSceneState> {\n  private cacheKey: string;\n  constructor(cacheKey: string) {\n    super({\n      filter: recentFilters[cacheKey] ?? '',\n    });\n    this.cacheKey = cacheKey;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<BreakdownSearchScene>) => {\n    const { filter } = model.useState();\n    return (\n      <SearchInput\n        value={filter}\n        onChange={model.onValueFilterChange}\n        onClear={model.clearValueFilter}\n        placeholder=\"Search for value\"\n      />\n    );\n  };\n\n  public onValueFilterChange = (event: ChangeEvent<HTMLInputElement>) => {\n    this.setState({ filter: event.target.value });\n    this.filterValues(event.target.value);\n  };\n\n  public clearValueFilter = () => {\n    this.setState({ filter: '' });\n    this.filterValues('');\n  };\n\n  public reset = () => {\n    this.setState({ filter: '' });\n    recentFilters[this.cacheKey] = '';\n  };\n\n  private filterValues(filter: string) {\n    const breakdownScene = sceneGraph.findObject(\n      this,\n      (o) => o instanceof LabelBreakdownScene || o instanceof FieldsBreakdownScene\n    );\n    if (breakdownScene instanceof LabelBreakdownScene || breakdownScene instanceof FieldsBreakdownScene) {\n      recentFilters[this.cacheKey] = filter;\n      const byFrameRepeater = sceneGraph.findDescendents(breakdownScene, ByFrameRepeater);\n      byFrameRepeater?.forEach((child) => {\n        if (child.state.body.isActive) {\n          child.filterByString(filter);\n        }\n      });\n    } else {\n      logger.warn('unable to find Breakdown scene', {\n        typeofBody: typeof breakdownScene,\n        filter,\n      });\n    }\n  }\n}\n","import React from 'react';\n\nimport { DataFrame, LoadingState, PanelData } from '@grafana/data';\nimport {\n  SceneByFrameRepeater,\n  SceneComponentProps,\n  SceneDataTransformer,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneLayout,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n  VizPanel,\n} from '@grafana/scenes';\nimport { sortSeries } from 'services/sorting';\nimport { fuzzySearch } from '../../../services/search';\nimport { getLabelValue } from './SortByScene';\nimport { Alert, Button } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { BreakdownSearchReset } from './BreakdownSearchScene';\nimport { map, Observable } from 'rxjs';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { VALUE_SUMMARY_PANEL_KEY } from './Panels/ValueSummary';\nimport { logger } from '../../../services/logger';\n\ninterface ByFrameRepeaterState extends SceneObjectState {\n  body: SceneLayout;\n  getLayoutChild(frame: DataFrame, frameIndex: number): SceneFlexItem;\n}\n\ntype FrameFilterCallback = (frame: DataFrame) => boolean;\ntype FrameIterateCallback = (frames: DataFrame[], seriesIndex: number) => void;\n\nexport class ByFrameRepeater extends SceneObjectBase<ByFrameRepeaterState> {\n  private unfilteredChildren: SceneFlexItem[] = [];\n  private sortBy: string;\n  private direction: string;\n  private sortedSeries: DataFrame[] = [];\n  private getFilter: () => string;\n  public constructor({\n    sortBy,\n    direction,\n    getFilter,\n    ...state\n  }: ByFrameRepeaterState & { sortBy: string; direction: string; getFilter: () => string }) {\n    super(state);\n\n    this.sortBy = sortBy;\n    this.direction = direction;\n    this.getFilter = getFilter;\n\n    this.addActivationHandler(() => {\n      const data = sceneGraph.getData(this);\n\n      this._subs.add(\n        data.subscribeToState((data, prevData) => {\n          if (\n            data.data?.state === LoadingState.Done ||\n            (data.data?.state === LoadingState.Streaming &&\n              data.data.series.length > (prevData.data?.series.length ?? 0))\n          ) {\n            this.performRepeat(data.data);\n          }\n        })\n      );\n\n      if (data.state.data) {\n        this.performRepeat(data.state.data);\n      }\n    });\n  }\n\n  public sort = (sortBy: string, direction: string) => {\n    const data = sceneGraph.getData(this);\n    this.sortBy = sortBy;\n    this.direction = direction;\n    if (data.state.data) {\n      this.performRepeat(data.state.data);\n    }\n  };\n\n  private performRepeat(data: PanelData) {\n    const newChildren: SceneFlexItem[] = [];\n    const sortedSeries = sortSeries(data.series, this.sortBy, this.direction);\n\n    for (let seriesIndex = 0; seriesIndex < sortedSeries.length; seriesIndex++) {\n      const layoutChild = this.state.getLayoutChild(sortedSeries[seriesIndex], seriesIndex);\n      newChildren.push(layoutChild);\n    }\n\n    this.sortedSeries = sortedSeries;\n    this.unfilteredChildren = newChildren;\n\n    if (this.getFilter()) {\n      this.state.body.setState({ children: [] });\n      this.filterByString(this.getFilter());\n    } else {\n      this.state.body.setState({ children: newChildren });\n    }\n  }\n\n  public iterateFrames = (callback: FrameIterateCallback) => {\n    const data = sceneGraph.getData(this).state.data;\n    if (!data) {\n      return;\n    }\n    for (let seriesIndex = 0; seriesIndex < this.sortedSeries.length; seriesIndex++) {\n      callback(this.sortedSeries, seriesIndex);\n    }\n  };\n\n  filterByString = (filter: string) => {\n    let haystack: string[] = [];\n\n    this.iterateFrames((frames, seriesIndex) => {\n      const labelValue = getLabelValue(frames[seriesIndex]);\n      haystack.push(labelValue);\n    });\n    fuzzySearch(haystack, filter, (data) => {\n      if (data && data[0]) {\n        // We got search results\n        this.filterFrames((frame: DataFrame) => {\n          const label = getLabelValue(frame);\n          return data[0].includes(label);\n        });\n      } else {\n        // reset search\n        this.filterFrames(() => true);\n      }\n\n      this.filterSummaryChart(data);\n    });\n  };\n\n  /**\n   * Filters the summary panel rendered above the breakdown panels by adding a transformation to the panel\n   * @param data\n   * @private\n   */\n  private filterSummaryChart(data: string[][]) {\n    const layoutSwitcher = sceneGraph.getAncestor(this, LayoutSwitcher);\n\n    if (layoutSwitcher) {\n      const singleGraphParent = sceneGraph.findAllObjects(\n        layoutSwitcher,\n        (obj) => obj.isActive && obj.state.key === VALUE_SUMMARY_PANEL_KEY\n      );\n      if (singleGraphParent[0] instanceof SceneFlexLayout) {\n        const panel = sceneGraph.findDescendents(singleGraphParent[0], VizPanel)[0];\n        if (panel instanceof VizPanel) {\n          panel.setState({\n            $data: new SceneDataTransformer({\n              transformations: [() => limitFramesByName(data[0])],\n            }),\n          });\n        } else {\n          logger.warn('filterSummaryChart: VizPanel not found', { typeofPanel: typeof panel });\n        }\n      } else {\n        logger.warn('filterSummaryChart: SceneFlexItem not found', { typeofGraphParent: typeof singleGraphParent });\n      }\n    }\n  }\n\n  public filterFrames = (filterFn: FrameFilterCallback) => {\n    const newChildren: SceneFlexItem[] = [];\n    this.iterateFrames((frames, seriesIndex) => {\n      if (filterFn(frames[seriesIndex])) {\n        newChildren.push(this.unfilteredChildren[seriesIndex]);\n      }\n    });\n\n    if (newChildren.length === 0) {\n      const filter = this.getFilter();\n      this.state.body.setState({ children: [buildNoResultsScene(filter, this.clearFilter)] });\n    } else {\n      this.state.body.setState({ children: newChildren });\n    }\n  };\n\n  public clearFilter = () => {\n    this.publishEvent(new BreakdownSearchReset(), true);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<SceneByFrameRepeater>) => {\n    const { body } = model.useState();\n    return <body.Component model={body} />;\n  };\n}\n\nfunction buildNoResultsScene(filter: string, clearFilter: () => void) {\n  return new SceneFlexLayout({\n    direction: 'row',\n    children: [\n      new SceneFlexItem({\n        body: new SceneReactObject({\n          reactNode: (\n            <div className={styles.alertContainer}>\n              <Alert title=\"\" severity=\"info\" className={styles.noResultsAlert}>\n                No values found matching &ldquo;{filter}&rdquo;\n                <Button className={styles.clearButton} onClick={clearFilter}>\n                  Clear filter\n                </Button>\n              </Alert>\n            </div>\n          ),\n        }),\n      }),\n    ],\n  });\n}\n\nconst styles = {\n  alertContainer: css({\n    flexGrow: 1,\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n  }),\n  noResultsAlert: css({\n    minWidth: '30vw',\n    flexGrow: 0,\n  }),\n  clearButton: css({\n    marginLeft: '1.5rem',\n  }),\n};\n\nexport function limitFramesByName(matches: string[]) {\n  return (source: Observable<DataFrame[]>) => {\n    return source.pipe(\n      map((frames) => {\n        if (!matches || !matches.length) {\n          return frames;\n        }\n        let newFrames: DataFrame[] = [];\n        frames.forEach((f) => {\n          const label = getLabelValue(f);\n          if (matches.includes(label)) {\n            newFrames.push(f);\n          }\n        });\n        return newFrames;\n      })\n    );\n  };\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { GrotError } from '../../GrotError';\nimport { Alert } from '@grafana/ui';\nimport React from 'react';\nimport { emptyStateStyles } from './FieldsBreakdownScene';\n\nexport interface EmptyLayoutSceneState extends SceneObjectState {\n  type: 'fields' | 'labels';\n}\n\nexport class EmptyLayoutScene extends SceneObjectBase<EmptyLayoutSceneState> {\n  public static Component({ model }: SceneComponentProps<EmptyLayoutScene>) {\n    const { type } = model.useState();\n    return (\n      <GrotError>\n        <Alert title=\"\" severity=\"warning\">\n          We did not find any {type} for the given timerange. Please{' '}\n          <a\n            className={emptyStateStyles.link}\n            href=\"https://forms.gle/1sYWCTPvD72T1dPH9\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            let us know\n          </a>{' '}\n          if you think this is a mistake.\n        </Alert>\n      </GrotError>\n    );\n  }\n}\n","import { css } from '@emotion/css';\nimport React, { useState } from 'react';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { Select, useStyles2, InlineField, Icon, ActionMeta, InputActionMeta } from '@grafana/ui';\nimport { testIds } from '../../../services/testIds';\nimport { VariableValueOption } from '@grafana/scenes';\n\nimport { wrapWildcardSearch } from '../../../services/query';\n\ntype Props<T> = {\n  options: VariableValueOption[];\n  value?: T;\n  onChange: (label: T | undefined) => void;\n  label: string;\n};\n\nexport type AsyncFieldSelectorProps = {\n  selectOption: (value: string) => void;\n  isLoading: boolean;\n  initialFilter: SelectableValue<string>;\n} & Props<string>;\n\nexport function FieldSelector<T>({ options, value, onChange, label }: Props<T>) {\n  const styles = useStyles2(getStyles);\n  const [selected, setSelected] = useState(false);\n\n  const selectableOptions: SelectableValue[] = options.map((option) => {\n    return {\n      label: option.label,\n      value: option.value,\n    };\n  });\n  return (\n    <InlineField className={styles.selectWrapper} label={label}>\n      <Select\n        {...{ options: selectableOptions, value }}\n        onOpenMenu={() => setSelected(true)}\n        onCloseMenu={() => setSelected(false)}\n        onChange={(selected: SelectableValue<T>) => onChange(selected.value)}\n        className={styles.select}\n        prefix={selected ? undefined : <Icon name={'search'} />}\n      />\n    </InlineField>\n  );\n}\n\nexport function ServiceFieldSelector({\n  options,\n  value,\n  onChange,\n  label,\n  selectOption,\n  isLoading,\n  initialFilter,\n}: AsyncFieldSelectorProps) {\n  const styles = useStyles2(getStyles);\n  const [selected, setSelected] = useState(false);\n  const [customOption, setCustomOption] = useState<SelectableValue<string>>(initialFilter);\n\n  const selectableOptions: SelectableValue[] = options.map((option) => {\n    return {\n      label: option.label,\n      value: option.value,\n    };\n  });\n  const allOptions =\n    customOption && value && customOption.value?.includes(value)\n      ? [customOption, ...selectableOptions]\n      : selectableOptions;\n\n  const selectedOption = allOptions?.find((opt) => opt.value === value);\n\n  return (\n    <InlineField className={styles.serviceSceneSelectWrapper} label={label}>\n      <Select\n        isLoading={isLoading}\n        data-testid={testIds.exploreServiceSearch.search}\n        placeholder={`Search values`}\n        options={allOptions}\n        isClearable={true}\n        value={value}\n        onOpenMenu={() => setSelected(true)}\n        onCloseMenu={() => setSelected(false)}\n        allowCustomValue={true}\n        prefix={selected || selectedOption?.__isNew__ ? undefined : <Icon name={'search'} />}\n        onChange={(value: SelectableValue<string>, actionMeta: ActionMeta) => {\n          // Custom added value\n          if (value?.__isNew__ || value?.icon) {\n            setCustomOption({ ...value, icon: 'filter' });\n            return onChange(value.value);\n          }\n\n          // If the user clears the search\n          if (actionMeta.action === 'clear') {\n            return onChange('');\n          }\n\n          // Select the service is the value is not a custom filter\n          if (actionMeta.action === 'select-option' && value.value && !value.__isNew__) {\n            selectOption(value.value);\n          }\n        }}\n        onInputChange={(value: string | undefined, actionMeta: InputActionMeta) => {\n          // Grafana/grafana doesn't have types from react-select, but we need the prevInput to add custom value when user clicks off with active search string\n          const meta = actionMeta as InputActionMeta & { prevInputValue: string };\n\n          // The user is typing\n          if (meta.action === 'input-change') {\n            return onChange(value);\n          }\n\n          // the user closed the menu, with text in search box\n          if (meta.action === 'menu-close' && meta.prevInputValue) {\n            setCustomOption({\n              value: wrapWildcardSearch(meta.prevInputValue),\n              label: meta.prevInputValue,\n              icon: 'filter',\n              __isNew__: true,\n            });\n            return onChange(meta.prevInputValue);\n          }\n        }}\n      />\n    </InlineField>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    input: css({\n      marginBottom: 0,\n    }),\n    select: css({\n      maxWidth: theme.spacing(64),\n      minWidth: theme.spacing(20),\n    }),\n    selectWrapper: css({\n      label: 'field-selector-select-wrapper',\n      maxWidth: theme.spacing(62.5),\n      minWidth: theme.spacing(20),\n      marginRight: theme.spacing.x1,\n      marginBottom: 0,\n    }),\n    serviceSceneSelectWrapper: css({\n      label: 'service-select-wrapper',\n      maxWidth: theme.spacing(62.5),\n      minWidth: theme.spacing(20),\n      marginRight: theme.spacing.x1,\n      marginBottom: 0,\n    }),\n  };\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridLayout,\n  SceneDataProvider,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  SceneReactObject,\n} from '@grafana/scenes';\nimport { buildDataQuery, renderLogQLFieldFilters, renderLogQLMetadataFilters } from '../../../services/query';\nimport { getSortByPreference } from '../../../services/store';\nimport { DataQueryError, LoadingState } from '@grafana/data';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { getQueryRunner } from '../../../services/panel';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { Alert, DrawStyle, LoadingPlaceholder, useStyles2 } from '@grafana/ui';\nimport {\n  buildFieldsQueryString,\n  getFilterBreakdownValueScene,\n  getParserForField,\n  getParserFromFieldsFilters,\n} from '../../../services/fields';\nimport { getLabelValue } from './SortByScene';\nimport { ParserType, VAR_FIELDS, VAR_METADATA } from '../../../services/variables';\nimport React from 'react';\nimport { FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS, FieldsBreakdownScene } from './FieldsBreakdownScene';\nimport { getDetectedFieldsFrame } from '../ServiceScene';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport {\n  getFieldGroupByVariable,\n  getFieldsVariable,\n  getLabelsVariable,\n  getLevelsVariable,\n  getLineFiltersVariable,\n  getMetadataVariable,\n  getPatternsVariable,\n} from '../../../services/variableGetters';\nimport { LokiQuery } from '../../../services/lokiQuery';\nimport { getPanelWrapperStyles, PanelMenu } from '../../Panels/PanelMenu';\nimport { ValueSummaryPanelScene } from './Panels/ValueSummary';\nimport { areArraysEqual } from '../../../services/comparison';\nimport { logger } from '../../../services/logger';\n\nexport interface FieldValuesBreakdownSceneState extends SceneObjectState {\n  body?: (LayoutSwitcher & SceneObject) | (SceneReactObject & SceneObject);\n  $data?: SceneDataProvider;\n}\n\nexport class FieldValuesBreakdownScene extends SceneObjectBase<FieldValuesBreakdownSceneState> {\n  constructor(state: Partial<FieldValuesBreakdownSceneState>) {\n    super(state);\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public static Selector({ model }: SceneComponentProps<FieldValuesBreakdownScene>) {\n    const { body } = model.useState();\n    if (body instanceof LayoutSwitcher) {\n      return <>{body && <LayoutSwitcher.Selector model={body} />}</>;\n    }\n\n    return <></>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<FieldValuesBreakdownScene>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getPanelWrapperStyles);\n    if (body) {\n      return <span className={styles.panelWrapper}>{body && <body.Component model={body} />}</span>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n\n  private getTagKey() {\n    const groupByVariable = getFieldGroupByVariable(this);\n    return String(groupByVariable.state.value);\n  }\n\n  onActivate() {\n    const query = this.buildQuery();\n\n    // Set query runner\n    this.setState({\n      body: this.build(query),\n      $data: this.buildQueryRunner(),\n    });\n\n    // Subscribe to data query changes\n    this._subs.add(\n      this.state.$data?.subscribeToState((newState) => {\n        this.onValuesDataQueryChange(newState, query);\n      })\n    );\n\n    this.runQuery();\n    this.setSubscriptions();\n  }\n\n  private buildQueryRunner() {\n    const query = this.buildQuery();\n    return getQueryRunner([query], { runQueriesMode: 'manual' });\n  }\n\n  /**\n   * Builds the LokiQuery for the value breakdown\n   */\n  private buildQuery() {\n    const tagKey = this.getTagKey();\n    const fieldsVariable = getFieldsVariable(this);\n    const detectedFieldsFrame = getDetectedFieldsFrame(this);\n    const queryString = buildFieldsQueryString(tagKey, fieldsVariable, detectedFieldsFrame);\n    // Manually interpolate query so we don't pollute the variable interpolation for other queries\n    const { variableName, filterExpression } = this.removeFieldLabelFromVariableInterpolation();\n    const expression = sceneGraph.interpolate(this, queryString.replace(`$\\{${variableName}}`, filterExpression));\n\n    return buildDataQuery(expression, { legendFormat: `{{${tagKey}}}`, refId: tagKey });\n  }\n\n  /**\n   * Sets activation subscriptions\n   */\n  private setSubscriptions() {\n    // Subscribe to time range changes\n    this._subs.add(\n      sceneGraph.getTimeRange(this).subscribeToState(() => {\n        // Run query on time range change\n        this.runQuery();\n      })\n    );\n\n    // VARIABLE SUBS\n    // Subscribe to line filter changes\n    this._subs.add(\n      getLineFiltersVariable(this).subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.runQuery();\n        }\n      })\n    );\n\n    // Subscribe to pattern filter changes\n    this._subs.add(\n      getPatternsVariable(this).subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          this.runQuery();\n        }\n      })\n    );\n\n    // Subscribe to labels variable changes\n    this._subs.add(\n      getLabelsVariable(this).subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.runQuery();\n        }\n      })\n    );\n\n    // Subscribe to levels variable changes\n    this._subs.add(\n      getLevelsVariable(this).subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.runQuery();\n        }\n      })\n    );\n\n    const { parser } = this.getParserForThisField();\n\n    if (parser !== 'structuredMetadata') {\n      this.setFieldParserSubscriptions();\n    } else {\n      this.setMetadataParserSubscriptions();\n    }\n  }\n\n  /**\n   * Subscribe to variables for metadata breakdowns\n   */\n  private setMetadataParserSubscriptions() {\n    const key = this.getTagKey();\n    // Subscribe to any fields change and run the query without change\n    this._subs.add(\n      getFieldsVariable(this).subscribeToState(async (newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.runQuery();\n        }\n      })\n    );\n\n    this._subs.add(\n      getMetadataVariable(this).subscribeToState(async (newState, prevState) => {\n        if (\n          !areArraysEqual(\n            newState.filters.filter((f) => f.key !== key),\n            prevState.filters.filter((f) => f.key !== key)\n          )\n        ) {\n          this.runQuery();\n        }\n      })\n    );\n  }\n\n  /**\n   * Subscribe to variables for field breakdowns\n   */\n  private setFieldParserSubscriptions() {\n    const key = this.getTagKey();\n    // Subscribe to any metadata change and run the query without alteration\n    this._subs.add(\n      getMetadataVariable(this).subscribeToState(async (newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.runQuery();\n        }\n      })\n    );\n    // Subscribe to fields variable, run the query if the change wasn't for this label\n    this._subs.add(\n      getFieldsVariable(this).subscribeToState(async (newState, prevState) => {\n        if (\n          !areArraysEqual(\n            newState.filters.filter((f) => f.key !== key),\n            prevState.filters.filter((f) => f.key !== key)\n          )\n        ) {\n          this.runQuery();\n        }\n      })\n    );\n  }\n\n  /**\n   * Rebuild the query before running.\n   * If so update the query with the new parser and set the parser to state.\n   */\n  private rebuildQuery() {\n    const query = this.buildQuery();\n    this.getSceneQueryRunner()?.setState({\n      queries: [query],\n    });\n  }\n\n  /**\n   * Run the field values breakdown query.\n   * Generates the filterExpression excluding all filters with a key that matches the label.\n   */\n  private runQuery() {\n    // Update the filters to exclude the current value so all options are displayed to the user\n    this.rebuildQuery();\n    const queryRunner = this.getSceneQueryRunner();\n    queryRunner?.runQueries();\n  }\n\n  /**\n   * Returns the query runner\n   */\n  private getSceneQueryRunner() {\n    if (this.state.$data) {\n      const queryRunners = sceneGraph.findDescendents(this.state.$data, SceneQueryRunner);\n      if (queryRunners.length !== 1) {\n        const error = new Error('Unable to find query runner in value breakdown!');\n        logger.error(error, { msg: 'FieldValuesBreakdownScene: Unable to find query runner in value breakdown!' });\n        throw error;\n      }\n\n      return queryRunners[0];\n    }\n    logger.warn('FieldValuesBreakdownScene: Query is attempting to execute, but query runner is undefined!');\n    return undefined;\n  }\n\n  /**\n   * Sets the expression builder to exclude the current field label\n   */\n  private removeFieldLabelFromVariableInterpolation() {\n    const tagKey = this.getTagKey();\n    let filterExpression;\n    let variableName: typeof VAR_FIELDS | typeof VAR_METADATA;\n\n    // We want the parser for this field, we only need to exclude keys for the variable type that matches this value breakdown\n    const parser = this.getQueryParser();\n    if (parser === 'structuredMetadata') {\n      const metadataVar = getMetadataVariable(this);\n      variableName = VAR_METADATA;\n      filterExpression = renderLogQLMetadataFilters(metadataVar.state.filters, [tagKey]);\n    } else {\n      variableName = VAR_FIELDS;\n      const fieldsVar = getFieldsVariable(this);\n      filterExpression = renderLogQLFieldFilters(fieldsVar.state.filters, [tagKey]);\n    }\n\n    return { filterExpression, variableName };\n  }\n\n  /**\n   * Actions to run when the value breakdown query response is received.\n   */\n  private onValuesDataQueryChange(newState: SceneDataState, query: LokiQuery) {\n    if (newState.data?.state === LoadingState.Done) {\n      if (this.state.body instanceof SceneReactObject) {\n        this.setState({\n          body: this.build(query),\n        });\n      }\n    }\n    if (newState.data?.state === LoadingState.Error) {\n      this.setErrorState(newState.data.errors);\n    }\n  }\n\n  /**\n   * Sets the error body state\n   */\n  private setErrorState(errors: DataQueryError[] | undefined) {\n    this.setState({\n      body: new SceneReactObject({\n        reactNode: (\n          <Alert title={'Something went wrong with your request'} severity={'error'}>\n            {errors?.map((err, key) => (\n              <div key={key}>\n                {err.status && (\n                  <>\n                    <strong>Status</strong>: {err.status} <br />\n                  </>\n                )}\n                {err.message && (\n                  <>\n                    <strong>Message</strong>: {err.message} <br />\n                  </>\n                )}\n                {err.traceId && (\n                  <>\n                    <strong>TraceId</strong>: {err.traceId}\n                  </>\n                )}\n              </div>\n            ))}\n          </Alert>\n        ),\n      }),\n    });\n  }\n\n  /**\n   * Builds the layout switcher\n   */\n  private build(query: LokiQuery) {\n    const { optionValue, parser } = this.getParserForThisField();\n    const { sortBy, direction } = getSortByPreference('fields', DEFAULT_SORT_BY, 'desc');\n    const fieldsBreakdownScene = sceneGraph.getAncestor(this, FieldsBreakdownScene);\n    const getFilter = () => fieldsBreakdownScene.state.search.state.filter ?? '';\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'single', label: 'Single' },\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        // Single\n        new SceneFlexLayout({\n          direction: 'column',\n          children: [\n            new SceneReactObject({\n              reactNode: <FieldsBreakdownScene.LabelsMenu model={fieldsBreakdownScene} />,\n            }),\n            new SceneFlexItem({\n              minHeight: 300,\n              body: PanelBuilders.timeseries()\n                .setTitle(optionValue)\n                // 11.5\n                // .setShowMenuAlways(true)\n                .setMenu(new PanelMenu({}))\n                .build(),\n            }),\n          ],\n        }),\n\n        // Grid\n        new SceneFlexLayout({\n          direction: 'column',\n          children: [\n            new SceneReactObject({\n              reactNode: <FieldsBreakdownScene.LabelsMenu model={fieldsBreakdownScene} />,\n            }),\n            new ValueSummaryPanelScene({ title: optionValue, type: 'field', tagKey: this.getTagKey() }),\n            new SceneReactObject({\n              reactNode: <FieldsBreakdownScene.ValuesMenu model={fieldsBreakdownScene} />,\n            }),\n            new ByFrameRepeater({\n              body: new SceneCSSGridLayout({\n                templateColumns: FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n                autoRows: '200px',\n                children: [\n                  new SceneFlexItem({\n                    body: new SceneReactObject({\n                      reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                    }),\n                  }),\n                ],\n                isLazy: true,\n              }),\n              getLayoutChild: getFilterBreakdownValueScene(\n                getLabelValue,\n                query?.expr.includes('count_over_time') ? DrawStyle.Bars : DrawStyle.Line,\n                parser === 'structuredMetadata' ? VAR_METADATA : VAR_FIELDS,\n                sceneGraph.getAncestor(this, FieldsBreakdownScene).state.sort,\n                optionValue\n              ),\n              sortBy,\n              direction,\n              getFilter,\n            }),\n          ],\n        }),\n\n        // Rows\n        new SceneFlexLayout({\n          direction: 'column',\n          children: [\n            new SceneReactObject({\n              reactNode: <FieldsBreakdownScene.LabelsMenu model={fieldsBreakdownScene} />,\n            }),\n            new ValueSummaryPanelScene({ title: optionValue, type: 'field', tagKey: this.getTagKey() }),\n            new SceneReactObject({\n              reactNode: <FieldsBreakdownScene.ValuesMenu model={fieldsBreakdownScene} />,\n            }),\n            new ByFrameRepeater({\n              body: new SceneCSSGridLayout({\n                templateColumns: '1fr',\n                autoRows: '200px',\n                children: [\n                  new SceneFlexItem({\n                    body: new SceneReactObject({\n                      reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                    }),\n                  }),\n                ],\n                isLazy: true,\n              }),\n              getLayoutChild: getFilterBreakdownValueScene(\n                getLabelValue,\n                query?.expr.includes('count_over_time') ? DrawStyle.Bars : DrawStyle.Line,\n                parser === 'structuredMetadata' ? VAR_METADATA : VAR_FIELDS,\n                sceneGraph.getAncestor(this, FieldsBreakdownScene).state.sort,\n                optionValue\n              ),\n              sortBy,\n              direction,\n              getFilter,\n            }),\n          ],\n        }),\n      ],\n    });\n  }\n\n  /**\n   * Gets the parser for the value breakdown\n   */\n  private getParserForThisField() {\n    const groupByVariable = getFieldGroupByVariable(this);\n    const optionValue = String(groupByVariable.state.value);\n    const parserForThisField = getParserForField(optionValue, this);\n    return { optionValue, parser: parserForThisField };\n  }\n\n  /**\n   * Gets the parser needed for fields variables\n   */\n  private getParserForFields() {\n    return getParserFromFieldsFilters(getFieldsVariable(this));\n  }\n\n  /**\n   * Gets the parser needed to run a query for the field variable and the breakdown field\n   */\n  private getQueryParser(): ParserType {\n    const { parser } = this.getParserForThisField();\n    const parserForFields = this.getParserForFields();\n\n    // If the parser needed to parse this field matches the parser needed to parse the fields\n    if (parser === parserForFields) {\n      return parserForFields;\n    }\n    // If there is no parser in the detected_fields frame for this field, let's play it safe and return mixed\n    if (parser === undefined) {\n      return 'mixed';\n    }\n    // If the parser for the breakdown field is metadata, return the parser for fields\n    if (parser === 'structuredMetadata') {\n      return parserForFields;\n    }\n    // if the parser for fields is metadata, return parser for the breakdown field\n    if (parserForFields === 'structuredMetadata') {\n      return parser;\n    }\n    return 'mixed';\n  }\n}\n","import {\n  PanelBuilders,\n  QueryRunnerState,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\nimport { ALL_VARIABLE_VALUE, DetectedFieldType, ParserType } from '../../../services/variables';\nimport { buildDataQuery } from '../../../services/query';\nimport { getQueryRunner, setLevelColorOverrides } from '../../../services/panel';\nimport { DrawStyle, LoadingPlaceholder, StackingMode, useStyles2 } from '@grafana/ui';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS, FieldsBreakdownScene } from './FieldsBreakdownScene';\nimport {\n  getDetectedFieldsFrame,\n  getDetectedFieldsFrameFromQueryRunnerState,\n  getDetectedFieldsNamesFromQueryRunnerState,\n  getDetectedFieldsParsersFromQueryRunnerState,\n  ServiceScene,\n} from '../ServiceScene';\nimport React from 'react';\nimport { SelectLabelActionScene } from './SelectLabelActionScene';\nimport { ValueSlugs } from '../../../services/routing';\nimport { DataFrame, LoadingState } from '@grafana/data';\nimport {\n  buildFieldsQueryString,\n  extractParserFromArray,\n  getDetectedFieldType,\n  isAvgField,\n} from '../../../services/fields';\nimport {\n  getFieldGroupByVariable,\n  getFieldsVariable,\n  getValueFromFieldsFilter,\n} from '../../../services/variableGetters';\nimport { AvgFieldPanelType, getPanelWrapperStyles, PanelMenu } from '../../Panels/PanelMenu';\nimport { logger } from '../../../services/logger';\nimport { getPanelOption } from '../../../services/store';\nimport { MAX_NUMBER_OF_TIME_SERIES } from './TimeSeriesLimit';\n\nexport interface FieldsAggregatedBreakdownSceneState extends SceneObjectState {\n  body?: LayoutSwitcher;\n}\n\nexport class FieldsAggregatedBreakdownScene extends SceneObjectBase<FieldsAggregatedBreakdownSceneState> {\n  constructor(state: Partial<FieldsAggregatedBreakdownSceneState>) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onDetectedFieldsChange = (newState: QueryRunnerState) => {\n    if (newState.data?.state === LoadingState.Done) {\n      //@todo cardinality looks wrong in API response\n      this.updateChildren(newState);\n    }\n  };\n\n  private updateChildren(newState: QueryRunnerState, newParser: ParserType | undefined = undefined) {\n    const detectedFieldsFrame = getDetectedFieldsFrameFromQueryRunnerState(newState);\n    const newNamesField = getDetectedFieldsNamesFromQueryRunnerState(newState);\n    const newParsersField = getDetectedFieldsParsersFromQueryRunnerState(newState);\n    const cardinalityMap = this.calculateCardinalityMap(newState);\n\n    // Iterate through all the layouts\n    this.state.body?.state.layouts.forEach((layout) => {\n      if (layout instanceof SceneCSSGridLayout) {\n        // populate set of new list of fields\n        const newFieldsSet = new Set<string>(newNamesField?.values);\n        const updatedChildren = layout.state.children as SceneCSSGridItem[];\n\n        // Iterate through all the existing panels\n        for (let i = 0; i < updatedChildren.length; i++) {\n          const gridItem = layout.state.children[i];\n          if (gridItem instanceof SceneCSSGridItem) {\n            const panel = gridItem.state.body;\n            if (panel instanceof VizPanel) {\n              if (newParser) {\n                const index = newNamesField?.values.indexOf(panel.state.title);\n                const existingParser = index && index !== -1 ? newParsersField?.values[index] : undefined;\n\n                // If a new field filter was added that updated the parsers, we'll need to rebuild the query\n                if (existingParser !== newParser) {\n                  const fieldType = getDetectedFieldType(panel.state.title, detectedFieldsFrame);\n                  const dataTransformer = this.getQueryRunnerForPanel(\n                    panel.state.title,\n                    detectedFieldsFrame,\n                    fieldType\n                  );\n                  panel.setState({\n                    $data: dataTransformer,\n                  });\n                }\n              }\n\n              if (newFieldsSet.has(panel.state.title)) {\n                // If the new response has this field, delete it from the set, but leave it in the layout\n                newFieldsSet.delete(panel.state.title);\n              } else {\n                // Otherwise if the panel doesn't exist in the response, delete it from the layout\n                updatedChildren.splice(i, 1);\n                // And make sure to update the index, or we'll skip the next one\n                i--;\n              }\n            } else {\n              logger.warn('panel is not VizPanel!');\n            }\n          } else {\n            logger.warn('gridItem is not SceneCSSGridItem');\n          }\n        }\n\n        const fieldsToAdd = Array.from(newFieldsSet);\n        const options = fieldsToAdd.map((fieldName) => fieldName);\n\n        updatedChildren.push(...this.buildChildren(options));\n        updatedChildren.sort(this.sortChildren(cardinalityMap));\n\n        updatedChildren.map((child) => {\n          this.subscribeToPanel(child);\n        });\n\n        layout.setState({\n          children: updatedChildren,\n        });\n      } else {\n        logger.warn('Layout is not SceneCSSGridLayout');\n      }\n    });\n  }\n\n  private sortChildren(cardinalityMap: Map<string, number>) {\n    return (a: SceneCSSGridItem, b: SceneCSSGridItem) => {\n      const aPanel = a.state.body as VizPanel;\n      const bPanel = b.state.body as VizPanel;\n      const aCardinality = cardinalityMap.get(aPanel.state.title) ?? 0;\n      const bCardinality = cardinalityMap.get(bPanel.state.title) ?? 0;\n      return bCardinality - aCardinality;\n    };\n  }\n\n  private calculateCardinalityMap(newState?: QueryRunnerState) {\n    const detectedFieldsFrame = getDetectedFieldsFrameFromQueryRunnerState(newState);\n    const cardinalityMap = new Map<string, number>();\n    if (detectedFieldsFrame?.length) {\n      for (let i = 0; i < detectedFieldsFrame?.length; i++) {\n        const name: string = detectedFieldsFrame.fields[0].values[i];\n        const cardinality: number = detectedFieldsFrame.fields[1].values[i];\n        cardinalityMap.set(name, cardinality);\n      }\n    }\n    return cardinalityMap;\n  }\n\n  onActivate() {\n    this.setState({\n      body: this.build(),\n    });\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    if (serviceScene.state.fieldsCount === undefined) {\n      this.updateFieldCount();\n    }\n\n    this._subs.add(serviceScene.state.$detectedFieldsData?.subscribeToState(this.onDetectedFieldsChange));\n    this._subs.add(this.subscribeToFieldsVar());\n  }\n\n  private subscribeToFieldsVar() {\n    const fieldsVar = getFieldsVariable(this);\n\n    return fieldsVar.subscribeToState((newState, prevState) => {\n      const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n      const newParsers = newState.filters.map((f) => getValueFromFieldsFilter(f).parser);\n      const oldParsers = prevState.filters.map((f) => getValueFromFieldsFilter(f).parser);\n\n      const newParser = extractParserFromArray(newParsers);\n      const oldParser = extractParserFromArray(oldParsers);\n\n      if (newParser !== oldParser) {\n        const detectedFieldsState = serviceScene.state.$detectedFieldsData?.state;\n        if (detectedFieldsState) {\n          this.updateChildren(detectedFieldsState, newParser);\n        }\n      }\n    });\n  }\n\n  public build() {\n    const groupByVariable = getFieldGroupByVariable(this);\n    const options = groupByVariable.state.options.map((opt) => String(opt.value));\n\n    const fieldsBreakdownScene = sceneGraph.getAncestor(this, FieldsBreakdownScene);\n    fieldsBreakdownScene.state.search.reset();\n\n    const children = this.buildChildren(options);\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const cardinalityMap = this.calculateCardinalityMap(serviceScene.state.$detectedFieldsData?.state);\n    children.sort(this.sortChildren(cardinalityMap));\n    const childrenClones = children.map((child) => child.clone());\n\n    // We must subscribe to the data providers for all children after the clone, or we'll see bugs in the row layout\n    [...children, ...childrenClones].map((child) => {\n      this.subscribeToPanel(child);\n    });\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        new SceneCSSGridLayout({\n          templateColumns: FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n          autoRows: '200px',\n          children: children,\n          isLazy: true,\n        }),\n        new SceneCSSGridLayout({\n          templateColumns: '1fr',\n          autoRows: '200px',\n          children: childrenClones,\n          isLazy: true,\n        }),\n      ],\n    });\n  }\n\n  private subscribeToPanel(child: SceneCSSGridItem) {\n    const panel = child.state.body as VizPanel | undefined;\n    if (panel) {\n      this._subs.add(\n        panel?.state.$data?.getResultsStream().subscribe((result) => {\n          if (result.data.errors && result.data.errors.length > 0) {\n            child.setState({ isHidden: true });\n            this.updateFieldCount();\n          }\n        })\n      );\n    }\n  }\n\n  public rebuildAvgFields() {\n    const detectedFieldsFrame = getDetectedFieldsFrame(this);\n    const activeLayout = this.getActiveGridLayouts();\n    const children: SceneCSSGridItem[] = [];\n    const panelType =\n      getPanelOption('panelType', [AvgFieldPanelType.histogram, AvgFieldPanelType.timeseries]) ??\n      AvgFieldPanelType.timeseries;\n\n    activeLayout?.state.children.forEach((child) => {\n      if (child instanceof SceneCSSGridItem && !child.state.isHidden) {\n        const panels = sceneGraph.findDescendents(child, VizPanel);\n        if (panels.length) {\n          // Will only be one panel as a child of CSSGridItem\n          const panel = panels[0];\n          const labelName = panel.state.title;\n          const fieldType = getDetectedFieldType(labelName, detectedFieldsFrame);\n          if (isAvgField(fieldType)) {\n            const newChild = this.buildChild(labelName, detectedFieldsFrame, panelType);\n            if (newChild) {\n              children.push(newChild);\n            }\n          } else {\n            children.push(child);\n          }\n        }\n      }\n    });\n\n    if (children.length) {\n      activeLayout?.setState({\n        children,\n      });\n    }\n  }\n\n  private buildChildren(options: string[]): SceneCSSGridItem[] {\n    const children: SceneCSSGridItem[] = [];\n    const detectedFieldsFrame = getDetectedFieldsFrame(this);\n    const panelType =\n      getPanelOption('panelType', [AvgFieldPanelType.timeseries, AvgFieldPanelType.histogram]) ??\n      AvgFieldPanelType.timeseries;\n    for (const option of options) {\n      if (option === ALL_VARIABLE_VALUE || !option) {\n        continue;\n      }\n\n      const child = this.buildChild(option, detectedFieldsFrame, panelType);\n      if (child) {\n        children.push(child);\n      }\n    }\n    return children;\n  }\n\n  private buildChild(labelName: string, detectedFieldsFrame: DataFrame | undefined, panelType?: AvgFieldPanelType) {\n    if (labelName === ALL_VARIABLE_VALUE || !labelName) {\n      return;\n    }\n\n    const fieldType = getDetectedFieldType(labelName, detectedFieldsFrame);\n    const dataTransformer = this.getQueryRunnerForPanel(labelName, detectedFieldsFrame, fieldType);\n    let body;\n\n    const headerActions = [];\n    if (!isAvgField(fieldType)) {\n      body = PanelBuilders.timeseries()\n        .setTitle(labelName)\n        .setData(dataTransformer)\n        .setMenu(new PanelMenu({ investigationOptions: { labelName: labelName } }))\n        .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n        .setCustomFieldConfig('fillOpacity', 100)\n        .setCustomFieldConfig('lineWidth', 0)\n        .setCustomFieldConfig('pointSize', 0)\n        .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n        .setOverrides(setLevelColorOverrides);\n      headerActions.push(new SelectLabelActionScene({ labelName: String(labelName), fieldType: ValueSlugs.field }));\n    } else {\n      if (panelType === 'histogram') {\n        body = PanelBuilders.histogram();\n      } else {\n        body = PanelBuilders.timeseries();\n      }\n      body\n        .setTitle(labelName)\n        .setData(dataTransformer)\n        .setMenu(new PanelMenu({ investigationOptions: { labelName: labelName }, panelType }));\n      headerActions.push(\n        new SelectLabelActionScene({\n          labelName: String(labelName),\n          hideValueDrilldown: true,\n          fieldType: ValueSlugs.field,\n        })\n      );\n    }\n    body.setHeaderActions(headerActions);\n    body.setSeriesLimit(MAX_NUMBER_OF_TIME_SERIES);\n    // 11.5\n    // body.setShowMenuAlways(true);\n\n    const viz = body.build();\n    return new SceneCSSGridItem({\n      body: viz,\n    });\n  }\n\n  private getQueryRunnerForPanel(\n    optionValue: string,\n    detectedFieldsFrame: DataFrame | undefined,\n    fieldType?: DetectedFieldType\n  ) {\n    const fieldsVariable = getFieldsVariable(this);\n    const queryString = buildFieldsQueryString(optionValue, fieldsVariable, detectedFieldsFrame);\n    const query = buildDataQuery(queryString, {\n      legendFormat: isAvgField(fieldType) ? optionValue : `{{${optionValue}}}`,\n      refId: optionValue,\n    });\n\n    return getQueryRunner([query]);\n  }\n\n  private getActiveGridLayouts() {\n    return (this.state.body?.state.layouts.find((l) => l.isActive) ?? this.state.body?.state.layouts[0]) as\n      | SceneCSSGridLayout\n      | undefined;\n  }\n\n  private updateFieldCount() {\n    const activeLayout = this.getActiveGridLayouts();\n    const activeLayoutChildren = activeLayout?.state.children as SceneCSSGridItem[] | undefined;\n    const activePanels = activeLayoutChildren?.filter((child) => !child.state.isHidden);\n\n    const fieldsBreakdownScene = sceneGraph.getAncestor(this, FieldsBreakdownScene);\n    fieldsBreakdownScene.state.changeFieldCount?.(activePanels?.length ?? 0);\n  }\n\n  public static Selector({ model }: SceneComponentProps<FieldsAggregatedBreakdownScene>) {\n    const { body } = model.useState();\n    return <>{body && <LayoutSwitcher.Selector model={body} />}</>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<FieldsAggregatedBreakdownScene>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getPanelWrapperStyles);\n    if (body) {\n      return <span className={styles.panelWrapper}>{body && <body.Component model={body} />}</span>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { DataFrame, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport {\n  QueryRunnerState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  VariableValueOption,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getSortByPreference } from 'services/store';\nimport { ALL_VARIABLE_VALUE, VAR_FIELD_GROUP_BY, VAR_LABELS } from 'services/variables';\nimport { areArraysEqual } from '../../../services/comparison';\nimport { CustomConstantVariable, CustomConstantVariableState } from '../../../services/CustomConstantVariable';\nimport { navigateToValueBreakdown } from '../../../services/navigate';\nimport { checkPrimaryLabel, getPrimaryLabelFromUrl, ValueSlugs } from '../../../services/routing';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport { IndexScene } from '../../IndexScene/IndexScene';\nimport { getDetectedFieldsFrame, ServiceScene } from '../ServiceScene';\nimport { BreakdownSearchReset, BreakdownSearchScene } from './BreakdownSearchScene';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { FieldsAggregatedBreakdownScene } from './FieldsAggregatedBreakdownScene';\nimport { FieldSelector } from './FieldSelector';\nimport { FieldValuesBreakdownScene } from './FieldValuesBreakdownScene';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { SortByScene, SortCriteriaChanged } from './SortByScene';\nimport { StatusWrapper } from './StatusWrapper';\nimport { getFieldOptions } from 'services/filters';\nimport { EmptyLayoutScene } from './EmptyLayoutScene';\nimport { getFieldGroupByVariable, getLabelsVariable } from '../../../services/variableGetters';\nimport { NoMatchingLabelsScene } from './NoMatchingLabelsScene';\nimport { clearVariables, getVariablesThatCanBeCleared } from '../../../services/variableHelpers';\n\nexport const averageFields = ['duration', 'count', 'total', 'bytes'];\nexport const FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\n\nexport interface FieldsBreakdownSceneState extends SceneObjectState {\n  body?:\n    | (NoMatchingLabelsScene & SceneObject)\n    | (FieldsAggregatedBreakdownScene & SceneObject)\n    | (FieldValuesBreakdownScene & SceneObject)\n    | (EmptyLayoutScene & SceneObject);\n  search: BreakdownSearchScene;\n  sort: SortByScene;\n  value?: string;\n  loading?: boolean;\n  error?: string;\n  blockingMessage?: string;\n  changeFieldCount?: (n: number) => void;\n}\n\nexport class FieldsBreakdownScene extends SceneObjectBase<FieldsBreakdownSceneState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_LABELS],\n  });\n\n  constructor(state: Partial<FieldsBreakdownSceneState> & { options?: VariableValueOption[]; value?: string }) {\n    super({\n      $variables:\n        state.$variables ??\n        new SceneVariableSet({\n          variables: [\n            new CustomConstantVariable({\n              name: VAR_FIELD_GROUP_BY,\n              defaultToAll: false,\n              includeAll: true,\n              value: state.value ?? ALL_VARIABLE_VALUE,\n              options: state.options ?? [],\n            }),\n          ],\n        }),\n      loading: true,\n      sort: new SortByScene({ target: 'fields' }),\n      search: new BreakdownSearchScene('fields'),\n      value: state.value ?? ALL_VARIABLE_VALUE,\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const groupByVariable = getFieldGroupByVariable(this);\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n\n    this.setState({\n      loading: serviceScene.state.$detectedLabelsData?.state.data?.state !== LoadingState.Done,\n    });\n\n    // Subscriptions\n    this._subs.add(\n      this.subscribeToEvent(BreakdownSearchReset, () => {\n        this.state.search.clearValueFilter();\n      })\n    );\n    this._subs.add(this.subscribeToEvent(SortCriteriaChanged, this.handleSortByChange));\n    this._subs.add(groupByVariable.subscribeToState(this.variableChanged));\n\n    this._subs.add(\n      getLabelsVariable(this).subscribeToState((newState, prevState) => {\n        const variable = getFieldGroupByVariable(this);\n        let { labelName } = getPrimaryLabelFromUrl();\n\n        const newService = newState.filters.find((filter) => filter.key === labelName);\n        const prevService = prevState.filters.find((filter) => filter.key === labelName);\n\n        // If the user changes the primary label\n        if (variable.state.value === ALL_VARIABLE_VALUE && newService !== prevService) {\n          this.setState({\n            loading: true,\n            body: undefined,\n          });\n        }\n      })\n    );\n\n    this._subs.add(\n      serviceScene.state.$detectedFieldsData?.subscribeToState(\n        (newState: QueryRunnerState, oldState: QueryRunnerState) => {\n          if (newState.data?.state === LoadingState.Done) {\n            if (newState.data.series?.[0]) {\n              this.updateOptions(newState.data.series?.[0]);\n            }\n          }\n        }\n      )\n    );\n\n    const detectedFieldsFrame = getDetectedFieldsFrame(this);\n    // Need to update labels with current state\n    if (detectedFieldsFrame) {\n      this.updateOptions(detectedFieldsFrame);\n    }\n\n    checkPrimaryLabel(this);\n  }\n\n  private variableChanged = (newState: CustomConstantVariableState, oldState: CustomConstantVariableState) => {\n    if (\n      newState.value !== oldState.value ||\n      !areArraysEqual(newState.options, oldState.options) ||\n      this.state.body === undefined ||\n      this.state.body instanceof EmptyLayoutScene ||\n      this.state.body instanceof NoMatchingLabelsScene\n    ) {\n      this.updateBody(newState);\n    }\n  };\n\n  private updateOptions(dataFrame: DataFrame) {\n    if (!dataFrame || !dataFrame.length) {\n      const indexScene = sceneGraph.getAncestor(this, IndexScene);\n      const variablesToClear = getVariablesThatCanBeCleared(indexScene);\n\n      let body;\n      if (variablesToClear.length > 1) {\n        this.state.changeFieldCount?.(0);\n        body = new NoMatchingLabelsScene({ clearCallback: () => clearVariables(this) });\n      } else {\n        body = new EmptyLayoutScene({ type: 'fields' });\n      }\n      this.setState({\n        loading: false,\n        body,\n      });\n      return;\n    }\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const variable = getFieldGroupByVariable(this);\n    variable.setState({\n      options: getFieldOptions(dataFrame.fields[0].values.map((v) => String(v))),\n      loading: false,\n      value: serviceScene.state.drillDownLabel ?? ALL_VARIABLE_VALUE,\n    });\n    this.setState({\n      loading: false,\n    });\n  }\n\n  private handleSortByChange = (event: SortCriteriaChanged) => {\n    if (event.target !== 'fields') {\n      return;\n    }\n\n    const body = this.state.body;\n    if (body instanceof FieldValuesBreakdownScene && body.state.body instanceof LayoutSwitcher) {\n      body.state.body?.state.layouts.forEach((layout) => {\n        const byFrameRepeater = sceneGraph.findDescendents(body, ByFrameRepeater);\n        byFrameRepeater.forEach((r) => r.sort(event.sortBy, event.direction));\n      });\n    }\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.value_breakdown_sort_change,\n      {\n        target: 'fields',\n        criteria: event.sortBy,\n        direction: event.direction,\n      }\n    );\n  };\n\n  private updateBody(newState: CustomConstantVariableState) {\n    const fieldsVariable = getFieldGroupByVariable(this);\n\n    // We get the labels from the service scene, if we don't have them yet, assume we're loading\n    if (!fieldsVariable.state.options || !fieldsVariable.state.options.length) {\n      return;\n    }\n\n    const stateUpdate: Partial<FieldsBreakdownSceneState> = {};\n\n    if (fieldsVariable.state.options && fieldsVariable.state.options.length <= 1) {\n      // If there's 1 or fewer fields build the empty or clear layout UI\n      const indexScene = sceneGraph.getAncestor(this, IndexScene);\n      const variablesToClear = getVariablesThatCanBeCleared(indexScene);\n\n      if (variablesToClear.length > 1) {\n        this.state.changeFieldCount?.(0);\n        stateUpdate.body = new NoMatchingLabelsScene({ clearCallback: () => clearVariables(this) });\n      } else {\n        stateUpdate.body = new EmptyLayoutScene({ type: 'fields' });\n      }\n    } else {\n      // Otherwise update the body, but don't re-instantiate if it's already the right class\n      if (newState.value === ALL_VARIABLE_VALUE && this.state.body instanceof FieldValuesBreakdownScene) {\n        stateUpdate.body = new FieldsAggregatedBreakdownScene({});\n      } else if (newState.value !== ALL_VARIABLE_VALUE && this.state.body instanceof FieldsAggregatedBreakdownScene) {\n        stateUpdate.body = new FieldValuesBreakdownScene({});\n      } else if (\n        // If the body hasn't been created, or the no-data views are active, we want to replace and render the correct scene\n        this.state.body === undefined ||\n        this.state.body instanceof EmptyLayoutScene ||\n        this.state.body instanceof NoMatchingLabelsScene\n      ) {\n        stateUpdate.body =\n          newState.value === ALL_VARIABLE_VALUE\n            ? new FieldsAggregatedBreakdownScene({})\n            : new FieldValuesBreakdownScene({});\n      }\n    }\n\n    this.setState(stateUpdate);\n  }\n  public onFieldSelectorChange = (value?: string) => {\n    if (!value) {\n      return;\n    }\n\n    const variable = getFieldGroupByVariable(this);\n    const { sortBy, direction } = getSortByPreference('fields', DEFAULT_SORT_BY, 'desc');\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.select_field_in_breakdown_clicked,\n      {\n        field: value,\n        previousField: variable.getValueText(),\n        view: 'fields',\n        sortBy,\n        sortByDirection: direction,\n      }\n    );\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    navigateToValueBreakdown(ValueSlugs.field, value, serviceScene);\n  };\n\n  public static LabelsMenu = ({ model }: SceneComponentProps<FieldsBreakdownScene>) => {\n    const { body, loading, search } = model.useState();\n    const styles = useStyles2(getStyles);\n    const variable = getFieldGroupByVariable(model);\n    const { options, value } = variable.useState();\n    return (\n      <div className={styles.labelsMenuWrapper}>\n        {body instanceof FieldsAggregatedBreakdownScene && <FieldsAggregatedBreakdownScene.Selector model={body} />}\n        {body instanceof FieldValuesBreakdownScene && <FieldValuesBreakdownScene.Selector model={body} />}\n        {body instanceof FieldValuesBreakdownScene && <search.Component model={search} />}\n        {!loading && options.length > 1 && (\n          <FieldSelector label=\"Field\" options={options} value={String(value)} onChange={model.onFieldSelectorChange} />\n        )}\n      </div>\n    );\n  };\n  public static ValuesMenu = ({ model }: SceneComponentProps<FieldsBreakdownScene>) => {\n    const { loading, sort } = model.useState();\n    const styles = useStyles2(getStyles);\n    const variable = getFieldGroupByVariable(model);\n    const { value } = variable.useState();\n    return (\n      <div className={styles.valuesMenuWrapper}>\n        {!loading && value !== ALL_VARIABLE_VALUE && (\n          <>\n            <sort.Component model={sort} />\n          </>\n        )}\n      </div>\n    );\n  };\n\n  public static Component = ({ model }: SceneComponentProps<FieldsBreakdownScene>) => {\n    const { body, loading, blockingMessage } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container}>\n        <StatusWrapper {...{ isLoading: loading, blockingMessage }}>\n          {body instanceof FieldsAggregatedBreakdownScene && model && <FieldsBreakdownScene.LabelsMenu model={model} />}\n          <div className={styles.content}>{body && <body.Component model={body} />}</div>\n        </StatusWrapper>\n      </div>\n    );\n  };\n}\n\nexport const emptyStateStyles = {\n  link: css({\n    textDecoration: 'underline',\n  }),\n  button: css({\n    marginLeft: '1.5rem',\n  }),\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n    }),\n    content: css({\n      flexGrow: 1,\n      display: 'flex',\n      paddingTop: theme.spacing(0),\n    }),\n    labelsMenuWrapper: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'top',\n      justifyContent: 'space-between',\n      flexDirection: 'row-reverse',\n      gap: theme.spacing(2),\n    }),\n    valuesMenuWrapper: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'top',\n      gap: theme.spacing(2),\n      flexDirection: 'row',\n    }),\n  };\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneDataProvider,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VariableValueOption,\n  VizPanel,\n} from '@grafana/scenes';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { DrawStyle, LoadingPlaceholder, StackingMode, useStyles2 } from '@grafana/ui';\nimport { getQueryRunner, setLevelColorOverrides } from '../../../services/panel';\nimport { ALL_VARIABLE_VALUE, LEVEL_VARIABLE_VALUE } from '../../../services/variables';\nimport React from 'react';\nimport { LabelBreakdownScene } from './LabelBreakdownScene';\nimport { SelectLabelActionScene } from './SelectLabelActionScene';\nimport { ValueSlugs } from '../../../services/routing';\nimport { buildLabelsQuery, LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS } from '../../../services/labels';\nimport { getFieldsVariable, getLabelGroupByVariable } from '../../../services/variableGetters';\nimport { ServiceScene } from '../ServiceScene';\nimport { DataFrame, LoadingState } from '@grafana/data';\nimport { getPanelWrapperStyles, PanelMenu } from '../../Panels/PanelMenu';\nimport { MAX_NUMBER_OF_TIME_SERIES } from './TimeSeriesLimit';\n\nexport interface LabelsAggregatedBreakdownSceneState extends SceneObjectState {\n  body?: LayoutSwitcher;\n}\n\nexport class LabelsAggregatedBreakdownScene extends SceneObjectBase<LabelsAggregatedBreakdownSceneState> {\n  constructor(state: Partial<LabelsAggregatedBreakdownSceneState>) {\n    super({\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const fields = getFieldsVariable(this);\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const $detectedLabels = serviceScene.state.$detectedLabelsData;\n\n    // If the body hasn't been built yet, build it\n    if (!this.state.body) {\n      this.setState({\n        body: this.build(),\n      });\n    }\n    // Otherwise if we have the detected labels done loading, update the body\n    else if ($detectedLabels?.state.data?.state === LoadingState.Done) {\n      this.update($detectedLabels?.state.data.series[0]);\n    }\n\n    this._subs.add(\n      $detectedLabels?.subscribeToState((newState, prevState) => {\n        if (newState.data?.state === LoadingState.Done) {\n          this.update(newState.data.series[0]);\n        }\n      })\n    );\n\n    this._subs.add(\n      fields.subscribeToState(() => {\n        this.updateQueriesOnFieldsVariableChange();\n      })\n    );\n  }\n\n  private updateQueriesOnFieldsVariableChange = () => {\n    this.state.body?.state.layouts.forEach((layoutObj) => {\n      const layout = layoutObj as SceneCSSGridLayout;\n      // Iterate through the existing panels\n      for (let i = 0; i < layout.state.children.length; i++) {\n        const { panel, title } = this.getPanelByIndex(layout, i);\n        const queryRunner: SceneDataProvider | SceneQueryRunner | undefined = panel.state.$data;\n        const query = buildLabelsQuery(this, title, title);\n\n        // Don't update if query didn't change\n        if (queryRunner instanceof SceneQueryRunner) {\n          if (query.expr === queryRunner?.state.queries?.[0]?.expr) {\n            break;\n          }\n        }\n\n        panel.setState({\n          $data: getQueryRunner([query]),\n        });\n      }\n    });\n  };\n\n  private getPanelByIndex(layout: SceneCSSGridLayout, i: number) {\n    const gridItem = layout.state.children[i] as SceneCSSGridItem;\n    const panel = gridItem.state.body as VizPanel;\n\n    const title = panel.state.title;\n    return { panel, title };\n  }\n\n  private update(detectedLabelsFrame: DataFrame) {\n    const variable = getLabelGroupByVariable(this);\n    const newLabels = variable.state.options.filter((opt) => opt.value !== ALL_VARIABLE_VALUE).map((opt) => opt.label);\n\n    this.state.body?.state.layouts.forEach((layoutObj) => {\n      let existingLabels = [];\n      const layout = layoutObj as SceneCSSGridLayout;\n      const newLabelsSet = new Set<string>(newLabels);\n      const updatedChildren = layout.state.children as SceneCSSGridItem[];\n\n      for (let i = 0; i < updatedChildren.length; i++) {\n        const { title } = this.getPanelByIndex(layout, i);\n\n        if (newLabelsSet.has(title)) {\n          // If the new response has this field, delete it from the set, but leave it in the layout\n          newLabelsSet.delete(title);\n        } else {\n          // Otherwise if the panel doesn't exist in the response, delete it from the layout\n          updatedChildren.splice(i, 1);\n          // And make sure to update the index, or we'll skip the next one\n          i--;\n        }\n        existingLabels.push(title);\n      }\n\n      const labelsToAdd = Array.from(newLabelsSet);\n\n      const options = labelsToAdd.map((fieldName) => {\n        return {\n          label: fieldName,\n          value: fieldName,\n        };\n      });\n\n      updatedChildren.push(...this.buildChildren(options));\n\n      const cardinalityMap = this.calculateCardinalityMap(detectedLabelsFrame);\n      updatedChildren.sort(this.sortChildren(cardinalityMap));\n\n      layout.setState({\n        children: updatedChildren,\n      });\n    });\n  }\n\n  private calculateCardinalityMap(detectedLabels?: DataFrame) {\n    const cardinalityMap = new Map<string, number>();\n    if (detectedLabels?.length) {\n      for (let i = 0; i < detectedLabels?.fields.length; i++) {\n        const name: string = detectedLabels.fields[i].name;\n        const cardinality: number = detectedLabels.fields[i].values[0];\n        cardinalityMap.set(name, cardinality);\n      }\n    }\n    return cardinalityMap;\n  }\n\n  private build(): LayoutSwitcher {\n    const variable = getLabelGroupByVariable(this);\n    const labelBreakdownScene = sceneGraph.getAncestor(this, LabelBreakdownScene);\n    labelBreakdownScene.state.search.reset();\n\n    const children = this.buildChildren(variable.state.options);\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const $detectedLabels = serviceScene.state.$detectedLabelsData;\n    if ($detectedLabels?.state.data?.state === LoadingState.Done) {\n      const cardinalityMap = this.calculateCardinalityMap($detectedLabels?.state.data.series[0]);\n      children.sort(this.sortChildren(cardinalityMap));\n    }\n\n    const childrenClones = children.map((child) => child.clone());\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        new SceneCSSGridLayout({\n          isLazy: true,\n          templateColumns: LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n          autoRows: '200px',\n          children: children,\n        }),\n        new SceneCSSGridLayout({\n          isLazy: true,\n          templateColumns: '1fr',\n          autoRows: '200px',\n          children: childrenClones,\n        }),\n      ],\n    });\n  }\n\n  private buildChildren(options: VariableValueOption[]) {\n    const children: SceneCSSGridItem[] = [];\n    for (const option of options) {\n      const { value } = option;\n      const optionValue = String(value);\n      if (value === ALL_VARIABLE_VALUE || !value) {\n        continue;\n      }\n      const query = buildLabelsQuery(this, String(option.value), String(option.value));\n      const queryRunner = getQueryRunner([query]);\n\n      children.push(\n        new SceneCSSGridItem({\n          body: PanelBuilders.timeseries()\n            .setTitle(optionValue)\n            .setData(queryRunner)\n            .setHeaderActions([new SelectLabelActionScene({ labelName: optionValue, fieldType: ValueSlugs.label })])\n            .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n            .setCustomFieldConfig('fillOpacity', 100)\n            .setCustomFieldConfig('lineWidth', 0)\n            .setCustomFieldConfig('pointSize', 0)\n            .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n            .setHoverHeader(false)\n            // 11.5\n            // .setShowMenuAlways(true)\n            .setOverrides(setLevelColorOverrides)\n            .setMenu(new PanelMenu({ investigationOptions: { labelName: optionValue } }))\n            .setSeriesLimit(MAX_NUMBER_OF_TIME_SERIES)\n            .build(),\n        })\n      );\n    }\n    return children;\n  }\n\n  private sortChildren(cardinalityMap: Map<string, number>) {\n    return (a: SceneCSSGridItem, b: SceneCSSGridItem) => {\n      const aPanel = a.state.body as VizPanel;\n      const bPanel = b.state.body as VizPanel;\n      if (aPanel.state.title === LEVEL_VARIABLE_VALUE) {\n        return -1;\n      }\n      if (bPanel.state.title === LEVEL_VARIABLE_VALUE) {\n        return 1;\n      }\n      const aCardinality = cardinalityMap.get(aPanel.state.title) ?? 0;\n      const bCardinality = cardinalityMap.get(bPanel.state.title) ?? 0;\n      return bCardinality - aCardinality;\n    };\n  }\n\n  public static Selector({ model }: SceneComponentProps<LabelsAggregatedBreakdownScene>) {\n    const { body } = model.useState();\n    return <>{body && <LayoutSwitcher.Selector model={body} />}</>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LabelsAggregatedBreakdownScene>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getPanelWrapperStyles);\n\n    if (body) {\n      return <span className={styles.panelWrapper}>{body && <body.Component model={body} />}</span>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { AdHocVariableFilter, DataFrame, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport {\n  QueryRunnerState,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneVariableSet,\n  SceneVariableState,\n  VariableDependencyConfig,\n  VariableValueOption,\n} from '@grafana/scenes';\nimport { Alert, useStyles2 } from '@grafana/ui';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { checkPrimaryLabel, getPrimaryLabelFromUrl, ValueSlugs } from 'services/routing';\nimport { ALL_VARIABLE_VALUE, SERVICE_NAME, SERVICE_UI_LABEL, VAR_LABEL_GROUP_BY, VAR_LABELS } from 'services/variables';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { FieldSelector } from './FieldSelector';\nimport { StatusWrapper } from './StatusWrapper';\nimport { getLabelOptions } from 'services/filters';\nimport { BreakdownSearchReset, BreakdownSearchScene } from './BreakdownSearchScene';\nimport { getSortByPreference } from 'services/store';\nimport { SortByScene, SortCriteriaChanged } from './SortByScene';\nimport { getDetectedLabelsFrame, ServiceScene } from '../ServiceScene';\nimport { CustomConstantVariable, CustomConstantVariableState } from '../../../services/CustomConstantVariable';\nimport { navigateToValueBreakdown } from '../../../services/navigate';\nimport { areArraysEqual } from '../../../services/comparison';\nimport { LabelValuesBreakdownScene } from './LabelValuesBreakdownScene';\nimport { LabelsAggregatedBreakdownScene } from './LabelsAggregatedBreakdownScene';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport { EmptyLayoutScene } from './EmptyLayoutScene';\nimport { getLabelGroupByVariable, getLabelsVariable } from '../../../services/variableGetters';\n\nexport interface LabelBreakdownSceneState extends SceneObjectState {\n  body?: SceneObject;\n  search: BreakdownSearchScene;\n  sort: SortByScene;\n  loading?: boolean;\n  error?: boolean;\n  blockingMessage?: string;\n  // We have to store the value in state because scenes doesn't allow variables that don't have options. We need to hold on to this until the API call getting values is done, and then reset the state\n  value?: string;\n}\n\nexport class LabelBreakdownScene extends SceneObjectBase<LabelBreakdownSceneState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_LABELS],\n  });\n\n  // Labels/options can be passed in when instantiated, but should ONLY exist on the state of the variable\n  constructor(state: Partial<LabelBreakdownSceneState> & { options?: VariableValueOption[]; value?: string }) {\n    super({\n      ...state,\n      $variables:\n        state.$variables ??\n        new SceneVariableSet({\n          variables: [\n            new CustomConstantVariable({\n              name: VAR_LABEL_GROUP_BY,\n              defaultToAll: false,\n              includeAll: true,\n              value: state.value ?? ALL_VARIABLE_VALUE,\n              options: state.options ?? [],\n            }),\n          ],\n        }),\n      loading: true,\n      sort: new SortByScene({ target: 'labels' }),\n      search: new BreakdownSearchScene('labels'),\n      value: state.value,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const groupByVariable = getLabelGroupByVariable(this);\n\n    this.setState({\n      loading: serviceScene.state.$detectedLabelsData?.state.data?.state !== LoadingState.Done,\n      error: serviceScene.state.$detectedLabelsData?.state.data?.state === LoadingState.Error,\n    });\n\n    this._subs.add(\n      this.subscribeToEvent(BreakdownSearchReset, () => {\n        this.state.search.clearValueFilter();\n      })\n    );\n    this._subs.add(this.subscribeToEvent(SortCriteriaChanged, this.handleSortByChange));\n\n    this._subs.add(serviceScene.state.$detectedLabelsData?.subscribeToState(this.onDetectedLabelsDataChange));\n\n    this._subs.add(\n      getLabelsVariable(this).subscribeToState((newState, prevState) => {\n        this.onLabelsVariableChange(newState, prevState);\n      })\n    );\n\n    this._subs.add(\n      groupByVariable.subscribeToState((newState, prevState) => {\n        this.onGroupByVariableChange(newState, prevState);\n      })\n    );\n\n    const detectedLabelsFrame = getDetectedLabelsFrame(this);\n    // Need to update labels with current state\n    if (detectedLabelsFrame) {\n      this.updateOptions(detectedLabelsFrame);\n    }\n\n    checkPrimaryLabel(this);\n  }\n\n  private onGroupByVariableChange(newState: CustomConstantVariableState, prevState: CustomConstantVariableState) {\n    // If the aggregation value changed, or the body is not yet defined\n    if (\n      newState.value !== prevState.value ||\n      !areArraysEqual(newState.options, prevState.options) ||\n      this.state.body === undefined ||\n      this.state.body instanceof EmptyLayoutScene\n    ) {\n      this.updateBody();\n    }\n  }\n\n  private onLabelsVariableChange(\n    newState: SceneVariableState & { filters: AdHocVariableFilter[] },\n    prevState: SceneVariableState & { filters: AdHocVariableFilter[] }\n  ) {\n    let { labelName } = getPrimaryLabelFromUrl();\n    if (labelName === SERVICE_UI_LABEL) {\n      labelName = SERVICE_NAME;\n    }\n    const variable = getLabelGroupByVariable(this);\n    const newPrimaryLabel = newState.filters.find((filter) => filter.key === labelName);\n    const prevPrimaryLabel = prevState.filters.find((filter) => filter.key === labelName);\n\n    // If the user changes the service\n    if (variable.state.value === ALL_VARIABLE_VALUE && newPrimaryLabel !== prevPrimaryLabel) {\n      this.setState({\n        loading: true,\n        body: undefined,\n        error: undefined,\n      });\n    }\n  }\n\n  /**\n   * Pull the detected_labels from our service scene, update the variable when they change\n   * @param newState\n   * @param prevState\n   */\n  private onDetectedLabelsDataChange = (newState: QueryRunnerState, prevState: QueryRunnerState) => {\n    if (\n      newState.data?.state === LoadingState.Done &&\n      newState.data.series?.[0] &&\n      !areArraysEqual(newState.data.series?.[0]?.fields, prevState.data?.series?.[0]?.fields)\n    ) {\n      this.updateOptions(newState.data.series?.[0]);\n    } else if (newState.data?.state === LoadingState.Done) {\n      // we got a new response, but nothing changed, just need to clear loading\n      const variable = getLabelGroupByVariable(this);\n      variable.setState({\n        loading: false,\n      });\n    }\n  };\n\n  private handleSortByChange = (event: SortCriteriaChanged) => {\n    if (event.target !== 'labels') {\n      return;\n    }\n    const body = this.state.body;\n    if (body instanceof LabelValuesBreakdownScene) {\n      const byFrameRepeaters = sceneGraph.findDescendents(body, ByFrameRepeater);\n      byFrameRepeaters.forEach((layout) => {\n        layout.sort(event.sortBy, event.direction);\n      });\n    }\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.value_breakdown_sort_change,\n      {\n        target: 'labels',\n        criteria: event.sortBy,\n        direction: event.direction,\n      }\n    );\n  };\n\n  private updateOptions(detectedLabels: DataFrame | undefined) {\n    if (!detectedLabels || !detectedLabels.length) {\n      this.setState({\n        loading: false,\n        body: new EmptyLayoutScene({ type: 'labels' }),\n      });\n      return;\n    }\n    const variable = getLabelGroupByVariable(this);\n    const options = getLabelOptions(detectedLabels.fields.map((label) => label.name));\n\n    variable.setState({\n      loading: false,\n      options,\n      value: this.state.value ?? ALL_VARIABLE_VALUE,\n    });\n  }\n\n  private updateBody() {\n    const variable = getLabelGroupByVariable(this);\n    // We get the labels from the service scene, if we don't have them yet, assume we're loading\n    if (!variable.state.options || !variable.state.options.length) {\n      return;\n    }\n\n    const stateUpdate: Partial<LabelBreakdownSceneState> = {\n      loading: false,\n      blockingMessage: undefined,\n      error: false,\n    };\n\n    if (variable.hasAllValue() && this.state.body instanceof LabelValuesBreakdownScene) {\n      stateUpdate.body = new LabelsAggregatedBreakdownScene({});\n    } else if (!variable.hasAllValue() && this.state.body instanceof LabelsAggregatedBreakdownScene) {\n      stateUpdate.body = new LabelValuesBreakdownScene({});\n    } else if (this.state.body === undefined) {\n      if (variable.state.options.length > 0) {\n        stateUpdate.body = variable.hasAllValue()\n          ? new LabelsAggregatedBreakdownScene({})\n          : new LabelValuesBreakdownScene({});\n      } else {\n        stateUpdate.body = new EmptyLayoutScene({ type: 'labels' });\n      }\n    } else if (this.state.body instanceof EmptyLayoutScene) {\n      if (variable.state.options.length > 0) {\n        stateUpdate.body = variable.hasAllValue()\n          ? new LabelsAggregatedBreakdownScene({})\n          : new LabelValuesBreakdownScene({});\n      }\n    }\n\n    this.setState({ ...stateUpdate });\n  }\n\n  public onChange = (value?: string) => {\n    if (!value) {\n      return;\n    }\n\n    const variable = getLabelGroupByVariable(this);\n    variable.changeValueTo(value);\n\n    const { sortBy, direction } = getSortByPreference('labels', DEFAULT_SORT_BY, 'desc');\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.select_field_in_breakdown_clicked,\n      {\n        label: value,\n        previousLabel: variable.getValueText(),\n        view: 'labels',\n        sortBy,\n        sortByDirection: direction,\n      }\n    );\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    navigateToValueBreakdown(ValueSlugs.label, value, serviceScene);\n  };\n\n  public static LabelsMenu = ({ model }: SceneComponentProps<LabelBreakdownScene>) => {\n    const { body, loading, search } = model.useState();\n    const variable = getLabelGroupByVariable(model);\n    const { options, value } = variable.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.labelsMenuWrapper}>\n        {body instanceof LabelValuesBreakdownScene && <LabelValuesBreakdownScene.Selector model={body} />}\n        {body instanceof LabelsAggregatedBreakdownScene && <LabelsAggregatedBreakdownScene.Selector model={body} />}\n        {body instanceof LabelValuesBreakdownScene && <search.Component model={search} />}\n        {!loading && options.length > 0 && (\n          <FieldSelector label=\"Label\" options={options} value={String(value)} onChange={model.onChange} />\n        )}\n      </div>\n    );\n  };\n\n  public static ValuesMenu = ({ model }: SceneComponentProps<LabelBreakdownScene>) => {\n    const { loading, sort } = model.useState();\n    const variable = getLabelGroupByVariable(model);\n    const { value } = variable.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.valuesMenuWrapper}>\n        {!loading && value !== ALL_VARIABLE_VALUE && (\n          <>\n            <sort.Component model={sort} />\n          </>\n        )}\n      </div>\n    );\n  };\n\n  public static Component = ({ model }: SceneComponentProps<LabelBreakdownScene>) => {\n    const { body, loading, blockingMessage, error } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container}>\n        <StatusWrapper {...{ isLoading: loading, blockingMessage }}>\n          {error && (\n            <Alert title=\"\" severity=\"warning\">\n              The labels are not available at this moment. Try using a different time range or check again later.\n            </Alert>\n          )}\n\n          {body instanceof LabelsAggregatedBreakdownScene && model && <LabelBreakdownScene.LabelsMenu model={model} />}\n\n          <div className={styles.content}>{body && <body.Component model={body} />}</div>\n        </StatusWrapper>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n    }),\n    content: css({\n      flexGrow: 1,\n      display: 'flex',\n      paddingTop: theme.spacing(0),\n    }),\n    labelsMenuWrapper: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'top',\n      justifyContent: 'space-between',\n      flexDirection: 'row-reverse',\n      gap: theme.spacing(2),\n    }),\n    valuesMenuWrapper: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'top',\n      gap: theme.spacing(2),\n      flexDirection: 'row',\n    }),\n  };\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridLayout,\n  SceneDataProvider,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  SceneReactObject,\n} from '@grafana/scenes';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { getLabelValue } from './SortByScene';\nimport { DrawStyle, LoadingPlaceholder, StackingMode, useStyles2 } from '@grafana/ui';\nimport { getQueryRunner, setLevelColorOverrides } from '../../../services/panel';\nimport { getSortByPreference } from '../../../services/store';\nimport { AppEvents, DataQueryError, LoadingState } from '@grafana/data';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { getFilterBreakdownValueScene } from '../../../services/fields';\nimport {\n  ALL_VARIABLE_VALUE,\n  LEVEL_VARIABLE_VALUE,\n  VAR_LABEL_GROUP_BY_EXPR,\n  VAR_LABELS,\n  VAR_LEVELS,\n} from '../../../services/variables';\nimport React from 'react';\nimport { LabelBreakdownScene } from './LabelBreakdownScene';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\nimport { buildLabelsQuery, LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS } from '../../../services/labels';\nimport { getAppEvents } from '@grafana/runtime';\nimport {\n  getFieldsVariable,\n  getLabelGroupByVariable,\n  getLabelsVariable,\n  getLevelsVariable,\n  getLineFiltersVariable,\n  getMetadataVariable,\n  getPatternsVariable,\n} from '../../../services/variableGetters';\nimport { getPanelWrapperStyles, PanelMenu } from '../../Panels/PanelMenu';\nimport { NoMatchingLabelsScene } from './NoMatchingLabelsScene';\nimport { EmptyLayoutScene } from './EmptyLayoutScene';\nimport { IndexScene } from '../../IndexScene/IndexScene';\nimport { clearVariables, getVariablesThatCanBeCleared } from '../../../services/variableHelpers';\nimport { ValueSummaryPanelScene } from './Panels/ValueSummary';\nimport { renderLevelsFilter, renderLogQLLabelFilters } from '../../../services/query';\nimport { logger } from '../../../services/logger';\nimport { areArraysEqual } from '../../../services/comparison';\n\ntype DisplayError = DataQueryError & { displayed: boolean };\ntype DisplayErrors = Record<string, DisplayError>;\n\nexport interface LabelValueBreakdownSceneState extends SceneObjectState {\n  body?: (LayoutSwitcher & SceneObject) | (NoMatchingLabelsScene & SceneObject) | (EmptyLayoutScene & SceneObject);\n  $data?: SceneDataProvider;\n  errors: DisplayErrors;\n}\n\nexport class LabelValuesBreakdownScene extends SceneObjectBase<LabelValueBreakdownSceneState> {\n  constructor(state: Partial<LabelValueBreakdownSceneState>) {\n    super({\n      ...state,\n      errors: {},\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setState({\n      $data: this.buildQueryRunner(),\n      body: this.build(),\n    });\n\n    // Run query on activate\n    this.runQuery();\n    this.setSubscriptions();\n  }\n\n  private buildQueryRunner() {\n    const query = this.buildQuery();\n    return getQueryRunner([query], { runQueriesMode: 'manual' });\n  }\n\n  private buildQuery() {\n    const query = buildLabelsQuery(this, VAR_LABEL_GROUP_BY_EXPR, String(getLabelGroupByVariable(this).state.value));\n    // Manually interpolate query so we don't pollute the variable interpolation for other queries\n    const { variableName, filterExpression } = this.removeValueLabelFromVariableInterpolation();\n    query.expr = query.expr.replace(`$\\{${variableName}}`, filterExpression);\n    return query;\n  }\n\n  /**\n   * Set variable & event subscriptions\n   */\n  private setSubscriptions() {\n    // QUERY RUNNER SUBS\n    // Subscribe to value breakdown state\n    this._subs.add(\n      this.state.$data?.subscribeToState((newState, prevState) => {\n        this.onValuesDataQueryChange(newState);\n      })\n    );\n\n    // VARIABLE SUBS\n    // Subscribe to label change via dropdown\n    this._subs.add(\n      getLabelGroupByVariable(this).subscribeToState((newState) => {\n        if (newState.value === ALL_VARIABLE_VALUE) {\n          this.setState({\n            $data: undefined,\n            body: undefined,\n          });\n        }\n      })\n    );\n\n    // Subscribe to time range changes\n    this._subs.add(\n      sceneGraph.getTimeRange(this).subscribeToState(() => {\n        // Run query on time range change\n        this.runQuery();\n      })\n    );\n\n    this._subs.add(\n      getFieldsVariable(this).subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          // Check to see if the new field filter changes the parser, if so rebuild the query\n          this.runQuery();\n        }\n      })\n    );\n\n    // Subscribe to fields variable changes\n    this._subs.add(\n      getMetadataVariable(this).subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.runQuery();\n        }\n      })\n    );\n\n    // Subscribe to line filter variable changes\n    this._subs.add(\n      getLineFiltersVariable(this).subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.runQuery();\n        }\n      })\n    );\n\n    // Subscribe to pattern variable changes\n    this._subs.add(\n      getPatternsVariable(this).subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          this.runQuery();\n        }\n      })\n    );\n\n    const key = this.getTagKey();\n\n    this._subs.add(\n      getLabelsVariable(this).subscribeToState(async (newState, prevState) => {\n        if (\n          !areArraysEqual(\n            newState.filters.filter((f) => key === LEVEL_VARIABLE_VALUE && f.key !== key),\n            prevState.filters.filter((f) => key === LEVEL_VARIABLE_VALUE && f.key !== key)\n          )\n        ) {\n          this.runQuery();\n        }\n      })\n    );\n\n    this._subs.add(\n      getLevelsVariable(this).subscribeToState(async (newState, prevState) => {\n        if (\n          !areArraysEqual(\n            newState.filters.filter((f) => key !== LEVEL_VARIABLE_VALUE && f.key !== key),\n            prevState.filters.filter((f) => key !== LEVEL_VARIABLE_VALUE && f.key !== key)\n          )\n        ) {\n          this.runQuery();\n        }\n      })\n    );\n  }\n\n  /**\n   * Since we run this query manually, we want to rebuild it before every execution\n   */\n  private rebuildQuery() {\n    // Rebuild the query\n    this.getSceneQueryRunner()?.setState({\n      queries: [this.buildQuery()],\n    });\n  }\n\n  /**\n   * Run the label values breakdown query.\n   * Generates the filterExpression excluding all filters with a key that matches the label.\n   */\n  private runQuery() {\n    this.rebuildQuery();\n    const queryRunner = this.getSceneQueryRunner();\n    queryRunner?.runQueries();\n  }\n\n  /**\n   * Helper method that grabs the SceneQueryRunner for the label value breakdown query.\n   */\n  private getSceneQueryRunner() {\n    if (this.state.$data) {\n      const queryRunners = sceneGraph.findDescendents(this.state.$data, SceneQueryRunner);\n      if (queryRunners.length !== 1) {\n        const error = new Error('Unable to find query runner in value breakdown!');\n        logger.error(error, { msg: 'LabelValuesBreakdownScene: Unable to find query runner in value breakdown!' });\n        throw error;\n      }\n\n      return queryRunners[0];\n    }\n    logger.warn('LabelValuesBreakdownScene: Query is attempting to execute, but query runner is undefined!');\n    return undefined;\n  }\n\n  /**\n   * Generates the filterExpression for the label value query and saves it to state.\n   * We have to manually generate the filterExpression as we want to exclude every filter for the target variable that matches the key used in this value breakdown.\n   * e.g. in the \"cluster\" breakdown, we don't want to execute this query containing a cluster filter, or users will only be able to include a single value.\n   */\n  private removeValueLabelFromVariableInterpolation() {\n    const tagKey = this.getTagKey();\n    let filterExpression;\n    let variableName: typeof VAR_LEVELS | typeof VAR_LABELS;\n\n    if (tagKey === LEVEL_VARIABLE_VALUE) {\n      const levelsVar = getLevelsVariable(this);\n      variableName = VAR_LEVELS;\n      filterExpression = renderLevelsFilter(levelsVar.state.filters, [tagKey]);\n    } else {\n      const labelsVar = getLabelsVariable(this);\n      variableName = VAR_LABELS;\n      filterExpression = renderLogQLLabelFilters(labelsVar.state.filters, [tagKey]);\n    }\n\n    return { filterExpression, variableName };\n  }\n\n  /**\n   * Helper method to get the key/label name from the variable on the parent scene\n   */\n  private getTagKey() {\n    const variable = getLabelGroupByVariable(this);\n    return String(variable.state.value);\n  }\n\n  /**\n   * Actions to run when the value breakdown query response is received.\n   */\n  private onValuesDataQueryChange(newState: SceneDataState) {\n    // Set empty states\n    this.setEmptyStates(newState);\n\n    // Set error states\n    this.setErrorStates(newState);\n  }\n\n  /**\n   * Sets the error body state\n   */\n  private setErrorStates(newState: SceneDataState) {\n    // If panels have errors\n    if (newState?.data?.errors && newState.data?.state !== LoadingState.Done) {\n      const errors: DisplayErrors = this.state.errors;\n      newState?.data?.errors.forEach((err) => {\n        const errorIndex = `${err.status}_${err.traceId}_${err.message}`;\n        if (errors[errorIndex] === undefined) {\n          errors[errorIndex] = { ...err, displayed: false };\n        }\n      });\n      this.setState({\n        errors,\n      });\n\n      this.showErrorToast(this.state.errors);\n    }\n  }\n\n  /**\n   * Sets the empty body state\n   */\n  private setEmptyStates(newState: SceneDataState) {\n    if (newState.data?.state === LoadingState.Done) {\n      if (newState.data.series.length > 0 && !(this.state.body instanceof LayoutSwitcher)) {\n        this.setState({\n          body: this.build(),\n        });\n      } else if (newState.data.series.length === 0) {\n        const indexScene = sceneGraph.getAncestor(this, IndexScene);\n        const variablesToClear = getVariablesThatCanBeCleared(indexScene);\n\n        if (variablesToClear.length > 1) {\n          this.setState({\n            body: new NoMatchingLabelsScene({ clearCallback: () => clearVariables(this) }),\n          });\n        } else {\n          this.setState({\n            body: new EmptyLayoutScene({ type: 'fields' }),\n          });\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns the active layout from the layout switcher\n   */\n  private getActiveLayout(): SceneFlexLayout | undefined {\n    const layoutSwitcher = this.state.body;\n    if (layoutSwitcher instanceof LayoutSwitcher) {\n      const activeLayout = layoutSwitcher?.state.layouts.find((layout) => layout.isActive);\n      if (activeLayout instanceof SceneFlexLayout) {\n        return activeLayout;\n      }\n    }\n    return undefined;\n  }\n\n  /**\n   * Returns a boolean when the active layout is empty\n   */\n  private activeLayoutContainsNoPanels(): boolean {\n    const activeLayout = this.getActiveLayout();\n    if (activeLayout) {\n      const byFrameRepeaters = sceneGraph.findDescendents(activeLayout, ByFrameRepeater);\n      return byFrameRepeaters.some((repeater) => {\n        const child = repeater.state.body.state.children[0];\n        return child instanceof SceneFlexItem || child instanceof SceneReactObject;\n      });\n    }\n\n    return false;\n  }\n\n  /**\n   * Builds the layout switcher\n   */\n  private build(): LayoutSwitcher {\n    const variable = getLabelGroupByVariable(this);\n    const variableState = variable.state;\n    const tagKey = String(variableState?.value);\n    const labelBreakdownScene = sceneGraph.getAncestor(this, LabelBreakdownScene);\n\n    let bodyOpts = PanelBuilders.timeseries();\n    bodyOpts = bodyOpts\n      .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n      .setCustomFieldConfig('fillOpacity', 100)\n      .setCustomFieldConfig('lineWidth', 0)\n      .setCustomFieldConfig('pointSize', 0)\n      .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n      // Waiting for 11.5\n      // .setShowMenuAlways(true)\n      .setOverrides(setLevelColorOverrides)\n      .setMenu(new PanelMenu({}))\n      .setTitle(tagKey);\n\n    const body = bodyOpts.build();\n\n    const { sortBy, direction } = getSortByPreference('labels', DEFAULT_SORT_BY, 'desc');\n\n    const getFilter = () => labelBreakdownScene.state.search.state.filter ?? '';\n\n    return new LayoutSwitcher({\n      options: [\n        { value: 'single', label: 'Single' },\n        { value: 'grid', label: 'Grid' },\n        { value: 'rows', label: 'Rows' },\n      ],\n      active: 'grid',\n      layouts: [\n        new SceneFlexLayout({\n          direction: 'column',\n          children: [\n            new SceneReactObject({ reactNode: <LabelBreakdownScene.LabelsMenu model={labelBreakdownScene} /> }),\n            new SceneFlexItem({\n              minHeight: 300,\n              body,\n            }),\n          ],\n        }),\n        new SceneFlexLayout({\n          direction: 'column',\n          children: [\n            new SceneReactObject({ reactNode: <LabelBreakdownScene.LabelsMenu model={labelBreakdownScene} /> }),\n            new ValueSummaryPanelScene({ title: tagKey, levelColor: true, tagKey: this.getTagKey(), type: 'label' }),\n            new SceneReactObject({ reactNode: <LabelBreakdownScene.ValuesMenu model={labelBreakdownScene} /> }),\n            new ByFrameRepeater({\n              body: new SceneCSSGridLayout({\n                isLazy: true,\n                templateColumns: LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS,\n                autoRows: '200px',\n                children: [\n                  new SceneFlexItem({\n                    body: new SceneReactObject({\n                      reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                    }),\n                  }),\n                ],\n              }),\n              getLayoutChild: getFilterBreakdownValueScene(\n                getLabelValue,\n                DrawStyle.Bars,\n                VAR_LABELS,\n                sceneGraph.getAncestor(this, LabelBreakdownScene).state.sort,\n                tagKey\n              ),\n              sortBy,\n              direction,\n              getFilter,\n            }),\n          ],\n        }),\n        new SceneFlexLayout({\n          direction: 'column',\n          children: [\n            new SceneReactObject({ reactNode: <LabelBreakdownScene.LabelsMenu model={labelBreakdownScene} /> }),\n            new ValueSummaryPanelScene({ title: tagKey, levelColor: true, tagKey: this.getTagKey(), type: 'label' }),\n            new SceneReactObject({ reactNode: <LabelBreakdownScene.ValuesMenu model={labelBreakdownScene} /> }),\n            new ByFrameRepeater({\n              body: new SceneCSSGridLayout({\n                templateColumns: '1fr',\n                autoRows: '200px',\n                children: [\n                  new SceneFlexItem({\n                    body: new SceneReactObject({\n                      reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n                    }),\n                  }),\n                ],\n              }),\n              getLayoutChild: getFilterBreakdownValueScene(\n                getLabelValue,\n                DrawStyle.Bars,\n                VAR_LABELS,\n                sceneGraph.getAncestor(this, LabelBreakdownScene).state.sort,\n                tagKey\n              ),\n              sortBy,\n              direction,\n              getFilter,\n            }),\n          ],\n        }),\n      ],\n    });\n  }\n\n  private showErrorToast(errors: DisplayErrors) {\n    const appEvents = getAppEvents();\n\n    // Make sure we only display each error once\n    let errorArray: DisplayError[] = [];\n    for (const err in errors) {\n      const displayError = errors[err];\n      if (!displayError.displayed) {\n        errorArray.push(displayError);\n        displayError.displayed = true;\n      }\n    }\n\n    if (errorArray.length) {\n      // If we don't have any panels the error message will replace the loading state, we want to set it as displayed but not render the toast\n      if (!this.activeLayoutContainsNoPanels()) {\n        appEvents.publish({\n          type: AppEvents.alertError.name,\n          payload: errorArray?.map((err, key) => this.renderError(key, err)),\n        });\n      }\n      this.setState({\n        errors,\n      });\n    }\n  }\n\n  private renderError(key: number, err: DataQueryError) {\n    return (\n      <div key={key}>\n        {err.status && (\n          <>\n            <strong>Status</strong>: {err.status} <br />\n          </>\n        )}\n        {err.message && (\n          <>\n            <strong>Message</strong>: {err.message} <br />\n          </>\n        )}\n        {err.traceId && (\n          <>\n            <strong>TraceId</strong>: {err.traceId}\n          </>\n        )}\n      </div>\n    );\n  }\n\n  public static Selector({ model }: SceneComponentProps<LabelValuesBreakdownScene>) {\n    const { body } = model.useState();\n    return <>{body && body instanceof LayoutSwitcher && <LayoutSwitcher.Selector model={body} />}</>;\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LabelValuesBreakdownScene>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getPanelWrapperStyles);\n    if (body) {\n      return <span className={styles.panelWrapper}>{body && <body.Component model={body} />}</span>;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n","import React from 'react';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Field, RadioButtonGroup, useStyles2 } from '@grafana/ui';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getDrilldownSlug } from '../../../services/routing';\nimport { css } from '@emotion/css';\n\nexport interface LayoutSwitcherState extends SceneObjectState {\n  active: LayoutType;\n  layouts: SceneObject[];\n  options: Array<SelectableValue<LayoutType>>;\n}\n\nexport type LayoutType = 'single' | 'grid' | 'rows';\n\nexport class LayoutSwitcher extends SceneObjectBase<LayoutSwitcherState> {\n  public static Selector = LayoutSwitcherComponent;\n\n  public onLayoutChange = (active: LayoutType) => {\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.layout_type_changed, {\n      layout: active,\n      view: getDrilldownSlug(),\n    });\n    this.setState({ active });\n  };\n\n  public static Component = ({ model }: SceneComponentProps<LayoutSwitcher>) => {\n    const { layouts, options, active } = model.useState();\n\n    const index = options.findIndex((o) => o.value === active);\n    if (index === -1) {\n      return null;\n    }\n\n    const layout = layouts[index];\n\n    return <layout.Component model={layout} />;\n  };\n}\n\nfunction LayoutSwitcherComponent({ model }: { model: LayoutSwitcher }) {\n  const { active, options } = model.useState();\n  const styles = useStyles2(getStyles);\n\n  return (\n    <Field className={styles.field}>\n      <RadioButtonGroup options={options} value={active} onChange={model.onLayoutChange} />\n    </Field>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    field: css({\n      marginBottom: 0,\n    }),\n  };\n};\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { GrotError } from '../../GrotError';\nimport { Alert, Button } from '@grafana/ui';\nimport React from 'react';\nimport { emptyStateStyles } from './FieldsBreakdownScene';\n\nexport interface ClearFiltersLayoutSceneState extends SceneObjectState {\n  clearCallback: () => void;\n}\nexport class NoMatchingLabelsScene extends SceneObjectBase<ClearFiltersLayoutSceneState> {\n  public static Component = ({ model }: SceneComponentProps<NoMatchingLabelsScene>) => {\n    const { clearCallback } = model.useState();\n    return (\n      <GrotError>\n        <Alert title=\"\" severity=\"info\">\n          No labels match these filters.{' '}\n          <Button className={emptyStateStyles.button} onClick={() => clearCallback()}>\n            Clear filters\n          </Button>{' '}\n        </Alert>\n      </GrotError>\n    );\n  };\n}\n","import {\n  AdHocFiltersVariable,\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataProvider,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\nimport { CollapsablePanelText, PanelMenu } from '../../../Panels/PanelMenu';\nimport { DrawStyle, PanelContext, SeriesVisibilityChangeMode, StackingMode } from '@grafana/ui';\nimport {\n  setLevelColorOverrides,\n  syncFieldsValueSummaryVisibleSeries,\n  syncLabelsValueSummaryVisibleSeries,\n  syncLevelsVisibleSeries,\n} from '../../../../services/panel';\nimport { getPanelOption, setPanelOption } from '../../../../services/store';\nimport React from 'react';\nimport {\n  getFieldsVariable,\n  getLabelsVariable,\n  getLevelsVariable,\n  getMetadataVariable,\n} from '../../../../services/variableGetters';\nimport { toggleLevelFromFilter } from '../../../../services/levels';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../../../services/analytics';\nimport { DataFrame, LoadingState } from '@grafana/data';\nimport { LEVEL_VARIABLE_VALUE } from '../../../../services/variables';\nimport { logger } from '../../../../services/logger';\nimport { FilterType } from '../AddToFiltersButton';\nimport { toggleFieldFromFilter, toggleLabelFromFilter } from '../../../../services/labels';\n\nconst SUMMARY_PANEL_SERIES_LIMIT = 100;\n\ninterface ValueSummaryPanelSceneState extends SceneObjectState {\n  body?: SceneFlexLayout;\n  title: string;\n  levelColor?: boolean;\n  tagKey: string;\n  type: 'field' | 'label';\n}\nexport class ValueSummaryPanelScene extends SceneObjectBase<ValueSummaryPanelSceneState> {\n  constructor(state: ValueSummaryPanelSceneState) {\n    super(state);\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public static Component = ({ model }: SceneComponentProps<ValueSummaryPanelScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return (\n        <div>\n          <body.Component model={body} />\n        </div>\n      );\n    }\n\n    return null;\n  };\n\n  onActivate() {\n    const collapsed =\n      getPanelOption('collapsed', [CollapsablePanelText.collapsed, CollapsablePanelText.expanded]) ??\n      CollapsablePanelText.expanded;\n    const viz = buildValueSummaryPanel(this.state.title, { levelColor: this.state.levelColor });\n    const height = getValueSummaryHeight(collapsed);\n\n    viz.setState({\n      extendPanelContext: (_, context) => this.extendTimeSeriesLegendBus(context),\n    });\n\n    this.setState({\n      body: new SceneFlexLayout({\n        key: VALUE_SUMMARY_PANEL_KEY,\n        minHeight: height,\n        height: height,\n        maxHeight: height,\n        wrap: 'nowrap',\n        children: [\n          new SceneFlexItem({\n            body: viz,\n          }),\n        ],\n      }),\n    });\n\n    this._subs.add(\n      viz.subscribeToState((newState, prevState) => {\n        if (newState.collapsed !== prevState.collapsed) {\n          const vizPanelFlexLayout = sceneGraph.getAncestor(viz, SceneFlexLayout);\n          setValueSummaryHeight(\n            vizPanelFlexLayout,\n            newState.collapsed ? CollapsablePanelText.collapsed : CollapsablePanelText.expanded\n          );\n          setPanelOption(\n            'collapsed',\n            newState.collapsed ? CollapsablePanelText.collapsed : CollapsablePanelText.expanded\n          );\n        }\n      })\n    );\n  }\n\n  /**\n   * Syncs legend with labels\n   */\n  private extendTimeSeriesLegendBus = (context: PanelContext) => {\n    const $data = sceneGraph.getData(this);\n    const dataFrame = $data.state.data?.series;\n    const key = this.state.tagKey;\n\n    const sceneFlexItem = this.state.body?.state.children[0];\n    if (!(sceneFlexItem instanceof SceneFlexItem)) {\n      throw new Error('Cannot find sceneFlexItem');\n    }\n    const panel = sceneFlexItem.state.body;\n\n    if (!(panel instanceof VizPanel)) {\n      throw new Error('Cannot find VizPanel');\n    }\n\n    this.initLegendOptions(dataFrame, key, panel);\n\n    if (this.state.type === 'label') {\n      this._subs.add(this.getLabelsVariableLegendSyncSubscription(key));\n    } else {\n      this._subs.add(this.getFieldsVariableLegendSyncSubscription(key, getFieldsVariable(this)));\n      this._subs.add(this.getFieldsVariableLegendSyncSubscription(key, getMetadataVariable(this)));\n    }\n\n    this._subs.add(this.getQuerySubscription(key, $data, panel));\n\n    context.onToggleSeriesVisibility = (value: string, mode: SeriesVisibilityChangeMode) => {\n      let action: FilterType;\n      if (this.state.type === 'label') {\n        if (key === LEVEL_VARIABLE_VALUE) {\n          action = toggleLevelFromFilter(value, this);\n        } else {\n          action = toggleLabelFromFilter(key, value, this);\n        }\n      } else {\n        action = toggleFieldFromFilter(key, value, this);\n      }\n\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.label_in_panel_summary_clicked,\n        {\n          label: value,\n          action,\n        }\n      );\n    };\n  };\n\n  /**\n   * Sync legend with current dataframe\n   */\n  private initLegendOptions(dataFrame: DataFrame[] | undefined, key: string, panel: VizPanel<{}, {}>) {\n    if (dataFrame) {\n      if (this.state.type === 'label') {\n        if (key === LEVEL_VARIABLE_VALUE) {\n          syncLevelsVisibleSeries(panel, dataFrame, this);\n        } else {\n          syncLabelsValueSummaryVisibleSeries(key, panel, dataFrame, this);\n        }\n      } else {\n        syncFieldsValueSummaryVisibleSeries(key, panel, dataFrame, this);\n      }\n    }\n  }\n\n  /**\n   * Sync visible series on dataframe update\n   */\n  private getQuerySubscription(key: string, $data: SceneDataProvider, panel: VizPanel<{}, {}>) {\n    return $data.subscribeToState((newState, prevState) => {\n      if (newState.data?.state === LoadingState.Done) {\n        if (this.state.type === 'label') {\n          if (key === LEVEL_VARIABLE_VALUE) {\n            syncLevelsVisibleSeries(panel, newState.data.series, this);\n          } else {\n            syncLabelsValueSummaryVisibleSeries(key, panel, newState.data.series, this);\n          }\n        } else {\n          syncFieldsValueSummaryVisibleSeries(key, panel, newState.data.series, this);\n        }\n      }\n    });\n  }\n\n  private getFieldsVariableLegendSyncSubscription(key: string, variable: AdHocFiltersVariable) {\n    return variable?.subscribeToState(() => {\n      const sceneFlexItem = this.state.body?.state.children[0];\n      if (!(sceneFlexItem instanceof SceneFlexItem)) {\n        throw new Error('Cannot find sceneFlexItem');\n      }\n      const panel = sceneFlexItem.state.body;\n      if (!(panel instanceof VizPanel)) {\n        throw new Error('ValueSummary - getFieldsVariableLegendSyncSubscription: Cannot find VizPanel');\n      }\n\n      const $data = sceneGraph.getData(this);\n      const dataFrame = $data.state.data?.series;\n\n      if (!dataFrame) {\n        logger.warn('ValueSummary - getFieldsVariableLegendSyncSubscription: missing dataframe!');\n        return;\n      }\n\n      syncFieldsValueSummaryVisibleSeries(key, panel, dataFrame, this);\n    });\n  }\n\n  /**\n   * Returns value subscription for labels\n   */\n  private getLabelsVariableLegendSyncSubscription(key: string) {\n    const isLevel = key === LEVEL_VARIABLE_VALUE;\n    const variable = isLevel ? getLevelsVariable(this) : getLabelsVariable(this);\n    return variable?.subscribeToState(() => {\n      const sceneFlexItem = this.state.body?.state.children[0];\n      if (!(sceneFlexItem instanceof SceneFlexItem)) {\n        throw new Error('Cannot find sceneFlexItem');\n      }\n      const panel = sceneFlexItem.state.body;\n      if (!(panel instanceof VizPanel)) {\n        throw new Error('ValueSummary - getLabelsVariableLegendSyncSubscription: Cannot find VizPanel');\n      }\n\n      const $data = sceneGraph.getData(this);\n      const dataFrame = $data.state.data?.series;\n\n      if (!dataFrame) {\n        logger.warn('ValueSummary - getLabelsVariableLegendSyncSubscription: missing dataframe!');\n        return;\n      }\n\n      if (isLevel) {\n        syncLevelsVisibleSeries(panel, dataFrame, this);\n      } else {\n        syncLabelsValueSummaryVisibleSeries(key, panel, dataFrame, this);\n      }\n    });\n  }\n}\n\nexport function setValueSummaryHeight(vizPanelFlexLayout: SceneFlexLayout, collapsableState: CollapsablePanelText) {\n  const height = getValueSummaryHeight(collapsableState);\n  vizPanelFlexLayout.setState({\n    minHeight: height,\n    height: height,\n    maxHeight: height,\n  });\n}\n\nfunction getValueSummaryHeight(collapsableState: CollapsablePanelText) {\n  return collapsableState === CollapsablePanelText.collapsed ? 35 : 300;\n}\n\nfunction buildValueSummaryPanel(title: string, options?: { levelColor?: boolean }): VizPanel {\n  const collapsed =\n    getPanelOption('collapsed', [CollapsablePanelText.collapsed, CollapsablePanelText.expanded]) ??\n    CollapsablePanelText.expanded;\n\n  const body = PanelBuilders.timeseries()\n    .setTitle(title)\n    .setMenu(new PanelMenu({}))\n    .setCollapsible(true)\n    .setCollapsed(collapsed === CollapsablePanelText.collapsed)\n    .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n    .setCustomFieldConfig('fillOpacity', 100)\n    .setCustomFieldConfig('lineWidth', 0)\n    .setCustomFieldConfig('pointSize', 0)\n    .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n    // 11.5\n    // .setShowMenuAlways(true)\n    .setSeriesLimit(SUMMARY_PANEL_SERIES_LIMIT);\n\n  if (options?.levelColor) {\n    body.setOverrides(setLevelColorOverrides);\n  }\n  return body.build();\n}\n\nexport const VALUE_SUMMARY_PANEL_KEY = 'value_summary_panel';\n","import { css } from '@emotion/css';\nimport { Icon, IconButton, Input, useStyles2 } from '@grafana/ui';\nimport React, { HTMLProps } from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\n\ninterface Props extends Omit<HTMLProps<HTMLInputElement>, 'width' | 'prefix'> {\n  onClear?: () => void;\n  suffix?: React.ReactNode;\n  prefix?: React.ReactNode;\n}\n\nexport const SearchInput = ({ value, onChange, placeholder, onClear, suffix, ...rest }: Props) => {\n  const styles = useStyles2(getStyles);\n  return (\n    <Input\n      value={value}\n      onChange={onChange}\n      suffix={\n        <span className={styles.suffixWrapper}>\n          {onClear && value ? (\n            <IconButton\n              aria-label={'Clear search'}\n              tooltip={'Clear search'}\n              onClick={onClear}\n              name=\"times\"\n              className={styles.clearIcon}\n            />\n          ) : undefined}\n          {suffix && suffix}\n        </span>\n      }\n      prefix={<Icon name=\"search\" />}\n      placeholder={placeholder}\n      {...rest}\n    />\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  suffixWrapper: css({\n    gap: theme.spacing(0.5),\n    display: 'inline-flex',\n  }),\n  clearIcon: css({\n    cursor: 'pointer',\n  }),\n});\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, ClickOutsideWrapper, Field, FieldSet, Input, Label, Select, Stack, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { css, cx } from '@emotion/css';\nimport { SelectLabelActionScene } from './SelectLabelActionScene';\nimport {\n  addNumericFilter,\n  removeNumericFilter,\n  validateVariableNameForField,\n  InterpolatedFilterType,\n} from './AddToFiltersButton';\nimport { FilterOp } from '../../../services/filterTypes';\nimport { getAdHocFiltersVariable, getValueFromFieldsFilter } from '../../../services/variableGetters';\nimport { logger } from '../../../services/logger';\nimport { testIds } from '../../../services/testIds';\n\nexport interface NumericFilterPopoverSceneState extends SceneObjectState {\n  labelName: string;\n  variableType: InterpolatedFilterType;\n  gt?: number;\n  gte?: boolean;\n  lt?: number;\n  lte?: boolean;\n  fieldType: 'float' | 'duration' | 'bytes';\n  hasExistingFilter?: boolean;\n}\n\nexport type NumericFilterPopoverSceneStateTotal =\n  | (NumericFilterPopoverSceneState & FloatTypes)\n  | (NumericFilterPopoverSceneState & DurationTypes)\n  | (NumericFilterPopoverSceneState & ByteTypes);\n\nenum DisplayDurationUnits {\n  ns = 'ns',\n  us = 's',\n  ms = 'ms',\n  s = 's',\n  m = 'm',\n  h = 'h',\n}\n\nexport const validDurationValues: { [key in DisplayDurationUnits]: string[] } = {\n  [DisplayDurationUnits.ns]: ['ns'],\n  [DisplayDurationUnits.us]: ['s', 'us'],\n  [DisplayDurationUnits.ms]: ['ms'],\n  [DisplayDurationUnits.s]: ['s'],\n  [DisplayDurationUnits.m]: ['m'],\n  [DisplayDurationUnits.h]: ['h'],\n};\n\nenum DisplayByteUnits {\n  B = 'B',\n  KB = 'KB',\n  MB = 'MB',\n  GB = 'GB',\n  TB = 'TB',\n}\n\nexport enum ValidByteUnitValues {\n  B = 'B',\n  KB = 'KB',\n  MB = 'MB',\n  GB = 'GB',\n  TB = 'TB',\n\n  // Not selectable in the UI, but valid from link extensions\n  kB = 'kB',\n  KiB = 'KiB',\n  MiB = 'MiB',\n  GiB = 'GiB',\n  TiB = 'TiB',\n}\n\ninterface FloatUnitTypes {\n  ltu: '';\n  gtu: '';\n}\n\ninterface FloatTypes extends FloatUnitTypes {\n  fieldType: 'float';\n}\n\ninterface DurationUnitTypes {\n  ltu: DisplayDurationUnits;\n  gtu: DisplayDurationUnits;\n}\n\ninterface DurationTypes extends DurationUnitTypes {\n  fieldType: 'duration';\n}\n\ninterface ByteUnitTypes {\n  ltu: DisplayByteUnits;\n  gtu: DisplayByteUnits;\n}\n\ninterface ByteTypes extends ByteUnitTypes {\n  fieldType: 'bytes';\n}\n\nexport class NumericFilterPopoverScene extends SceneObjectBase<NumericFilterPopoverSceneStateTotal> {\n  constructor(state: Omit<NumericFilterPopoverSceneStateTotal, 'gtu' | 'ltu'>) {\n    let units: FloatUnitTypes | DurationUnitTypes | ByteUnitTypes;\n    const fieldType: 'float' | 'bytes' | 'duration' = state.fieldType;\n    if (fieldType === 'bytes') {\n      units = { ltu: DisplayByteUnits.B, gtu: DisplayByteUnits.B };\n    } else if (fieldType === 'duration') {\n      units = { ltu: DisplayDurationUnits.s, gtu: DisplayDurationUnits.s };\n    } else if (fieldType === 'float') {\n      units = { ltu: '', gtu: '' };\n    } else {\n      throw new Error(`field type incorrectly defined: ${fieldType}`);\n    }\n\n    // @todo - how to avoid type assertion?\n    super({ ...state, ...units } as NumericFilterPopoverSceneStateTotal);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    // get existing values if they exist\n    const variable = getAdHocFiltersVariable(\n      validateVariableNameForField(this.state.labelName, this.state.variableType),\n      this\n    );\n    const filters = variable.state.filters.filter((f) => f.key === this.state.labelName);\n    const gtFilter = filters.find((f) => f.operator === FilterOp.gte || f.operator === FilterOp.gt);\n    const ltFilter = filters.find((f) => f.operator === FilterOp.lte || f.operator === FilterOp.lt);\n    let stateUpdate: Partial<NumericFilterPopoverSceneStateTotal> = {};\n\n    if (this.state.fieldType === 'duration' || this.state.fieldType === 'bytes') {\n      if (gtFilter) {\n        const extractedValue = extractValueFromString(getValueFromFieldsFilter(gtFilter).value, this.state.fieldType);\n\n        if (extractedValue) {\n          stateUpdate.gt = extractedValue.value;\n          stateUpdate.gtu = extractedValue.unit;\n          stateUpdate.gte = gtFilter.operator === FilterOp.gte;\n        }\n      }\n\n      if (ltFilter) {\n        const extractedValue = extractValueFromString(getValueFromFieldsFilter(ltFilter).value, this.state.fieldType);\n\n        if (extractedValue) {\n          stateUpdate.lt = extractedValue.value;\n          stateUpdate.ltu = extractedValue.unit;\n          stateUpdate.lte = ltFilter.operator === FilterOp.lte;\n        }\n      }\n    } else {\n      // Floats have no unit\n      if (gtFilter) {\n        const extractedValue = getValueFromFieldsFilter(gtFilter).value;\n        stateUpdate.gt = Number(extractedValue);\n        stateUpdate.gtu = '';\n        stateUpdate.gte = gtFilter.operator === FilterOp.gte;\n      }\n      if (ltFilter) {\n        const extractedValue = getValueFromFieldsFilter(ltFilter).value;\n        stateUpdate.lt = Number(extractedValue);\n        stateUpdate.ltu = '';\n        stateUpdate.lte = ltFilter.operator === FilterOp.lte;\n      }\n    }\n\n    if (Object.keys(stateUpdate).length !== 0) {\n      stateUpdate.hasExistingFilter = true;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  onSubmit() {\n    // \"0\" values break byte queries see https://github.com/grafana/loki/issues/14993, for now we remove the filter when a 0 value is entered to prevent breakage\n    // numeric values can only be fields or metadata variable\n    if (this.state.gt) {\n      addNumericFilter(\n        this.state.labelName,\n        this.state.gt.toString() + this.state.gtu,\n        this.state.gte ? FilterOp.gte : FilterOp.gt,\n        this,\n        this.state.variableType\n      );\n    } else {\n      removeNumericFilter(\n        this.state.labelName,\n        this,\n        this.state.gte ? FilterOp.gte : FilterOp.gt,\n        this.state.variableType\n      );\n    }\n\n    if (this.state.lt) {\n      addNumericFilter(\n        this.state.labelName,\n        this.state.lt.toString() + this.state.ltu,\n        this.state.lte ? FilterOp.lte : FilterOp.lt,\n        this,\n        this.state.variableType\n      );\n    } else {\n      removeNumericFilter(\n        this.state.labelName,\n        this,\n        this.state.lte ? FilterOp.lte : FilterOp.lt,\n        this.state.variableType\n      );\n    }\n\n    const selectLabelActionScene = sceneGraph.getAncestor(this, SelectLabelActionScene);\n    selectLabelActionScene.togglePopover();\n  }\n  onInputKeydown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    const formDisabled = this.state.gt === undefined && this.state.lt === undefined;\n    if (e.key === 'Enter' && !formDisabled) {\n      this.onSubmit();\n    }\n  };\n\n  public static Component = ({ model }: SceneComponentProps<NumericFilterPopoverScene>) => {\n    const popoverStyles = useStyles2(getPopoverStyles);\n    const { labelName, gt, lt, gte, lte, gtu, ltu, fieldType, hasExistingFilter } = model.useState();\n    const subTitle = fieldType !== 'float' && fieldType !== labelName ? `(${fieldType})` : undefined;\n\n    const selectLabelActionScene = sceneGraph.getAncestor(model, SelectLabelActionScene);\n    const formDisabled = gt === undefined && lt === undefined;\n\n    return (\n      <ClickOutsideWrapper useCapture={true} onClick={() => selectLabelActionScene.togglePopover()}>\n        <Stack direction=\"column\" gap={0} role=\"tooltip\">\n          <div className={popoverStyles.card.body}>\n            <div className={popoverStyles.card.title}>\n              {labelName} {subTitle}\n            </div>\n\n            <div className={popoverStyles.card.fieldWrap}>\n              {/* greater than */}\n              <FieldSet className={popoverStyles.card.fieldset}>\n                <Field\n                  data-testid={testIds.breakdowns.common.filterNumericPopover.inputGreaterThanInclusive}\n                  horizontal={true}\n                  className={cx(popoverStyles.card.field, popoverStyles.card.inclusiveField)}\n                >\n                  <Select<string>\n                    className={popoverStyles.card.inclusiveInput}\n                    menuShouldPortal={false}\n                    value={gte !== undefined ? gte.toString() : 'false'}\n                    options={[\n                      { label: 'Greater than', value: 'false' },\n                      { label: 'Greater than or equal', value: 'true' },\n                    ]}\n                    onChange={(value) => model.setState({ gte: value.value === 'true' })}\n                  />\n                </Field>\n                <Field\n                  data-testid={testIds.breakdowns.common.filterNumericPopover.inputGreaterThan}\n                  horizontal={true}\n                  className={popoverStyles.card.field}\n                >\n                  <Input\n                    onKeyDownCapture={model.onInputKeydown}\n                    autoFocus={true}\n                    onChange={(e) => {\n                      model.setState({\n                        gt: e.currentTarget.value !== '' ? Number(e.currentTarget.value) : undefined,\n                      });\n                    }}\n                    className={popoverStyles.card.numberInput}\n                    value={gt}\n                    type={'number'}\n                  />\n                </Field>\n                {fieldType !== 'float' && (\n                  <Label>\n                    <Field\n                      data-testid={testIds.breakdowns.common.filterNumericPopover.inputGreaterThanUnit}\n                      horizontal={true}\n                      className={popoverStyles.card.field}\n                      label={<span className={popoverStyles.card.unitFieldLabel}>Unit</span>}\n                    >\n                      <Select\n                        onChange={(e) => {\n                          model.setState({\n                            gtu: e.value,\n                          });\n                        }}\n                        menuShouldPortal={false}\n                        options={getUnitOptions(fieldType)}\n                        className={popoverStyles.card.selectInput}\n                        value={gtu}\n                      />\n                    </Field>\n                  </Label>\n                )}\n              </FieldSet>\n\n              {/* less than */}\n              <FieldSet className={popoverStyles.card.fieldset}>\n                <Field\n                  data-testid={testIds.breakdowns.common.filterNumericPopover.inputLessThanInclusive}\n                  horizontal={true}\n                  className={cx(popoverStyles.card.field, popoverStyles.card.inclusiveField)}\n                >\n                  <Select<string>\n                    className={popoverStyles.card.inclusiveInput}\n                    menuShouldPortal={false}\n                    value={lte !== undefined ? lte.toString() : 'false'}\n                    options={[\n                      { label: 'Less than', value: 'false' },\n                      { label: 'Less than or equal', value: 'true' },\n                    ]}\n                    onChange={(value) => model.setState({ lte: value.value === 'true' })}\n                  />\n                </Field>\n                <Field\n                  data-testid={testIds.breakdowns.common.filterNumericPopover.inputLessThan}\n                  horizontal={true}\n                  className={popoverStyles.card.field}\n                >\n                  <Input\n                    onKeyDownCapture={model.onInputKeydown}\n                    onChange={(e) =>\n                      model.setState({ lt: e.currentTarget.value !== '' ? Number(e.currentTarget.value) : undefined })\n                    }\n                    className={popoverStyles.card.numberInput}\n                    value={lt}\n                    type={'number'}\n                  />\n                </Field>\n                {fieldType !== 'float' && (\n                  <Label>\n                    <Field\n                      data-testid={testIds.breakdowns.common.filterNumericPopover.inputLessThanUnit}\n                      horizontal={true}\n                      className={popoverStyles.card.field}\n                      label={<span className={popoverStyles.card.unitFieldLabel}>Unit</span>}\n                    >\n                      <Select\n                        onChange={(e) => {\n                          model.setState({\n                            ltu: e.value,\n                          });\n                        }}\n                        menuShouldPortal={false}\n                        options={getUnitOptions(fieldType)}\n                        className={popoverStyles.card.selectInput}\n                        value={ltu}\n                      />\n                    </Field>\n                  </Label>\n                )}\n              </FieldSet>\n            </div>\n\n            {/* buttons */}\n            <div className={popoverStyles.card.buttons}>\n              {hasExistingFilter && (\n                <Button\n                  data-testid={testIds.breakdowns.common.filterNumericPopover.removeButton}\n                  disabled={!hasExistingFilter}\n                  onClick={() => {\n                    model.setState({\n                      gt: undefined,\n                      lt: undefined,\n                    });\n                    model.onSubmit();\n                  }}\n                  size={'sm'}\n                  variant={'destructive'}\n                  fill={'outline'}\n                >\n                  Remove\n                </Button>\n              )}\n              <Button\n                data-testid={testIds.breakdowns.common.filterNumericPopover.submitButton}\n                disabled={formDisabled}\n                onClick={() => model.onSubmit()}\n                size={'sm'}\n                variant={'primary'}\n                fill={'outline'}\n                type={'submit'}\n              >\n                Add\n              </Button>\n\n              <Button\n                data-testid={testIds.breakdowns.common.filterNumericPopover.cancelButton}\n                onClick={() => selectLabelActionScene.togglePopover()}\n                size={'sm'}\n                variant={'secondary'}\n                fill={'outline'}\n              >\n                Cancel\n              </Button>\n            </div>\n          </div>\n        </Stack>\n      </ClickOutsideWrapper>\n    );\n  };\n}\n\nexport function extractValueFromString(\n  inputString: string,\n  inputType: 'bytes' | 'duration'\n): { value: number; unit: DisplayByteUnits | DisplayDurationUnits } | undefined {\n  if (inputType === 'duration') {\n    const durationValues = Object.values(DisplayDurationUnits);\n\n    // Check the end of the filter value for a unit that exactly matches\n    const durationValue = durationValues.find((durationValue) => {\n      const durationValueLength = durationValue.length;\n      return inputString.slice(durationValueLength * -1) === durationValue;\n    });\n\n    if (durationValue) {\n      const value = Number(inputString.replace(durationValue, ''));\n      if (!isNaN(value)) {\n        return {\n          unit: durationValue,\n          value: value,\n        };\n      }\n    }\n  }\n\n  if (inputType === 'bytes') {\n    const bytesValues = Object.values(DisplayByteUnits)\n      // must be sorted from longest to shortest\n      .sort((a, b) => b.length - a.length);\n\n    // Check the end of the filter value for a unit that exactly matches\n    const bytesValue = bytesValues.find((bytesValue) => {\n      const byteValueLength = bytesValue.length;\n      return inputString.slice(byteValueLength * -1) === bytesValue;\n    });\n\n    if (bytesValue) {\n      const value = Number(inputString.replace(bytesValue, ''));\n      if (!isNaN(value)) {\n        return {\n          unit: bytesValue,\n          value: value,\n        };\n      }\n    }\n  }\n\n  return undefined;\n}\n\nfunction getUnitOptions(\n  fieldType: 'duration' | 'bytes'\n): Array<SelectableValue<DisplayDurationUnits | DisplayByteUnits>> {\n  if (fieldType === 'duration') {\n    const keys = Object.keys(DisplayDurationUnits) as Array<keyof typeof DisplayDurationUnits>;\n    return keys.map((key) => {\n      return {\n        text: key,\n        value: DisplayDurationUnits[key],\n        label: key,\n      };\n    });\n  }\n\n  if (fieldType === 'bytes') {\n    const keys = Object.keys(DisplayByteUnits) as Array<keyof typeof DisplayByteUnits>;\n    return keys.map((key) => {\n      return {\n        text: key,\n        value: DisplayByteUnits[key],\n        label: key,\n      };\n    });\n  }\n\n  const error = new Error(`invalid field type: ${fieldType}`);\n  logger.error(error, { msg: 'getUnitOptions, invalid field type' });\n  throw error;\n}\n\nconst getPopoverStyles = (theme: GrafanaTheme2) => ({\n  card: {\n    buttons: css({\n      display: 'flex',\n      flexWrap: 'wrap',\n      justifyContent: 'flex-end',\n      gap: theme.spacing(1.5),\n      marginTop: theme.spacing(1),\n    }),\n    inclusiveInput: css({\n      minWidth: '185px',\n    }),\n    selectInput: css({\n      minWidth: '65px',\n    }),\n    numberInput: css({\n      width: '75px',\n    }),\n    fieldWrap: css({\n      display: 'flex',\n      flexDirection: 'column',\n      paddingTop: theme.spacing(2),\n      paddingBottom: 0,\n    }),\n    field: css({\n      display: 'flex',\n      alignItems: 'center',\n      marginBottom: theme.spacing(1),\n    }),\n    inclusiveField: css({\n      marginRight: theme.spacing(1),\n    }),\n    unitFieldLabel: css({\n      marginLeft: theme.spacing(2),\n      marginRight: theme.spacing(1.5),\n    }),\n    numberFieldLabel: css({\n      width: '100px',\n    }),\n    switchFieldLabel: css({\n      marginLeft: theme.spacing(2),\n      marginRight: theme.spacing(1),\n    }),\n    fieldset: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'space-between',\n      width: '100%',\n      marginBottom: 0,\n    }),\n    title: css({}),\n    body: css({\n      padding: theme.spacing(2),\n    }),\n    p: css({\n      maxWidth: 300,\n    }),\n  },\n});\n","import {\n  AdHocFiltersVariable,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  VizPanel,\n} from '@grafana/scenes';\nimport { getDetectedFieldsFrame, getLogsPanelFrame, ServiceScene } from '../ServiceScene';\nimport { getValueBreakdownLink } from '../../../services/navigate';\nimport { getPrimaryLabelFromUrl, ValueSlugs } from '../../../services/routing';\nimport {\n  Button,\n  ButtonGroup,\n  ButtonSelect,\n  IconButton,\n  LinkButton,\n  Popover,\n  PopoverController,\n  useStyles2,\n} from '@grafana/ui';\nimport React, { useRef } from 'react';\nimport { addToFilters, clearFilters, InterpolatedFilterType } from './AddToFiltersButton';\nimport { EMPTY_VARIABLE_VALUE, LEVEL_VARIABLE_VALUE, VAR_FIELDS } from '../../../services/variables';\nimport { AdHocVariableFilter, Field, GrafanaTheme2, Labels, LoadingState, SelectableValue } from '@grafana/data';\nimport {\n  getFieldsVariable,\n  getLabelsVariable,\n  getLevelsVariable,\n  getValueFromAdHocVariableFilter,\n  getValueFromFieldsFilter,\n} from '../../../services/variableGetters';\nimport { FilterOp } from '../../../services/filterTypes';\nimport { LokiQuery } from '../../../services/lokiQuery';\nimport { css } from '@emotion/css';\nimport { rest } from 'lodash';\nimport { NumericFilterPopoverScene } from './NumericFilterPopoverScene';\nimport { getDetectedFieldType } from '../../../services/fields';\nimport { logger } from '../../../services/logger';\nimport { testIds } from '../../../services/testIds';\nimport { findObjectOfType } from '../../../services/scenes';\nimport { syncLevelsVariable } from '../../IndexScene/LevelsVariableScene';\n\ninterface SelectLabelActionSceneState extends SceneObjectState {\n  labelName: string;\n  fieldType: ValueSlugs;\n  hideValueDrilldown?: boolean;\n  hasSparseFilters?: boolean;\n  hasNumericFilters?: boolean;\n  selectedValue?: SelectableValue<string>;\n  popover?: NumericFilterPopoverScene;\n  showPopover: boolean;\n}\n\nconst INCLUDE_VALUE = 'Include';\nconst EXCLUDE_VALUE = 'Exclude';\nconst NUMERIC_FILTER_VALUE = 'Add to filter';\n\nexport class SelectLabelActionScene extends SceneObjectBase<SelectLabelActionSceneState> {\n  constructor(state: Omit<SelectLabelActionSceneState, 'showPopover'>) {\n    super({ ...state, showPopover: false });\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onChange(value: SelectableValue<string>) {\n    const variable = this.getVariable();\n    const variableName = variable.state.name as InterpolatedFilterType;\n    const existingFilter = this.getExistingFilter(variable);\n    const fieldValue = getValueFromAdHocVariableFilter(variableName, existingFilter);\n    const isIncluded = existingFilter?.operator === FilterOp.NotEqual && fieldValue.value === EMPTY_VARIABLE_VALUE;\n\n    if (isIncluded && value.value === INCLUDE_VALUE) {\n      this.clearFilter(variableName);\n    } else if (value.value === INCLUDE_VALUE) {\n      this.onClickExcludeEmpty(variableName);\n    } else if (value.value === EXCLUDE_VALUE) {\n      this.onClickIncludeEmpty(variableName);\n    } else if (value.value === NUMERIC_FILTER_VALUE) {\n      this.onClickNumericFilter(variableName);\n    }\n\n    this.setState({\n      selectedValue: value,\n    });\n  }\n\n  public static Component = ({ model }: SceneComponentProps<SelectLabelActionScene>) => {\n    const {\n      hideValueDrilldown,\n      labelName,\n      hasSparseFilters,\n      hasNumericFilters,\n      selectedValue,\n      popover,\n      showPopover,\n      fieldType,\n    } = model.useState();\n    const variable = model.getVariable();\n    const variableName = variable.useState().name as InterpolatedFilterType;\n    const existingFilter = model.getExistingFilter(variable);\n    const fieldValue = getValueFromAdHocVariableFilter(variableName, existingFilter);\n    const styles = useStyles2(getStyles);\n    const popoverRef = useRef<HTMLButtonElement>(null);\n    const filterButtonDisabled =\n      fieldType === ValueSlugs.label &&\n      variable.state.name === VAR_FIELDS &&\n      variable.state.filters.filter((f) => f.key !== labelName && f.operator === FilterOp.Equal).length === 0;\n\n    const isIncluded = existingFilter?.operator === FilterOp.NotEqual && fieldValue.value === EMPTY_VARIABLE_VALUE;\n    const hasOtherFilter = !!existingFilter;\n\n    const selectedOptionValue =\n      selectedValue?.value ?? (isIncluded ? INCLUDE_VALUE : hasNumericFilters ? NUMERIC_FILTER_VALUE : INCLUDE_VALUE);\n\n    const hasExistingNumericFilter = existingFilter?.operator\n      ? [FilterOp.gte, FilterOp.gt, FilterOp.lte, FilterOp.lt].includes(existingFilter.operator)\n      : false;\n    const numericSelected = selectedOptionValue === NUMERIC_FILTER_VALUE || hasExistingNumericFilter;\n    const includeSelected = selectedOptionValue === INCLUDE_VALUE && !numericSelected;\n\n    const sparseIncludeOption: SelectableValue<string> = {\n      value: INCLUDE_VALUE,\n      component: () => (\n        <SelectableValueComponent selected={includeSelected} text={`Include all log lines with ${labelName}`} />\n      ),\n    };\n    const sparseExcludeOption: SelectableValue<string> = {\n      value: EXCLUDE_VALUE,\n      component: () => <SelectableValueComponent selected={false} text={`Exclude all log lines with ${labelName}`} />,\n    };\n    const numericFilterOption: SelectableValue<string> = {\n      value: NUMERIC_FILTER_VALUE,\n      component: () => (\n        <SelectableValueComponent selected={numericSelected} text={`Add an expression, i.e. ${labelName} > 30`} />\n      ),\n    };\n\n    const options: Array<SelectableValue<string>> = [];\n    if (hasNumericFilters) {\n      options.push(numericFilterOption);\n    }\n\n    if (hasSparseFilters) {\n      if (!hasExistingNumericFilter) {\n        options.push(sparseIncludeOption);\n      }\n\n      options.push(sparseExcludeOption);\n    }\n\n    const defaultOption = isIncluded\n      ? sparseIncludeOption\n      : hasNumericFilters\n      ? numericFilterOption\n      : sparseIncludeOption;\n\n    return (\n      <>\n        {hasOtherFilter && (\n          <IconButton\n            disabled={filterButtonDisabled}\n            name={'filter'}\n            tooltip={`Clear ${labelName} filters`}\n            onClick={() => model.clearFilters(variableName)}\n          />\n        )}\n        {(hasNumericFilters || hasSparseFilters) && (\n          <>\n            <ButtonGroup data-testid={testIds.breakdowns.common.filterButtonGroup}>\n              <Button\n                data-testid={testIds.breakdowns.common.filterButton}\n                ref={popoverRef}\n                onClick={() => model.onChange(selectedValue ?? defaultOption)}\n                size={'sm'}\n                fill={'outline'}\n                variant={'secondary'}\n              >\n                {selectedValue?.value ?? defaultOption.value}\n              </Button>\n              <ButtonSelect\n                data-testid={testIds.breakdowns.common.filterSelect}\n                className={styles.buttonSelect}\n                variant={'default'}\n                options={options}\n                onChange={(value) => {\n                  model.onChange(value);\n                }}\n              />\n            </ButtonGroup>\n          </>\n        )}\n        {hideValueDrilldown !== true && (\n          <LinkButton\n            title={`View breakdown of values for ${labelName}`}\n            variant=\"primary\"\n            fill=\"outline\"\n            size=\"sm\"\n            aria-label={`Select ${labelName}`}\n            href={model.getViewValuesLink()}\n          >\n            Select\n          </LinkButton>\n        )}\n\n        {popover && (\n          <PopoverController content={<popover.Component model={popover} />}>\n            {(showPopper, hidePopper, popperProps) => {\n              const blurFocusProps = {\n                onBlur: hidePopper,\n                onFocus: showPopper,\n              };\n\n              return (\n                <>\n                  {popoverRef.current && (\n                    <>\n                      {/* @ts-expect-error @todo upgrade typescript */}\n                      <Popover\n                        {...popperProps}\n                        {...rest}\n                        show={showPopover}\n                        wrapperClassName={styles.popover}\n                        referenceElement={popoverRef.current}\n                        renderArrow={true}\n                        {...blurFocusProps}\n                      />\n                    </>\n                  )}\n                </>\n              );\n            }}\n          </PopoverController>\n        )}\n      </>\n    );\n  };\n\n  private getExistingFilter(variable?: AdHocFiltersVariable): AdHocVariableFilter | undefined {\n    let { labelName } = getPrimaryLabelFromUrl();\n    if (this.state.labelName !== labelName) {\n      return variable?.state.filters.find((filter) => {\n        return filter.key === this.state.labelName;\n      });\n    }\n\n    return undefined;\n  }\n\n  public onActivate() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n\n    if (serviceScene.state.$data?.state.data?.state === LoadingState.Done) {\n      this.calculateSparsity();\n    }\n\n    this._subs.add(\n      sceneGraph.getData(this).subscribeToState((newState) => {\n        if (newState.data?.state === LoadingState.Done) {\n          if (serviceScene.state.$data?.state.data?.state === LoadingState.Done) {\n            this.calculateSparsity();\n          }\n\n          this._subs.add(\n            serviceScene.state.$data?.subscribeToState((newLogsPanelState) => {\n              if (newLogsPanelState.data?.state === LoadingState.Done) {\n                this.calculateSparsity();\n              }\n            })\n          );\n        }\n      })\n    );\n  }\n\n  public onClickNumericFilter = (variableType: InterpolatedFilterType) => {\n    const detectedFieldFrame = getDetectedFieldsFrame(this);\n    const fieldType = getDetectedFieldType(this.state.labelName, detectedFieldFrame);\n\n    if (!fieldType || fieldType === 'string' || fieldType === 'boolean' || fieldType === 'int') {\n      const error = new Error(`Incorrect field type: ${fieldType}`);\n      logger.error(error, { msg: `onClickNumericFilter invalid field type ${fieldType}` });\n      throw error;\n    }\n\n    this.setState({\n      popover: new NumericFilterPopoverScene({ labelName: this.state.labelName, variableType, fieldType }),\n    });\n    this.togglePopover();\n  };\n\n  public getViewValuesLink = () => {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    return getValueBreakdownLink(this.state.fieldType, this.state.labelName, serviceScene);\n  };\n\n  public onClickExcludeEmpty = (variableType: InterpolatedFilterType) => {\n    addToFilters(this.state.labelName, EMPTY_VARIABLE_VALUE, 'exclude', this, variableType);\n  };\n\n  public onClickIncludeEmpty = (variableType: InterpolatedFilterType) => {\n    // If json do we want != '{}'?\n    addToFilters(this.state.labelName, EMPTY_VARIABLE_VALUE, 'include', this, variableType);\n  };\n\n  public clearFilter = (variableType: InterpolatedFilterType) => {\n    addToFilters(this.state.labelName, EMPTY_VARIABLE_VALUE, 'clear', this, variableType);\n  };\n\n  public clearFilters = (variableType: InterpolatedFilterType) => {\n    clearFilters(this.state.labelName, this, variableType);\n    if (this.state.labelName === LEVEL_VARIABLE_VALUE) {\n      syncLevelsVariable(this);\n    }\n  };\n\n  public togglePopover() {\n    this.setState({\n      showPopover: !this.state.showPopover,\n    });\n  }\n\n  private calculateSparsity() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const logsPanelData = getLogsPanelFrame(serviceScene.state.$data?.state.data);\n    const labels: Field<Labels> | undefined = logsPanelData?.fields.find((field) => field.name === 'labels');\n\n    const data = sceneGraph.getData(this);\n    const queryRunner = findObjectOfType(data, (o) => o instanceof SceneQueryRunner, SceneQueryRunner);\n    if (queryRunner) {\n      const queries = queryRunner.state.queries;\n      const query = queries[0] as LokiQuery | undefined;\n      if (query?.expr.includes('avg_over_time')) {\n        this.setState({\n          hasNumericFilters: true,\n        });\n      }\n    }\n\n    if (!labels || !logsPanelData) {\n      this.setState({\n        hasSparseFilters: false,\n      });\n      return;\n    }\n    const variable = this.getVariable();\n    // iterate through all the labels on the log panel query result and count how many times this exists\n    const logLinesWithLabelCount = labels.values.reduce((acc, labels) => {\n      if (labels?.[this.state.labelName]) {\n        acc++;\n      }\n      return acc;\n    }, 0);\n\n    const panel = sceneGraph.getAncestor(this, VizPanel);\n    if (logLinesWithLabelCount !== undefined && logsPanelData.length > 0) {\n      const percentage = ((logLinesWithLabelCount / logsPanelData.length) * 100).toLocaleString();\n      const description = `${this.state.labelName} exists on ${percentage}% of ${logsPanelData.length} sampled log lines`;\n\n      // Update the desc\n      panel.setState({\n        description,\n      });\n    } else {\n      panel.setState({\n        description: undefined,\n      });\n    }\n\n    // Only show for sparse fields and existing include and exclude filters, which will match an empty string in the value\n    const existingFilter = this.getExistingFilter(variable);\n    const existingFilterValue =\n      existingFilter && variable.state.name === VAR_FIELDS ? getValueFromFieldsFilter(existingFilter) : undefined;\n\n    if (logLinesWithLabelCount < logsPanelData.length || existingFilterValue?.value === EMPTY_VARIABLE_VALUE) {\n      this.setState({\n        hasSparseFilters: true,\n      });\n    } else {\n      this.setState({\n        hasSparseFilters: false,\n      });\n    }\n  }\n\n  private getVariable() {\n    if (this.state.fieldType === ValueSlugs.field) {\n      return getFieldsVariable(this);\n    } else if (this.state.labelName === LEVEL_VARIABLE_VALUE) {\n      return getLevelsVariable(this);\n    } else {\n      return getLabelsVariable(this);\n    }\n  }\n}\n\nfunction SelectableValueComponent(props: { text: string; selected: boolean }) {\n  const styles = useStyles2(getSelectableValueComponentStyles);\n  return (\n    <span className={styles.description}>\n      {props.selected && <span className={styles.selected}></span>}\n      {props.text}\n    </span>\n  );\n}\n\nconst getSelectableValueComponentStyles = (theme: GrafanaTheme2) => {\n  return {\n    selected: css({\n      label: 'selectable-value-selected',\n      '&:before': {\n        content: '\"\"',\n        position: 'absolute',\n        left: 0,\n        top: '4px',\n        height: 'calc(100% - 8px)',\n        width: '2px',\n        backgroundColor: theme.colors.warning.main,\n      },\n    }),\n    description: css({\n      textAlign: 'left',\n      fontSize: theme.typography.pxToRem(12),\n    }),\n  };\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    popover: css({\n      borderRadius: theme.shape.radius.default,\n      boxShadow: theme.shadows.z3,\n      background: theme.colors.background.primary,\n      border: `1px solid ${theme.colors.border.weak}`,\n    }),\n    description: css({\n      textAlign: 'left',\n      fontSize: theme.typography.pxToRem(12),\n    }),\n    buttonSelect: css({\n      border: `1px solid ${theme.colors.border.strong}`,\n      borderLeft: 'none',\n      borderTopLeftRadius: 0,\n      borderBottomLeftRadius: 0,\n      padding: 1,\n      height: '24px',\n    }),\n  };\n};\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React from 'react';\nimport { BusEventBase, DataFrame, FieldReducerInfo, ReducerID, SelectableValue, fieldReducers } from '@grafana/data';\nimport { getLabelValueFromDataFrame } from 'services/levels';\nimport { InlineField, Select } from '@grafana/ui';\nimport { getSortByPreference, setSortByPreference } from 'services/store';\nimport { testIds } from '../../../services/testIds';\nimport { DEFAULT_SORT_BY } from '../../../services/sorting';\n\nexport type SortBy = 'changepoint' | 'outliers' | ReducerID | '';\nexport type SortDirection = 'asc' | 'desc';\nexport interface SortBySceneState extends SceneObjectState {\n  target: 'fields' | 'labels';\n  sortBy: SortBy;\n  direction: SortDirection;\n}\n\nexport class SortCriteriaChanged extends BusEventBase {\n  constructor(public target: 'fields' | 'labels', public sortBy: string, public direction: string) {\n    super();\n  }\n  public static type = 'sort-criteria-changed';\n}\n\nexport class SortByScene extends SceneObjectBase<SortBySceneState> {\n  public sortingOptions: Array<{ label: string; options: SelectableValue<SortBy> }> = [\n    {\n      label: '',\n      options: [\n        {\n          value: 'changepoint',\n          label: 'Most relevant',\n          description: 'Smart ordering of graphs based on the most significant spikes in the data',\n        },\n        {\n          value: 'outliers',\n          label: 'Outlying values',\n          description: 'Order by the amount of outlying values in the data',\n        },\n        {\n          value: ReducerID.stdDev,\n          label: 'Widest spread',\n          description: 'Sort graphs by deviation from the average value',\n        },\n        {\n          value: 'alphabetical',\n          label: 'Name',\n          description: 'Alphabetical order',\n        },\n        {\n          value: ReducerID.sum,\n          label: 'Count',\n          description: 'Sort graphs by total number of logs',\n        },\n        {\n          value: ReducerID.max,\n          label: 'Highest spike',\n          description: 'Sort graphs by the highest values (max)',\n        },\n        {\n          value: ReducerID.min,\n          label: 'Lowest dip',\n          description: 'Sort graphs by the smallest values (min)',\n        },\n      ],\n    },\n    {\n      label: 'Percentiles',\n      options: [...fieldReducers.selectOptions([], filterReducerOptions).options],\n    },\n  ];\n\n  constructor(state: Pick<SortBySceneState, 'target'>) {\n    const { sortBy, direction } = getSortByPreference(state.target, DEFAULT_SORT_BY, 'desc');\n    super({\n      target: state.target,\n      sortBy,\n      direction,\n    });\n  }\n\n  public onCriteriaChange = (criteria: SelectableValue<SortBy>) => {\n    if (!criteria.value) {\n      return;\n    }\n    this.setState({ sortBy: criteria.value });\n    setSortByPreference(this.state.target, criteria.value, this.state.direction);\n    this.publishEvent(new SortCriteriaChanged(this.state.target, criteria.value, this.state.direction), true);\n  };\n\n  public onDirectionChange = (direction: SelectableValue<SortDirection>) => {\n    if (!direction.value) {\n      return;\n    }\n    this.setState({ direction: direction.value });\n    setSortByPreference(this.state.target, this.state.sortBy, direction.value);\n    this.publishEvent(new SortCriteriaChanged(this.state.target, this.state.sortBy, direction.value), true);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<SortByScene>) => {\n    const { sortBy, direction } = model.useState();\n    const group = model.sortingOptions.find((group) =>\n      group.options.find((option: SelectableValue<SortBy>) => option.value === sortBy)\n    );\n    const sortByValue: SelectableValue<SortBy> | undefined = group?.options.find(\n      (option: SelectableValue<SortBy>) => option.value === sortBy\n    );\n    return (\n      <>\n        <InlineField\n          label=\"Sort by\"\n          htmlFor=\"sort-by-criteria\"\n          tooltip=\"Calculate a derived quantity from the values in your time series and sort by this criteria. Defaults to standard deviation.\"\n        >\n          <Select\n            data-testid={testIds.breakdowns.common.sortByFunction}\n            value={sortByValue}\n            width={20}\n            isSearchable={true}\n            options={model.sortingOptions}\n            placeholder={'Choose criteria'}\n            onChange={model.onCriteriaChange}\n            inputId=\"sort-by-criteria\"\n          />\n        </InlineField>\n        <InlineField>\n          <Select\n            data-testid={testIds.breakdowns.common.sortByDirection}\n            onChange={model.onDirectionChange}\n            aria-label=\"Sort direction\"\n            placeholder=\"\"\n            value={direction}\n            options={[\n              {\n                label: 'Asc',\n                value: 'asc',\n              },\n              {\n                label: 'Desc',\n                value: 'desc',\n              },\n            ]}\n          ></Select>\n        </InlineField>\n      </>\n    );\n  };\n}\n\nconst ENABLED_PERCENTILES = ['p10', 'p25', 'p75', 'p90', 'p99'];\nfunction filterReducerOptions(ext: FieldReducerInfo) {\n  if (ext.id >= 'p1' && ext.id <= 'p99') {\n    return ENABLED_PERCENTILES.includes(ext.id);\n  }\n  return false;\n}\n\nexport function getLabelValue(frame: DataFrame) {\n  return getLabelValueFromDataFrame(frame) ?? 'No labels';\n}\n","import { css } from '@emotion/css';\nimport React, { ReactNode } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { LoadingPlaceholder, useStyles2 } from '@grafana/ui';\n\ntype Props = {\n  blockingMessage?: string;\n  isLoading?: boolean;\n  children?: ReactNode;\n};\n\nexport function StatusWrapper({ blockingMessage, isLoading, children }: Props) {\n  const styles = useStyles2(getStyles);\n\n  if (isLoading && !blockingMessage) {\n    blockingMessage = 'Loading...';\n  }\n\n  if (isLoading) {\n    return <LoadingPlaceholder className={styles.statusMessage} text={blockingMessage} />;\n  }\n\n  if (!blockingMessage) {\n    return <>{children}</>;\n  }\n\n  return <div className={styles.statusMessage}>{blockingMessage}</div>;\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    statusMessage: css({\n      fontStyle: 'italic',\n      marginTop: theme.spacing(7),\n      textAlign: 'center',\n    }),\n  };\n}\n","export const MAX_NUMBER_OF_TIME_SERIES = 20;\n","import { GrafanaTheme2 } from '@grafana/data';\n\n// from /grafana/grafana/packages/grafana-ui/src/themes/mixins.ts\nexport function getFocusStyles(theme: GrafanaTheme2) {\n  return {\n    outline: '2px dotted transparent',\n    outlineOffset: '2px',\n    boxShadow: `0 0 0 2px ${theme.colors.background.canvas}, 0 0 0px 4px ${theme.colors.primary.main}`,\n    transitionTimingFunction: `cubic-bezier(0.19, 1, 0.22, 1)`,\n    transitionDuration: '0.2s',\n    transitionProperty: 'outline, outline-offset, box-shadow',\n  };\n}\n\nexport function getMouseFocusStyles(theme: GrafanaTheme2) {\n  return {\n    outline: 'none',\n    boxShadow: `none`,\n  };\n}\n\nexport function getIconButtonBefore(hoverSize: number, theme: GrafanaTheme2) {\n  return {\n    zIndex: '-1',\n    position: 'absolute',\n    opacity: '0',\n    width: `${hoverSize}px`,\n    height: `${hoverSize}px`,\n    borderRadius: theme.shape.radius.default,\n    content: '\"\"',\n    [theme.transitions.handleMotion('no-preference', 'reduce')]: {\n      transitionDuration: '0.2s',\n      transitionTimingFunction: 'cubic-bezier(0.4, 0, 0.2, 1)',\n      transitionProperty: 'opacity',\n    },\n  };\n}\n","import { IconButtonVariant, Tooltip, useTheme2 } from '@grafana/ui';\nimport React from 'react';\nimport { colorManipulator, GrafanaTheme2 } from '@grafana/data';\nimport { css, cx } from '@emotion/css';\nimport { getFocusStyles, getIconButtonBefore, getMouseFocusStyles } from '../../../services/mixins';\n\nexport type RegexInputValue = 'regex' | 'match';\ninterface Props {\n  onRegexToggle: (state: RegexInputValue) => void;\n  regex: boolean;\n}\n\nexport const RegexIconButton = (props: Props) => {\n  const theme = useTheme2();\n  const fill = props.regex ? theme.colors.text.maxContrast : theme.colors.text.disabled;\n  const styles = getStyles(theme);\n  const description = `${props.regex ? 'Disable' : 'Enable'} regex`;\n\n  return (\n    <Tooltip content={description}>\n      <button\n        onClick={() => props.onRegexToggle(props.regex ? 'match' : 'regex')}\n        className={cx(styles.button, props.regex ? styles.active : null)}\n        aria-label={description}\n      >\n        <svg fill={fill} width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\">\n          <text fontSize=\"13\" width=\"16\" height=\"16\" x=\"50%\" y=\"50%\" dominantBaseline=\"central\" textAnchor=\"middle\">\n            .*\n          </text>\n        </svg>\n      </button>\n    </Tooltip>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2, variant: IconButtonVariant = 'secondary') => {\n  const hoverSize = 16 + theme.spacing.gridSize;\n\n  return {\n    button: css({\n      zIndex: 0,\n      position: 'relative',\n      margin: `0 ${theme.spacing.x0_5} 0 ${theme.spacing.x0_5}`,\n      boxShadow: 'none',\n      border: 'none',\n      display: 'inline-flex',\n      background: 'transparent',\n      justifyContent: 'center',\n      alignItems: 'center',\n      padding: 0,\n      color: theme.colors.text.primary,\n\n      '&:before': {\n        ...getIconButtonBefore(hoverSize, theme),\n        position: 'absolute',\n      },\n\n      '&:hover': {\n        '&:before': {\n          backgroundColor:\n            variant === 'secondary'\n              ? theme.colors.action.hover\n              : colorManipulator.alpha(theme.colors.text.primary, 0.12),\n          opacity: 1,\n        },\n      },\n\n      '&:focus, &:focus-visible': getFocusStyles(theme),\n      '&:focus:not(:focus-visible)': getMouseFocusStyles(theme),\n    }),\n    active: css({\n      '&:before': {\n        backgroundColor:\n          variant === 'secondary' ? theme.colors.action.hover : colorManipulator.alpha(theme.colors.text.primary, 0.12),\n        opacity: 1,\n      },\n      '&:hover': {\n        '&:before': {\n          backgroundColor: 'none',\n          opacity: 0,\n        },\n      },\n    }),\n  };\n};\n","import { IconButtonVariant, Tooltip, useTheme2 } from '@grafana/ui';\nimport React from 'react';\nimport { colorManipulator, GrafanaTheme2 } from '@grafana/data';\nimport { css, cx } from '@emotion/css';\nimport { getFocusStyles, getIconButtonBefore, getMouseFocusStyles } from '../../../services/mixins';\nimport { LineFilterCaseSensitive } from '../../../services/filterTypes';\n\ninterface Props {\n  onCaseSensitiveToggle: (state: LineFilterCaseSensitive) => void;\n  caseSensitive: boolean;\n}\n\nexport const LineFilterCaseSensitivityButton = (props: Props) => {\n  const theme = useTheme2();\n  const fill = props.caseSensitive ? theme.colors.text.maxContrast : theme.colors.text.disabled;\n  const styles = getStyles(theme);\n  const description = `${props.caseSensitive ? 'Disable' : 'Enable'} case match`;\n\n  return (\n    <Tooltip content={description}>\n      <button\n        onClick={() =>\n          props.onCaseSensitiveToggle(\n            props.caseSensitive ? LineFilterCaseSensitive.caseInsensitive : LineFilterCaseSensitive.caseSensitive\n          )\n        }\n        className={cx(styles.button, props.caseSensitive ? styles.active : null)}\n        aria-label={description}\n      >\n        <svg fill={fill} width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\">\n          <text fontSize=\"13\" width=\"16\" height=\"16\" x=\"50%\" y=\"50%\" dominantBaseline=\"central\" textAnchor=\"middle\">\n            Aa\n          </text>\n        </svg>\n      </button>\n    </Tooltip>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2, variant: IconButtonVariant = 'secondary') => {\n  const hoverSize = 16 + theme.spacing.gridSize;\n\n  return {\n    button: css({\n      zIndex: 0,\n      position: 'relative',\n      margin: `0 ${theme.spacing.x0_5} 0 ${theme.spacing.x0_5}`,\n      boxShadow: 'none',\n      border: 'none',\n      display: 'inline-flex',\n      background: 'transparent',\n      justifyContent: 'center',\n      alignItems: 'center',\n      padding: 0,\n      color: theme.colors.text.primary,\n\n      '&:before': {\n        ...getIconButtonBefore(hoverSize, theme),\n        position: 'absolute',\n      },\n\n      '&:hover': {\n        '&:before': {\n          backgroundColor:\n            variant === 'secondary'\n              ? theme.colors.action.hover\n              : colorManipulator.alpha(theme.colors.text.primary, 0.12),\n          opacity: 1,\n        },\n      },\n\n      '&:focus, &:focus-visible': getFocusStyles(theme),\n      '&:focus:not(:focus-visible)': getMouseFocusStyles(theme),\n    }),\n    active: css({\n      '&:before': {\n        backgroundColor:\n          variant === 'secondary' ? theme.colors.action.hover : colorManipulator.alpha(theme.colors.text.primary, 0.12),\n        opacity: 1,\n      },\n      '&:hover': {\n        '&:before': {\n          backgroundColor: 'none',\n          opacity: 0,\n        },\n      },\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport { Icon, IconButton, Input, useStyles2 } from '@grafana/ui';\nimport React, { HTMLProps } from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\n\ninterface Props extends Omit<HTMLProps<HTMLInputElement>, 'width' | 'prefix'> {\n  onClear?: () => void;\n  suffix?: React.ReactNode;\n  prefix?: React.ReactNode;\n  width?: number;\n}\n\nexport const LineFilterInput = ({ value, onChange, placeholder, onClear, suffix, width, ...rest }: Props) => {\n  const styles = useStyles2(getStyles);\n  return (\n    <Input\n      rows={2}\n      width={width}\n      value={value}\n      onChange={onChange}\n      suffix={\n        <span className={styles.suffixWrapper}>\n          {onClear && value ? (\n            <IconButton\n              aria-label={'Clear line filter'}\n              tooltip={'Clear line filter'}\n              onClick={onClear}\n              name=\"times\"\n              className={styles.clearIcon}\n            />\n          ) : undefined}\n          {suffix && suffix}\n        </span>\n      }\n      prefix={<Icon name=\"search\" />}\n      placeholder={placeholder}\n      {...rest}\n    />\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  suffixWrapper: css({\n    gap: theme.spacing(0.5),\n    display: 'inline-flex',\n  }),\n  clearIcon: css({\n    cursor: 'pointer',\n  }),\n});\n","import React, { useEffect, useState } from 'react';\nimport { RegexIconButton } from './RegexIconButton';\nimport { Button, Field, Select, useStyles2 } from '@grafana/ui';\nimport { testIds } from '../../../services/testIds';\nimport { css, cx } from '@emotion/css';\nimport { LineFilterCaseSensitivityButton } from './LineFilterCaseSensitivityButton';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { LineFilterInput } from '../Breakdowns/LineFilterInput';\nimport { LineFilterProps } from '../../IndexScene/LineFilterVariable';\n\nexport interface LineFilterEditorProps extends LineFilterProps {\n  focus: boolean;\n  setFocus: (focus: boolean) => void;\n  type: 'variable' | 'editor';\n}\n\nconst INITIAL_INPUT_WIDTH = 30;\n\nexport function LineFilterEditor({\n  exclusive,\n  lineFilter,\n  caseSensitive,\n  setExclusive,\n  regex,\n  onInputChange,\n  onCaseSensitiveToggle,\n  onRegexToggle,\n  handleEnter,\n  onSubmitLineFilter,\n  onClearLineFilter,\n  focus,\n  setFocus,\n  type,\n}: LineFilterEditorProps) {\n  const styles = useStyles2((theme) => getStyles(theme, type));\n  const [width, setWidth] = useState(INITIAL_INPUT_WIDTH);\n\n  function resize(content?: string) {\n    // The input width roughly corresponds to char count\n    const width = Math.max(content?.length ?? 0, INITIAL_INPUT_WIDTH);\n    // We add a few extra because the buttons are absolutely positioned within the input width\n    setWidth(width + 9);\n  }\n\n  useEffect(() => {\n    resize(lineFilter);\n  }, [lineFilter, focus]);\n\n  return (\n    <div className={styles.wrapper}>\n      {!onSubmitLineFilter && (\n        <Select\n          prefix={null}\n          className={styles.select}\n          value={exclusive ? 'exclusive' : 'inclusive'}\n          options={[\n            {\n              value: 'exclusive',\n              label: 'Exclude',\n            },\n            {\n              value: 'inclusive',\n              label: 'Include',\n            },\n          ]}\n          onChange={() => setExclusive(!exclusive)}\n        />\n      )}\n      <Field className={styles.field}>\n        <LineFilterInput\n          // Only set width if focused\n          width={focus ? width : undefined}\n          onFocus={() => setFocus(true)}\n          // onBlur={() => setFocus(false)}\n          data-testid={testIds.exploreServiceDetails.searchLogs}\n          value={lineFilter}\n          className={cx(onSubmitLineFilter ? styles.inputNoBorderRight : undefined, styles.input)}\n          onChange={onInputChange}\n          suffix={\n            <span className={`${styles.suffix} input-suffix`}>\n              <LineFilterCaseSensitivityButton\n                caseSensitive={caseSensitive}\n                onCaseSensitiveToggle={onCaseSensitiveToggle}\n              />\n              <RegexIconButton regex={regex} onRegexToggle={onRegexToggle} />\n            </span>\n          }\n          prefix={null}\n          placeholder=\"Search in log lines\"\n          onClear={onClearLineFilter}\n          onKeyUp={(e) => {\n            handleEnter(e, lineFilter);\n            resize(lineFilter);\n          }}\n        />\n      </Field>\n      {onSubmitLineFilter && (\n        <span className={styles.buttonWrap}>\n          <Button\n            onClick={() => {\n              setExclusive(false);\n              onSubmitLineFilter();\n            }}\n            className={styles.includeButton}\n            variant={'secondary'}\n            fill={'outline'}\n            disabled={!lineFilter}\n          >\n            Include\n          </Button>\n          <Button\n            onClick={() => {\n              setExclusive(true);\n              onSubmitLineFilter();\n            }}\n            className={styles.excludeButton}\n            variant={'secondary'}\n            fill={'outline'}\n            disabled={!lineFilter}\n          >\n            Exclude\n          </Button>\n        </span>\n      )}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2, type: 'variable' | 'editor') => ({\n  inputNoBorderRight: css({\n    input: {\n      borderTopRightRadius: 0,\n      borderBottomRightRadius: 0,\n    },\n  }),\n  suffix: css({\n    display: 'inline-flex',\n    gap: theme.spacing(0.5),\n  }),\n  removeBtn: css({\n    borderTopLeftRadius: 0,\n    borderBottomLeftRadius: 0,\n  }),\n  buttonWrap: css({\n    display: 'flex',\n    justifyContent: 'center',\n  }),\n  includeButton: css({\n    borderLeft: 'none',\n    borderRadius: 0,\n    borderRight: 'none',\n    '&[disabled]': {\n      borderRight: 'none',\n    },\n  }),\n  excludeButton: css({\n    borderRadius: `0 ${theme.shape.radius.default} ${theme.shape.radius.default} 0`,\n    borderLeft: 'none',\n    '&[disabled]': {\n      borderLeft: 'none',\n    },\n  }),\n  submit: css({\n    borderTopLeftRadius: 0,\n    borderBottomLeftRadius: 0,\n  }),\n  select: css({\n    label: 'line-filter-exclusion',\n    marginLeft: 0,\n    paddingLeft: 0,\n    height: 'auto',\n    borderBottomRightRadius: '0',\n    borderTopRightRadius: '0',\n    borderRight: 'none',\n    minHeight: '30px',\n    minWidth: '95px',\n    maxWidth: '95px',\n    outline: 'none',\n  }),\n  wrapper: css({\n    display: 'flex',\n    width: '100%',\n  }),\n  input: css({\n    label: 'line-filter-input-wrapper',\n    minWidth: '200px',\n\n    // Keeps the input from overflowing container on resize\n    maxWidth: type === 'editor' ? 'calc(100vw - 198px)' : 'calc(100vw - 288px)',\n\n    input: {\n      borderTopLeftRadius: 0,\n      borderBottomLeftRadius: 0,\n      fontFamily: 'monospace',\n      fontSize: theme.typography.bodySmall.fontSize,\n      width: '100%',\n    },\n  }),\n  exclusiveBtn: css({\n    marginRight: '1rem',\n  }),\n  field: css({\n    label: 'field',\n    flex: '0 1 auto',\n    marginBottom: 0,\n  }),\n});\n","import { css } from '@emotion/css';\nimport { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, InlineField, RadioButtonGroup, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { getLogOption, LogsVisualizationType, setLogOption } from 'services/store';\nimport { LogsListScene } from './LogsListScene';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { LogsPanelHeaderActions } from '../Table/LogsHeaderActions';\nimport { GrafanaTheme2, LogsSortOrder } from '@grafana/data';\nimport { LogsPanelScene } from './LogsPanelScene';\nimport { locationService } from '@grafana/runtime';\nimport { narrowLogsSortOrder } from '../../services/narrowing';\nimport { logger } from '../../services/logger';\n\ninterface LogOptionsState extends SceneObjectState {\n  visualizationType: LogsVisualizationType;\n  onChangeVisualizationType: (type: LogsVisualizationType) => void;\n}\n\n/**\n * The options rendered in the logs panel header\n */\nexport class LogOptionsScene extends SceneObjectBase<LogOptionsState> {\n  static Component = LogOptionsRenderer;\n\n  constructor(state: LogOptionsState) {\n    super({\n      ...state,\n    });\n  }\n\n  handleWrapLinesChange = (type: boolean) => {\n    this.getLogsPanelScene().setState({ wrapLogMessage: type });\n    setLogOption('wrapLogMessage', type);\n    this.getLogsListScene().setLogsVizOption({ wrapLogMessage: type });\n    this.getLogsListScene().setLogsVizOption({ prettifyLogMessage: type });\n  };\n\n  onChangeLogsSortOrder = (sortOrder: LogsSortOrder) => {\n    this.getLogsPanelScene().setState({ sortOrder: sortOrder });\n    setLogOption('sortOrder', sortOrder);\n    this.getLogsListScene().setLogsVizOption({ sortOrder: sortOrder });\n  };\n\n  getLogsListScene = () => {\n    return sceneGraph.getAncestor(this, LogsListScene);\n  };\n\n  getLogsPanelScene = () => {\n    return sceneGraph.getAncestor(this, LogsPanelScene);\n  };\n\n  clearDisplayedFields = () => {\n    const parentScene = this.getLogsListScene();\n    parentScene.clearDisplayedFields();\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.logs_clear_displayed_fields\n    );\n  };\n}\n\nfunction LogOptionsRenderer({ model }: SceneComponentProps<LogOptionsScene>) {\n  const { onChangeVisualizationType, visualizationType } = model.useState();\n  const { wrapLogMessage, sortOrder } = model.getLogsPanelScene().useState();\n  const { displayedFields } = model.getLogsListScene().useState();\n  const styles = useStyles2(getStyles);\n  const wrapLines = wrapLogMessage ?? false;\n\n  return (\n    <div className={styles.container}>\n      {displayedFields.length > 0 && (\n        <Tooltip content={`Clear displayed fields: ${displayedFields.join(', ')}`}>\n          <Button size={'sm'} variant=\"secondary\" fill=\"outline\" onClick={model.clearDisplayedFields}>\n            Show original log line\n          </Button>\n        </Tooltip>\n      )}\n      <InlineField className={styles.buttonGroupWrapper} transparent>\n        <RadioButtonGroup\n          size=\"sm\"\n          options={[\n            {\n              label: 'Newest first',\n              value: LogsSortOrder.Descending,\n              description: 'Show results newest to oldest',\n            },\n            {\n              label: 'Oldest first',\n              value: LogsSortOrder.Ascending,\n              description: 'Show results oldest to newest',\n            },\n          ]}\n          value={sortOrder}\n          onChange={model.onChangeLogsSortOrder}\n        />\n      </InlineField>\n\n      <InlineField className={styles.buttonGroupWrapper} transparent>\n        <RadioButtonGroup\n          size=\"sm\"\n          value={wrapLines}\n          onChange={model.handleWrapLinesChange}\n          options={[\n            {\n              label: 'Wrap',\n              value: true,\n              description: 'Enable wrapping of long log lines',\n            },\n            {\n              label: 'No wrap',\n              value: false,\n              description: 'Disable wrapping of long log lines',\n            },\n          ]}\n        />\n      </InlineField>\n      <LogsPanelHeaderActions vizType={visualizationType} onChange={onChangeVisualizationType} />\n    </div>\n  );\n}\n\nexport function getLogsPanelSortOrderFromStore() {\n  return getLogOption<LogsSortOrder>('sortOrder', LogsSortOrder.Descending) as LogsSortOrder;\n}\n\nexport function getLogsPanelSortOrderFromURL() {\n  // Since sort order is used to execute queries before the logs panel is instantiated, the scene url state will never influence the query\n  // Hacking this for now to manually check the URL search params to override local storage state if set\n  const location = locationService.getLocation();\n  const search = new URLSearchParams(location.search);\n  const sortOrder = search.get('sortOrder');\n\n  try {\n    if (typeof sortOrder === 'string') {\n      const decodedSortOrder = narrowLogsSortOrder(JSON.parse(sortOrder));\n      if (decodedSortOrder) {\n        return decodedSortOrder;\n      }\n    }\n  } catch (e) {\n    // URL Params can be manually changed and it will make JSON.parse() fail.\n    logger.error(e, { msg: 'LogOptionsScene(getLogsPanelSortOrderFromURL): unable to parse sortOrder' });\n  }\n\n  return false;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css({\n    display: 'flex',\n    alignItems: 'center',\n    gap: theme.spacing(1),\n    marginTop: theme.spacing(0.5),\n  }),\n  buttonGroupWrapper: css({\n    margin: 0,\n    alignItems: 'center',\n  }),\n});\n","import React, { createContext, ReactNode, useCallback, useContext, useEffect, useState } from 'react';\nimport { ActiveFieldMeta, FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { getBodyName, getTimeName, LogsFrame } from '../../../services/logsFrame';\nimport { logger } from '../../../services/logger';\n\nimport { PLUGIN_ID } from '../../../services/plugin';\nimport { NarrowingError, narrowRecordStringNumber } from '../../../services/narrowing';\n\nconst tableColumnCustomWidths = `${PLUGIN_ID}.tableColumnWidths`;\n\ntype TableColumnsContextType = {\n  // the current list of labels from the dataframe combined with UI metadata\n  columns: FieldNameMetaStore;\n  // The active search results\n  filteredColumns?: FieldNameMetaStore;\n  // Update the column state\n  setColumns(newColumns: FieldNameMetaStore): void;\n  // Update search state\n  setFilteredColumns(newColumns?: FieldNameMetaStore): void;\n  // WIP - sets the visibility of the drawer right now\n  visible: boolean;\n  setVisible: (v: boolean) => void;\n  bodyState: LogLineState;\n  setBodyState: (s: LogLineState) => void;\n  clearSelectedLine: () => void;\n  setColumnWidthMap(map: Record<string, number>): void;\n  columnWidthMap: Record<string, number>;\n};\n\nexport enum LogLineState {\n  text = 'text',\n  labels = 'labels',\n  auto = 'auto',\n}\n\nconst TableColumnsContext = createContext<TableColumnsContextType>({\n  columnWidthMap: {},\n  setColumnWidthMap: () => {},\n  columns: {},\n  filteredColumns: {},\n  setColumns: () => {},\n  setFilteredColumns: () => {},\n  setVisible: () => false,\n  visible: false,\n  bodyState: LogLineState.auto,\n  setBodyState: () => {},\n  clearSelectedLine: () => {},\n});\n\nfunction setDefaultColumns(\n  columns: FieldNameMetaStore,\n  handleSetColumns: (newColumns: FieldNameMetaStore) => void,\n  logsFrame: LogsFrame\n) {\n  const pendingColumns = { ...columns };\n\n  pendingColumns[getTimeName(logsFrame)] = {\n    index: 0,\n    active: true,\n    type: 'TIME_FIELD',\n    percentOfLinesWithLabel: 100,\n    cardinality: Infinity,\n  };\n  pendingColumns[getBodyName(logsFrame)] = {\n    index: 1,\n    active: true,\n    type: 'BODY_FIELD',\n    percentOfLinesWithLabel: 100,\n    cardinality: Infinity,\n  };\n  handleSetColumns(pendingColumns);\n}\n\nfunction getColumnWidthsFromLocalStorage(): Record<string, number> {\n  let initialColumnWidths = {};\n  const existingWidths = localStorage.getItem(tableColumnCustomWidths);\n  if (existingWidths) {\n    try {\n      initialColumnWidths = narrowRecordStringNumber(JSON.parse(existingWidths));\n      if (initialColumnWidths === false) {\n        logger.error(\n          new NarrowingError('getColumnWidthsFromLocalStorage: unable to validate values in local storage'),\n          { msg: 'NarrowingError: error parsing table column widths from local storage' }\n        );\n      }\n      return initialColumnWidths;\n    } catch (e) {\n      logger.error(e, { msg: 'error parsing table column widths from local storage' });\n    }\n  }\n  return initialColumnWidths;\n}\n\nexport const TableColumnContextProvider = ({\n  children,\n  initialColumns,\n  logsFrame,\n  setUrlColumns,\n  clearSelectedLine,\n  setUrlTableBodyState,\n  urlTableBodyState,\n  showColumnManagementDrawer,\n  isColumnManagementActive,\n}: {\n  children: ReactNode;\n  initialColumns: FieldNameMetaStore;\n  logsFrame: LogsFrame;\n  setUrlColumns: (columns: string[]) => void;\n  clearSelectedLine: () => void;\n  setUrlTableBodyState: (logLineState: LogLineState) => void;\n  urlTableBodyState?: LogLineState;\n  showColumnManagementDrawer: (isActive: boolean) => void;\n  isColumnManagementActive: boolean;\n}) => {\n  const [columns, setColumns] = useState<FieldNameMetaStore>(removeExtraColumns(initialColumns));\n  const [bodyState, setBodyState] = useState<LogLineState>(urlTableBodyState ?? LogLineState.auto);\n  const [filteredColumns, setFilteredColumns] = useState<FieldNameMetaStore | undefined>(undefined);\n\n  const initialColumnWidths = getColumnWidthsFromLocalStorage();\n  const [columnWidthMap, setColumnWidthMapState] = useState<Record<string, number>>(initialColumnWidths);\n  const setColumnWidthMap = (map: Record<string, number>) => {\n    localStorage.setItem(tableColumnCustomWidths, JSON.stringify(map));\n    setColumnWidthMapState(map);\n  };\n\n  const getActiveColumns = (columns: FieldNameMetaStore): string[] => {\n    let activeColumns: string[] = [];\n    Object.keys(columns).forEach((fieldName) => {\n      if (columns[fieldName].active && columns[fieldName].index !== undefined) {\n        activeColumns.push(fieldName);\n      }\n    });\n    activeColumns.sort((a, b) => {\n      // Typescript doesn't seem to know that the indicies we picked in the loop above are only for ActiveFieldMeta, so we're forced to assert\n      const colA: ActiveFieldMeta = columns[a] as ActiveFieldMeta;\n      const colB: ActiveFieldMeta = columns[b] as ActiveFieldMeta;\n      return colA.index - colB.index;\n    });\n    return activeColumns;\n  };\n\n  const handleSetColumns = useCallback(\n    (newColumns: FieldNameMetaStore) => {\n      if (newColumns) {\n        const columns = removeExtraColumns(newColumns);\n\n        setColumns(columns);\n\n        // Sync react state update with scenes url management\n        setUrlColumns(getActiveColumns(columns));\n      }\n    },\n    [setUrlColumns]\n  );\n\n  const handleSetBodyState = useCallback(\n    (logLineState: LogLineState) => {\n      setBodyState(logLineState);\n\n      // Sync change with url state\n      setUrlTableBodyState(logLineState);\n    },\n    [setUrlTableBodyState]\n  );\n\n  const handleClearSelectedLine = () => {\n    clearSelectedLine();\n  };\n\n  const handleSetVisible = useCallback(\n    (isVisible: boolean) => {\n      showColumnManagementDrawer(isVisible);\n    },\n    [showColumnManagementDrawer]\n  );\n\n  // When the parent component recalculates new columns on dataframe change, we need to update or the column UI will be stale!\n  useEffect(() => {\n    if (initialColumns) {\n      handleSetColumns(initialColumns);\n    }\n  }, [initialColumns, handleSetColumns]);\n\n  // When the columns are updated, we need to check if nothing is selected so we can set the default\n  useEffect(() => {\n    const activeColumns = getDefaultColumns(columns, logsFrame);\n    if (activeColumns?.length) {\n      const activeFields = Object.keys(columns).filter((col) => columns[col].active);\n\n      // If we're missing all fields, the user must have removed the last column, let's revert back to the default state\n      if (activeFields.length === 0) {\n        setDefaultColumns(columns, handleSetColumns, logsFrame);\n      }\n\n      // Reset any local search state\n      setFilteredColumns(undefined);\n    }\n  }, [columns, logsFrame, setFilteredColumns, handleSetColumns]);\n\n  return (\n    <TableColumnsContext.Provider\n      value={{\n        setColumnWidthMap,\n        columnWidthMap,\n        bodyState,\n        setBodyState: handleSetBodyState,\n        setFilteredColumns,\n        filteredColumns,\n        columns,\n        setColumns: handleSetColumns,\n        visible: isColumnManagementActive,\n        setVisible: handleSetVisible,\n        clearSelectedLine: handleClearSelectedLine,\n      }}\n    >\n      {children}\n    </TableColumnsContext.Provider>\n  );\n};\n/**\n * Filter out fields that shouldn't be exposed in the UI\n * @param columns\n */\nconst removeExtraColumns = (columns: FieldNameMetaStore): FieldNameMetaStore => {\n  // Remove label Types\n  if ('labelTypes' in columns) {\n    const { labelTypes, ...columnsToSet }: FieldNameMetaStore = {\n      ...columns,\n    };\n    return columnsToSet;\n  }\n  return columns;\n};\n\nfunction getDefaultColumns(pendingLabelState: FieldNameMetaStore, logsFrame: LogsFrame) {\n  if (!logsFrame) {\n    logger.warn('missing dataframe, cannot set url state');\n    return;\n  }\n  // Get all active columns and sort by index\n  const newColumnsArray = Object.keys(pendingLabelState)\n    // Only include active filters\n    .filter((key) => pendingLabelState[key]?.active)\n    .sort((a, b) => {\n      const pa = pendingLabelState[a];\n      const pb = pendingLabelState[b];\n      if (pa.index !== undefined && pb.index !== undefined) {\n        return pa.index - pb.index; // sort by index\n      }\n      return 0;\n    });\n\n  const timeField = logsFrame.timeField;\n  const bodyField = logsFrame.bodyField;\n\n  if ((timeField && bodyField) || newColumnsArray.length) {\n    const defaultColumns = [];\n    if (timeField?.name) {\n      defaultColumns.push(timeField.name);\n    }\n    if (bodyField?.name) {\n      defaultColumns.push(bodyField.name);\n    }\n\n    // Update url state\n    return newColumnsArray.length ? newColumnsArray : defaultColumns;\n  }\n\n  return [];\n}\n\nexport const useTableColumnContext = () => {\n  return useContext(TableColumnsContext);\n};\n","import React, { createContext, ReactNode, useCallback, useContext, useState } from 'react';\n\nexport type CellIndex = {\n  fieldName?: string;\n  // If the field contains labels (like log line), we need to know which field (line) and which label (e.g. level)\n  subFieldName?: string;\n  index: number | null;\n  numberOfMenuItems?: number;\n};\n\ntype TableCellContextType = {\n  cellIndex: CellIndex;\n  setActiveCellIndex(cellIndex: CellIndex): void;\n};\n\nconst TableCellContext = createContext<TableCellContextType>({\n  cellIndex: { index: null, numberOfMenuItems: 3 },\n  setActiveCellIndex: (cellIndex: CellIndex) => false,\n});\n\nexport const TableCellContextProvider = ({ children }: { children: ReactNode }) => {\n  const [cellActive, setCellActive] = useState<CellIndex>({ index: null });\n\n  const handleCellActive = useCallback((cellIndex: CellIndex) => {\n    setCellActive(cellIndex);\n  }, []);\n\n  return (\n    <TableCellContext.Provider value={{ cellIndex: cellActive, setActiveCellIndex: handleCellActive }}>\n      {children}\n    </TableCellContext.Provider>\n  );\n};\n\nexport const useTableCellContext = () => {\n  return useContext(TableCellContext);\n};\n","import React, { createContext, ReactNode, useCallback, useContext, useState } from 'react';\n\ntype TableHeaderContextType = {\n  isHeaderMenuActive: boolean;\n  setHeaderMenuActive: (isHeaderMenuActive: boolean) => void;\n};\n\nconst TableHeaderContext = createContext<TableHeaderContextType>({\n  isHeaderMenuActive: false,\n  setHeaderMenuActive: (isHeaderMenuActive: boolean) => false,\n});\n\nexport const TableHeaderContextProvider = ({ children }: { children: ReactNode }) => {\n  const [isHeaderMenuActive, setHeaderMenuActive] = useState<boolean>(false);\n\n  const handleisHeaderMenuActive = useCallback((isHeaderMenuActive: boolean) => {\n    setHeaderMenuActive(isHeaderMenuActive);\n  }, []);\n\n  return (\n    <TableHeaderContext.Provider value={{ isHeaderMenuActive, setHeaderMenuActive: handleisHeaderMenuActive }}>\n      {children}\n    </TableHeaderContext.Provider>\n  );\n};\n\nexport const useTableHeaderContext = () => {\n  return useContext(TableHeaderContext);\n};\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Field, Input, useTheme2 } from '@grafana/ui';\n\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { reportInteraction } from '@grafana/runtime';\nimport { debouncedFuzzySearch } from '../../../services/search';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    searchWrap: css({\n      padding: `${theme.spacing(0.4)} 0 ${theme.spacing(0.4)} ${theme.spacing(0.4)}`,\n    }),\n  };\n}\n\ninterface LogsColumnSearchProps {\n  searchValue: string;\n  setSearchValue: (value: string) => void;\n}\nexport function LogsColumnSearch({ searchValue, setSearchValue }: LogsColumnSearchProps) {\n  const { columns, setFilteredColumns } = useTableColumnContext();\n\n  // uFuzzy search dispatcher, adds any matches to the local state\n  const dispatcher = (data: string[][]) => {\n    const matches = data[0];\n    let newColumnsWithMeta: FieldNameMetaStore = {};\n    let numberOfResults = 0;\n    matches.forEach((match) => {\n      if (match in columns) {\n        newColumnsWithMeta[match] = columns[match];\n        numberOfResults++;\n      }\n    });\n    setFilteredColumns(newColumnsWithMeta);\n    searchFilterEvent(numberOfResults);\n  };\n\n  // uFuzzy search\n  const search = (needle: string) => {\n    debouncedFuzzySearch(Object.keys(columns), needle, dispatcher);\n  };\n\n  // onChange handler for search input\n  const onSearchInputChange = (e: React.FormEvent<HTMLInputElement>) => {\n    const value = e.currentTarget?.value;\n    setSearchValue(value);\n    if (value) {\n      search(value);\n    } else {\n      // If the search input is empty, reset the local search state.\n      setFilteredColumns(undefined);\n    }\n  };\n\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return (\n    <Field className={styles.searchWrap}>\n      <Input value={searchValue} type={'text'} placeholder={'Search fields by name'} onChange={onSearchInputChange} />\n    </Field>\n  );\n}\n\nfunction searchFilterEvent(searchResultCount: number) {\n  reportInteraction('grafana_logs_app_table_text_search_result_count', {\n    resultCount: searchResultCount,\n  });\n}\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    empty: css({\n      marginBottom: theme.spacing(2),\n      marginLeft: theme.spacing(1.75),\n      fontSize: theme.typography.fontSize,\n    }),\n  };\n}\n\nexport function LogsTableEmptyFields() {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return <div className={styles.empty}>No fields</div>;\n}\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Checkbox, Icon, useTheme2 } from '@grafana/ui';\n\nimport { FieldNameMeta } from '../TableTypes';\n\nexport function LogsTableNavField(props: {\n  label: string;\n  onChange: () => void;\n  labels: Record<string, FieldNameMeta>;\n  draggable?: boolean;\n  showCount?: boolean;\n  setColumnWidthMap?: (map: Record<string, number>) => void;\n  columnWidthMap?: Record<string, number>;\n}): React.JSX.Element | null {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  if (props.labels[props.label]) {\n    return (\n      <>\n        <div className={styles.contentWrap}>\n          <Checkbox\n            className={styles.checkboxLabel}\n            label={props.label}\n            onChange={props.onChange}\n            checked={props.labels[props.label]?.active ?? false}\n          />\n          {props.showCount && (\n            <div className={styles.labelCount}>\n              <div>{props.labels[props.label]?.percentOfLinesWithLabel}%</div>\n              <div>\n                {props.labels[props.label]?.cardinality}{' '}\n                {props.labels[props.label]?.cardinality === 1 ? 'value' : 'values'}\n              </div>\n            </div>\n          )}\n          {props.columnWidthMap && props.setColumnWidthMap && props.columnWidthMap?.[props.label] !== undefined && (\n            <div\n              onClick={() => {\n                const { [props.label]: omit, ...map } = { ...props.columnWidthMap };\n                props.setColumnWidthMap?.(map);\n              }}\n              title={'Clear column width override'}\n              className={styles.customWidthWrap}\n            >\n              Reset column width\n              <Icon name={'x'} />\n            </div>\n          )}\n        </div>\n        {props.draggable && (\n          <Icon\n            aria-label=\"Drag and drop icon\"\n            title=\"Drag and drop to reorder\"\n            name=\"draggabledots\"\n            size=\"lg\"\n            className={styles.dragIcon}\n          />\n        )}\n      </>\n    );\n  }\n\n  return null;\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    dragIcon: css({\n      cursor: 'drag',\n      marginLeft: theme.spacing(1),\n      opacity: 0.4,\n    }),\n    labelCount: css({\n      marginLeft: theme.spacing(0.5),\n      marginRight: theme.spacing(0.5),\n      appearance: 'none',\n      background: 'none',\n      border: 'none',\n      fontSize: theme.typography.pxToRem(11),\n      opacity: 0.6,\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'self-end',\n    }),\n    contentWrap: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'space-between',\n      width: '100%',\n    }),\n    customWidthWrap: css({\n      fontSize: theme.typography.bodySmall.fontSize,\n      cursor: 'pointer',\n    }),\n    // Hide text that overflows, had to select elements within the Checkbox component, so this is a bit fragile\n    checkboxLabel: css({\n      '> span': {\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n        whiteSpace: 'nowrap',\n        display: 'block',\n        maxWidth: '100%',\n      },\n    }),\n  };\n}\n","import React, { ReactElement } from 'react';\nimport { DragDropContext, Draggable, DraggableProvided, Droppable, DropResult } from '@hello-pangea/dnd';\nimport { css, cx } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data/';\nimport { useTheme2 } from '@grafana/ui/';\n\nimport { FieldNameMeta, FieldNameMetaStore } from '../TableTypes';\n\nimport { LogsTableEmptyFields } from './LogsTableEmptyFields';\nimport { LogsTableNavField } from './LogsTableNavField';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\n\nexport function getLogsFieldsStyles(theme: GrafanaTheme2) {\n  return {\n    wrap: css({\n      marginTop: theme.spacing(1),\n      marginBottom: theme.spacing(1),\n      display: 'flex',\n      background: theme.colors.background.primary,\n    }),\n    dragging: css({\n      background: theme.colors.background.secondary,\n    }),\n    columnWrapper: css({\n      marginBottom: theme.spacing(1.5),\n      // need some space or the outline of the checkbox is cut off\n      paddingLeft: theme.spacing(0.5),\n    }),\n  };\n}\n\nfunction sortLabels(labels: Record<string, FieldNameMeta>) {\n  return (a: string, b: string) => {\n    const la = labels[a];\n    const lb = labels[b];\n\n    // Sort by index\n    if (la.index != null && lb.index != null) {\n      return la.index - lb.index;\n    }\n\n    // otherwise do not sort\n    return 0;\n  };\n}\n\nexport const LogsTableActiveFields = (props: {\n  labels: Record<string, FieldNameMeta>;\n  valueFilter: (value: string) => boolean;\n  toggleColumn: (columnName: string) => void;\n  reorderColumn: (cols: FieldNameMetaStore, sourceIndex: number, destinationIndex: number) => void;\n  id: string;\n}): ReactElement => {\n  const { columnWidthMap, setColumnWidthMap } = useTableColumnContext();\n  const { reorderColumn, labels, valueFilter, toggleColumn } = props;\n  const theme = useTheme2();\n  const { columns } = useTableColumnContext();\n  const styles = getLogsFieldsStyles(theme);\n  const labelKeys = Object.keys(labels).filter((labelName) => valueFilter(labelName));\n\n  const onDragEnd = (result: DropResult) => {\n    if (!result.destination) {\n      return;\n    }\n    reorderColumn(columns, result.source.index, result.destination.index);\n  };\n\n  const renderTitle = (labelName: string) => {\n    const label = labels[labelName];\n    if (label) {\n      return `${labelName} appears in ${label?.percentOfLinesWithLabel}% of log lines`;\n    }\n\n    return undefined;\n  };\n\n  if (labelKeys.length) {\n    return (\n      <DragDropContext onDragEnd={onDragEnd}>\n        <Droppable droppableId=\"order-fields\" direction=\"vertical\">\n          {(provided) => (\n            <div className={styles.columnWrapper} {...provided.droppableProps} ref={provided.innerRef}>\n              {labelKeys.sort(sortLabels(labels)).map((labelName, index) => (\n                <Draggable draggableId={labelName} key={labelName} index={index}>\n                  {(provided: DraggableProvided, snapshot) => (\n                    <div\n                      className={cx(styles.wrap, snapshot.isDragging ? styles.dragging : undefined)}\n                      ref={provided.innerRef}\n                      {...provided.draggableProps}\n                      {...provided.dragHandleProps}\n                      title={renderTitle(labelName)}\n                    >\n                      <LogsTableNavField\n                        setColumnWidthMap={setColumnWidthMap}\n                        columnWidthMap={columnWidthMap}\n                        label={labelName}\n                        onChange={() => toggleColumn(labelName)}\n                        labels={labels}\n                        draggable={true}\n                      />\n                    </div>\n                  )}\n                </Draggable>\n              ))}\n              {provided.placeholder}\n            </div>\n          )}\n        </Droppable>\n      </DragDropContext>\n    );\n  }\n\n  return <LogsTableEmptyFields />;\n};\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { FieldNameMeta } from '../TableTypes';\n\nimport { LogsTableEmptyFields } from './LogsTableEmptyFields';\nimport { LogsTableNavField } from './LogsTableNavField';\n\nconst collator = new Intl.Collator(undefined, { sensitivity: 'base' });\n\nfunction getLogsFieldsStyles(theme: GrafanaTheme2) {\n  return {\n    wrap: css({\n      marginTop: theme.spacing(0.25),\n      marginBottom: theme.spacing(0.25),\n      display: 'flex',\n      background: theme.colors.background.primary,\n      borderBottom: `1px solid ${theme.colors.background.canvas}`,\n    }),\n    dragging: css({\n      background: theme.colors.background.secondary,\n    }),\n    columnWrapper: css({\n      marginBottom: theme.spacing(1.5),\n      // need some space or the outline of the checkbox is cut off\n      paddingLeft: theme.spacing(0.5),\n    }),\n  };\n}\n\nfunction sortLabels(labels: Record<string, FieldNameMeta>) {\n  return (a: string, b: string) => {\n    const la = labels[a];\n    const lb = labels[b];\n\n    // ...sort by type and alphabetically\n    if (la != null && lb != null) {\n      return (\n        Number(lb.type === 'TIME_FIELD') - Number(la.type === 'TIME_FIELD') ||\n        Number(lb.type === 'BODY_FIELD') - Number(la.type === 'BODY_FIELD') ||\n        collator.compare(a, b)\n      );\n    }\n\n    // otherwise do not sort\n    return 0;\n  };\n}\n\nexport const LogsTableAvailableFields = (props: {\n  labels: Record<string, FieldNameMeta>;\n  valueFilter: (value: string) => boolean;\n  toggleColumn: (columnName: string) => void;\n}): React.ReactElement => {\n  const { labels, valueFilter, toggleColumn } = props;\n  const theme = useTheme2();\n  const styles = getLogsFieldsStyles(theme);\n  const labelKeys = Object.keys(labels).filter((labelName) => valueFilter(labelName));\n  if (labelKeys.length) {\n    // Otherwise show list with a hardcoded order\n    return (\n      <div className={styles.columnWrapper}>\n        {labelKeys.sort(sortLabels(labels)).map((labelName) => (\n          <div\n            key={labelName}\n            className={styles.wrap}\n            title={`${labelName} appears in ${labels[labelName]?.percentOfLinesWithLabel}% of log lines`}\n          >\n            <LogsTableNavField\n              showCount={true}\n              label={labelName}\n              onChange={() => toggleColumn(labelName)}\n              labels={labels}\n            />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return <LogsTableEmptyFields />;\n};\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { LogsTableActiveFields } from 'Components/Table/ColumnSelection/LogsTableActiveFields';\nimport { LogsTableAvailableFields } from 'Components/Table/ColumnSelection/LogsTableAvailableFields';\n\nimport { FieldNameMeta, FieldNameMetaStore } from '../TableTypes';\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    sidebarWrap: css({\n      overflowY: 'scroll',\n      height: 'calc(100% - 50px)',\n      /* Hide scrollbar for Chrome, Safari, and Opera */\n      '&::-webkit-scrollbar': {\n        display: 'none',\n      },\n      /* Hide scrollbar for Firefox */\n      scrollbarWidth: 'none',\n    }),\n    columnHeaderButton: css({\n      appearance: 'none',\n      background: 'none',\n      border: 'none',\n      fontSize: theme.typography.pxToRem(11),\n    }),\n    columnHeader: css({\n      display: 'flex',\n      justifyContent: 'space-between',\n      fontSize: theme.typography.h6.fontSize,\n      background: theme.colors.background.secondary,\n      position: 'sticky',\n      top: 0,\n      left: 0,\n      paddingTop: theme.spacing(0.75),\n      paddingRight: theme.spacing(0.75),\n      paddingBottom: theme.spacing(0.75),\n      paddingLeft: theme.spacing(1.5),\n      zIndex: 3,\n      marginBottom: theme.spacing(2),\n    }),\n  };\n}\n\nexport const LogsTableMultiSelect = (props: {\n  toggleColumn: (columnName: string) => void;\n  filteredColumnsWithMeta: Record<string, FieldNameMeta> | undefined;\n  columnsWithMeta: Record<string, FieldNameMeta>;\n  clear: () => void;\n  reorderColumn: (cols: FieldNameMetaStore, oldIndex: number, newIndex: number) => void;\n}) => {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n\n  return (\n    <div className={styles.sidebarWrap}>\n      {/* Sidebar columns */}\n      <>\n        <div className={styles.columnHeader}>\n          Selected fields\n          <button onClick={props.clear} className={styles.columnHeaderButton}>\n            Reset\n          </button>\n        </div>\n        <LogsTableActiveFields\n          reorderColumn={props.reorderColumn}\n          toggleColumn={props.toggleColumn}\n          labels={props.filteredColumnsWithMeta ?? props.columnsWithMeta}\n          valueFilter={(value) => props.columnsWithMeta[value]?.active ?? false}\n          id={'selected-fields'}\n        />\n\n        <div className={styles.columnHeader}>Fields</div>\n        <LogsTableAvailableFields\n          toggleColumn={props.toggleColumn}\n          labels={props.filteredColumnsWithMeta ?? props.columnsWithMeta}\n          valueFilter={(value) => !props.columnsWithMeta[value]?.active}\n        />\n      </>\n    </div>\n  );\n};\n","import React, { useState } from 'react';\n\nimport { ClickOutsideWrapper } from '@grafana/ui';\n\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { LogsColumnSearch } from 'Components/Table/ColumnSelection/LogsColumnSearch';\nimport { LogsTableMultiSelect } from 'Components/Table/ColumnSelection/LogsTableMultiSelect';\n\nimport { FieldNameMetaStore } from '../TableTypes';\nimport { reportInteraction } from '@grafana/runtime';\nimport { logger } from '../../../services/logger';\n\nexport function getReorderColumn(setColumns: (cols: FieldNameMetaStore) => void) {\n  return (columns: FieldNameMetaStore, sourceIndex: number, destinationIndex: number) => {\n    if (sourceIndex === destinationIndex) {\n      return;\n    }\n\n    const pendingLabelState = { ...columns };\n    const keys = Object.keys(pendingLabelState)\n      .filter((key) => pendingLabelState[key].active)\n      .map((key) => ({\n        fieldName: key,\n        index: pendingLabelState[key].index ?? 0,\n      }))\n      .sort((a, b) => a.index - b.index);\n\n    const [source] = keys.splice(sourceIndex, 1);\n    keys.splice(destinationIndex, 0, source);\n\n    keys\n      .filter((key) => key !== undefined)\n      .forEach((key, index) => {\n        pendingLabelState[key.fieldName].index = index;\n      });\n\n    // Set local state\n    setColumns(pendingLabelState);\n  };\n}\n\nfunction logError(columnName: string, columns: FieldNameMetaStore) {\n  let logContext;\n  try {\n    logContext = {\n      columns: JSON.stringify(columns),\n      columnName: columnName,\n    };\n  } catch (e) {\n    logContext = {\n      msg: 'Table: ColumnSelectionDrawerWrap failed to encode context',\n      columnName: columnName,\n    };\n  }\n  logger.warn('failed to get column', logContext);\n}\n\nexport function ColumnSelectionDrawerWrap() {\n  const { columns, setColumns, setVisible, filteredColumns, setFilteredColumns } = useTableColumnContext();\n  const [searchValue, setSearchValue] = useState<string>('');\n  const toggleColumn = (columnName: string) => {\n    if (!columns || !(columnName in columns)) {\n      logError(columnName, columns);\n      return;\n    }\n\n    const length = Object.keys(columns).filter((c) => columns[c].active).length;\n    const isActive = !columns[columnName].active ? true : undefined;\n\n    let pendingLabelState: FieldNameMetaStore;\n    if (isActive) {\n      pendingLabelState = {\n        ...columns,\n        [columnName]: {\n          ...columns[columnName],\n          active: isActive,\n          index: length,\n        },\n      };\n    } else {\n      pendingLabelState = {\n        ...columns,\n        [columnName]: {\n          ...columns[columnName],\n          active: false,\n          index: undefined,\n        },\n      };\n    }\n\n    // Analytics\n    columnFilterEvent(columnName);\n\n    // Set local state\n    setColumns(pendingLabelState);\n\n    // If user is currently filtering, update filtered state\n    if (filteredColumns) {\n      const active = !filteredColumns[columnName]?.active;\n      let pendingFilteredLabelState: FieldNameMetaStore;\n      if (active) {\n        pendingFilteredLabelState = {\n          ...filteredColumns,\n          [columnName]: {\n            ...filteredColumns[columnName],\n            active: active,\n            index: length,\n          },\n        };\n      } else {\n        pendingFilteredLabelState = {\n          ...filteredColumns,\n          [columnName]: {\n            ...filteredColumns[columnName],\n            active: false,\n            index: undefined,\n          },\n        };\n      }\n\n      setFilteredColumns(pendingFilteredLabelState);\n      setSearchValue('');\n    }\n  };\n\n  const reorderColumn = getReorderColumn(setColumns);\n\n  const clearSelection = () => {\n    const pendingLabelState = { ...columns };\n    let index = 0;\n    Object.keys(pendingLabelState).forEach((key) => {\n      const isDefaultField =\n        pendingLabelState[key].type === 'BODY_FIELD' || pendingLabelState[key].type === 'TIME_FIELD';\n      // after reset the only active fields are the special time and body fields\n      pendingLabelState[key].active = isDefaultField;\n      // reset the index\n      pendingLabelState[key].index = isDefaultField ? index++ : undefined;\n    });\n\n    setColumns(pendingLabelState);\n    setFilteredColumns(pendingLabelState);\n    setSearchValue('');\n  };\n\n  // Tracking event for filtering columns\n  function columnFilterEvent(columnName: string) {\n    if (columns) {\n      const newState = !columns[columnName]?.active;\n      const priorActiveCount = Object.keys(columns).filter((column) => columns[column]?.active)?.length;\n      const event = {\n        columnAction: newState ? 'add' : 'remove',\n        columnCount: newState ? priorActiveCount + 1 : priorActiveCount - 1,\n      };\n      reportInteraction('grafana_logs_app_table_column_filter_clicked', event);\n    }\n  }\n\n  return (\n    <ClickOutsideWrapper\n      onClick={() => {\n        setVisible(false);\n        setFilteredColumns(columns);\n        setSearchValue('');\n      }}\n      useCapture={true}\n    >\n      <LogsColumnSearch searchValue={searchValue} setSearchValue={setSearchValue} />\n      <LogsTableMultiSelect\n        toggleColumn={toggleColumn}\n        filteredColumnsWithMeta={filteredColumns}\n        columnsWithMeta={columns}\n        clear={clearSelection}\n        reorderColumn={reorderColumn}\n      />\n    </ClickOutsideWrapper>\n  );\n}\n","import React, { PropsWithChildren } from 'react';\nimport { css, cx } from '@emotion/css';\n\nimport { Field, GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\n\ninterface DefaultCellWrapComponentProps {}\n\ninterface Props extends PropsWithChildren<DefaultCellWrapComponentProps> {\n  rowIndex: number;\n  field: Field;\n  onClick?: () => void;\n  onMouseIn?: () => void;\n  onMouseOut?: () => void;\n}\n\nconst getStyles = (theme: GrafanaTheme2, bgColor?: string, numberOfMenuItems?: number) => ({\n  active: css({\n    // Save 20px for context menu\n    height: `calc(${100}% + 36px)`,\n    zIndex: theme.zIndex.tooltip,\n    background: 'transparent',\n  }),\n  wrap: css({\n    position: 'absolute',\n    overflowX: 'hidden',\n    whiteSpace: 'nowrap',\n    width: '100%',\n    height: '100%',\n    left: 0,\n    top: 0,\n    margin: 'auto',\n    background: bgColor ?? 'transparent',\n  }),\n});\n\nexport const DefaultCellWrapComponent = (props: Props) => {\n  return (\n    <CellWrapInnerComponent\n      onMouseOut={props.onMouseOut}\n      onMouseIn={props.onMouseIn}\n      onClick={props.onClick}\n      field={props.field}\n      rowIndex={props.rowIndex}\n    >\n      {props.children}\n    </CellWrapInnerComponent>\n  );\n};\n\nconst CellWrapInnerComponent = (props: Props) => {\n  const theme = useTheme2();\n  const cellState = useTableCellContext();\n  const styles = getStyles(theme, undefined, cellState.cellIndex?.numberOfMenuItems);\n\n  return (\n    <div\n      onMouseLeave={props.onMouseOut}\n      onMouseEnter={props.onMouseIn}\n      onClick={props.onClick}\n      className={\n        cellState.cellIndex.index === props.rowIndex && cellState.cellIndex.fieldName === props.field.name\n          ? cx(styles.wrap, styles.active)\n          : styles.wrap\n      }\n    >\n      {props.children}\n    </div>\n  );\n};\n","import React, { createContext, ReactNode, useContext } from 'react';\nimport { LogsFrame } from '../../../services/logsFrame';\nimport { AdHocVariableFilter, TimeRange } from '@grafana/data';\nimport { SelectedTableRow } from '../LogLineCellComponent';\n\nexport type Label = { name: string; values: string[]; indexed: boolean };\n\nexport type QueryContextType = {\n  logsFrame: LogsFrame | null;\n  addFilter: (filter: AdHocVariableFilter) => void;\n  selectedLine?: SelectedTableRow;\n  timeRange?: TimeRange;\n};\n\nexport const initialState = {\n  logsFrame: null,\n  addFilter: (filter: AdHocVariableFilter) => {},\n  timeRange: undefined,\n  selectedLine: undefined,\n};\n\nexport const QueryContext = createContext<QueryContextType>(initialState);\n\nexport const QueryContextProvider = ({\n  children,\n  logsFrame,\n  addFilter,\n  selectedLine,\n  timeRange,\n}: {\n  children: ReactNode;\n  logsFrame: LogsFrame;\n  addFilter: (filter: AdHocVariableFilter) => void;\n  selectedLine?: SelectedTableRow;\n  timeRange?: TimeRange;\n}) => {\n  return (\n    <QueryContext.Provider\n      value={{\n        logsFrame,\n        addFilter,\n        selectedLine,\n        timeRange,\n      }}\n    >\n      {children}\n    </QueryContext.Provider>\n  );\n};\n\nexport const useQueryContext = () => {\n  return useContext(QueryContext);\n};\n","import React from 'react';\nimport { css } from '@emotion/css';\n\nimport { GrafanaTheme2, LinkModel } from '@grafana/data';\nimport { Icon, useTheme2 } from '@grafana/ui';\nimport { useQueryContext } from './Context/QueryContext';\n\nimport { FilterOp } from '../../services/filterTypes';\n\ninterface Props {\n  fieldType?: 'derived';\n  label: string;\n  value: string;\n  showColumn?: () => void;\n  links?: LinkModel[];\n  pillType: 'logPill' | 'column';\n}\n\nconst getStyles = (theme: GrafanaTheme2, pillType: 'logPill' | 'column') => ({\n  menu: css({\n    position: 'relative',\n    paddingRight: '5px',\n    display: 'flex',\n    minWidth: '60px',\n    justifyContent: 'flex-start',\n  }),\n  menuItemsWrap: css({\n    boxShadow: theme.shadows.z3,\n    display: 'flex',\n    background: theme.colors.background.secondary,\n    padding: '5px 0',\n    marginLeft: pillType === 'column' ? '5px' : undefined,\n  }),\n  menuItem: css({\n    overflow: 'auto',\n    textOverflow: 'ellipsis',\n    cursor: 'pointer',\n    paddingLeft: '5px',\n    paddingRight: '5px',\n    display: 'flex',\n    alignItems: 'center',\n  }),\n});\n\nexport const CellContextMenu = (props: Props) => {\n  const theme = useTheme2();\n  const styles = getStyles(theme, props.pillType);\n  const { addFilter } = useQueryContext();\n\n  return (\n    <span className={styles.menu}>\n      <span className={styles.menuItemsWrap}>\n        {props.fieldType !== 'derived' && (\n          <>\n            <div\n              className={styles.menuItem}\n              onClick={() => {\n                addFilter({\n                  key: props.label,\n                  value: props.value,\n                  operator: FilterOp.Equal,\n                });\n              }}\n            >\n              <Icon title={'Add to search'} size={'md'} name={'plus-circle'} />\n            </div>\n            <div\n              className={styles.menuItem}\n              onClick={() => {\n                addFilter({\n                  key: props.label,\n                  value: props.value,\n                  operator: FilterOp.NotEqual,\n                });\n              }}\n            >\n              <Icon title={'Exclude from search'} size={'md'} name={'minus-circle'} />\n            </div>\n          </>\n        )}\n\n        {props.showColumn && (\n          <div title={'Add column'} onClick={props.showColumn} className={styles.menuItem}>\n            <svg width=\"18\" height=\"16\" viewBox=\"0 0 18 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path\n                fillRule=\"evenodd\"\n                clipRule=\"evenodd\"\n                d=\"M1.38725 1.33301H13.3872C13.5641 1.33301 13.7336 1.40325 13.8587 1.52827C13.9837 1.65329 14.0539 1.82286 14.0539 1.99967V2.33333C14.0539 2.70152 13.7554 3 13.3872 3H13.0542C12.87 3 12.7206 2.85062 12.7206 2.66634H8.05391V13.333H12.7206C12.7206 13.1491 12.8697 13 13.0536 13H13.3872C13.7554 13 14.0539 13.2985 14.0539 13.6667V13.9997C14.0539 14.1765 13.9837 14.3461 13.8587 14.4711C13.7336 14.5961 13.5641 14.6663 13.3872 14.6663H1.38725C1.21044 14.6663 1.04087 14.5961 0.915843 14.4711C0.790819 14.3461 0.720581 14.1765 0.720581 13.9997V1.99967C0.720581 1.82286 0.790819 1.65329 0.915843 1.52827C1.04087 1.40325 1.21044 1.33301 1.38725 1.33301ZM2.05391 13.333H6.72058V2.66634H2.05391V13.333Z\"\n                fill=\"#CCCCDC\"\n                fillOpacity=\"1\"\n              />\n              <path\n                d=\"M13.8538 7.19999H16.2538C16.466 7.19999 16.6695 7.28429 16.8195 7.4343C16.9696 7.58432 17.0538 7.78783 17.0538 7.99999C17.0538 8.21214 16.9696 8.41566 16.8195 8.56567C16.6695 8.71569 16.466 8.79999 16.2538 8.79999H13.8538V11.2C13.8538 11.4121 13.7696 11.6156 13.6195 11.7657C13.4695 11.9157 13.266 12 13.0538 12C12.8416 12 12.6382 11.9157 12.4881 11.7657C12.3381 11.6156 12.2538 11.4121 12.2538 11.2V8.79999H9.85384C9.64165 8.79999 9.43819 8.71569 9.28815 8.56567C9.13811 8.41566 9.05383 8.21214 9.05383 7.99999C9.05383 7.78783 9.13811 7.58432 9.28815 7.4343C9.43819 7.28429 9.64165 7.19999 9.85384 7.19999H12.2538V4.8C12.2538 4.58784 12.3381 4.38433 12.4881 4.23431C12.6382 4.0843 12.8416 4 13.0538 4C13.266 4 13.4695 4.0843 13.6195 4.23431C13.7696 4.38433 13.8538 4.58784 13.8538 4.8V7.19999Z\"\n                fill=\"#CCCCDC\"\n                fillOpacity=\"1\"\n              />\n            </svg>\n          </div>\n        )}\n\n        {props.links &&\n          props.links.map((link) => {\n            return (\n              <div\n                className={styles.menuItem}\n                onClick={() => {\n                  window.open(link.href, '_blank');\n                }}\n                key={link.href}\n              >\n                <Icon title={link.title ?? 'Link'} key={link.href} size={'md'} name={'link'} />\n              </div>\n            );\n          })}\n      </span>\n    </span>\n  );\n};\n","export const LEVEL_NAME = 'detected_level';\n","import React, { ReactElement } from 'react';\nimport { css, cx } from '@emotion/css';\n\nimport { Field, FieldType, GrafanaTheme2 } from '@grafana/data';\nimport { useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\nimport { CellContextMenu } from 'Components/Table/CellContextMenu';\nimport { getFieldMappings } from 'Components/Table/Table';\nimport { LEVEL_NAME } from './constants';\n\ninterface DefaultPillProps {\n  label: string;\n  showColumns?: () => void;\n  value: string | unknown | ReactElement;\n  rowIndex: number;\n  field: Field;\n}\n\nconst getStyles = (theme: GrafanaTheme2, levelColor?: string) => ({\n  activePillWrap: css({}),\n  pillWrap: css({\n    width: '100%',\n  }),\n  pill: css({\n    border: `1px solid ${theme.colors.border.weak}`,\n    '&:hover': {\n      border: `1px solid ${theme.colors.border.strong}`,\n    },\n    marginRight: '5px',\n    marginTop: '4px',\n    marginLeft: '5px',\n    padding: '2px 5px',\n    position: 'relative',\n    display: 'inline-flex',\n    flexDirection: 'row-reverse',\n    backgroundColor: 'transparent',\n\n    paddingLeft: levelColor ? `${theme.spacing(0.75)}` : `2px`,\n\n    '&:before': {\n      content: '\"\"',\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      height: '100%',\n      width: `${theme.spacing(0.25)}`,\n      backgroundColor: levelColor,\n    },\n  }),\n  menu: css({\n    width: '100%',\n  }),\n  menuItem: css({\n    overflow: 'auto',\n    textOverflow: 'ellipsis',\n  }),\n  menuItemText: css({\n    width: '65px',\n    display: 'inline-block',\n  }),\n});\nexport const DefaultPill = (props: DefaultPillProps) => {\n  const { label, value } = props;\n  const theme = useTheme2();\n  const { cellIndex } = useTableCellContext();\n  let levelColor;\n\n  if (label === LEVEL_NAME) {\n    const mappings = getFieldMappings().options;\n    if (typeof value === 'string' && value in mappings) {\n      levelColor = mappings[value].color;\n    }\n  }\n\n  const isPillActive = cellIndex.index === props.rowIndex && props.field.name === cellIndex.fieldName;\n\n  const styles = getStyles(theme, levelColor);\n  return (\n    <div className={cx(styles.pillWrap, isPillActive ? styles.activePillWrap : undefined)}>\n      {!!value && (\n        <>\n          <span className={styles.pill}>\n            <>{value}</>\n          </span>\n          {isPillActive && typeof value === 'string' && props.field.type !== FieldType.time && (\n            <CellContextMenu label={props.label} value={value} pillType={'column'} />\n          )}\n        </>\n      )}\n    </div>\n  );\n};\n","import { ClipboardButton, IconButton, Modal, useTheme2 } from '@grafana/ui';\nimport React, { useCallback, useState } from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { useQueryContext } from 'Components/Table/Context/QueryContext';\nimport { testIds } from '../../services/testIds';\nimport { generateLogShortlink } from 'services/text';\n\nexport const getStyles = (theme: GrafanaTheme2, bgColor?: string) => ({\n  clipboardButton: css({\n    padding: 0,\n    height: '100%',\n    lineHeight: '1',\n    width: '20px',\n  }),\n  inspectButton: css({\n    display: 'inline-flex',\n    verticalAlign: 'middle',\n    margin: 0,\n    overflow: 'hidden',\n    borderRadius: '5px',\n  }),\n  iconWrapper: css({\n    height: '35px',\n    position: 'sticky',\n    left: 0,\n    display: 'flex',\n    background: theme.colors.background.secondary,\n    padding: `0 ${theme.spacing(0.5)}`,\n    zIndex: 1,\n    boxShadow: theme.shadows.z2,\n  }),\n  inspect: css({\n    padding: '5px 3px',\n\n    '&:hover': {\n      color: theme.colors.text.link,\n      cursor: 'pointer',\n    },\n  }),\n});\nexport function LineActionIcons(props: { rowIndex: number; value: unknown }) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const { logsFrame, timeRange } = useQueryContext();\n  const logId = logsFrame?.idField?.values[props.rowIndex];\n  const lineValue = logsFrame?.bodyField.values[props.rowIndex];\n  const [isInspecting, setIsInspecting] = useState(false);\n  const getText = useCallback(() => {\n    if (timeRange) {\n      return generateLogShortlink('selectedLine', { id: logId, row: props.rowIndex }, timeRange);\n    }\n    return '';\n  }, [logId, props.rowIndex, timeRange]);\n  return (\n    <>\n      <div className={styles.iconWrapper}>\n        <div className={styles.inspect}>\n          <IconButton\n            data-testid={testIds.table.inspectLine}\n            className={styles.inspectButton}\n            tooltip=\"View log line\"\n            variant=\"secondary\"\n            aria-label=\"View log line\"\n            tooltipPlacement=\"top\"\n            size=\"md\"\n            name=\"eye\"\n            onClick={() => setIsInspecting(true)}\n            tabIndex={0}\n          />\n        </div>\n        <div className={styles.inspect}>\n          <ClipboardButton\n            className={styles.clipboardButton}\n            icon=\"share-alt\"\n            variant=\"secondary\"\n            fill=\"text\"\n            size=\"md\"\n            tooltip=\"Copy link to log line\"\n            tooltipPlacement=\"top\"\n            tabIndex={0}\n            getText={getText}\n          />\n        </div>\n      </div>\n      <>\n        {isInspecting && (\n          <Modal onDismiss={() => setIsInspecting(false)} isOpen={true} title=\"Inspect value\">\n            <pre>{lineValue}</pre>\n            <Modal.ButtonRow>\n              <ClipboardButton icon=\"copy\" getText={() => props.value as string}>\n                Copy to Clipboard\n              </ClipboardButton>\n            </Modal.ButtonRow>\n          </Modal>\n        )}\n      </>\n    </>\n  );\n}\n","import React, { ReactElement } from 'react';\nimport { Row } from 'react-table';\nimport { css } from '@emotion/css';\n\nimport { FieldType, formattedValueToString, GrafanaTheme2 } from '@grafana/data';\nimport { CustomCellRendererProps, DataLinksContextMenu, getCellLinks, useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { DefaultCellWrapComponent } from 'Components/Table/DefaultCellWrapComponent';\nimport { DefaultPill } from 'Components/Table/DefaultPill';\nimport { LineActionIcons } from 'Components/Table/LineActionIcons';\n\nconst getStyles = (theme: GrafanaTheme2, fieldType?: FieldType) => ({\n  flexWrap: css({\n    display: 'flex',\n    alignItems: 'flex-start',\n    flexDirection: fieldType === FieldType.number ? 'row-reverse' : 'row',\n    textAlign: fieldType === FieldType.number ? 'right' : 'left',\n  }),\n  content: css({\n    position: 'relative',\n    overflow: 'hidden',\n    display: 'flex',\n    height: '100%',\n  }),\n  linkWrapper: css({\n    color: theme.colors.text.link,\n    marginTop: '7px',\n    marginLeft: '7px',\n    '&:hover': {\n      textDecoration: 'underline',\n    },\n  }),\n});\n\ninterface DefaultCellComponentCustomProps {\n  fieldIndex: number;\n}\nexport const DefaultCellComponent = (props: CustomCellRendererProps & DefaultCellComponentCustomProps) => {\n  let value = props.value;\n  const field = props.field;\n  const displayValue = field.display!(value);\n  const theme = useTheme2();\n  const styles = getStyles(theme, props.field.type);\n  const { setVisible } = useTableColumnContext();\n  const { cellIndex, setActiveCellIndex } = useTableCellContext();\n\n  // We don't get back the full react.table row here, but the calling function only uses the index, which are in `CustomCellRendererProps`\n  const row = { index: props.rowIndex } as Row;\n  const hasLinks = Boolean(getCellLinks(props.field, row)?.length);\n\n  if (value === null) {\n    return <></>;\n  }\n\n  if (React.isValidElement(props.value)) {\n    value = props.value;\n  } else if (typeof value === 'object') {\n    value = JSON.stringify(props.value);\n  } else {\n    value = formattedValueToString(displayValue);\n  }\n\n  const renderValue = (value: string | unknown | ReactElement, label: string) => {\n    return (\n      <DefaultPill\n        field={props.field}\n        rowIndex={props.rowIndex}\n        showColumns={() => setVisible(true)}\n        label={label}\n        value={value}\n      />\n    );\n  };\n\n  return (\n    <DefaultCellWrapComponent\n      onClick={() => {\n        if (props.rowIndex === cellIndex.index && props.field.name === cellIndex.fieldName) {\n          return setActiveCellIndex({ index: null });\n        }\n        return setActiveCellIndex({ index: props.rowIndex, fieldName: props.field.name, numberOfMenuItems: 3 });\n      }}\n      field={props.field}\n      rowIndex={props.rowIndex}\n    >\n      <div className={styles.content}>\n        {props.fieldIndex === 0 && <LineActionIcons value={value} rowIndex={props.rowIndex} />}\n        <div className={styles.flexWrap}></div>\n\n        {!hasLinks && renderValue(value, field.name)}\n\n        {hasLinks && field.getLinks && (\n          <DataLinksContextMenu links={() => getCellLinks(field, row) ?? []}>\n            {(api) => {\n              if (api.openMenu) {\n                return (\n                  <div className={styles.linkWrapper} onClick={api.openMenu}>\n                    <>{value}</>\n                  </div>\n                );\n              } else {\n                return (\n                  <div className={styles.linkWrapper}>\n                    <>{value}</>\n                  </div>\n                );\n              }\n            }}\n          </DataLinksContextMenu>\n        )}\n      </div>\n    </DefaultCellWrapComponent>\n  );\n};\n","import React, { useMemo } from 'react';\nimport { Row } from 'react-table';\nimport { css, cx } from '@emotion/css';\n\nimport { DataFrame, Field, FieldType, getLinksSupplier, GrafanaTheme2, LinkModel } from '@grafana/data';\nimport { getCellLinks, useTheme2 } from '@grafana/ui';\n\nimport { useTableCellContext } from 'Components/Table/Context/TableCellContext';\nimport { CellContextMenu } from 'Components/Table/CellContextMenu';\nimport { getFieldMappings } from 'Components/Table/Table';\nimport { FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { LEVEL_NAME } from './constants';\n\ninterface LogLinePillProps {\n  originalField?: Field;\n  field?: Field;\n  columns: FieldNameMetaStore;\n  label: string;\n  showColumns: () => void;\n  rowIndex: number;\n  frame: DataFrame;\n  originalFrame: DataFrame | undefined;\n  isDerivedField: boolean;\n  value: string;\n}\n\nconst getStyles = (theme: GrafanaTheme2, levelColor?: string) => ({\n  pill: css({\n    flex: '0 1 auto',\n    marginLeft: theme.spacing(0.5),\n    marginRight: theme.spacing(0.5),\n    padding: `${theme.spacing(0.25)} ${theme.spacing(0.25)}`,\n    position: 'relative',\n    display: 'inline-flex',\n    flexDirection: 'column',\n    marginTop: theme.spacing(0.5),\n  }),\n  activePill: css({}),\n  valueWrap: css({\n    border: `1px solid ${theme.colors.background.secondary}`,\n    boxShadow: `-2px 2px 5px 0px ${theme.colors.background.secondary}`,\n    backgroundColor: 'transparent',\n    cursor: 'pointer',\n    position: 'relative',\n\n    paddingRight: `${theme.spacing(0.5)}`,\n    paddingLeft: levelColor ? `${theme.spacing(0.75)}` : `${theme.spacing(0.5)}`,\n\n    '&:before': {\n      content: '\"\"',\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      height: '100%',\n      width: `${theme.spacing(0.25)}`,\n      backgroundColor: levelColor,\n    },\n\n    '&:hover': {\n      border: `1px solid ${theme.colors.border.strong}`,\n    },\n  }),\n});\n\nfunction LogLinePillValue(props: {\n  fieldType?: 'derived';\n  onClick: () => void;\n  label: string;\n  value: string;\n  menuActive: boolean;\n  onClickAdd: () => void;\n  links?: LinkModel[];\n}) {\n  const theme = useTheme2();\n\n  let levelColor;\n  if (props.label === LEVEL_NAME) {\n    const mappings = getFieldMappings().options;\n    if (props.value in mappings) {\n      levelColor = mappings[props.value].color;\n    }\n  }\n\n  const styles = getStyles(theme, levelColor);\n\n  return (\n    <span className={cx(styles.pill, props.menuActive ? styles.activePill : undefined)} onClick={props.onClick}>\n      <span className={styles.valueWrap}>\n        {props.label}={props.value}\n      </span>\n      {props.menuActive && (\n        <CellContextMenu\n          pillType={'logPill'}\n          fieldType={props.fieldType}\n          links={props.links}\n          label={props.label}\n          value={props.value}\n          showColumn={props.onClickAdd}\n        />\n      )}\n    </span>\n  );\n}\n\nexport const LogLinePill = (props: LogLinePillProps) => {\n  const { label } = props;\n  const { cellIndex, setActiveCellIndex } = useTableCellContext();\n  const { columns, setColumns } = useTableColumnContext();\n  const value = props.value;\n  const templateSrv = getTemplateSrv();\n  const replace = useMemo(() => templateSrv.replace.bind(templateSrv), [templateSrv]);\n\n  // Need untransformed frame for links?\n  const field = props.field;\n\n  if (!field || field?.type === FieldType.other) {\n    return null;\n  }\n  const row = { index: props.rowIndex } as Row;\n\n  if (props.originalField && props.isDerivedField && props.originalFrame) {\n    props.originalField.getLinks = getLinksSupplier(props.originalFrame, props.originalField, {}, replace);\n  }\n\n  const links = props.originalField && getCellLinks(props.originalField, row);\n\n  /**\n   * This Could be moved?\n   * Callback called by the pill context menu\n   * @param fieldName\n   */\n  const addFieldToColumns = (fieldName: string) => {\n    const pendingColumns = { ...columns };\n\n    const length = Object.keys(columns).filter((c) => columns[c].active).length;\n    if (pendingColumns[fieldName].active) {\n      pendingColumns[fieldName].active = false;\n      pendingColumns[fieldName].index = undefined;\n    } else {\n      pendingColumns[fieldName].active = true;\n      pendingColumns[fieldName].index = length;\n    }\n\n    setColumns(pendingColumns);\n  };\n\n  return (\n    <LogLinePillValue\n      onClick={() => {\n        if (\n          props.rowIndex === cellIndex.index &&\n          field.name === cellIndex.fieldName &&\n          label === cellIndex.subFieldName\n        ) {\n          return setActiveCellIndex({ index: null });\n        }\n\n        return setActiveCellIndex({\n          index: props.rowIndex,\n          fieldName: field.name,\n          subFieldName: label,\n          numberOfMenuItems: props.isDerivedField ? 2 : 3,\n        });\n      }}\n      menuActive={\n        cellIndex.index === props.rowIndex && cellIndex.fieldName === field.name && cellIndex.subFieldName === label\n      }\n      fieldType={props.isDerivedField ? 'derived' : undefined}\n      label={label}\n      value={value}\n      onClickAdd={() => addFieldToColumns(label)}\n      links={links}\n    />\n  );\n};\n","import { Icon, useTheme2 } from '@grafana/ui';\nimport React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  scroller: css`\n    position: absolute;\n    right: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 40px;\n    height: 20px;\n    top: 32px;\n    margin-top: -24px;\n    // For some reason clicking on this button causes text to be selected in the following row\n    user-select: none;\n  `,\n  scrollLeft: css`\n    cursor: pointer;\n    background: ${theme.colors.background.primary};\n\n    &:hover {\n      background: ${theme.colors.background.secondary};\n    }\n  `,\n  scrollRight: css`\n    cursor: pointer;\n    background: ${theme.colors.background.primary};\n\n    &:hover {\n      background: ${theme.colors.background.secondary};\n    }\n  `,\n});\n\nconst stopScroll = (id: React.MutableRefObject<HTMLDivElement | null>) => {\n  id?.current?.scrollTo({\n    left: id.current?.scrollLeft,\n  });\n};\n\nconst goLeft = (id: React.MutableRefObject<HTMLDivElement | null>) => {\n  id?.current?.scrollTo({\n    top: 0,\n    left: 0,\n    behavior: 'smooth',\n  });\n};\n\nconst goRight = (id: React.MutableRefObject<HTMLDivElement | null>) => {\n  id?.current?.scrollTo({\n    top: 0,\n    left: id.current.scrollWidth,\n    behavior: 'smooth',\n  });\n};\n\nexport function Scroller({ scrollerRef: ref }: { scrollerRef: React.MutableRefObject<HTMLDivElement | null> }) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return (\n    <div className={styles.scroller}>\n      <span onPointerDown={() => goLeft(ref)} onPointerUp={() => stopScroll(ref)} className={styles.scrollLeft}>\n        <Icon name={'arrow-left'} />\n      </span>\n      <span onPointerDown={() => goRight(ref)} onPointerUp={() => stopScroll(ref)} className={styles.scrollRight}>\n        <Icon name={'arrow-right'} />\n      </span>\n    </div>\n  );\n}\n","import React from 'react';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { useTheme2 } from '@grafana/ui';\nimport { testIds } from '../../services/testIds';\n\nexport function RawLogLineText(props: { value: unknown }) {\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  return (\n    <div data-testid={testIds.table.rawLogLine} className={styles.rawLogLine}>\n      <>{props.value}</>\n    </div>\n  );\n}\n\nexport const getStyles = (theme: GrafanaTheme2, bgColor?: string) => ({\n  rawLogLine: css({\n    fontFamily: theme.typography.fontFamilyMonospace,\n    height: '35px',\n    lineHeight: '35px',\n    paddingRight: theme.spacing(1.5),\n    paddingLeft: theme.spacing(1),\n    fontSize: theme.typography.bodySmall.fontSize,\n  }),\n});\n","import React, { useRef, useState } from 'react';\nimport { ScrollSyncPane } from 'react-scroll-sync';\n\nimport { FieldType, formattedValueToString, GrafanaTheme2, Labels } from '@grafana/data';\nimport { CustomCellRendererProps, useTheme2 } from '@grafana/ui';\n\nimport { useQueryContext } from 'Components/Table/Context/QueryContext';\nimport { LogLineState, useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { DefaultCellWrapComponent } from 'Components/Table/DefaultCellWrapComponent';\nimport { LogLinePill } from 'Components/Table/LogLinePill';\nimport { Scroller } from 'Components/Table/Scroller';\nimport { css } from '@emotion/css';\nimport { LineActionIcons } from 'Components/Table/LineActionIcons';\nimport { RawLogLineText } from 'Components/Table/RawLogLineText';\nimport { getBodyName } from '../../services/logsFrame';\nimport { LEVEL_NAME } from './constants';\n\nexport type SelectedTableRow = {\n  row: number;\n  id: string;\n};\n\ninterface Props extends CustomCellRendererProps {\n  labels: Labels;\n  fieldIndex: number;\n}\nexport const LogLineCellComponent = (props: Props) => {\n  let value = props.value;\n  const field = props.field;\n  const displayValue = field.display!(value);\n  const theme = useTheme2();\n  const styles = getStyles(theme);\n  const { columns, setVisible, bodyState } = useTableColumnContext();\n  const { logsFrame } = useQueryContext();\n  const [isHover, setIsHover] = useState(false);\n  const ref = useRef<HTMLDivElement | null>(null);\n\n  if (React.isValidElement(props.value)) {\n    value = props.value;\n  } else if (typeof value === 'object') {\n    value = JSON.stringify(props.value);\n  } else {\n    value = formattedValueToString(displayValue);\n  }\n\n  /**\n   * Render labels as log line pills\n   * @param labels Label[]\n   */\n  const renderLabels = (labels: Labels) => {\n    const columnLabelNames = Object.keys(columns);\n    const labelNames = columnLabelNames\n      .filter((name) => name !== getBodyName(logsFrame))\n      .sort((a, b) => {\n        // Sort level first\n        if (a === LEVEL_NAME) {\n          return -1;\n        }\n        if (b === LEVEL_NAME) {\n          return 1;\n        }\n        // Then sort links\n        if (columns[a].type === 'LINK_FIELD') {\n          return -1;\n        }\n        if (columns[b].type === 'LINK_FIELD') {\n          return 1;\n        }\n\n        // Finally sort fields by cardinality descending\n        return columns[a].cardinality > columns[b].cardinality ? -1 : 1;\n      });\n\n    const filteredLabels = labelNames.filter(\n      (label) =>\n        // Not already visible in another column\n        !columns[label].active &&\n        // And the cardinality is greater than 1\n        columns[label].cardinality > 1\n    );\n\n    return filteredLabels\n      .map((label) => {\n        const labelValue = labels[label];\n        const untransformedField = logsFrame?.raw?.fields.find((field) => field.name === label);\n        const rawValue = field?.values[props.rowIndex];\n        const isDerived = !labelValue && !!rawValue;\n\n        // If we have a label value, the field is not derived\n        if (labelValue) {\n          return (\n            <LogLinePill\n              originalFrame={undefined}\n              field={field}\n              columns={columns}\n              rowIndex={props.rowIndex}\n              frame={props.frame}\n              showColumns={() => setVisible(true)}\n              key={label}\n              label={label}\n              isDerivedField={false}\n              value={labelValue}\n            />\n          );\n        }\n\n        // Otherwise, the field might be derived\n        if (isDerived && untransformedField?.name) {\n          const untransformedValue = untransformedField?.values[props.rowIndex];\n          if (untransformedField?.type === FieldType.string && untransformedValue) {\n            return (\n              <LogLinePill\n                originalFrame={logsFrame?.raw}\n                originalField={untransformedField}\n                field={field}\n                value={untransformedValue}\n                columns={columns}\n                rowIndex={props.rowIndex}\n                frame={props.frame}\n                showColumns={() => setVisible(true)}\n                key={untransformedField.name}\n                label={untransformedField.name}\n                isDerivedField={true}\n              />\n            );\n          }\n        }\n\n        return null;\n      })\n      .filter((v) => v);\n  };\n\n  const labels = renderLabels(props.labels);\n  const isAuto = bodyState === LogLineState.auto;\n  const hasLabels = labels.length > 0;\n\n  return (\n    <DefaultCellWrapComponent\n      onMouseIn={() => {\n        setIsHover(true);\n      }}\n      onMouseOut={() => {\n        setIsHover(false);\n      }}\n      rowIndex={props.rowIndex}\n      field={props.field}\n    >\n      <ScrollSyncPane innerRef={ref} group=\"horizontal\">\n        <div className={styles.content}>\n          {/* First Field gets the icons */}\n          {props.fieldIndex === 0 && <LineActionIcons rowIndex={props.rowIndex} value={value} />}\n          {/* Labels */}\n          {isAuto && hasLabels && <>{labels}</>}\n          {bodyState === LogLineState.labels && hasLabels && <>{labels}</>}\n          {bodyState === LogLineState.labels && !hasLabels && <RawLogLineText value={value} />}\n\n          {/* Raw log line*/}\n          {isAuto && !hasLabels && <RawLogLineText value={value} />}\n          {bodyState === LogLineState.text && <RawLogLineText value={value} />}\n\n          {isHover && <Scroller scrollerRef={ref} />}\n        </div>\n      </ScrollSyncPane>\n    </DefaultCellWrapComponent>\n  );\n};\n\nexport const getStyles = (theme: GrafanaTheme2) => ({\n  content: css`\n    white-space: nowrap;\n    overflow-x: auto;\n    -ms-overflow-style: none; /* IE and Edge */\n    scrollbar-width: none; /* Firefox */\n    padding-right: 30px;\n    display: flex;\n    align-items: flex-start;\n    height: 100%;\n    &::-webkit-scrollbar {\n      display: none; /* Chrome, Safari and Opera */\n    }\n\n    &:after {\n      pointer-events: none;\n      content: '';\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      left: 0;\n      top: 0;\n      // Fade out text in last 10px to background color to add affordance to horiziontal scroll\n      background: linear-gradient(to right, transparent calc(100% - 10px), ${theme.colors.background.primary});\n    }\n  `,\n});\n","import React, { PropsWithChildren, useRef } from 'react';\nimport { css } from '@emotion/css';\n\nimport { Field, GrafanaTheme2 } from '@grafana/data';\nimport { ClickOutsideWrapper, IconButton, Popover, useTheme2 } from '@grafana/ui';\n\nimport { useTableHeaderContext } from 'Components/Table/Context/TableHeaderContext';\nimport { useQueryContext } from './Context/QueryContext';\nimport { getBodyName } from '../../services/logsFrame';\nimport { LogLineState, useTableColumnContext } from './Context/TableColumnsContext';\n\nexport interface LogsTableHeaderProps extends PropsWithChildren<CustomHeaderRendererProps> {\n  fieldIndex: number;\n}\n//@todo delete when released in Grafana core\nexport interface CustomHeaderRendererProps {\n  field: Field;\n  defaultContent: React.ReactNode;\n}\n\nconst getStyles = (theme: GrafanaTheme2, isFirstColumn: boolean, isLine: boolean) => ({\n  logLineButton: css({\n    marginLeft: '5px',\n  }),\n  tableHeaderMenu: css({\n    label: 'tableHeaderMenu',\n    width: '100%',\n    minWidth: '250px',\n    height: '100%',\n    maxHeight: '400px',\n    backgroundColor: theme.colors.background.primary,\n    border: `1px solid ${theme.colors.border.weak}`,\n    padding: theme.spacing(2),\n    margin: theme.spacing(1, 0),\n    boxShadow: theme.shadows.z3,\n    borderRadius: theme.shape.radius.default,\n  }),\n  leftAlign: css({\n    label: 'left-align',\n    display: 'flex',\n    width: 'calc(100% - 20px)',\n  }),\n  clearButton: css({\n    marginLeft: '5px',\n  }),\n  rightAlign: css({\n    label: 'right-align',\n    display: 'flex',\n    marginRight: '5px',\n  }),\n  wrapper: css({\n    label: 'wrapper',\n    display: 'flex',\n    marginLeft: isFirstColumn ? '56px' : '6px',\n    // Body has extra padding then other columns\n    width: isLine ? 'calc(100% + 6px)' : '100%',\n\n    // Hack to show a visible resize indicator, despite 6px of padding on the header in grafana/table\n    borderRight: `1px solid ${theme.colors.border.weak}`,\n    marginRight: '-6px',\n  }),\n  defaultContentWrapper: css({\n    borderLeft: isFirstColumn ? `1px solid ${theme.colors.border.weak}` : 'none',\n    marginLeft: isFirstColumn ? '-6px' : 0,\n    paddingLeft: isFirstColumn ? '12px' : 0,\n    display: 'flex',\n  }),\n});\n\nexport const LogsTableHeader = (props: LogsTableHeaderProps) => {\n  const { setHeaderMenuActive, isHeaderMenuActive } = useTableHeaderContext();\n  const { logsFrame } = useQueryContext();\n  const referenceElement = useRef<HTMLButtonElement | null>(null);\n  const theme = useTheme2();\n  const styles = getStyles(theme, props.fieldIndex === 0, props.field.name === getBodyName(logsFrame));\n  const { columnWidthMap, setColumnWidthMap, setBodyState, bodyState } = useTableColumnContext();\n  const isBodyField = props.field.name === getBodyName(logsFrame);\n\n  const onLogTextToggle = () => {\n    setBodyState(bodyState === LogLineState.text ? LogLineState.labels : LogLineState.text);\n  };\n\n  return (\n    <span className={styles.wrapper}>\n      <span className={styles.leftAlign}>\n        <span className={styles.defaultContentWrapper}>{props.defaultContent}</span>\n        {columnWidthMap && setColumnWidthMap && columnWidthMap?.[props.field.name] !== undefined && (\n          <IconButton\n            tooltip={'Reset column width'}\n            tooltipPlacement={'top'}\n            className={styles.clearButton}\n            aria-label={'Reset column width'}\n            name={'x'}\n            onClick={() => {\n              const { [props.field.name]: omit, ...map } = { ...columnWidthMap };\n              setColumnWidthMap?.(map);\n            }}\n          />\n        )}\n        {isBodyField && (\n          <>\n            {bodyState === LogLineState.text ? (\n              <IconButton\n                tooltipPlacement={'top'}\n                tooltip={'Show log labels'}\n                aria-label={'Show log labels'}\n                onClick={onLogTextToggle}\n                className={styles.logLineButton}\n                name={'brackets-curly'}\n                size={'md'}\n              />\n            ) : (\n              <IconButton\n                tooltipPlacement={'top'}\n                tooltip={'Show log text'}\n                aria-label={'Show log text'}\n                onClick={onLogTextToggle}\n                className={styles.logLineButton}\n                name={'text-fields'}\n                size={'md'}\n              />\n            )}\n          </>\n        )}\n      </span>\n      <span className={styles.rightAlign}>\n        <IconButton\n          tooltip={`Show ${props.field.name} menu`}\n          tooltipPlacement={'top'}\n          ref={referenceElement}\n          aria-label={`Show ${props.field.name} menu`}\n          onClick={(e) => {\n            setHeaderMenuActive(!isHeaderMenuActive);\n          }}\n          name={'ellipsis-v'}\n        />\n      </span>\n\n      {referenceElement.current && (\n        //@ts-ignore\n        <Popover\n          show={isHeaderMenuActive}\n          content={\n            <ClickOutsideWrapper onClick={() => setHeaderMenuActive(false)} useCapture={true}>\n              <div className={styles.tableHeaderMenu}>{props.children}</div>\n            </ClickOutsideWrapper>\n          }\n          referenceElement={referenceElement.current}\n        />\n      )}\n    </span>\n  );\n};\n","import { LogsTableHeader, LogsTableHeaderProps } from 'Components/Table/LogsTableHeader';\nimport { FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { useTableHeaderContext } from 'Components/Table/Context/TableHeaderContext';\nimport { LogLineState, useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { Icon } from '@grafana/ui';\nimport React, { useCallback } from 'react';\nimport { Field } from '@grafana/data';\nimport { getBodyName } from '../../services/logsFrame';\nimport { css, cx } from '@emotion/css';\nimport { useQueryContext } from './Context/QueryContext';\n\nexport function LogsTableHeaderWrap(props: {\n  headerProps: LogsTableHeaderProps;\n  openColumnManagementDrawer: () => void;\n\n  // Moves the current column forward or backward one index\n  slideLeft?: (cols: FieldNameMetaStore) => void;\n  slideRight?: (cols: FieldNameMetaStore) => void;\n\n  autoColumnWidths?: () => void;\n}) {\n  const { setHeaderMenuActive } = useTableHeaderContext();\n  const { columns, setColumns, bodyState, setBodyState } = useTableColumnContext();\n  const { logsFrame } = useQueryContext();\n  const styles = getStyles();\n\n  const hideColumn = useCallback(\n    (field: Field) => {\n      const pendingColumnState = { ...columns };\n\n      const columnsThatNeedIndexUpdate = Object.keys(pendingColumnState)\n        .filter((col) => {\n          const columnIndex = pendingColumnState[col].index;\n          const fieldIndex = pendingColumnState[field.name].index;\n          return pendingColumnState[col].active && fieldIndex && columnIndex && columnIndex > fieldIndex;\n        })\n        .map((cols) => pendingColumnState[cols]);\n\n      columnsThatNeedIndexUpdate.forEach((col) => {\n        if (col.index !== undefined) {\n          col.index--;\n        }\n      });\n\n      pendingColumnState[field.name].active = false;\n      pendingColumnState[field.name].index = undefined;\n      setColumns(pendingColumnState);\n    },\n    [columns, setColumns]\n  );\n\n  const isBodyField = props.headerProps.field.name === getBodyName(logsFrame);\n\n  return (\n    <LogsTableHeader {...props.headerProps}>\n      <div className={styles.linkWrap}>\n        <a\n          className={styles.link}\n          onClick={() => {\n            props.openColumnManagementDrawer();\n            setHeaderMenuActive(false);\n          }}\n        >\n          <Icon className={styles.icon} name={'columns'} size={'md'} />\n          Manage columns\n        </a>\n      </div>\n      <div className={styles.linkWrap}>\n        <a className={styles.link} onClick={() => hideColumn(props.headerProps.field)}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 17 16\"\n            width=\"17\"\n            height=\"16\"\n            className=\"css-q2u0ig-Icon\"\n          >\n            <path\n              fillRule=\"evenodd\"\n              clipRule=\"evenodd\"\n              d=\"M1.73446 1.33301H12.2345C12.3892 1.33301 12.5375 1.40325 12.6469 1.52827C12.7563 1.65329 12.8178 1.82286 12.8178 1.99967V4.74967C12.8178 5.07184 12.5566 5.33301 12.2345 5.33301C11.9123 5.33301 11.6511 5.07184 11.6511 4.74967V2.66634H7.56779V13.333H11.6511V10.9163C11.6511 10.5942 11.9123 10.333 12.2345 10.333C12.5566 10.333 12.8178 10.5942 12.8178 10.9163V13.9997C12.8178 14.1765 12.7563 14.3461 12.6469 14.4711C12.5375 14.5961 12.3892 14.6663 12.2345 14.6663H1.73446C1.57975 14.6663 1.43137 14.5961 1.32198 14.4711C1.21258 14.3461 1.15112 14.1765 1.15112 13.9997V1.99967C1.15112 1.82286 1.21258 1.65329 1.32198 1.52827C1.43137 1.40325 1.57975 1.33301 1.73446 1.33301ZM2.31779 13.333H6.40112V2.66634H2.31779V13.333Z\"\n              fill=\"#CCCCDC\"\n              fillOpacity=\"1\"\n            />\n            <path\n              d=\"M15.9893 10.6315C15.9498 10.7263 15.8919 10.8123 15.819 10.8846C15.7467 10.9575 15.6607 11.0154 15.5659 11.0549C15.4712 11.0943 15.3695 11.1147 15.2668 11.1147C15.1641 11.1147 15.0625 11.0943 14.9677 11.0549C14.8729 11.0154 14.7869 10.9575 14.7146 10.8846L12.9335 9.09573L11.1524 10.8846C11.0801 10.9575 10.9941 11.0154 10.8993 11.0549C10.8045 11.0943 10.7028 11.1147 10.6002 11.1147C10.4975 11.1147 10.3958 11.0943 10.301 11.0549C10.2063 11.0154 10.1202 10.9575 10.0479 10.8846C9.97504 10.8123 9.91717 10.7263 9.87769 10.6315C9.8382 10.5367 9.81787 10.4351 9.81787 10.3324C9.81787 10.2297 9.8382 10.1281 9.87769 10.0333C9.91717 9.9385 9.97504 9.85248 10.0479 9.78017L11.8368 7.99906L10.0479 6.21795C9.90148 6.07149 9.8192 5.87285 9.8192 5.66573C9.8192 5.4586 9.90148 5.25996 10.0479 5.1135C10.1944 4.96705 10.393 4.88477 10.6002 4.88477C10.8073 4.88477 11.0059 4.96705 11.1524 5.1135L12.9335 6.90239L14.7146 5.1135C14.8611 4.96705 15.0597 4.88477 15.2668 4.88477C15.4739 4.88477 15.6726 4.96705 15.819 5.1135C15.9655 5.25996 16.0478 5.4586 16.0478 5.66573C16.0478 5.87285 15.9655 6.07149 15.819 6.21795L14.0302 7.99906L15.819 9.78017C15.8919 9.85248 15.9498 9.9385 15.9893 10.0333C16.0288 10.1281 16.0491 10.2297 16.0491 10.3324C16.0491 10.4351 16.0288 10.5367 15.9893 10.6315Z\"\n              fill=\"#CCCCDC\"\n              fillOpacity=\"1\"\n            />\n          </svg>\n          Remove column\n        </a>\n      </div>\n      {props.slideLeft && (\n        <div className={styles.linkWrap}>\n          <a className={styles.link} onClick={() => props.slideLeft?.(columns)}>\n            <Icon className={cx(styles.icon, styles.reverse)} name={'arrow-from-right'} size={'md'} />\n            Move left\n          </a>\n        </div>\n      )}\n      {props.slideRight && (\n        <div className={styles.linkWrap}>\n          <a className={styles.link} onClick={() => props.slideRight?.(columns)}>\n            <Icon className={styles.icon} name={'arrow-from-right'} size={'md'} />\n            Move right\n          </a>\n        </div>\n      )}\n      {isBodyField && (\n        <div className={styles.linkWrap}>\n          <a\n            className={styles.link}\n            onClick={() => {\n              if (bodyState === LogLineState.text) {\n                setBodyState(LogLineState.labels);\n              } else {\n                setBodyState(LogLineState.text);\n              }\n            }}\n          >\n            {bodyState === LogLineState.text ? (\n              <Icon className={styles.icon} name={'brackets-curly'} size={'md'} />\n            ) : (\n              <Icon className={styles.icon} name={'text-fields'} size={'md'} />\n            )}\n\n            {bodyState === LogLineState.text ? 'Show labels' : 'Show log text'}\n          </a>\n        </div>\n      )}\n\n      {props.autoColumnWidths && (\n        <div className={styles.linkWrap}>\n          <a className={styles.link} onClick={() => props.autoColumnWidths?.()}>\n            <Icon className={styles.icon} name={'arrows-h'} size={'md'} />\n            Reset column widths\n          </a>\n        </div>\n      )}\n    </LogsTableHeader>\n  );\n}\n\nconst getStyles = () => {\n  return {\n    reverse: css({\n      transform: 'scaleX(-1)',\n    }),\n    link: css({\n      paddingTop: '5px',\n      paddingBottom: '5px',\n    }),\n    icon: css({\n      marginRight: '10px',\n    }),\n    linkWrap: css({}),\n  };\n};\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { ScrollSync } from 'react-scroll-sync';\nimport { css } from '@emotion/css';\nimport { lastValueFrom } from 'rxjs';\n\nimport {\n  applyFieldOverrides,\n  CustomTransformOperator,\n  DataFrame,\n  DataFrameType,\n  DataTransformerConfig,\n  Field,\n  FieldType,\n  FieldWithIndex,\n  Labels,\n  MappingType,\n  transformDataFrame,\n  ValueMap,\n} from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { TableCellHeight, TableColoredBackgroundCellOptions } from '@grafana/schema';\nimport { Drawer, Table as GrafanaTable, TableCellDisplayMode, TableCustomCellOptions, useTheme2 } from '@grafana/ui';\n\nimport { TableCellContextProvider } from 'Components/Table/Context/TableCellContext';\nimport { useTableColumnContext } from 'Components/Table/Context/TableColumnsContext';\nimport { TableHeaderContextProvider } from 'Components/Table/Context/TableHeaderContext';\nimport {\n  ColumnSelectionDrawerWrap,\n  getReorderColumn,\n} from 'Components/Table/ColumnSelection/ColumnSelectionDrawerWrap';\nimport { DefaultCellComponent } from 'Components/Table/DefaultCellComponent';\nimport { LogLineCellComponent } from 'Components/Table/LogLineCellComponent';\nimport { CustomHeaderRendererProps } from 'Components/Table/LogsTableHeader';\nimport { FieldName, FieldNameMeta, FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { guessLogsFieldTypeForValue } from 'Components/Table/TableWrap';\nimport { LogsTableHeaderWrap } from 'Components/Table/LogsTableHeaderWrap';\nimport { getBodyName, getIdName, getTimeName, LogsFrame } from '../../services/logsFrame';\nimport { useQueryContext } from './Context/QueryContext';\nimport { testIds } from '../../services/testIds';\nimport { debounce } from 'lodash';\n\ninterface Props {\n  height: number;\n  timeZone: string;\n  logsFrame: LogsFrame;\n  width: number;\n  labels: Labels[];\n}\n\nconst getStyles = () => ({\n  section: css({\n    position: 'relative',\n  }),\n  tableWrap: css({\n    '.cellActions': {\n      // Hacky but without inspect turned on the table will change the width of the row on hover, but we don't want the default icons to show\n      display: 'none !important',\n    },\n  }),\n});\n\nfunction TableAndContext(props: {\n  data: DataFrame;\n  height: number;\n  width: number;\n  selectedLine?: number;\n  logsFrame: LogsFrame;\n  onResize: (fieldDisplayName: string, width: number) => void;\n}) {\n  return (\n    <GrafanaTable\n      onColumnResize={props.onResize}\n      initialSortBy={[{ displayName: getTimeName(props.logsFrame), desc: true }]}\n      initialRowIndex={props.selectedLine}\n      cellHeight={TableCellHeight.Sm}\n      data={props.data}\n      height={props.height}\n      width={props.width}\n      footerOptions={{ show: true, reducer: ['count'], countRows: true }}\n    />\n  );\n}\n\nexport const Table = (props: Props) => {\n  const { height, timeZone, logsFrame, width, labels } = props;\n  const theme = useTheme2();\n  const styles = getStyles();\n\n  const [tableFrame, setTableFrame] = useState<DataFrame | undefined>(undefined);\n  const {\n    columns,\n    visible,\n    setVisible,\n    setFilteredColumns,\n    setColumns,\n    clearSelectedLine,\n    columnWidthMap,\n    setColumnWidthMap,\n  } = useTableColumnContext();\n\n  const { selectedLine } = useQueryContext();\n\n  // Create a local state for selected line so we can clear the state tied to the URL\n  const [localSelectedLine] = useState(selectedLine);\n\n  const reorderColumn = getReorderColumn(setColumns);\n\n  const templateSrv = getTemplateSrv();\n  const replace = useMemo(() => templateSrv.replace.bind(templateSrv), [templateSrv]);\n\n  const prepareTableFrame = useCallback(\n    (frame: DataFrame): DataFrame => {\n      if (!frame.length) {\n        return frame;\n      }\n\n      const [frameWithOverrides] = applyFieldOverrides({\n        data: [frame],\n        timeZone: timeZone,\n        theme: theme,\n        replaceVariables: replace,\n        fieldConfig: {\n          defaults: {\n            custom: {},\n          },\n          overrides: [],\n        },\n      });\n\n      // `getLinks` and `applyFieldOverrides` are taken from TableContainer.tsx\n      for (const [index, field] of frameWithOverrides.fields.entries()) {\n        // If it's a string, then try to guess for a better type for numeric support in viz\n        field.type =\n          field.type === FieldType.string ? guessLogsFieldTypeForField(field) ?? FieldType.string : field.type;\n\n        field.config = {\n          ...field.config,\n\n          custom: {\n            inspect: true,\n            filterable: true, // This sets the columns to be filterable\n            headerComponent: (props: CustomHeaderRendererProps) => (\n              <TableHeaderContextProvider>\n                <LogsTableHeaderWrap\n                  headerProps={{ ...props, fieldIndex: index }}\n                  openColumnManagementDrawer={() => setVisible(true)}\n                  slideLeft={\n                    index !== 0 ? (cols: FieldNameMetaStore) => reorderColumn(cols, index, index - 1) : undefined\n                  }\n                  slideRight={\n                    index !== frame.fields.length - 1\n                      ? (cols: FieldNameMetaStore) => reorderColumn(cols, index, index + 1)\n                      : undefined\n                  }\n                  autoColumnWidths={\n                    Object.keys(columnWidthMap).length > 0\n                      ? () => {\n                          setColumnWidthMap({});\n                        }\n                      : undefined\n                  }\n                />\n              </TableHeaderContextProvider>\n            ),\n            width:\n              columnWidthMap[field.name] ??\n              getInitialFieldWidth(field, index, columns, width, frameWithOverrides.fields.length, logsFrame),\n            cellOptions: getTableCellOptions(field, index, labels, logsFrame),\n            ...field.config.custom,\n          },\n          // This sets the individual field value as filterable\n          // filterable: isFieldFilterable(field, logsFrame?.bodyField.name ?? '', logsFrame?.timeField.name ?? ''),\n          filterable: true,\n        };\n      }\n\n      return frameWithOverrides;\n    },\n    // This function is building the table dataframe that will be transformed, even though the components within the dataframe (cells, headers) can mutate the dataframe!\n    // If we try to update the dataframe whenever the columns are changed (which are rebuilt using this dataframe after being transformed), react will infinitely update frame -> columns -> frame -> ...\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [timeZone, theme, labels, width, replace, setVisible, columnWidthMap]\n  );\n\n  // prepare dataFrame\n  useEffect(() => {\n    const prepare = async () => {\n      const transformations: Array<DataTransformerConfig | CustomTransformOperator> = getExtractFieldsTransform(\n        logsFrame.raw\n      );\n\n      let labelFilters = buildColumnsWithMeta(columns);\n\n      const labelFiltersTransform = getOrganizeFieldsTransform(labelFilters);\n      if (labelFiltersTransform) {\n        transformations.push(labelFiltersTransform);\n      } else {\n        const specialFields = {\n          time: logsFrame.timeField,\n          body: logsFrame.bodyField,\n          extraFields: logsFrame.extraFields,\n        };\n        if (specialFields && specialFields.body !== undefined && specialFields.time !== undefined) {\n          transformations.push(\n            getDefaultStateOrganizeFieldsTransform(\n              specialFields as {\n                time: FieldWithIndex;\n                body: FieldWithIndex;\n              }\n            )\n          );\n        }\n      }\n\n      if (transformations.length > 0) {\n        const transformedDataFrame: DataFrame[] = await lastValueFrom(\n          // @ts-ignore\n          transformDataFrame(transformations, [logsFrame.raw])\n        );\n        const tableFrame = prepareTableFrame(transformedDataFrame[0]);\n        setTableFrame(tableFrame);\n      } else {\n        setTableFrame(prepareTableFrame(logsFrame.raw));\n      }\n    };\n    prepare();\n  }, [logsFrame.raw, logsFrame.bodyField, logsFrame.timeField, logsFrame.extraFields, prepareTableFrame, columns]);\n\n  // Clear selected line from URL so it doesn't pollute future queries\n  useEffect(() => {\n    if (localSelectedLine && selectedLine) {\n      clearSelectedLine();\n      return;\n    }\n  }, [localSelectedLine, clearSelectedLine, selectedLine]);\n\n  const idField = logsFrame.raw.fields.find((field) => field.name === getIdName(logsFrame));\n  const lineIndex = idField?.values.findIndex((v) => v === localSelectedLine?.id);\n  const cleanLineIndex = lineIndex && lineIndex !== -1 ? lineIndex : undefined;\n\n  if (!tableFrame) {\n    return <></>;\n  }\n\n  const onResize = (fieldDisplayName: string, width: number) => {\n    const key = Object.keys(columns)\n      .filter((key) => columns[key].active)\n      .find((key) => key === fieldDisplayName);\n\n    if (key && width > 0) {\n      const map = { ...columnWidthMap };\n      map[key] = width;\n      setColumnWidthMap(map);\n    }\n  };\n\n  return (\n    <div data-testid={testIds.table.wrapper} className={styles.section}>\n      {visible && (\n        <Drawer\n          size={'sm'}\n          onClose={() => {\n            setVisible(false);\n            setFilteredColumns(columns);\n          }}\n        >\n          <ColumnSelectionDrawerWrap />\n        </Drawer>\n      )}\n\n      <div className={styles.tableWrap}>\n        <TableCellContextProvider>\n          <ScrollSync horizontal={true} vertical={false} proportional={false}>\n            <TableAndContext\n              logsFrame={logsFrame}\n              selectedLine={cleanLineIndex}\n              data={tableFrame}\n              height={height}\n              width={width}\n              onResize={debounce(onResize, 100)}\n            />\n          </ScrollSync>\n        </TableCellContextProvider>\n      </div>\n    </div>\n  );\n};\n\nfunction getDefaultStateOrganizeFieldsTransform(specialFields: { time: FieldWithIndex; body: FieldWithIndex }) {\n  return {\n    id: 'organize',\n    options: {\n      indexByName: {\n        [specialFields.time.name]: 0,\n        [specialFields.body.name]: 1,\n      },\n      includeByName: {\n        [specialFields.body.name]: true,\n        [specialFields.time.name]: true,\n      },\n    },\n  };\n}\n\nfunction guessLogsFieldTypeForField(field: Field): FieldType | undefined {\n  // 1. Use the column name to guess\n  if (field.name) {\n    const name = field.name.toLowerCase();\n    if (name === 'date' || name === 'time') {\n      return FieldType.time;\n    }\n  }\n\n  // 2. Check the first non-null value\n  for (let i = 0; i < field.values.length; i++) {\n    const v = field.values[i];\n    if (v != null) {\n      return guessLogsFieldTypeForValue(v);\n    }\n  }\n\n  // Could not find anything\n  return undefined;\n}\n\nexport const getFieldMappings = (): ValueMap => {\n  return {\n    options: {\n      critical: {\n        color: '#705da0',\n        index: 0,\n      },\n      crit: {\n        color: '#705da0',\n        index: 1,\n      },\n      error: {\n        color: '#e24d42',\n        index: 2,\n      },\n      err: {\n        color: '#e24d42',\n        index: 3,\n      },\n      eror: {\n        color: '#e24d42',\n        index: 4,\n      },\n      warning: {\n        color: '#FF9900',\n        index: 5,\n      },\n      warn: {\n        color: '#FF9900',\n        index: 6,\n      },\n      info: {\n        color: '#7eb26d',\n        index: 7,\n      },\n      debug: {\n        color: '#1f78c1',\n        index: 8,\n      },\n      trace: {\n        color: '#6ed0e0',\n        index: 9,\n      },\n    },\n    type: MappingType.ValueToText,\n  };\n};\n\nfunction buildColumnsWithMeta(columnsWithMeta: Record<FieldName, FieldNameMeta>) {\n  // Create object of label filters to include columns selected by the user\n  let labelFilters: Record<FieldName, number> = {};\n  Object.keys(columnsWithMeta)\n    .filter((key) => columnsWithMeta[key].active)\n    .forEach((key) => {\n      const index = columnsWithMeta[key].index;\n      // Index should always be defined for any active column\n      if (index !== undefined) {\n        labelFilters[key] = index;\n      }\n    });\n\n  return labelFilters;\n}\n\nfunction getOrganizeFieldsTransform(labelFilters: Record<FieldName, number>) {\n  let labelFiltersInclude: Record<FieldName, boolean> = {};\n\n  for (const key in labelFilters) {\n    labelFiltersInclude[key] = true;\n  }\n\n  if (Object.keys(labelFilters).length > 0) {\n    return {\n      id: 'organize',\n      options: {\n        indexByName: labelFilters,\n        includeByName: labelFiltersInclude,\n      },\n    };\n  }\n  return null;\n}\n\nexport function getExtractFieldsTransform(dataFrame: DataFrame) {\n  return dataFrame.fields\n    .filter((field: Field & { typeInfo?: { frame: string } }) => {\n      const isFieldLokiLabels =\n        field.typeInfo?.frame === 'json.RawMessage' &&\n        field.name === 'labels' &&\n        dataFrame?.meta?.type !== DataFrameType.LogLines;\n      const isFieldDataplaneLabels =\n        field.name === 'labels' && field.type === FieldType.other && dataFrame?.meta?.type === DataFrameType.LogLines;\n      return isFieldLokiLabels || isFieldDataplaneLabels;\n    })\n    .flatMap((field: Field) => {\n      return [\n        {\n          id: 'extractFields',\n          options: {\n            format: 'json',\n            keepTime: false,\n            replace: false,\n            source: field.name,\n          },\n        },\n      ];\n    });\n}\n\nfunction getTableCellOptions(\n  field: Field,\n  fieldIndex: number,\n  labels: Labels[],\n  logsFrame: LogsFrame\n): TableCustomCellOptions | TableColoredBackgroundCellOptions {\n  if (field.name === getBodyName(logsFrame)) {\n    return {\n      cellComponent: (props) => (\n        <LogLineCellComponent {...props} fieldIndex={fieldIndex} labels={labels[props.rowIndex]} />\n      ),\n      type: TableCellDisplayMode.Custom,\n    };\n  }\n\n  return {\n    cellComponent: (props) => <DefaultCellComponent {...props} fieldIndex={fieldIndex} />,\n    type: TableCellDisplayMode.Custom,\n  };\n}\n\nfunction getInitialFieldWidth(\n  field: Field,\n  fieldIndex: number,\n  columns: FieldNameMetaStore,\n  tableWidth: number,\n  numberOfFields: number,\n  logsFrame: LogsFrame\n): number | undefined {\n  const minWidth = 90;\n\n  // Columns shouldn't take more than half the available space, unless there are only 2 columns\n  const maxWidth = numberOfFields <= 2 ? tableWidth : Math.min(tableWidth / 2);\n\n  // First field gets icons, and a little extra width\n  const extraPadding = fieldIndex === 0 ? 50 : 0;\n\n  // Time fields have consistent widths\n  if (field.type === FieldType.time) {\n    return 200 + extraPadding;\n  }\n\n  const columnMeta = columns[field.name];\n\n  if (columnMeta === undefined) {\n    return undefined;\n  }\n\n  const maxLength = Math.max(columnMeta.maxLength ?? 0, field.name.length);\n\n  if (columnMeta.maxLength) {\n    // Super rough estimate, about 6.5px per char, and 95px for some space for the header icons (remember when sorted a new icon is added to the table header).\n    // I guess to be a little tighter we could only add the extra padding IF the field name is longer then the longest value\n    return Math.min(Math.max(maxLength * 6.5 + 95 + extraPadding, minWidth + extraPadding), maxWidth);\n  }\n\n  if (field.name === getBodyName(logsFrame)) {\n    return undefined;\n  }\n\n  // Just derived fields, which should have uniform length\n  return Math.min(\n    Math.max((field.values?.[0]?.length ?? 80) * 6.5 + 95 + extraPadding, minWidth + extraPadding),\n    maxWidth\n  );\n}\n","import React, { useCallback, useState } from 'react';\nimport { css } from '@emotion/css';\n\nimport { DataFrame, FieldType, FieldWithIndex, getTimeZone, guessFieldTypeFromValue, Labels } from '@grafana/data';\n\nimport { LogLineState, TableColumnContextProvider } from 'Components/Table/Context/TableColumnsContext';\nimport { Table } from 'Components/Table/Table';\nimport { FieldNameMeta, FieldNameMetaStore } from 'Components/Table/TableTypes';\nimport { useQueryContext } from 'Components/Table/Context/QueryContext';\nimport { useResizeObserver } from '@react-aria/utils';\n\nexport type SpecialFieldsType = {\n  time: FieldWithIndex;\n  body: FieldWithIndex;\n  extraFields: FieldWithIndex[];\n};\n\n// matches common ISO 8601\nconst iso8601Regex = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d{3,})?(?:Z|[-+]\\d{2}:?\\d{2})$/;\n\ninterface TableWrapProps {\n  urlColumns: string[];\n  urlTableBodyState?: LogLineState;\n  setUrlColumns: (columns: string[]) => void;\n  panelWrap: React.RefObject<HTMLDivElement | null>;\n  clearSelectedLine: () => void;\n  setUrlTableBodyState: (logLineState: LogLineState) => void;\n  showColumnManagementDrawer: (isActive: boolean) => void;\n  isColumnManagementActive: boolean;\n}\n\nconst getStyles = () => ({\n  section: css({\n    position: 'relative',\n  }),\n});\n\nexport const TableWrap = (props: TableWrapProps) => {\n  const { logsFrame } = useQueryContext();\n\n  const [panelWrapSize, setPanelWrapSize] = useState({ width: 0, height: 0 });\n\n  // Table needs to be positioned absolutely, passing in reference wrapping panelChrome from parent\n  useResizeObserver({\n    ref: props.panelWrap,\n    onResize: () => {\n      const element = props.panelWrap.current;\n      if (element) {\n        if (panelWrapSize.width !== element.clientWidth || panelWrapSize.height !== element.clientHeight) {\n          setPanelWrapSize({\n            width: element.clientWidth,\n            height: element.clientHeight,\n          });\n        }\n      }\n    },\n  });\n\n  const styles = getStyles();\n  const timeZone = getTimeZone();\n\n  // This function is called when we want to grab the column names that are currently stored in the URL.\n  // So instead we have to grab the current columns directly from the URL.\n  const getColumnsFromProps = useCallback(\n    (fieldNames: FieldNameMetaStore) => {\n      const previouslySelected = props.urlColumns;\n      if (previouslySelected?.length) {\n        Object.values(previouslySelected).forEach((key, index) => {\n          if (fieldNames[key]) {\n            fieldNames[key].active = true;\n            fieldNames[key].index = index;\n          }\n        });\n      }\n\n      return fieldNames;\n    },\n    [props.urlColumns]\n  );\n\n  // If the data frame is empty, there's nothing to viz, it could mean the user has unselected all columns\n  if (!logsFrame || !logsFrame.raw.length) {\n    return null;\n  }\n\n  const labels = logsFrame.getLogFrameLabelsAsLabels() ?? [];\n  const numberOfLogLines = logsFrame ? logsFrame.raw.length : 0;\n\n  // If we have labels and log lines\n  let pendingLabelState = mapLabelsToInitialState(logsFrame.raw, labels);\n  const specialFields = {\n    time: logsFrame.timeField,\n    body: logsFrame.bodyField,\n    extraFields: logsFrame.extraFields,\n  };\n\n  // Normalize the other fields\n  if (specialFields) {\n    addSpecialLabelsState(\n      [specialFields.time, specialFields.body, ...specialFields.extraFields],\n      pendingLabelState,\n      numberOfLogLines\n    );\n\n    pendingLabelState = getColumnsFromProps(pendingLabelState);\n\n    // Get all active columns\n    const active = Object.keys(pendingLabelState).filter((key) => pendingLabelState[key].active);\n\n    // If nothing is selected, then select the default columns\n    setSpecialFieldMeta(active, specialFields, pendingLabelState);\n  }\n\n  return (\n    <section className={styles.section}>\n      <TableColumnContextProvider\n        setUrlTableBodyState={props.setUrlTableBodyState}\n        logsFrame={logsFrame}\n        initialColumns={pendingLabelState}\n        setUrlColumns={props.setUrlColumns}\n        clearSelectedLine={props.clearSelectedLine}\n        urlTableBodyState={props.urlTableBodyState}\n        showColumnManagementDrawer={props.showColumnManagementDrawer}\n        isColumnManagementActive={props.isColumnManagementActive}\n      >\n        <Table\n          logsFrame={logsFrame}\n          timeZone={timeZone}\n          height={panelWrapSize.height - 50}\n          width={panelWrapSize.width - 25}\n          labels={labels}\n        />\n      </TableColumnContextProvider>\n    </section>\n  );\n};\n\nconst normalize = (value: number, total: number): number => {\n  return Math.ceil((100 * value) / total);\n};\n\ntype labelName = string;\ntype labelValue = string;\n\nexport function getCardinalityMapFromLabels(labels: Labels[]) {\n  const cardinalityMap = new Map<labelName, { valueSet: Set<labelValue>; maxLength: number }>();\n  labels.forEach((fieldLabels) => {\n    const labelNames = Object.keys(fieldLabels);\n    labelNames.forEach((labelName) => {\n      if (cardinalityMap.has(labelName)) {\n        const setObj = cardinalityMap.get(labelName);\n        const values = setObj?.valueSet;\n        const maxLength = setObj?.maxLength;\n\n        if (values && !values?.has(fieldLabels[labelName])) {\n          values?.add(fieldLabels[labelName]);\n          if (maxLength && fieldLabels[labelName].length > maxLength) {\n            cardinalityMap.set(labelName, { maxLength: fieldLabels[labelName].length, valueSet: values });\n          }\n        }\n      } else {\n        cardinalityMap.set(labelName, {\n          maxLength: fieldLabels[labelName].length,\n          valueSet: new Set([fieldLabels[labelName]]),\n        });\n      }\n    });\n  });\n\n  return cardinalityMap;\n}\n\n/**\n * Guess the field type of the value\n * @param value\n */\nexport function guessLogsFieldTypeForValue(value: string) {\n  let fieldType = guessFieldTypeFromValue(value);\n  const isISO8601 = fieldType === 'string' && iso8601Regex.test(value);\n  if (isISO8601) {\n    fieldType = FieldType.time;\n  }\n  return fieldType;\n}\n\nfunction mapLabelsToInitialState(dataFrame: DataFrame, labels: Labels[]) {\n  let pendingLabelState: FieldNameMetaStore = {};\n\n  // Use a map to dedupe labels and count their occurrences in the logs\n  const labelMap = new Map<string, FieldNameMeta>();\n  const cardinality = getCardinalityMapFromLabels(labels);\n  const numberOfLogLines = dataFrame ? dataFrame.length : 0;\n\n  if (labels?.length && numberOfLogLines) {\n    // Iterate through all of Labels\n    labels.forEach((labels: Labels) => {\n      const labelsArray = Object.keys(labels);\n      // Iterate through the label values\n      labelsArray.forEach((label) => {\n        const cardinalityMap = cardinality.get(label);\n        const cardinalityCount = cardinalityMap?.valueSet?.size ?? 0;\n        // If it's already in our map, increment the count\n        if (labelMap.has(label)) {\n          const value = labelMap.get(label);\n\n          if (value) {\n            if (value?.active) {\n              labelMap.set(label, {\n                percentOfLinesWithLabel: value.percentOfLinesWithLabel + 1,\n                active: true,\n                index: value.index,\n                cardinality: cardinalityCount,\n                maxLength: cardinalityMap?.maxLength,\n              });\n            } else {\n              labelMap.set(label, {\n                percentOfLinesWithLabel: value.percentOfLinesWithLabel + 1,\n                active: false,\n                index: undefined,\n                cardinality: cardinalityCount,\n                maxLength: cardinalityMap?.maxLength,\n              });\n            }\n          }\n          // Otherwise add it\n        } else {\n          labelMap.set(label, {\n            percentOfLinesWithLabel: 1,\n            active: false,\n            index: undefined,\n            cardinality: cardinalityCount,\n            maxLength: cardinalityMap?.maxLength,\n          });\n        }\n      });\n    });\n\n    // Converting the map to an object\n    pendingLabelState = Object.fromEntries(labelMap);\n\n    // Convert count to percent of log lines\n    Object.keys(pendingLabelState).forEach((key) => {\n      pendingLabelState[key].percentOfLinesWithLabel = normalize(\n        pendingLabelState[key].percentOfLinesWithLabel,\n        numberOfLogLines\n      );\n    });\n  }\n  return pendingLabelState;\n}\n\n/**\n * Add special fields like time and body\n * @param specialFieldArray\n * @param pendingLabelState\n * @param numberOfLogLines\n */\nfunction addSpecialLabelsState(\n  specialFieldArray: Array<FieldWithIndex | undefined>,\n  pendingLabelState: FieldNameMetaStore,\n  numberOfLogLines: number\n) {\n  specialFieldArray.forEach((field) => {\n    if (!field) {\n      return;\n    }\n    const isActive = pendingLabelState[field.name]?.active;\n    const index = pendingLabelState[field.name]?.index;\n    if (isActive && index !== undefined) {\n      pendingLabelState[field.name] = {\n        percentOfLinesWithLabel: normalize(\n          field.values.filter((value) => value !== null && value !== undefined).length,\n          numberOfLogLines\n        ),\n        active: true,\n        index: index,\n        cardinality: numberOfLogLines,\n      };\n    } else {\n      pendingLabelState[field.name] = {\n        percentOfLinesWithLabel: normalize(\n          field.values.filter((value) => value !== null && value !== undefined).length,\n          numberOfLogLines\n        ),\n        active: false,\n        index: undefined,\n        cardinality: numberOfLogLines,\n      };\n    }\n  });\n\n  return pendingLabelState;\n}\n\nfunction setSpecialFieldMeta(\n  active: string[],\n  specialFields: SpecialFieldsType,\n  pendingLabelState: FieldNameMetaStore\n) {\n  // If no fields are visible, set defaults\n  if (active.length === 0) {\n    if (specialFields.body?.name) {\n      pendingLabelState[specialFields.body?.name].active = true;\n      pendingLabelState[specialFields.body?.name].index = 1;\n    }\n    if (specialFields.time?.name) {\n      pendingLabelState[specialFields.time?.name].active = true;\n      pendingLabelState[specialFields.time?.name].index = 0;\n    }\n  }\n\n  if (specialFields.time?.name && specialFields.body?.name) {\n    pendingLabelState[specialFields.body?.name].type = 'BODY_FIELD';\n    pendingLabelState[specialFields.time?.name].type = 'TIME_FIELD';\n  }\n\n  if (specialFields.extraFields.length) {\n    specialFields.extraFields.forEach((field) => {\n      const hasLinks = field.config.links?.length;\n      if (hasLinks) {\n        pendingLabelState[field.name].type = 'LINK_FIELD';\n      }\n    });\n  }\n}\n","import React from 'react';\n\nimport { TableWrap } from 'Components/Table/TableWrap';\nimport { AdHocVariableFilter, DataFrame, TimeRange } from '@grafana/data';\nimport { QueryContextProvider } from 'Components/Table/Context/QueryContext';\nimport { parseLogsFrame } from '../../services/logsFrame';\nimport { SelectedTableRow } from './LogLineCellComponent';\nimport { LogLineState } from './Context/TableColumnsContext';\n\ninterface TableProviderProps {\n  dataFrame: DataFrame;\n  setUrlColumns: (columns: string[]) => void;\n  urlColumns: string[];\n  addFilter: (filter: AdHocVariableFilter) => void;\n  selectedLine?: SelectedTableRow;\n  timeRange?: TimeRange;\n  panelWrap: React.RefObject<HTMLDivElement | null>;\n  clearSelectedLine: () => void;\n  setUrlTableBodyState: (logLineState: LogLineState) => void;\n  urlTableBodyState?: LogLineState;\n  showColumnManagementDrawer: (isActive: boolean) => void;\n  isColumnManagementActive: boolean;\n}\n\nexport const TableProvider = ({\n  dataFrame,\n  setUrlColumns,\n  urlColumns,\n  addFilter,\n  selectedLine,\n  timeRange,\n  panelWrap,\n  clearSelectedLine,\n  setUrlTableBodyState,\n  urlTableBodyState,\n  showColumnManagementDrawer,\n  isColumnManagementActive,\n}: TableProviderProps) => {\n  if (!dataFrame) {\n    return null;\n  }\n\n  const logsFrame = parseLogsFrame(dataFrame);\n  if (!logsFrame) {\n    return null;\n  }\n\n  return (\n    <QueryContextProvider addFilter={addFilter} selectedLine={selectedLine} timeRange={timeRange} logsFrame={logsFrame}>\n      <TableWrap\n        urlTableBodyState={urlTableBodyState}\n        setUrlColumns={setUrlColumns}\n        setUrlTableBodyState={setUrlTableBodyState}\n        urlColumns={urlColumns}\n        panelWrap={panelWrap}\n        clearSelectedLine={clearSelectedLine}\n        showColumnManagementDrawer={showColumnManagementDrawer}\n        isColumnManagementActive={isColumnManagementActive}\n      />\n    </QueryContextProvider>\n  );\n};\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { LogsListScene } from './LogsListScene';\nimport { AdHocVariableFilter, GrafanaTheme2 } from '@grafana/data';\nimport { TableProvider } from '../Table/TableProvider';\nimport React, { useRef } from 'react';\nimport { Button, PanelChrome, useStyles2 } from '@grafana/ui';\nimport { LogsPanelHeaderActions } from '../Table/LogsHeaderActions';\nimport { css } from '@emotion/css';\nimport { addAdHocFilter } from './Breakdowns/AddToFiltersButton';\nimport { areArraysStrictlyEqual } from '../../services/comparison';\nimport { getLogsPanelFrame } from './ServiceScene';\nimport { getVariableForLabel } from '../../services/fields';\nimport { PanelMenu } from '../Panels/PanelMenu';\nimport { LogLineState } from '../Table/Context/TableColumnsContext';\n\ninterface LogsTableSceneState extends SceneObjectState {\n  menu?: PanelMenu;\n  isColumnManagementActive: boolean;\n}\nexport class LogsTableScene extends SceneObjectBase<LogsTableSceneState> {\n  constructor(state: Partial<LogsTableSceneState>) {\n    super({ ...state, isColumnManagementActive: false });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public showColumnManagementDrawer = (isActive: boolean) => {\n    this.setState({\n      isColumnManagementActive: isActive,\n    });\n  };\n\n  public onActivate() {\n    this.setState({\n      menu: new PanelMenu({ addInvestigationsLink: false }),\n    });\n  }\n  public static Component = ({ model }: SceneComponentProps<LogsTableScene>) => {\n    const styles = useStyles2(getStyles);\n    // Get state from parent model\n    const parentModel = sceneGraph.getAncestor(model, LogsListScene);\n    const { data } = sceneGraph.getData(model).useState();\n    const { selectedLine, urlColumns, visualizationType, tableLogLineState } = parentModel.useState();\n    const { menu, isColumnManagementActive } = model.useState();\n\n    // Get time range\n    const timeRange = sceneGraph.getTimeRange(model);\n    const { value: timeRangeValue } = timeRange.useState();\n\n    const dataFrame = getLogsPanelFrame(data);\n\n    // Define callback function to update filters in react\n    const addFilter = (filter: AdHocVariableFilter) => {\n      const variableType = getVariableForLabel(dataFrame, filter.key, model);\n      addAdHocFilter(filter, parentModel, variableType);\n    };\n\n    // Get reference to panel wrapper so table knows how much space it can use to render\n    const panelWrap = useRef<HTMLDivElement>(null);\n\n    // Define callback function to update url columns in react\n    const setUrlColumns = (urlColumns: string[]) => {\n      if (!areArraysStrictlyEqual(urlColumns, parentModel.state.urlColumns)) {\n        parentModel.setState({ urlColumns });\n      }\n    };\n\n    const setUrlTableBodyState = (logLineState: LogLineState) => {\n      parentModel.setState({ tableLogLineState: logLineState });\n    };\n\n    const clearSelectedLine = () => {\n      if (parentModel.state.selectedLine) {\n        parentModel.clearSelectedLine();\n      }\n    };\n\n    return (\n      <div className={styles.panelWrapper} ref={panelWrap}>\n        <PanelChrome\n          loadingState={data?.state}\n          title={'Logs'}\n          menu={menu ? <menu.Component model={menu} /> : undefined}\n          actions={\n            <>\n              <Button onClick={() => model.showColumnManagementDrawer(true)} variant={'secondary'} size={'sm'}>\n                Manage columns\n              </Button>\n              <LogsPanelHeaderActions vizType={visualizationType} onChange={parentModel.setVisualizationType} />\n            </>\n          }\n        >\n          {dataFrame && (\n            <TableProvider\n              panelWrap={panelWrap}\n              addFilter={addFilter}\n              timeRange={timeRangeValue}\n              selectedLine={selectedLine}\n              urlColumns={urlColumns ?? []}\n              setUrlColumns={setUrlColumns}\n              dataFrame={dataFrame}\n              clearSelectedLine={clearSelectedLine}\n              setUrlTableBodyState={setUrlTableBodyState}\n              urlTableBodyState={tableLogLineState}\n              showColumnManagementDrawer={model.showColumnManagementDrawer}\n              isColumnManagementActive={isColumnManagementActive}\n            />\n          )}\n        </PanelChrome>\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  panelWrapper: css({\n    width: '100%',\n    height: '100%',\n    label: 'panel-wrapper-table',\n\n    // @todo remove this wrapper and styles when core changes are introduced in 11.5\n    // Need more specificity to override core style\n    'button.show-on-hover': {\n      opacity: 1,\n      visibility: 'visible',\n      background: 'none',\n      '&:hover': {\n        background: theme.colors.secondary.shade,\n      },\n    },\n  }),\n});\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport debounce from 'lodash/debounce';\nimport { ChangeEvent, KeyboardEvent, useState } from 'react';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getLineFiltersVariable, getLineFilterVariable } from '../../../services/variableGetters';\nimport {\n  getLineFilterCase,\n  getLineFilterExclusive,\n  getLineFilterRegex,\n  setLineFilterCase,\n  setLineFilterExclusive,\n  setLineFilterRegex,\n} from '../../../services/store';\nimport { RegexInputValue } from './RegexIconButton';\nimport { LineFilterCaseSensitive, LineFilterOp } from '../../../services/filterTypes';\nimport { LineFilterEditor } from './LineFilterEditor';\nimport { addCurrentUrlToHistory } from '../../../services/navigate';\n\ninterface LineFilterState extends SceneObjectState {\n  lineFilter: string;\n  caseSensitive: boolean;\n  regex: boolean;\n  exclusive: boolean;\n}\n\n/**\n * The line filter scene used in the logs tab\n */\nexport class LineFilterScene extends SceneObjectBase<LineFilterState> {\n  static Component = LineFilterComponent;\n\n  /**\n   * Sets default regex/sensitivity/exclusivity state from local storage\n   */\n  constructor(state?: Partial<LineFilterState>) {\n    super({\n      lineFilter: state?.lineFilter || '',\n      caseSensitive: state?.caseSensitive ?? getLineFilterCase(false),\n      regex: state?.regex ?? getLineFilterRegex(false),\n      exclusive: state?.exclusive ?? getLineFilterExclusive(false),\n      ...state,\n    });\n    this.addActivationHandler(this.onActivate);\n  }\n\n  /**\n   * Set initial state on activation\n   */\n  private onActivate = () => {\n    const filter = this.getFilter();\n\n    if (!filter) {\n      return;\n    }\n\n    this.setState({\n      lineFilter: filter.value,\n      regex: filter.operator === LineFilterOp.regex || filter.operator === LineFilterOp.negativeRegex,\n      caseSensitive: filter.key === LineFilterCaseSensitive.caseSensitive,\n      exclusive: filter.operator === LineFilterOp.negativeMatch || filter.operator === LineFilterOp.negativeRegex,\n    });\n\n    return () => {\n      // This won't clear the variable as the URL won't have time to sync, but it does prevent changes to the variable that haven't yet been synced with this scene state\n      this.clearFilter();\n    };\n  };\n\n  /**\n   * Clear filter variable\n   */\n  private clearVariable() {\n    const variable = getLineFilterVariable(this);\n    variable.updateFilters([], {\n      skipPublish: true,\n    });\n    this.setState({\n      lineFilter: '',\n    });\n  }\n  /**\n   * Returns operator from current state\n   */\n  private getOperator(): LineFilterOp {\n    if (this.state.regex && this.state.exclusive) {\n      return LineFilterOp.negativeRegex;\n    }\n    if (this.state.regex && !this.state.exclusive) {\n      return LineFilterOp.regex;\n    }\n    if (!this.state.regex && this.state.exclusive) {\n      return LineFilterOp.negativeMatch;\n    }\n    if (!this.state.regex && !this.state.exclusive) {\n      return LineFilterOp.match;\n    }\n\n    throw new Error('getOperator: failed to determine operation');\n  }\n\n  /**\n   * Since there is no \"key\" for line-filters in logQL that will map to the key of the ad-hoc filter, we currently use the key to store the case sensitivity state\n   * Note: This is technically a non-standard implementation (hack) of the ad-hoc variable, we should look into adding metadata to the ad-hoc variables in scenes\n   * However the behavior of the ad-hoc variable lines up well with our use-case, we want case sensitivity state to be saved in the URL and to trigger query updates.\n   * Since we use a custom renderer, this should be fine, but a source of tech-debt nonetheless.\n   */\n  private getFilterKey() {\n    return this.state.caseSensitive ? LineFilterCaseSensitive.caseSensitive : LineFilterCaseSensitive.caseInsensitive;\n  }\n\n  /**\n   * Returns the current ad-hoc variable filter\n   */\n  private getFilter() {\n    const lineFilterVariable = getLineFilterVariable(this);\n    return lineFilterVariable.state.filters[0];\n  }\n\n  /**\n   * Clears filter input and clears debounce queue\n   */\n  clearFilter = () => {\n    this.updateVariableDebounced.cancel();\n    this.updateFilter('', false);\n  };\n\n  /**\n   * Updates line filter state\n   * Note: Updating/debouncing the queries onChange was removed to prevent people from accidentally hammering loki while writing line filters (particularly regex)\n   * The code has been left in for now as we discussed adding an \"edit\" mode with a dedicated logs panel with a smaller line limit to let users debug the results as they type\n   */\n  updateFilter(lineFilter: string, debounced = true) {\n    this.updateInputState(lineFilter);\n    if (debounced) {\n      this.updateVariableDebounced(lineFilter);\n    } else {\n      this.updateVariable(lineFilter);\n    }\n  }\n\n  updateInputState(lineFilter: string) {\n    this.setState({\n      lineFilter,\n    });\n  }\n\n  /**\n   * Update exclusive state, triggers re-query without debounce\n   */\n  onToggleExclusive = (exclusive: boolean) => {\n    setLineFilterExclusive(exclusive);\n    this.setState({\n      exclusive,\n    });\n\n    this.updateFilter(this.state.lineFilter, false);\n  };\n\n  /**\n   * Moves the filter to the \"global\" line-filter ad-hoc variable after flushing the debounce queue.\n   * Clears the state of the local ad-hoc variable.\n   */\n  onSubmitLineFilter = () => {\n    addCurrentUrlToHistory();\n    this.updateFilter(this.state.lineFilter, false);\n    // Flush any debounced updates before grabbing the filter. Important that this happens before getFilter is called!\n    this.updateVariableDebounced.flush();\n\n    const lineFiltersVariable = getLineFiltersVariable(this);\n    const existingFilters = lineFiltersVariable.state.filters;\n    const thisFilter = this.getFilter();\n\n    lineFiltersVariable.updateFilters([...existingFilters, thisFilter]);\n    this.clearVariable();\n  };\n\n  /**\n   * Passes the input value to the updateFilter method\n   */\n  handleChange = (e: ChangeEvent<HTMLInputElement>) => {\n    this.updateInputState(e.target.value);\n  };\n\n  /**\n   * Submits on enter\n   */\n  handleEnter = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter' && this.state.lineFilter) {\n      this.onSubmitLineFilter();\n    }\n  };\n\n  /**\n   * Sets local state and triggers query on case sensitivity toggle\n   */\n  onCaseSensitiveToggle = (newState: LineFilterCaseSensitive) => {\n    const caseSensitive = newState === LineFilterCaseSensitive.caseSensitive;\n\n    // Set value to scene state\n    this.setState({\n      caseSensitive,\n    });\n\n    // Set value in local storage\n    setLineFilterCase(caseSensitive);\n\n    this.updateFilter(this.state.lineFilter, false);\n  };\n\n  /**\n   * Sets local state and triggers query on regex toggle\n   */\n  onRegexToggle = (newState: RegexInputValue) => {\n    const regex = newState === 'regex';\n\n    // Set value to scene state\n    this.setState({\n      regex,\n    });\n\n    // Set value in local storage\n    setLineFilterRegex(regex);\n\n    this.updateFilter(this.state.lineFilter, false);\n  };\n\n  /**\n   * Instance variable reference to debounced update method\n   */\n  updateVariableDebounced = debounce((search: string) => {\n    this.updateVariable(search);\n  }, 1000);\n\n  /**\n   * Updates the ad-hoc variable from local state and triggers a query.\n   * Sends analytics event.\n   */\n  updateVariable = (search: string) => {\n    this.updateVariableDebounced.flush();\n    const variable = getLineFilterVariable(this);\n    const variables = getLineFiltersVariable(this);\n    const filter = {\n      key: this.getFilterKey(),\n      // The keyLabel is used to sort line filters by order added.\n      keyLabel: variables.state.filters.length.toString(),\n      operator: this.getOperator(),\n      value: search,\n    };\n\n    variable.updateFilters([filter]);\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.search_string_in_logs_changed,\n      {\n        searchQueryLength: search.length,\n        containsLevel: search.toLowerCase().includes('level'),\n        operator: filter.operator,\n        caseSensitive: filter.key,\n      }\n    );\n  };\n}\n\nfunction LineFilterComponent({ model }: SceneComponentProps<LineFilterScene>) {\n  const { lineFilter, caseSensitive, regex, exclusive } = model.useState();\n  const [focus, setFocus] = useState(false);\n  return LineFilterEditor({\n    exclusive,\n    lineFilter,\n    caseSensitive,\n    regex,\n    onSubmitLineFilter: model.onSubmitLineFilter,\n    handleEnter: model.handleEnter,\n    onInputChange: model.handleChange,\n    updateFilter: model.updateFilter,\n    onCaseSensitiveToggle: model.onCaseSensitiveToggle,\n    onRegexToggle: model.onRegexToggle,\n    setExclusive: model.onToggleExclusive,\n    onClearLineFilter: model.clearFilter,\n    focus,\n    setFocus,\n    type: 'editor',\n  });\n}\n","import React from 'react';\n\nimport {\n  SceneComponentProps,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneTimeRangeLike,\n} from '@grafana/scenes';\nimport { SelectedTableRow } from '../Table/LogLineCellComponent';\nimport { LogsTableScene } from './LogsTableScene';\nimport { css } from '@emotion/css';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { locationService } from '@grafana/runtime';\nimport { LogsPanelScene } from './LogsPanelScene';\nimport {\n  getDisplayedFields,\n  getLogsVisualizationType,\n  LogsVisualizationType,\n  setLogsVisualizationType,\n} from 'services/store';\nimport { logger } from '../../services/logger';\nimport { Options } from '@grafana/schema/dist/esm/raw/composable/logs/panelcfg/x/LogsPanelCfg_types.gen';\nimport { narrowLogsVisualizationType, narrowSelectedTableRow, unknownToStrings } from '../../services/narrowing';\nimport { LogLineState } from '../Table/Context/TableColumnsContext';\nimport { LineFilterScene } from './LineFilter/LineFilterScene';\n\nexport interface LogsListSceneState extends SceneObjectState {\n  loading?: boolean;\n  panel?: SceneFlexLayout;\n  visualizationType: LogsVisualizationType;\n  urlColumns?: string[];\n  tableLogLineState?: LogLineState;\n  selectedLine?: SelectedTableRow;\n  $timeRange?: SceneTimeRangeLike;\n  displayedFields: string[];\n  lineFilter?: string;\n}\n\nexport class LogsListScene extends SceneObjectBase<LogsListSceneState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: ['urlColumns', 'selectedLine', 'visualizationType', 'displayedFields', 'tableLogLineState'],\n  });\n  private logsPanelScene?: LogsPanelScene = undefined;\n  constructor(state: Partial<LogsListSceneState>) {\n    super({\n      ...state,\n      visualizationType: getLogsVisualizationType(),\n      displayedFields: [],\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  getUrlState() {\n    const urlColumns = this.state.urlColumns ?? [];\n    const selectedLine = this.state.selectedLine;\n    const visualizationType = this.state.visualizationType;\n    const displayedFields = this.state.displayedFields ?? getDisplayedFields(this) ?? [];\n    return {\n      urlColumns: JSON.stringify(urlColumns),\n      selectedLine: JSON.stringify(selectedLine),\n      visualizationType: JSON.stringify(visualizationType),\n      displayedFields: JSON.stringify(displayedFields),\n      tableLogLineState: JSON.stringify(this.state.tableLogLineState),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<LogsListSceneState> = {};\n    try {\n      if (typeof values.urlColumns === 'string') {\n        const decodedUrlColumns: string[] = unknownToStrings(JSON.parse(values.urlColumns));\n        if (decodedUrlColumns !== this.state.urlColumns) {\n          stateUpdate.urlColumns = decodedUrlColumns;\n        }\n      }\n      if (typeof values.selectedLine === 'string') {\n        const unknownTableRow = narrowSelectedTableRow(JSON.parse(values.selectedLine));\n        if (unknownTableRow) {\n          const decodedSelectedTableRow: SelectedTableRow = unknownTableRow;\n          if (decodedSelectedTableRow !== this.state.selectedLine) {\n            stateUpdate.selectedLine = decodedSelectedTableRow;\n          }\n        }\n      }\n      if (typeof values.visualizationType === 'string') {\n        const decodedVisualizationType = narrowLogsVisualizationType(JSON.parse(values.visualizationType));\n        if (decodedVisualizationType && decodedVisualizationType !== this.state.visualizationType) {\n          stateUpdate.visualizationType = decodedVisualizationType;\n        }\n      }\n      if (typeof values.displayedFields === 'string') {\n        const displayedFields = unknownToStrings(JSON.parse(values.displayedFields));\n        if (displayedFields && displayedFields.length) {\n          stateUpdate.displayedFields = displayedFields;\n        }\n      }\n      if (typeof values.tableLogLineState === 'string') {\n        const tableLogLineState = JSON.parse(values.tableLogLineState);\n        if (tableLogLineState === LogLineState.labels || tableLogLineState === LogLineState.text) {\n          stateUpdate.tableLogLineState = tableLogLineState;\n        }\n      }\n    } catch (e) {\n      // URL Params can be manually changed and it will make JSON.parse() fail.\n      logger.error(e, { msg: 'LogsListScene: updateFromUrl unexpected error' });\n    }\n\n    if (Object.keys(stateUpdate).length) {\n      this.setState(stateUpdate);\n    }\n  }\n\n  clearSelectedLine() {\n    this.setState({\n      selectedLine: undefined,\n    });\n  }\n\n  clearDisplayedFields = () => {\n    this.setState({ displayedFields: [] });\n    if (this.logsPanelScene) {\n      this.logsPanelScene.clearDisplayedFields();\n    }\n  };\n\n  public onActivate() {\n    const searchParams = new URLSearchParams(locationService.getLocation().search);\n    this.setStateFromUrl(searchParams);\n\n    if (!this.state.panel) {\n      this.updateLogsPanel();\n    }\n\n    this._subs.add(\n      this.subscribeToState((newState, prevState) => {\n        if (newState.visualizationType !== prevState.visualizationType) {\n          this.updateLogsPanel();\n        }\n      })\n    );\n  }\n\n  private setStateFromUrl(searchParams: URLSearchParams) {\n    const selectedLineUrl = searchParams.get('selectedLine');\n    const urlColumnsUrl = searchParams.get('urlColumns');\n    const vizTypeUrl = searchParams.get('visualizationType');\n    const displayedFieldsUrl = searchParams.get('displayedFields') ?? JSON.stringify(getDisplayedFields(this));\n    const tableLogLineState = searchParams.get('tableLogLineState');\n\n    this.updateFromUrl({\n      selectedLine: selectedLineUrl,\n      urlColumns: urlColumnsUrl,\n      vizType: vizTypeUrl,\n      displayedFields: displayedFieldsUrl,\n      tableLogLineState,\n    });\n  }\n\n  public setLogsVizOption = (options: Partial<Options> = {}) => {\n    if (this.logsPanelScene) {\n      this.logsPanelScene.setLogsVizOption(options);\n    }\n  };\n\n  public updateLogsPanel = () => {\n    this.setState({\n      panel: this.getVizPanel(),\n    });\n\n    // Subscribe to line filter state so we can pass the current filter between different viz\n    if (this.state.panel) {\n      const lineFilterScenes = sceneGraph.findDescendents(this.state.panel, LineFilterScene);\n      if (lineFilterScenes.length) {\n        const lineFilterScene = lineFilterScenes[0];\n        this._subs.add(\n          lineFilterScene.subscribeToState((newState, prevState) => {\n            if (newState.lineFilter !== prevState.lineFilter) {\n              this.setState({\n                lineFilter: newState.lineFilter,\n              });\n            }\n          })\n        );\n      }\n    }\n  };\n\n  public setVisualizationType = (type: LogsVisualizationType) => {\n    this.setState({\n      visualizationType: type,\n    });\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.logs_visualization_toggle,\n      {\n        visualisationType: type,\n      }\n    );\n    setLogsVisualizationType(type);\n  };\n\n  private getVizPanel() {\n    this.logsPanelScene = new LogsPanelScene({});\n\n    return new SceneFlexLayout({\n      direction: 'column',\n      children:\n        this.state.visualizationType === 'logs'\n          ? [\n              new SceneFlexLayout({\n                children: [\n                  new SceneFlexItem({\n                    body: new LineFilterScene({ lineFilter: this.state.lineFilter }),\n                    xSizing: 'fill',\n                  }),\n                ],\n              }),\n              new SceneFlexItem({\n                height: 'calc(100vh - 220px)',\n                body: this.logsPanelScene,\n              }),\n            ]\n          : [\n              new SceneFlexItem({\n                body: new LineFilterScene({ lineFilter: this.state.lineFilter }),\n                xSizing: 'fill',\n              }),\n              new SceneFlexItem({\n                height: 'calc(100vh - 220px)',\n                body: new LogsTableScene({}),\n              }),\n            ],\n    });\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LogsListScene>) => {\n    const { panel } = model.useState();\n\n    if (!panel) {\n      return;\n    }\n\n    return (\n      <div className={styles.panelWrapper}>\n        <panel.Component model={panel} />\n      </div>\n    );\n  };\n}\n\nconst styles = {\n  panelWrapper: css({\n    // Hack to select internal div\n    'section > div[class$=\"panel-content\"]': css({\n      // A components withing the Logs viz sets contain, which creates a new containing block that is not body which breaks the popover menu\n      contain: 'none',\n      // Prevent overflow from spilling out of parent container\n      overflow: 'auto',\n    }),\n  }),\n};\n","import { LogRowModel } from '@grafana/data';\nimport { IconButton } from '@grafana/ui';\nimport React, { MouseEvent, useCallback, useEffect, useState } from 'react';\n\ninterface Props {\n  onClick(event: MouseEvent<HTMLElement>, row?: LogRowModel): void;\n}\n\nexport const CopyLinkButton = ({ onClick }: Props) => {\n  const [copied, setCopied] = useState(false);\n\n  useEffect(() => {\n    let timeoutId: ReturnType<typeof setTimeout>;\n\n    if (copied) {\n      timeoutId = setTimeout(() => {\n        setCopied(false);\n      }, 2000);\n    }\n\n    return () => {\n      clearTimeout(timeoutId);\n    };\n  }, [copied]);\n\n  const handleClick = useCallback(\n    (event: MouseEvent<HTMLElement>, row?: LogRowModel) => {\n      onClick(event, row);\n      setCopied(true);\n    },\n    [onClick]\n  );\n\n  return (\n    <IconButton\n      aria-label={copied ? 'Copied' : 'Copy link to log line'}\n      tooltip={copied ? 'Copied' : 'Copy link to log line'}\n      tooltipPlacement=\"top\"\n      variant={copied ? 'primary' : 'secondary'}\n      size=\"md\"\n      name={copied ? 'check' : 'share-alt'}\n      onClick={handleClick}\n    />\n  );\n};\n","import React from 'react';\nimport { GrotError } from 'Components/GrotError';\nimport { Button } from '@grafana/ui';\n\ninterface Props {\n  clearFilters(): void;\n  error: string;\n}\n\nexport const LogsPanelError = ({ clearFilters, error }: Props) => {\n  return (\n    <GrotError>\n      <div>\n        <p>{error}</p>\n        <Button variant=\"secondary\" onClick={clearFilters}>\n          Clear filters\n        </Button>\n      </div>\n    </GrotError>\n  );\n};\n","import {\n  AdHocFiltersVariable,\n  PanelBuilders,\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneQueryRunner,\n  VizPanel,\n} from '@grafana/scenes';\nimport { DataFrame, getValueFormat, LoadingState, LogRowModel, PanelData } from '@grafana/data';\nimport { getLogOption, getLogsVolumeOption, setDisplayedFields } from '../../services/store';\nimport React, { MouseEvent } from 'react';\nimport { LogsListScene } from './LogsListScene';\nimport { LoadingPlaceholder, useStyles2 } from '@grafana/ui';\nimport { addToFilters, FilterType } from './Breakdowns/AddToFiltersButton';\nimport { getVariableForLabel } from '../../services/fields';\nimport { VAR_FIELDS, VAR_LABELS, VAR_LEVELS, VAR_METADATA } from '../../services/variables';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport {\n  getAdHocFiltersVariable,\n  getLineFiltersVariable,\n  getValueFromFieldsFilter,\n} from '../../services/variableGetters';\nimport { copyText, generateLogShortlink, resolveRowTimeRangeForSharing } from 'services/text';\nimport { CopyLinkButton } from './CopyLinkButton';\nimport { getLogsPanelSortOrderFromStore, LogOptionsScene } from './LogOptionsScene';\nimport { LogsVolumePanel, logsVolumePanelKey } from './LogsVolumePanel';\nimport { getPanelWrapperStyles, PanelMenu } from '../Panels/PanelMenu';\nimport { ServiceScene } from './ServiceScene';\nimport { LineFilterCaseSensitive, LineFilterOp } from '../../services/filterTypes';\nimport { Options } from '@grafana/schema/dist/esm/raw/composable/logs/panelcfg/x/LogsPanelCfg_types.gen';\nimport { locationService } from '@grafana/runtime';\nimport { narrowLogsSortOrder } from '../../services/narrowing';\nimport { logger } from '../../services/logger';\nimport { LogsSortOrder } from '@grafana/schema';\nimport { getPrettyQueryExpr } from 'services/scenes';\nimport { LogsPanelError } from './LogsPanelError';\nimport { clearVariables } from 'services/variableHelpers';\nimport { isEmptyLogsResult } from 'services/logsFrame';\n\ninterface LogsPanelSceneState extends SceneObjectState {\n  body?: VizPanel<Options>;\n  error?: string;\n  logsVolumeCollapsedByError?: boolean;\n  sortOrder?: LogsSortOrder;\n  wrapLogMessage?: boolean;\n}\n\nexport class LogsPanelScene extends SceneObjectBase<LogsPanelSceneState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: ['sortOrder', 'wrapLogMessage'],\n  });\n\n  constructor(state: Partial<LogsPanelSceneState>) {\n    super({\n      sortOrder: getLogsPanelSortOrderFromStore(),\n      wrapLogMessage: Boolean(getLogOption<boolean>('wrapLogMessage', false)),\n      error: undefined,\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private setStateFromUrl() {\n    const searchParams = new URLSearchParams(locationService.getLocation().search);\n\n    this.updateFromUrl({\n      sortOrder: searchParams.get('sortOrder'),\n      wrapLogMessage: searchParams.get('wrapLogMessage'),\n    });\n  }\n\n  getUrlState() {\n    return {\n      sortOrder: JSON.stringify(this.state.sortOrder),\n      wrapLogMessage: JSON.stringify(this.state.wrapLogMessage),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<LogsPanelSceneState> = {};\n    try {\n      if (typeof values.sortOrder === 'string' && values.sortOrder) {\n        const decodedSortOrder = narrowLogsSortOrder(JSON.parse(values.sortOrder));\n        if (decodedSortOrder) {\n          stateUpdate.sortOrder = decodedSortOrder;\n          this.setLogsVizOption({ sortOrder: decodedSortOrder });\n        }\n      }\n\n      if (typeof values.wrapLogMessage === 'string' && values.wrapLogMessage) {\n        const decodedWrapLogMessage = JSON.parse(values.wrapLogMessage);\n        if (typeof decodedWrapLogMessage === 'boolean') {\n          stateUpdate.wrapLogMessage = decodedWrapLogMessage;\n          this.setLogsVizOption({ wrapLogMessage: decodedWrapLogMessage });\n          this.setLogsVizOption({ prettifyLogMessage: decodedWrapLogMessage });\n        }\n      }\n    } catch (e) {\n      // URL Params can be manually changed and it will make JSON.parse() fail.\n      logger.error(e, { msg: 'LogOptionsScene: updateFromUrl unexpected error' });\n    }\n\n    if (Object.keys(stateUpdate).length) {\n      this.setState({ ...stateUpdate });\n    }\n  }\n\n  public onActivate() {\n    // Need viz to set options, but setting options will trigger query\n    this.setStateFromUrl();\n\n    if (!this.state.body) {\n      this.setState({\n        body: this.getLogsPanel({\n          wrapLogMessage: this.state.wrapLogMessage,\n          prettifyLogMessage: this.state.wrapLogMessage,\n          sortOrder: this.state.sortOrder,\n        }),\n      });\n    }\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    this._subs.add(\n      serviceScene.subscribeToState((newState, prevState) => {\n        if (newState.$data?.state.data?.state === LoadingState.Error) {\n          this.handleLogsError(newState.$data?.state.data);\n        } else if (\n          newState.$data?.state.data?.state === LoadingState.Done &&\n          isEmptyLogsResult(newState.$data?.state.data.series)\n        ) {\n          this.handleNoData();\n        } else if (this.state.error) {\n          this.clearLogsError();\n        }\n        if (newState.logsCount !== prevState.logsCount) {\n          if (!this.state.body) {\n            this.setState({\n              body: this.getLogsPanel({\n                wrapLogMessage: this.state.wrapLogMessage,\n                prettifyLogMessage: this.state.wrapLogMessage,\n                sortOrder: this.state.sortOrder,\n              }),\n            });\n          } else {\n            this.state.body.setState({\n              title: this.getTitle(newState.logsCount),\n            });\n          }\n        }\n      })\n    );\n  }\n\n  handleLogsError(data: PanelData) {\n    const error = data.errors?.length ? data.errors[0] : data.error;\n    const errorResponse = error?.message;\n    if (errorResponse) {\n      logger.error(new Error('Logs Panel error'), {\n        msg: errorResponse,\n        status: error.statusText ?? 'N/A',\n        type: error.type ?? 'N/A',\n      });\n    }\n\n    let errorMessage = 'Unexpected error response. Please review your filters or try a different time range.';\n    if (errorResponse?.includes('parse error')) {\n      errorMessage =\n        'Logs could not be retrieved due to invalid filter parameters. Please review your filters and try again.';\n    } else if (errorResponse?.includes('response larger than the max message size')) {\n      errorMessage =\n        'The response is too large to process. Try narrowing your search or using filters to reduce the data size.';\n    }\n\n    this.showLogsError(errorMessage);\n  }\n\n  handleNoData() {\n    this.showLogsError('No logs match your search. Please review your filters or try a different time range.');\n  }\n\n  showLogsError(error: string) {\n    const logsVolumeCollapsedByError = this.state.logsVolumeCollapsedByError ?? !getLogsVolumeOption('collapsed');\n\n    this.setState({ error, logsVolumeCollapsedByError });\n\n    if (logsVolumeCollapsedByError) {\n      const logsVolume = sceneGraph.findByKeyAndType(this, logsVolumePanelKey, LogsVolumePanel);\n      logsVolume.state.panel?.setState({ collapsed: true });\n    }\n  }\n\n  clearLogsError() {\n    if (this.state.logsVolumeCollapsedByError) {\n      const logsVolume = sceneGraph.findByKeyAndType(this, logsVolumePanelKey, LogsVolumePanel);\n      logsVolume.state.panel?.setState({ collapsed: false });\n    }\n\n    this.setState({ error: undefined, logsVolumeCollapsedByError: undefined });\n  }\n\n  onClickShowField = (field: string) => {\n    const parent = this.getParentScene();\n    const index = parent.state.displayedFields.indexOf(field);\n\n    if (index === -1 && this.state.body) {\n      const displayedFields = [...parent.state.displayedFields, field];\n      this.setLogsVizOption({\n        displayedFields,\n      });\n      parent.setState({ displayedFields });\n      setDisplayedFields(this, parent.state.displayedFields);\n\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.logs_toggle_displayed_field\n      );\n    }\n  };\n\n  onClickHideField = (field: string) => {\n    const parent = this.getParentScene();\n    const index = parent.state.displayedFields.indexOf(field);\n\n    if (index >= 0 && this.state.body) {\n      const displayedFields = parent.state.displayedFields.filter((displayedField) => field !== displayedField);\n      this.setLogsVizOption({\n        displayedFields,\n      });\n      parent.setState({ displayedFields });\n      setDisplayedFields(this, parent.state.displayedFields);\n\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.logs_toggle_displayed_field\n      );\n    }\n  };\n\n  setLogsVizOption(options: Partial<Options> = {}) {\n    if (!this.state.body) {\n      return;\n    }\n    if ('sortOrder' in options && options.sortOrder !== this.state.body.state.options.sortOrder) {\n      const $data = sceneGraph.getData(this);\n      const queryRunner =\n        $data instanceof SceneQueryRunner ? $data : sceneGraph.findDescendents($data, SceneQueryRunner)[0];\n      if (queryRunner) {\n        queryRunner.runQueries();\n      }\n    }\n    this.state.body.onOptionsChange(options);\n  }\n\n  clearDisplayedFields = () => {\n    if (!this.state.body) {\n      return;\n    }\n    this.setLogsVizOption({\n      displayedFields: [],\n    });\n    setDisplayedFields(this, []);\n  };\n\n  private getParentScene() {\n    return sceneGraph.getAncestor(this, LogsListScene);\n  }\n\n  private getTitle(logsCount: number | undefined) {\n    const valueFormatter = getValueFormat('short');\n    const formattedCount = logsCount !== undefined ? valueFormatter(logsCount, 0) : undefined;\n    return formattedCount !== undefined ? `Logs (${formattedCount.text}${formattedCount.suffix?.trim()})` : 'Logs';\n  }\n\n  private getLogsPanel(options: Partial<Options>) {\n    const parentModel = this.getParentScene();\n    const visualizationType = parentModel.state.visualizationType;\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    return (\n      PanelBuilders.logs()\n        .setTitle(this.getTitle(serviceScene.state.logsCount))\n        .setOption('showTime', true)\n        .setOption('onClickFilterLabel', this.handleLabelFilterClick)\n        .setOption('onClickFilterOutLabel', this.handleLabelFilterOutClick)\n        .setOption('isFilterLabelActive', this.handleIsFilterLabelActive)\n        .setOption('onClickFilterString', this.handleFilterStringClick)\n        .setOption('onClickFilterOutString', this.handleFilterOutStringClick)\n        .setOption('onClickShowField', this.onClickShowField)\n        .setOption('onClickHideField', this.onClickHideField)\n        .setOption('displayedFields', parentModel.state.displayedFields)\n        .setOption('sortOrder', options.sortOrder ?? getLogsPanelSortOrderFromStore())\n        .setOption('wrapLogMessage', options.wrapLogMessage ?? Boolean(getLogOption<boolean>('wrapLogMessage', false)))\n        .setOption(\n          'prettifyLogMessage',\n          options.prettifyLogMessage ?? Boolean(getLogOption<boolean>('wrapLogMessage', false))\n        )\n        .setMenu(\n          new PanelMenu({\n            investigationOptions: { type: 'logs', getLabelName: () => `Logs: ${getPrettyQueryExpr(serviceScene)}` },\n          })\n        )\n        .setOption('showLogContextToggle', true)\n        // @ts-expect-error Requires Grafana 11.5\n        .setOption('enableInfiniteScrolling', true)\n        // @ts-expect-error Grafana 11.5\n        .setOption('onNewLogsReceived', this.updateVisibleRange)\n        // @ts-expect-error Grafana 11.5\n        .setOption('logRowMenuIconsAfter', [<CopyLinkButton onClick={this.handleShareLogLineClick} key={0} />])\n\n        .setHeaderActions(\n          new LogOptionsScene({ visualizationType, onChangeVisualizationType: parentModel.setVisualizationType })\n        )\n        .build()\n    );\n  }\n\n  private updateVisibleRange = (newLogs: DataFrame[]) => {\n    // Update logs count\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    serviceScene.setState({\n      logsCount: newLogs[0].length,\n    });\n\n    if (serviceScene.state.$data?.state.data?.series) {\n      // We need to update the state with the new data without triggering state-dependent changes.\n      serviceScene.state.$data.setState({\n        ...serviceScene.state.$data.state,\n        data: {\n          ...serviceScene.state.$data.state.data,\n          series: newLogs,\n        },\n      });\n    }\n\n    const logsVolumeScene = sceneGraph.findByKeyAndType(this, logsVolumePanelKey, LogsVolumePanel);\n    logsVolumeScene.updateVisibleRange(newLogs);\n  };\n\n  private handleShareLogLineClick = (event: MouseEvent<HTMLElement>, row?: LogRowModel) => {\n    if (row?.rowId && this.state.body) {\n      const parent = this.getParentScene();\n      const timeRange = resolveRowTimeRangeForSharing(row);\n      copyText(\n        generateLogShortlink(\n          'panelState',\n          {\n            logs: { id: row.uid, displayedFields: parent.state.displayedFields },\n          },\n          timeRange\n        )\n      );\n    }\n  };\n\n  private handleLabelFilterClick = (key: string, value: string, frame?: DataFrame) => {\n    this.handleLabelFilter(key, value, frame, 'toggle');\n  };\n\n  private handleLabelFilterOutClick = (key: string, value: string, frame?: DataFrame) => {\n    this.handleLabelFilter(key, value, frame, 'exclude');\n  };\n\n  private handleIsFilterLabelActive = (key: string, value: string) => {\n    const labels = getAdHocFiltersVariable(VAR_LABELS, this);\n    const fields = getAdHocFiltersVariable(VAR_FIELDS, this);\n    const levels = getAdHocFiltersVariable(VAR_LEVELS, this);\n    const metadata = getAdHocFiltersVariable(VAR_METADATA, this);\n\n    const hasKeyValueFilter = (filter: AdHocFiltersVariable | null) => {\n      return (\n        filter &&\n        filter.state.filters.findIndex(\n          (filter) => filter.operator === '=' && filter.key === key && filter.value === value\n        ) >= 0\n      );\n    };\n\n    // Fields have json encoded values unlike the other variables, get the value for the matching filter and parse it before comparing\n    const hasKeyValueFilterField = (filter: AdHocFiltersVariable | null) => {\n      if (filter) {\n        const fieldFilter = filter.state.filters.find((filter) => filter.operator === '=' && filter.key === key);\n\n        if (fieldFilter) {\n          const fieldValue = getValueFromFieldsFilter(fieldFilter, key);\n          return fieldValue.value === value;\n        }\n      }\n      return false;\n    };\n\n    return (\n      hasKeyValueFilter(labels) ||\n      hasKeyValueFilterField(fields) ||\n      hasKeyValueFilter(levels) ||\n      hasKeyValueFilter(metadata)\n    );\n  };\n\n  private handleFilterOutStringClick = (value: string) => {\n    const lineFiltersVar = getLineFiltersVariable(this);\n    if (lineFiltersVar) {\n      lineFiltersVar.setState({\n        filters: [\n          ...lineFiltersVar.state.filters,\n          {\n            operator: LineFilterOp.negativeMatch,\n            value,\n            key: LineFilterCaseSensitive.caseSensitive,\n            keyLabel: lineFiltersVar.state.filters.length.toString(),\n          },\n        ],\n      });\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.logs_popover_line_filter,\n        {\n          selectionLength: value.length,\n        }\n      );\n    }\n  };\n\n  private handleFilterStringClick = (value: string) => {\n    const lineFiltersVar = getLineFiltersVariable(this);\n    if (lineFiltersVar) {\n      lineFiltersVar.setState({\n        filters: [\n          ...lineFiltersVar.state.filters,\n          {\n            operator: LineFilterOp.match,\n            value,\n            key: LineFilterCaseSensitive.caseSensitive,\n            keyLabel: lineFiltersVar.state.filters.length.toString(),\n          },\n        ],\n      });\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.logs_popover_line_filter,\n        {\n          selectionLength: value.length,\n        }\n      );\n    }\n  };\n\n  private handleLabelFilter(key: string, value: string, frame: DataFrame | undefined, operator: FilterType) {\n    const variableType = getVariableForLabel(frame, key, this);\n    addToFilters(key, value, operator, this, variableType);\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_details,\n      USER_EVENTS_ACTIONS.service_details.logs_detail_filter_applied,\n      {\n        filterType: variableType,\n        key,\n        action: operator,\n      }\n    );\n  }\n\n  public static Component = ({ model }: SceneComponentProps<LogsPanelScene>) => {\n    const { body, error } = model.useState();\n    const styles = useStyles2(getPanelWrapperStyles);\n    if (body) {\n      return (\n        <span className={styles.panelWrapper}>\n          {!error && <body.Component model={body} />}\n          {error && <LogsPanelError error={error} clearFilters={() => clearVariables(body)} />}\n        </span>\n      );\n    }\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n","import React from 'react';\n\nimport { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { usePluginComponent } from '@grafana/runtime';\nimport { VAR_LABELS } from 'services/variables';\nimport { getAdHocFiltersVariable } from 'services/variableGetters';\nimport { AdHocVariableFilter } from '@grafana/data';\nimport { getDataSource } from 'services/scenes';\n\ninterface LogsVolumeActionsState extends SceneObjectState {}\n\nexport class LogsVolumeActions extends SceneObjectBase<LogsVolumeActionsState> {\n  static Component = Component;\n}\n\ntype StreamSelector = Pick<AdHocVariableFilter, 'key' | 'operator' | 'value'>;\n\ntype TemporaryExemptionsProps = {\n  /** An ordered list of lower-case [a-z]+ string identifiers to provide context clues of where this component is being embedded and how we might want to consider displaying it */\n  contextHints?: string[];\n  /** Currently selected data source */\n  dataSourceUid?: string;\n  /** The stream selector, broken down into a list of structured subselector filter items */\n  streamSelector?: StreamSelector[];\n};\n\nfunction Component({ model }: SceneComponentProps<LogsVolumeActions>) {\n  const { component: TemporaryExemptionsButton, isLoading } = usePluginComponent<TemporaryExemptionsProps>(\n    'grafana-adaptivelogs-app/temporary-exemptions/v1'\n  );\n\n  const labelsVar = getAdHocFiltersVariable(VAR_LABELS, model);\n  const { filters } = labelsVar.useState();\n  const streamSelector = filters.map(({ key, operator, value }: AdHocVariableFilter) => ({ key, operator, value }));\n\n  const dataSourceUid = getDataSource(model);\n\n  if (isLoading || !TemporaryExemptionsButton) {\n    return null;\n  }\n\n  return (\n    <TemporaryExemptionsButton\n      dataSourceUid={dataSourceUid}\n      streamSelector={streamSelector}\n      contextHints={['explorelogs', 'logvolumepanel', 'headeraction']}\n    />\n  );\n}\n","import React from 'react';\n\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\nimport { LegendDisplayMode, PanelContext, SeriesVisibilityChangeMode, useStyles2 } from '@grafana/ui';\nimport { getQueryRunner, setLogsVolumeFieldConfigs, syncLevelsVisibleSeries } from 'services/panel';\nimport { buildDataQuery, LINE_LIMIT } from 'services/query';\nimport { LEVEL_VARIABLE_VALUE } from 'services/variables';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getTimeSeriesExpr } from '../../services/expressions';\nimport { toggleLevelFromFilter } from 'services/levels';\nimport { DataFrame, getValueFormat, LoadingState } from '@grafana/data';\nimport { getFieldsVariable, getLabelsVariable, getLevelsVariable } from '../../services/variableGetters';\nimport { areArraysEqual } from '../../services/comparison';\nimport { getPanelWrapperStyles, PanelMenu } from '../Panels/PanelMenu';\nimport { ServiceScene } from './ServiceScene';\nimport { getSeriesVisibleRange, getVisibleRangeFrame } from 'services/logsFrame';\nimport { getLogsVolumeOption, setLogsVolumeOption } from 'services/store';\nimport { IndexScene } from '../IndexScene/IndexScene';\nimport { LogsVolumeActions } from './LogsVolumeActions';\nimport { AddFilterEvent } from './Breakdowns/AddToFiltersButton';\nimport { LevelsVariableScene } from '../IndexScene/LevelsVariableScene';\n\nexport interface LogsVolumePanelState extends SceneObjectState {\n  panel?: VizPanel;\n}\n\nexport const logsVolumePanelKey = 'logs-volume-panel';\nexport class LogsVolumePanel extends SceneObjectBase<LogsVolumePanelState> {\n  private updatedLogSeries: DataFrame[] | null = null;\n  constructor(state: LogsVolumePanelState) {\n    super({\n      ...state,\n      key: logsVolumePanelKey,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    if (!this.state.panel) {\n      const panel = this.getVizPanel();\n      this.setState({\n        panel,\n      });\n      this.updateContainerHeight(panel);\n    }\n\n    const labels = getLabelsVariable(this);\n    const fields = getFieldsVariable(this);\n\n    // Set panel on labels variable filter update\n    this._subs.add(\n      labels.subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.setState({\n            panel: this.getVizPanel(),\n          });\n        }\n      })\n    );\n\n    // Set Panel on fields variable filter update\n    this._subs.add(\n      fields.subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.setState({\n            panel: this.getVizPanel(),\n          });\n        }\n      })\n    );\n\n    // trigger variable render on AddFilterEvent, set filter state to trigger logs panel query\n    this._subs.add(\n      this.subscribeToEvent(AddFilterEvent, (event) => {\n        if (event.key === LEVEL_VARIABLE_VALUE) {\n          const levelsVariableScene = sceneGraph.findObject(this, (obj) => obj instanceof LevelsVariableScene);\n          if (levelsVariableScene instanceof LevelsVariableScene) {\n            const levelsVar = getLevelsVariable(this);\n            levelsVar.setState({ filters: levelsVar.state.filters });\n          }\n        }\n      })\n    );\n  }\n\n  private getTitle(totalLogsCount: number | undefined, logsCount: number | undefined) {\n    const indexScene = sceneGraph.getAncestor(this, IndexScene);\n    const maxLines = indexScene.state.ds?.maxLines ?? LINE_LIMIT;\n    const valueFormatter = getValueFormat('short');\n    const formattedTotalCount = totalLogsCount !== undefined ? valueFormatter(totalLogsCount, 0) : undefined;\n    // The instant query (totalLogsCount) doesn't return good results for small result sets, if we're below the max number of lines, use the logs query result instead.\n    if (totalLogsCount === undefined && logsCount !== undefined && logsCount < maxLines) {\n      const formattedCount = valueFormatter(logsCount, 0);\n      return formattedCount !== undefined\n        ? `Log volume (${formattedCount.text}${formattedCount.suffix?.trim()})`\n        : 'Log volume';\n    }\n    return formattedTotalCount !== undefined\n      ? `Log volume (${formattedTotalCount.text}${formattedTotalCount.suffix?.trim()})`\n      : 'Log volume';\n  }\n\n  private getVizPanel() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const viz = PanelBuilders.timeseries()\n      .setTitle(this.getTitle(serviceScene.state.totalLogsCount, serviceScene.state.logsCount))\n      .setOption('legend', { showLegend: true, calcs: ['sum'], displayMode: LegendDisplayMode.List })\n      .setUnit('short')\n      .setMenu(new PanelMenu({ investigationOptions: { labelName: 'level' } }))\n      .setCollapsible(true)\n      .setCollapsed(getLogsVolumeOption('collapsed'))\n      .setHeaderActions(new LogsVolumeActions({}))\n      // 11.5\n      // .setShowMenuAlways(true)\n      .setData(\n        getQueryRunner([\n          buildDataQuery(getTimeSeriesExpr(this, LEVEL_VARIABLE_VALUE, false), {\n            legendFormat: `{{${LEVEL_VARIABLE_VALUE}}}`,\n          }),\n        ])\n      );\n\n    setLogsVolumeFieldConfigs(viz);\n\n    const panel = viz.build();\n    panel.setState({\n      extendPanelContext: (_, context) => this.extendTimeSeriesLegendBus(context),\n    });\n\n    this._subs.add(\n      panel.subscribeToState((newState, prevState) => {\n        if (newState.collapsed !== prevState.collapsed) {\n          this.updateContainerHeight(panel);\n          setLogsVolumeOption('collapsed', newState.collapsed ? 'true' : undefined);\n        }\n      })\n    );\n\n    this._subs.add(\n      panel.state.$data?.subscribeToState((newState) => {\n        if (newState.data?.state !== LoadingState.Done) {\n          return;\n        }\n        if (serviceScene.state.$data?.state.data?.state === LoadingState.Done && !newState.data.annotations?.length) {\n          this.updateVisibleRange(serviceScene.state.$data?.state.data?.series);\n        } else {\n          this.displayVisibleRange();\n        }\n        syncLevelsVisibleSeries(panel, newState.data.series, this);\n      })\n    );\n\n    this._subs.add(\n      serviceScene.state.$data?.subscribeToState((newState) => {\n        if (newState.data?.state === LoadingState.Done) {\n          this.updateVisibleRange(newState.data.series);\n        }\n      })\n    );\n\n    this._subs.add(\n      serviceScene.subscribeToState((newState, prevState) => {\n        if (newState.totalLogsCount !== prevState.totalLogsCount || newState.logsCount !== undefined) {\n          if (!this.state.panel) {\n            this.setState({\n              panel: this.getVizPanel(),\n            });\n          } else {\n            this.state.panel.setState({\n              title: this.getTitle(newState.totalLogsCount, newState.logsCount),\n            });\n          }\n        }\n      })\n    );\n\n    return panel;\n  }\n\n  public updateContainerHeight(panel: VizPanel) {\n    const containerLayout = sceneGraph.getAncestor(panel, SceneFlexLayout);\n    const height = panel.state.collapsed ? 35 : Math.max(Math.round(window.innerHeight * 0.2), 100);\n    containerLayout.setState({\n      minHeight: height,\n      height: height,\n      maxHeight: height,\n    });\n  }\n\n  public updateVisibleRange(data: DataFrame[] = []) {\n    this.updatedLogSeries = data;\n    this.displayVisibleRange();\n  }\n\n  private displayVisibleRange() {\n    const panel = this.state.panel;\n    if (\n      !panel ||\n      !panel.state.$data?.state.data ||\n      panel.state.$data?.state.data.state !== LoadingState.Done ||\n      !this.updatedLogSeries\n    ) {\n      return;\n    }\n    const visibleRange = getSeriesVisibleRange(this.updatedLogSeries);\n    this.updatedLogSeries = null;\n    panel.state.$data.setState({\n      data: {\n        ...panel.state.$data.state.data,\n        annotations: [getVisibleRangeFrame(visibleRange.start, visibleRange.end)],\n      },\n    });\n  }\n\n  private extendTimeSeriesLegendBus = (context: PanelContext) => {\n    const levelFilter = getLevelsVariable(this);\n    this._subs.add(\n      levelFilter?.subscribeToState(() => {\n        const panel = this.state.panel;\n        if (!panel?.state.$data?.state.data?.series) {\n          return;\n        }\n\n        syncLevelsVisibleSeries(panel, panel?.state.$data?.state.data?.series, this);\n      })\n    );\n\n    context.onToggleSeriesVisibility = (label: string, mode: SeriesVisibilityChangeMode) => {\n      const action = toggleLevelFromFilter(label, this);\n      this.publishEvent(new AddFilterEvent('legend', 'include', LEVEL_VARIABLE_VALUE, label), true);\n\n      reportAppInteraction(\n        USER_EVENTS_PAGES.service_details,\n        USER_EVENTS_ACTIONS.service_details.level_in_logs_volume_clicked,\n        {\n          level: label,\n          action,\n        }\n      );\n    };\n  };\n\n  public static Component = ({ model }: SceneComponentProps<LogsVolumePanel>) => {\n    const { panel } = model.useState();\n    if (!panel) {\n      return;\n    }\n    const styles = useStyles2(getPanelWrapperStyles);\n\n    return (\n      <span className={styles.panelWrapper}>\n        <panel.Component model={panel} />\n      </span>\n    );\n  };\n}\n","import { sceneGraph, SceneObjectState } from '@grafana/scenes';\nimport { IndexScene } from '../../../IndexScene/IndexScene';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { logger } from '../../../../services/logger';\nimport { addCurrentUrlToHistory } from '../../../../services/navigate';\n\nexport interface FilterByPatternsButtonState extends SceneObjectState {\n  pattern: string;\n  type: 'exclude' | 'include' | 'undo';\n}\n\nexport interface FilterByPatternsState extends FilterByPatternsButtonState {\n  indexScene: IndexScene;\n}\n\nexport function onPatternClick(props: FilterByPatternsState) {\n  const { indexScene: staleIndex, pattern, type } = { ...props };\n\n  const indexScene = sceneGraph.getAncestor(staleIndex, IndexScene);\n\n  if (!indexScene) {\n    logger.warn('logs exploration scene not found');\n    return;\n  }\n\n  addCurrentUrlToHistory();\n  const { patterns = [] } = indexScene.state;\n\n  // Remove the pattern if it's already there\n  const filteredPatterns = patterns.filter((pat) => pat.pattern !== pattern);\n  // Analytics\n  const includePatternsLength = filteredPatterns.filter((p) => p.type === 'include')?.length ?? 0;\n  const excludePatternsLength = filteredPatterns.filter((p) => p.type === 'exclude')?.length ?? 0;\n  reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.pattern_selected, {\n    type: type,\n    includePatternsLength: includePatternsLength + (type === 'include' ? 1 : 0),\n    excludePatternsLength: excludePatternsLength + (type === 'exclude' ? 1 : 0),\n  });\n\n  // If we have type undo, then we don't need to add the pattern\n  if (type === 'undo') {\n    indexScene.setState({\n      patterns: filteredPatterns,\n    });\n  } else {\n    // Otherwise, add the pattern\n    indexScene.setState({\n      patterns: [...filteredPatterns, { pattern: pattern, type: type }],\n    });\n  }\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  logsStatsRow: css({\n    margin: `${theme.spacing(1.15)}px 0`,\n  }),\n  logsStatsRowActive: css({\n    color: theme.colors.primary.text,\n    position: 'relative',\n  }),\n  logsStatsRowLabel: css({\n    display: 'flex',\n    marginBottom: '1px',\n  }),\n  logsStatsRowValue: css({\n    flex: 1,\n    textOverflow: 'ellipsis',\n    overflow: 'hidden',\n  }),\n  logsStatsRowCount: css({\n    textAlign: 'right',\n    marginLeft: theme.spacing(0.75),\n  }),\n  logsStatsRowPercent: css({\n    textAlign: 'right',\n    marginLeft: theme.spacing(0.75),\n    width: theme.spacing(4.5),\n  }),\n  logsStatsRowBar: css({\n    height: theme.spacing(0.5),\n    overflow: 'hidden',\n    background: theme.colors.text.disabled,\n  }),\n  logsStatsRowInnerBar: css({\n    height: theme.spacing(0.5),\n    overflow: 'hidden',\n    background: theme.colors.primary.main,\n  }),\n});\n\nexport interface Props {\n  active?: boolean;\n  count: number;\n  proportion: number;\n  value?: string;\n}\n\nexport const PatternFieldLabelStatsRow = ({ active, count, proportion, value }: Props) => {\n  const style = useStyles2(getStyles);\n  const percent = `${Math.round(proportion * 100)}%`;\n  const barStyle = { width: percent };\n\n  return (\n    <div className={active ? `${style.logsStatsRow} ${style.logsStatsRowActive}` : style.logsStatsRow}>\n      <div className={style.logsStatsRowLabel}>\n        <div className={style.logsStatsRowValue} title={value}>\n          {value}\n        </div>\n        <div className={style.logsStatsRowCount}>{count}</div>\n        <div className={style.logsStatsRowPercent}>{percent}</div>\n      </div>\n      <div className={style.logsStatsRowBar}>\n        <div className={style.logsStatsRowInnerBar} style={barStyle} />\n      </div>\n    </div>\n  );\n};\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { LogLabelStatsModel, GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\n//Components\nimport { PatternFieldLabelStatsRow } from './PatternFieldLabelStatsRow';\n\nconst STATS_ROW_LIMIT = 10;\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  logsStats: css({\n    background: 'inherit',\n    color: theme.colors.text.primary,\n    wordBreak: 'break-all',\n    width: 'fit-content',\n    maxHeight: '40vh',\n    overflowY: 'auto',\n    marginTop: theme.spacing(1),\n  }),\n  logsStatsHeader: css({\n    borderBottom: `1px solid ${theme.colors.border.medium}`,\n    display: 'flex',\n  }),\n  logsStatsTitle: css({\n    fontWeight: theme.typography.fontWeightMedium,\n    paddingRight: theme.spacing(2),\n    display: 'inline-block',\n    whiteSpace: 'nowrap',\n    textOverflow: 'ellipsis',\n    flexGrow: 1,\n  }),\n  logsStatsClose: css({\n    cursor: 'pointer',\n  }),\n  logsStatsBody: css({\n    padding: '5px 0px',\n  }),\n});\n\ninterface PatternFieldLabelStatsProps {\n  stats: LogLabelStatsModel[];\n  value: string;\n}\n\nexport const PatternFieldLabelStats = (props: PatternFieldLabelStatsProps) => {\n  const style = useStyles2(getStyles);\n\n  const { stats, value } = props;\n\n  const topRows = stats.slice(0, STATS_ROW_LIMIT);\n  let activeRow = topRows.find((row) => row.value === value);\n  let otherRows = stats.slice(STATS_ROW_LIMIT);\n  const insertActiveRow = !activeRow;\n\n  // Remove active row from other to show extra\n  if (insertActiveRow) {\n    activeRow = otherRows.find((row) => row.value === value);\n    otherRows = otherRows.filter((row) => row.value !== value);\n  }\n\n  const otherCount = otherRows.reduce((sum, row) => sum + row.count, 0);\n  const topCount = topRows.reduce((sum, row) => sum + row.count, 0);\n  const total = topCount + otherCount;\n\n  // Combine topRows and otherRows\n  let combinedRows = [...topRows];\n\n  // If there's an \"Other\" category, add it to combinedRows\n  if (otherCount > 0) {\n    combinedRows.push({ value: 'Other', count: otherCount, proportion: otherCount / total });\n  }\n\n  // Sort combinedRows by count in descending order\n  combinedRows.sort((a, b) => b.count - a.count);\n\n  return (\n    <div className={style.logsStats}>\n      <div className={style.logsStatsHeader}>\n        <div className={style.logsStatsTitle}>From a sample of {total} rows found</div>\n      </div>\n      <div className={style.logsStatsBody}>\n        {combinedRows.map((stat) => (\n          <PatternFieldLabelStatsRow key={stat.value} {...stat} active={stat.value === value} />\n        ))}\n      </div>\n    </div>\n  );\n};\n","import React, { useMemo, useRef, useState } from 'react';\nimport { AdHocFiltersVariable, sceneGraph } from '@grafana/scenes';\nimport { Spinner, Toggletip, useStyles2 } from '@grafana/ui';\nimport { getLokiDatasource } from 'services/scenes';\nimport { IndexScene } from 'Components/IndexScene/IndexScene';\nimport { buildDataQuery } from 'services/query';\nimport { PatternFieldLabelStats } from './PatternFieldLabelStats';\nimport { GrafanaTheme2, LoadingState, LogLabelStatsModel, TimeRange } from '@grafana/data';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { css } from '@emotion/css';\nimport { getLabelsVariable } from '../../../../services/variableGetters';\n\ninterface PatternNameLabelProps {\n  exploration: IndexScene;\n  pattern: string;\n  maxLines: number;\n}\n\nexport const PatternNameLabel = ({ exploration, pattern, maxLines }: PatternNameLabelProps) => {\n  const patternIndices = extractPatternIndices(pattern);\n  const [stats, setStats] = useState<LogLabelStatsModel[][] | undefined>(undefined);\n  const [statsError, setStatsError] = useState(false);\n  const styles = useStyles2(getStyles);\n\n  // Refs to store the previous values of query and timeRange\n  const previousQueryRef = useRef<string | null>(null);\n  const previousTimeRangeRef = useRef<TimeRange | null>(null);\n\n  const handlePatternClick = async () => {\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.pattern_field_clicked);\n    const query = constructQuery(pattern, patternIndices, getLabelsVariable(exploration));\n    const datasource = await getLokiDatasource(exploration);\n    const currentTimeRange = sceneGraph.getTimeRange(exploration).state.value;\n\n    // If the query and timeRange are the same as the previous ones, do not re-query\n    if (stats && query === previousQueryRef.current && currentTimeRange === previousTimeRangeRef.current) {\n      return;\n    }\n\n    // Update the refs with the new values\n    previousQueryRef.current = query;\n    previousTimeRangeRef.current = currentTimeRange;\n\n    datasource\n      ?.query({\n        requestId: '1',\n        interval: '',\n        intervalMs: 0,\n        scopedVars: {},\n        range: currentTimeRange,\n        targets: [buildDataQuery(query, { maxLines })],\n        timezone: '',\n        app: '',\n        startTime: 0,\n      })\n      .forEach((result) => {\n        if (result.state === LoadingState.Done && !result.errors?.length) {\n          setStats(convertResultToStats(result, patternIndices.length, maxLines));\n          setStatsError(false);\n        } else if (result.state === LoadingState.Error || result.errors?.length) {\n          setStats(undefined);\n          setStatsError(true);\n        }\n      });\n  };\n\n  const parts = useMemo(() => pattern.split('<_>'), [pattern]);\n\n  return (\n    <div>\n      {parts.map((part, index) => (\n        <span key={index}>\n          {part}\n          {index !== patternIndices.length && (\n            <Toggletip\n              onOpen={handlePatternClick}\n              content={\n                <>\n                  {stats && stats[index].length > 0 && <PatternFieldLabelStats stats={stats[index]} value=\"\" />}\n                  {stats && stats[index].length === 0 && (\n                    <div>No available stats for this field in the current timestamp.</div>\n                  )}\n                  {!stats && statsError && <div>Could not load stats for this pattern.</div>}\n                  {!stats && !statsError && (\n                    <div style={{ padding: '10px' }}>\n                      <Spinner size=\"xl\" />\n                    </div>\n                  )}\n                </>\n              }\n            >\n              <span className={styles.pattern}>&lt;_&gt;</span>\n            </Toggletip>\n          )}\n        </span>\n      ))}\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    pattern: css({\n      cursor: 'pointer',\n      backgroundColor: theme.colors.emphasize(theme.colors.background.primary, 0.1),\n      margin: '0 2px',\n\n      '&:hover': {\n        backgroundColor: theme.colors.emphasize(theme.colors.background.primary, 0.2),\n      },\n    }),\n  };\n}\n\n// Convert the result to statistics data structure\nfunction convertResultToStats(result: any, fieldCount: number, maxLines: number): LogLabelStatsModel[][] {\n  const fieldStatsMap = new Map<string, Map<string, number>>();\n\n  // Populate the fieldStatsMap with values from the result\n  result.data[0].fields[0].values.toArray().forEach((value: Record<string, any>) => {\n    Object.keys(value).forEach((key) => {\n      if (!fieldStatsMap.has(key)) {\n        fieldStatsMap.set(key, new Map<string, number>());\n      }\n      fieldStatsMap.get(key)?.set(value[key], (fieldStatsMap.get(key)?.get(value[key]) || 0) + 1);\n    });\n  });\n\n  const stats: LogLabelStatsModel[][] = [];\n\n  // Construct stats array from fieldStatsMap\n  for (let i = 0; i <= fieldCount; i++) {\n    const fieldStats: LogLabelStatsModel[] = [];\n    fieldStatsMap.get(`field_${i + 1}`)?.forEach((count, key) => {\n      fieldStats.push({ value: key, count, proportion: count / maxLines });\n    });\n    fieldStats.sort((a, b) => b.count - a.count);\n    stats.push(fieldStats);\n  }\n\n  return stats;\n}\n\n// Extract indices of the pattern '<_>' in the given string\nfunction extractPatternIndices(pattern: string): number[] {\n  const indices: number[] = [];\n  let currentIndex = pattern.indexOf('<_>');\n\n  while (currentIndex !== -1) {\n    indices.push(currentIndex);\n    currentIndex = pattern.indexOf('<_>', currentIndex + 1);\n  }\n  return indices;\n}\n\n// Construct the query string based on pattern and other conditions\nfunction constructQuery(pattern: string, patternIndices: number[], filters: AdHocFiltersVariable): string {\n  let fieldIndex = 1;\n  const patternExtractor = pattern.replace(/<_>/g, () => `<field_${fieldIndex++}>`);\n  const filterExpression = filters.state.filterExpression;\n  const fields = patternIndices.map((_value, index) => `field_${index + 1}`).join(' ,');\n  return `{${filterExpression}} |> \\`${pattern}\\` | pattern \\`${patternExtractor}\\` | keep ${fields} | line_format \"\"`;\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataProviderResult,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneReactObject,\n  VizPanel,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { LoadingState } from '@grafana/data';\nimport { Alert, Button } from '@grafana/ui';\nimport {\n  AppliedPattern,\n  LOG_STREAM_SELECTOR_EXPR,\n  PATTERNS_SAMPLE_SELECTOR_EXPR,\n  VAR_PATTERNS_EXPR,\n} from '../../../../services/variables';\nimport { buildDataQuery } from '../../../../services/query';\nimport { getQueryRunner } from '../../../../services/panel';\nimport { PatternsViewTableScene } from './PatternsViewTableScene';\nimport { emptyStateStyles } from '../FieldsBreakdownScene';\nimport { getFieldsVariable, getLevelsVariable, getLineFiltersVariable } from '../../../../services/variableGetters';\nimport { LokiQuery } from '../../../../services/lokiQuery';\nimport { logger } from '../../../../services/logger';\nimport { renderPatternFilters } from '../../../../services/renderPatternFilters';\n\ninterface PatternsLogsSampleSceneState extends SceneObjectState {\n  pattern: string;\n  body?: SceneFlexLayout;\n}\nexport class PatternsLogsSampleScene extends SceneObjectBase<PatternsLogsSampleSceneState> {\n  constructor(state: PatternsLogsSampleSceneState) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    if (this.state.body) {\n      return;\n    }\n\n    // We start by querying with the users current query context\n    const queryWithFilters = buildDataQuery(LOG_STREAM_SELECTOR_EXPR);\n    this.replacePatternsInQuery(queryWithFilters);\n\n    // but if that fails to return results, we fire the query without the filters, instead of showing no-data in the viz\n    const queryRunnerWithFilters = getQueryRunner([queryWithFilters]);\n    queryRunnerWithFilters.getResultsStream().subscribe((value) => {\n      this.onQueryWithFiltersResult(value);\n    });\n\n    this.setState({\n      body: new SceneFlexLayout({\n        direction: 'column',\n        children: [\n          new SceneFlexItem({\n            body: undefined,\n            width: '100%',\n            height: 0,\n          }),\n          new SceneFlexItem({\n            height: 300,\n            width: '100%',\n            body: PanelBuilders.logs()\n              .setHoverHeader(true)\n              .setOption('showLogContextToggle', true)\n              .setOption('showTime', true)\n              .setData(queryRunnerWithFilters)\n              .build(),\n          }),\n        ],\n      }),\n    });\n  }\n\n  private replacePatternsInQuery(queryWithFilters: LokiQuery) {\n    const pendingPattern: AppliedPattern = {\n      pattern: this.state.pattern,\n      type: 'include',\n    };\n    const patternsLine = renderPatternFilters([pendingPattern]);\n    queryWithFilters.expr = queryWithFilters.expr.replace(VAR_PATTERNS_EXPR, patternsLine);\n  }\n\n  private clearFilters = () => {\n    const filterVariable = getFieldsVariable(this);\n    const lineFiltersVariable = getLineFiltersVariable(this);\n    const levelsVariable = getLevelsVariable(this);\n    filterVariable.setState({\n      filters: [],\n    });\n    levelsVariable.setState({\n      filters: [],\n    });\n    if (lineFiltersVariable.state.filters.length) {\n      lineFiltersVariable.setState({\n        filters: [],\n      });\n\n      const noticeFlexItem = this.getNoticeFlexItem();\n\n      // The query we just fired is already correct after we clear the filters, we just need to hide the warning, and allow filtering\n      noticeFlexItem?.setState({\n        isHidden: true,\n      });\n\n      this.removePatternFromFilterExclusion();\n    }\n  };\n\n  private removePatternFromFilterExclusion() {\n    const patternsViewTableScene = sceneGraph.getAncestor(this, PatternsViewTableScene);\n    const patternsNotMatchingFilters = patternsViewTableScene.state.patternsNotMatchingFilters ?? [];\n\n    const index = patternsNotMatchingFilters.findIndex((pattern) => pattern === this.state.pattern);\n\n    if (index !== -1) {\n      patternsNotMatchingFilters.splice(index, 1);\n      // remove this pattern, as they can filter by this pattern again\n      patternsViewTableScene.setState({\n        patternsNotMatchingFilters: patternsNotMatchingFilters,\n      });\n    }\n  }\n\n  /**\n   * If the first query with the users filters applied fails, we run another one after removing the filters\n   * @param value\n   */\n  private onQueryError = (value: SceneDataProviderResult) => {\n    if (\n      (value.data.state === LoadingState.Done &&\n        (value.data.series.length === 0 || value.data.series.every((frame) => frame.length === 0))) ||\n      value.data.state === LoadingState.Error\n    ) {\n      // Logging an error so loki folks can debug why some patterns returned from the API seem to fail.\n      let logContext;\n      try {\n        logContext = {\n          pattern: this.state.pattern,\n          traceIds: JSON.stringify(value.data.traceIds),\n          request: JSON.stringify(value.data.request),\n          msg: 'onQueryError',\n        };\n      } catch (e) {\n        logContext = {\n          pattern: this.state.pattern,\n          msg: 'Failed to encode context',\n        };\n      }\n\n      // Logging an error so loki folks can debug why some patterns returned from the API seem to fail.\n      logger.error(new Error('Pattern sample query returns no results'), logContext);\n\n      this.setWarningMessage(\n        <Alert severity={'error'} title={''}>\n          This pattern returns no logs.\n        </Alert>\n      );\n\n      const panelFlexItem = this.getVizFlexItem();\n\n      // Run another query without the filters so we can still show log lines of what the pattern looks like.\n      if (panelFlexItem instanceof SceneFlexItem) {\n        panelFlexItem.setState({\n          isHidden: true,\n        });\n      }\n    }\n  };\n\n  private setWarningMessage(reactNode: React.ReactNode) {\n    const noticeFlexItem = this.getNoticeFlexItem();\n    const vizFlexItem = this.getVizFlexItem();\n\n    if (noticeFlexItem instanceof SceneFlexItem) {\n      noticeFlexItem.setState({\n        isHidden: false,\n        height: 'auto',\n        body: new SceneReactObject({\n          reactNode: reactNode,\n        }),\n      });\n    }\n    return vizFlexItem;\n  }\n\n  private getNoticeFlexItem() {\n    const children = this.getFlexItemChildren();\n    return children?.[0];\n  }\n  private getVizFlexItem() {\n    const children = this.getFlexItemChildren();\n    return children?.[1];\n  }\n\n  private getFlexItemChildren() {\n    return this.state.body?.state.children;\n  }\n\n  /**\n   * Callback to subscription of pattern sample query with all of the current query filters applied.\n   * If this query fails to return data, we show a warning, and attempt the pattern sample query again without applying the existing filters.\n   * We also add the pattern to the state of the PatternsTableViewScene so we can hide the filter buttons for this pattern, as including it would break the query\n   * @param value\n   */\n  private onQueryWithFiltersResult = (value: SceneDataProviderResult) => {\n    const queryWithoutFilters = buildDataQuery(PATTERNS_SAMPLE_SELECTOR_EXPR);\n    this.replacePatternsInQuery(queryWithoutFilters);\n\n    const queryRunnerWithoutFilters = getQueryRunner([queryWithoutFilters]);\n\n    // Subscribe to the secondary query, so we can log errors and update the UI\n    queryRunnerWithoutFilters.getResultsStream().subscribe(this.onQueryError);\n\n    if (\n      value.data.state === LoadingState.Done &&\n      (value.data.series.length === 0 || value.data.series.every((frame) => frame.length === 0))\n    ) {\n      const noticeFlexItem = this.getNoticeFlexItem();\n      const panelFlexItem = this.getVizFlexItem();\n\n      // Add a warning notice that the patterns shown will not show up in their current log results due to their existing filters.\n      if (noticeFlexItem instanceof SceneFlexItem) {\n        noticeFlexItem.setState({\n          isHidden: false,\n          height: 'auto',\n          body: new SceneReactObject({\n            reactNode: (\n              <Alert severity={'warning'} title={''}>\n                The logs returned by this pattern do not match the current query filters.\n                <Button className={emptyStateStyles.button} onClick={() => this.clearFilters()}>\n                  Clear filters\n                </Button>\n              </Alert>\n            ),\n          }),\n        });\n      }\n\n      // Run another query without the filters so we can still show log lines of what the pattern looks like.\n      if (panelFlexItem instanceof SceneFlexItem) {\n        const panel = panelFlexItem.state.body;\n        if (panel instanceof VizPanel) {\n          panel?.setState({\n            $data: queryRunnerWithoutFilters,\n          });\n        }\n      }\n      this.excludeThisPatternFromFiltering();\n    }\n\n    if (value.data.state === LoadingState.Error) {\n      this.onQueryError(value);\n    }\n  };\n\n  private excludeThisPatternFromFiltering() {\n    const patternsViewTableScene = sceneGraph.getAncestor(this, PatternsViewTableScene);\n    const patternsThatDontMatchCurrentFilters = patternsViewTableScene.state.patternsNotMatchingFilters ?? [];\n\n    // Add this pattern to the array of patterns that don't match current filters\n    patternsViewTableScene.setState({\n      patternsNotMatchingFilters: [...patternsThatDontMatchCurrentFilters, this.state.pattern],\n    });\n  }\n\n  public static Component({ model }: SceneComponentProps<PatternsLogsSampleScene>) {\n    const { body } = model.useState();\n    if (body) {\n      return <body.Component model={body} />;\n    }\n    return null;\n  }\n}\n","import React, { useEffect } from 'react';\nimport { PatternsLogsSampleScene } from './PatternsLogsSampleScene';\nimport { PatternsTableCellData, PatternsViewTableScene } from './PatternsViewTableScene';\n\ninterface ExpandedRowProps {\n  tableViz: PatternsViewTableScene;\n  row: PatternsTableCellData;\n}\n\nexport function PatternsTableExpandedRow({ tableViz, row }: ExpandedRowProps) {\n  const { expandedRows } = tableViz.useState();\n\n  const rowScene = expandedRows?.find((scene) => scene.state.key === row.pattern);\n\n  useEffect(() => {\n    if (!rowScene) {\n      const newRowScene = buildExpandedRowScene(row.pattern);\n      tableViz.setState({ expandedRows: [...(tableViz.state.expandedRows ?? []), newRowScene] });\n    }\n  }, [row, tableViz, rowScene]);\n\n  return rowScene ? <rowScene.Component model={rowScene} /> : null;\n}\n\nfunction buildExpandedRowScene(pattern: string) {\n  return new PatternsLogsSampleScene({\n    pattern: pattern,\n    key: pattern,\n  });\n}\n","import {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneDataNode,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n} from '@grafana/scenes';\nimport { PatternFrame } from './PatternsBreakdownScene';\nimport React from 'react';\nimport { IndexScene } from '../../../IndexScene/IndexScene';\nimport { DataFrame, GrafanaTheme2, LoadingState, PanelData, scaledUnits } from '@grafana/data';\nimport { AxisPlacement, Column, InteractiveTable, TooltipDisplayMode, useTheme2 } from '@grafana/ui';\nimport { CellProps } from 'react-table';\nimport { css, cx } from '@emotion/css';\nimport { onPatternClick } from './FilterByPatternsButton';\nimport { FilterButton } from '../../../FilterButton';\nimport { config } from '@grafana/runtime';\nimport { testIds } from '../../../../services/testIds';\nimport { PatternsFrameScene } from './PatternsFrameScene';\nimport { PatternNameLabel } from './PatternNameLabel';\nimport { getExplorationFor } from 'services/scenes';\nimport { PatternsTableExpandedRow } from './PatternsTableExpandedRow';\nimport { LINE_LIMIT } from '../../../../services/query';\nimport { AppliedPattern } from '../../../../services/variables';\n\n// copied from from grafana repository packages/grafana-data/src/valueFormats/categories.ts\n// that is used in Grafana codebase for \"short\" units\nconst SCALED_UNITS = ['', ' K', ' Mil', ' Bil', ' Tri', ' Quadr', ' Quint', ' Sext', ' Sept'];\nexport interface SingleViewTableSceneState extends SceneObjectState {\n  // The local copy of the pattern frames, the parent breakdown scene decides if we get the filtered subset or not, in this scene we just present the data\n  patternFrames: PatternFrame[] | undefined;\n  expandedRows?: SceneObject[];\n\n  // An array of patterns to exclude links\n  patternsNotMatchingFilters?: string[];\n  maxLines?: number;\n}\n\nexport interface PatternsTableCellData {\n  pattern: string;\n  dataFrame: DataFrame;\n  sum: number;\n  includeLink: () => void;\n  excludeLink: () => void;\n  undoLink: () => void;\n}\n\nexport class PatternsViewTableScene extends SceneObjectBase<SingleViewTableSceneState> {\n  constructor(state: SingleViewTableSceneState) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n  onActivate() {\n    const indexScene = sceneGraph.getAncestor(this, IndexScene);\n    const maxLines = indexScene.state.ds?.maxLines;\n    this.setState({ maxLines });\n  }\n\n  public static Component = PatternTableViewSceneComponent;\n\n  /**\n   * Build columns for interactive table (wrapper for react-table v7)\n   * @param total\n   * @param appliedPatterns\n   * @param theme\n   * @param patternsNotMatchingFilters\n   * @protected\n   */\n  public buildColumns(\n    total: number,\n    appliedPatterns: AppliedPattern[] | undefined,\n    theme: GrafanaTheme2,\n    maxLines: number,\n    patternsNotMatchingFilters?: string[]\n  ) {\n    const styles = getColumnStyles(theme);\n    const timeRange = sceneGraph.getTimeRange(this).state.value;\n    const columns: Array<Column<PatternsTableCellData>> = [\n      {\n        id: 'volume-samples',\n        header: '',\n        cell: (props: CellProps<PatternsTableCellData>) => {\n          const panelData: PanelData = {\n            timeRange: timeRange,\n            series: [props.cell.row.original.dataFrame],\n            state: LoadingState.Done,\n          };\n          const dataNode = new SceneDataNode({\n            data: panelData,\n          });\n\n          const timeSeries = PanelBuilders.timeseries()\n            .setData(dataNode)\n            .setHoverHeader(true)\n            .setOption('tooltip', {\n              mode: TooltipDisplayMode.None,\n            })\n            .setCustomFieldConfig('hideFrom', {\n              legend: true,\n              tooltip: true,\n            })\n            .setCustomFieldConfig('axisPlacement', AxisPlacement.Hidden)\n            .setDisplayMode('transparent')\n            .build();\n\n          return (\n            <div className={styles.tableTimeSeriesWrap}>\n              <div className={styles.tableTimeSeries}>\n                <timeSeries.Component model={timeSeries} />\n              </div>\n            </div>\n          );\n        },\n      },\n      {\n        id: 'count',\n        header: 'Count',\n        sortType: 'number',\n        cell: (props) => {\n          const value = scaledUnits(1000, SCALED_UNITS)(props.cell.row.original.sum);\n          return (\n            <div className={styles.countTextWrap}>\n              <div>\n                {value.prefix ?? ''}\n                {value.text}\n                {value.suffix ?? ''}\n              </div>\n            </div>\n          );\n        },\n      },\n      {\n        id: 'percent',\n        header: '%',\n        sortType: 'number',\n        cell: (props) => (\n          <div className={styles.countTextWrap}>\n            <div>{((100 * props.cell.row.original.sum) / total).toFixed(0)}%</div>\n          </div>\n        ),\n      },\n      {\n        id: 'pattern',\n        header: 'Pattern',\n        cell: (props: CellProps<PatternsTableCellData>) => {\n          return (\n            <div className={cx(getTablePatternTextStyles(), styles.tablePatternTextDefault)}>\n              <PatternNameLabel\n                exploration={getExplorationFor(this)}\n                pattern={props.cell.row.original.pattern}\n                maxLines={maxLines}\n              />\n            </div>\n          );\n        },\n      },\n      {\n        id: 'include',\n        header: undefined,\n        disableGrow: true,\n        cell: (props: CellProps<PatternsTableCellData>) => {\n          if (patternsNotMatchingFilters?.includes(props.cell.row.original.pattern)) {\n            return undefined;\n          }\n\n          const existingPattern = appliedPatterns?.find(\n            (appliedPattern) => appliedPattern.pattern === props.cell.row.original.pattern\n          );\n          const isIncluded = existingPattern?.type === 'include';\n          const isExcluded = existingPattern?.type === 'exclude';\n          return (\n            <FilterButton\n              isExcluded={isExcluded}\n              isIncluded={isIncluded}\n              onInclude={() => props.cell.row.original.includeLink()}\n              onExclude={() => props.cell.row.original.excludeLink()}\n              onClear={() => props.cell.row.original.undoLink()}\n              buttonFill={'outline'}\n            />\n          );\n        },\n      },\n    ];\n    return columns;\n  }\n\n  /**\n   * Filter visible patterns in table, and return cell data for InteractiveTable\n   * @param patternFrames\n   * @param legendSyncPatterns\n   * @private\n   */\n  public buildTableData(patternFrames: PatternFrame[], legendSyncPatterns: Set<string>): PatternsTableCellData[] {\n    const logExploration = sceneGraph.getAncestor(this, IndexScene);\n    return patternFrames\n      .filter((patternFrame) => {\n        return legendSyncPatterns.size ? legendSyncPatterns.has(patternFrame.pattern) : true;\n      })\n      .map((pattern: PatternFrame) => {\n        return {\n          dataFrame: pattern.dataFrame,\n          pattern: pattern.pattern,\n          sum: pattern.sum,\n          includeLink: () =>\n            onPatternClick({\n              pattern: pattern.pattern,\n              type: 'include',\n              indexScene: logExploration,\n            }),\n          excludeLink: () =>\n            onPatternClick({\n              pattern: pattern.pattern,\n              type: 'exclude',\n              indexScene: logExploration,\n            }),\n          undoLink: () =>\n            onPatternClick({\n              pattern: pattern.pattern,\n              type: 'undo',\n              indexScene: logExploration,\n            }),\n        };\n      });\n  }\n}\n\nconst theme = config.theme2;\n\nconst getTablePatternTextStyles = () => {\n  return css({\n    minWidth: '200px',\n    fontFamily: theme.typography.fontFamilyMonospace,\n    overflow: 'hidden',\n    overflowWrap: 'break-word',\n  });\n};\n\nconst getTableStyles = (theme: GrafanaTheme2) => {\n  return {\n    link: css({\n      textDecoration: 'underline',\n    }),\n    tableWrap: css({\n      // Override interactive table style\n      '> div': {\n        // Need to define explicit height for overflowX\n        height: 'calc(100vh - 450px)',\n        minHeight: '470px',\n      },\n      // Make table headers sticky\n      th: {\n        top: 0,\n        position: 'sticky',\n        backgroundColor: theme.colors.background.canvas,\n        zIndex: theme.zIndex.navbarFixed,\n      },\n    }),\n  };\n};\nconst getColumnStyles = (theme: GrafanaTheme2) => {\n  return {\n    tablePatternTextDefault: css({\n      fontFamily: theme.typography.fontFamilyMonospace,\n      minWidth: '200px',\n      maxWidth: '100%',\n      overflow: 'hidden',\n      overflowWrap: 'break-word',\n      fontSize: theme.typography.bodySmall.fontSize,\n      wordBreak: 'break-word',\n    }),\n    countTextWrap: css({\n      textAlign: 'right',\n      fontSize: theme.typography.bodySmall.fontSize,\n    }),\n    tableTimeSeriesWrap: css({\n      width: '230px',\n      pointerEvents: 'none',\n    }),\n    tableTimeSeries: css({\n      height: '30px',\n      overflow: 'hidden',\n    }),\n  };\n};\n\nexport function PatternTableViewSceneComponent({ model }: SceneComponentProps<PatternsViewTableScene>) {\n  const indexScene = sceneGraph.getAncestor(model, IndexScene);\n  const { patterns: appliedPatterns } = indexScene.useState();\n  const theme = useTheme2();\n  const styles = getTableStyles(theme);\n\n  // Get state from parent\n  const patternsFrameScene = sceneGraph.getAncestor(model, PatternsFrameScene);\n  const { legendSyncPatterns } = patternsFrameScene.useState();\n\n  // Must use local patternFrames as the parent decides if we get the filtered or not\n  const { patternFrames: patternFramesRaw, patternsNotMatchingFilters } = model.useState();\n  const patternFrames = patternFramesRaw ?? [];\n\n  // Calculate total for percentages\n  const total = patternFrames.reduce((previousValue, frame) => {\n    return previousValue + frame.sum;\n  }, 0);\n\n  const tableData = model.buildTableData(patternFrames, legendSyncPatterns);\n  const columns = model.buildColumns(\n    total,\n    appliedPatterns,\n    theme,\n    model.state.maxLines ?? LINE_LIMIT,\n    patternsNotMatchingFilters\n  );\n\n  return (\n    <div data-testid={testIds.patterns.tableWrapper} className={styles.tableWrap}>\n      <InteractiveTable\n        columns={columns}\n        data={tableData}\n        getRowId={(r: PatternsTableCellData) => r.pattern}\n        renderExpandedRow={(row) => <PatternsTableExpandedRow tableViz={model} row={row} />}\n      />\n    </div>\n  );\n}\n","import React from 'react';\n\nimport { ConfigOverrideRule, FieldColor, LoadingState } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridLayout,\n  SceneDataNode,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  VizPanel,\n} from '@grafana/scenes';\nimport { LegendDisplayMode, PanelContext, SeriesVisibilityChangeMode } from '@grafana/ui';\nimport { ServiceScene } from '../../ServiceScene';\nimport { onPatternClick } from './FilterByPatternsButton';\nimport { IndexScene } from '../../../IndexScene/IndexScene';\nimport { PatternsViewTableScene } from './PatternsViewTableScene';\nimport { config } from '@grafana/runtime';\nimport { css } from '@emotion/css';\nimport { PatternFrame, PatternsBreakdownScene } from './PatternsBreakdownScene';\nimport { areArraysEqual } from '../../../../services/comparison';\nimport { logger } from '../../../../services/logger';\n\nconst palette = config.theme2.visualization.palette;\n\nexport interface PatternsFrameSceneState extends SceneObjectState {\n  body?: SceneCSSGridLayout;\n  loading?: boolean;\n  legendSyncPatterns: Set<string>;\n}\n\nexport class PatternsFrameScene extends SceneObjectBase<PatternsFrameSceneState> {\n  constructor(state?: Partial<PatternsFrameSceneState>) {\n    super({\n      loading: true,\n      ...state,\n      legendSyncPatterns: new Set(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  // parent render\n  public static Component = ({ model }: SceneComponentProps<PatternsFrameScene>) => {\n    const { body, loading } = model.useState();\n    const logsByServiceScene = sceneGraph.getAncestor(model, ServiceScene);\n    const { $patternsData } = logsByServiceScene.useState();\n    const patterns = $patternsData?.state.data?.series;\n\n    return (\n      <div className={styles.container}>\n        {!loading && patterns && patterns.length > 0 && <>{body && <body.Component model={body} />}</>}\n      </div>\n    );\n  };\n\n  private onActivate() {\n    this.updateBody();\n\n    // If the patterns have changed, recalculate the dataframes\n    this._subs.add(\n      sceneGraph.getAncestor(this, ServiceScene).subscribeToState((newState, prevState) => {\n        const newFrame = newState?.$patternsData?.state?.data?.series;\n        const prevFrame = prevState?.$patternsData?.state?.data?.series;\n\n        if (!areArraysEqual(newFrame, prevFrame)) {\n          const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n          this.updatePatterns(patternsBreakdownScene.state.patternFrames);\n\n          // In order to keep the search state from clearing, we need to clear the filtered state\n          patternsBreakdownScene.setState({\n            filteredPatterns: undefined,\n          });\n        }\n      })\n    );\n\n    // If the text search results have changed, update the components to use the filtered dataframe\n    this._subs.add(\n      sceneGraph.getAncestor(this, PatternsBreakdownScene).subscribeToState((newState, prevState) => {\n        const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n        if (newState.filteredPatterns && !areArraysEqual(newState.filteredPatterns, prevState.filteredPatterns)) {\n          this.updatePatterns(patternsBreakdownScene.state.filteredPatterns);\n        } else {\n          // If there is no search string, clear the state\n          if (!patternsBreakdownScene.state.patternFilter) {\n            this.updatePatterns(patternsBreakdownScene.state.patternFrames);\n          }\n        }\n      })\n    );\n  }\n\n  private async updatePatterns(patternFrames: PatternFrame[] = []) {\n    // CSS Grid doesn't need rebuilding, just the children need the updated dataframe\n    this.state.body?.forEachChild((child) => {\n      if (child instanceof VizPanel) {\n        child.setState({\n          $data: this.getTimeseriesDataNode(patternFrames),\n        });\n      }\n      if (child instanceof PatternsViewTableScene) {\n        child.setState({\n          patternFrames,\n        });\n      }\n    });\n  }\n\n  private async updateBody() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    const patternFrames = patternsBreakdownScene.state.patternFrames;\n\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n\n    const lokiPatterns = serviceScene.state.$patternsData?.state.data?.series;\n    if (!lokiPatterns || !patternFrames) {\n      logger.warn('Failed to update PatternsFrameScene body');\n      return;\n    }\n\n    this.setState({\n      body: this.getSingleViewLayout(),\n      legendSyncPatterns: new Set(),\n      loading: false,\n    });\n  }\n\n  private extendTimeSeriesLegendBus(vizPanel: VizPanel, context: PanelContext) {\n    const originalOnToggleSeriesVisibility = context.onToggleSeriesVisibility;\n\n    context.onToggleSeriesVisibility = (label: string, mode: SeriesVisibilityChangeMode) => {\n      originalOnToggleSeriesVisibility?.(label, mode);\n\n      const override: ConfigOverrideRule | undefined = vizPanel.state.fieldConfig.overrides?.[0];\n      const patternsToShow: string[] = override?.matcher.options.names;\n      const legendSyncPatterns = new Set<string>();\n\n      if (patternsToShow) {\n        patternsToShow.forEach(legendSyncPatterns.add, legendSyncPatterns);\n      }\n\n      this.setState({\n        legendSyncPatterns,\n      });\n    };\n  }\n\n  private getSingleViewLayout() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    const patternFrames = patternsBreakdownScene.state.patternFrames;\n\n    if (!patternFrames) {\n      logger.warn('Failed to set getSingleViewLayout');\n      return;\n    }\n\n    const timeSeries = this.getTimeSeries(patternFrames);\n\n    return new SceneCSSGridLayout({\n      templateColumns: '100%',\n      autoRows: '200px',\n      isLazy: true,\n\n      children: [\n        timeSeries,\n        new PatternsViewTableScene({\n          patternFrames,\n        }),\n      ],\n    });\n  }\n\n  private getTimeSeries(patternFrames: PatternFrame[]) {\n    const logExploration = sceneGraph.getAncestor(this, IndexScene);\n\n    const timeSeries = PanelBuilders.timeseries()\n      .setData(this.getTimeseriesDataNode(patternFrames))\n      .setOption('legend', {\n        asTable: true,\n        showLegend: true,\n        displayMode: LegendDisplayMode.Table,\n        placement: 'right',\n        width: 200,\n      })\n      .setHoverHeader(true)\n      .setUnit('short')\n      .setLinks([\n        {\n          url: '#',\n          targetBlank: false,\n          onClick: (event) => {\n            onPatternClick({\n              pattern: event.origin.labels.name,\n              type: 'include',\n              indexScene: logExploration,\n            });\n          },\n          title: 'Include',\n        },\n        {\n          url: '#',\n          targetBlank: false,\n          onClick: (event) => {\n            onPatternClick({\n              pattern: event.origin.labels.name,\n              type: 'exclude',\n              indexScene: logExploration,\n            });\n          },\n          title: 'Exclude',\n        },\n      ])\n      .build();\n\n    timeSeries.setState({\n      extendPanelContext: (vizPanel, context) => this.extendTimeSeriesLegendBus(vizPanel, context),\n    });\n\n    return timeSeries;\n  }\n\n  private getTimeseriesDataNode(patternFrames: PatternFrame[]) {\n    const timeRange = sceneGraph.getTimeRange(this).state.value;\n\n    return new SceneDataNode({\n      data: {\n        series: patternFrames.map((patternFrame, seriesIndex) => {\n          // Mutating the dataframe config here means that we don't need to update the colors in the table view\n          const dataFrame = patternFrame.dataFrame;\n          dataFrame.fields[1].config.color = overrideToFixedColor(seriesIndex);\n          dataFrame.fields[1].name = '';\n          return dataFrame;\n        }),\n        state: LoadingState.Done,\n        timeRange: timeRange,\n      },\n    });\n  }\n}\n\nexport function overrideToFixedColor(key: keyof typeof palette): FieldColor {\n  return {\n    mode: 'fixed',\n    fixedColor: palette[key] as string,\n  };\n}\n\nconst styles = {\n  container: css({\n    width: '100%',\n    // Hide header on hover hack\n    '.show-on-hover': {\n      display: 'none',\n    },\n  }),\n};\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React, { ChangeEvent } from 'react';\nimport { Field } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { PatternFrame, PatternsBreakdownScene } from './PatternsBreakdownScene';\nimport { debouncedFuzzySearch, fuzzySearch } from '../../../../services/search';\nimport { SearchInput } from '../SearchInput';\nimport { areArraysEqual } from '../../../../services/comparison';\n\nexport interface PatternsViewTextSearchState extends SceneObjectState {}\n\nexport class PatternsViewTextSearch extends SceneObjectBase<PatternsViewTextSearchState> {\n  public static Component = PatternTextSearchComponent;\n\n  constructor(state?: Partial<PatternsViewTextSearchState>) {\n    super({\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  /**\n   * On click callback to clear current text search\n   */\n  public clearSearch = () => {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    patternsBreakdownScene.setState({\n      patternFilter: '',\n    });\n  };\n\n  /**\n   * Search input onchange callback\n   * @param e\n   */\n  public handleSearchChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    patternsBreakdownScene.setState({\n      patternFilter: e.target.value,\n    });\n  };\n\n  /**\n   * Activation handler\n   * @private\n   */\n  private onActivate() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    this._subs.add(\n      patternsBreakdownScene.subscribeToState((newState, prevState) => {\n        if (newState.patternFilter !== prevState.patternFilter) {\n          const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n          if (patternsBreakdownScene.state.patternFrames) {\n            debouncedFuzzySearch(\n              patternsBreakdownScene.state.patternFrames.map((frame) => frame.pattern),\n              patternsBreakdownScene.state.patternFilter,\n              this.onSearchResult\n            );\n          }\n        }\n      })\n    );\n\n    this._subs.add(\n      patternsBreakdownScene.subscribeToState((newState, prevState) => {\n        // If we have a search string, but no filtered patterns, run the search\n        if (\n          newState.patternFilter &&\n          !newState.filteredPatterns &&\n          newState.patternFrames &&\n          !areArraysEqual(newState.filteredPatterns, prevState.filteredPatterns)\n        ) {\n          fuzzySearch(\n            newState.patternFrames.map((frame) => frame.pattern),\n            newState.patternFilter,\n            this.onSearchResult\n          );\n        }\n      })\n    );\n  }\n\n  /**\n   * Sets the patterns filtered by string match\n   * @param patterns\n   * @param patternFramesOverride\n   */\n  setFilteredPatterns(patterns: string[], patternFramesOverride?: PatternFrame[]) {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    const patternFrames = patternFramesOverride ?? patternsBreakdownScene.state.patternFrames;\n\n    if (patternFrames) {\n      const filteredPatternFrames = patternFrames.filter((patternFrame) => {\n        if (patternsBreakdownScene.state.patternFilter && patternFrames?.length) {\n          return patterns.find((pattern) => pattern === patternFrame.pattern);\n        }\n        return false;\n      });\n\n      patternsBreakdownScene.setState({\n        filteredPatterns: filteredPatternFrames,\n      });\n    }\n  }\n\n  /**\n   * Fuzzy search callback\n   * @param data\n   */\n  onSearchResult = (data: string[][]) => {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    // If we have a search string\n    if (patternsBreakdownScene.state.patternFilter) {\n      this.setFilteredPatterns(data[0]);\n    } else if (patternsBreakdownScene.state.filteredPatterns && !patternsBreakdownScene.state.patternFilter) {\n      // Wipe the parent filtered state\n      this.setEmptySearch();\n    }\n  };\n\n  /**\n   * Wipes filtered patterns when search string is empty\n   */\n  private setEmptySearch() {\n    const patternsBreakdownScene = sceneGraph.getAncestor(this, PatternsBreakdownScene);\n    patternsBreakdownScene.setState({\n      filteredPatterns: undefined,\n    });\n  }\n}\n\nconst styles = {\n  field: css({\n    label: 'field',\n    marginBottom: 0,\n  }),\n  icon: css({\n    cursor: 'pointer',\n  }),\n};\n\nexport function PatternTextSearchComponent({ model }: SceneComponentProps<PatternsViewTextSearch>) {\n  const patternsBreakdownScene = sceneGraph.getAncestor(model, PatternsBreakdownScene);\n  const { patternFilter } = patternsBreakdownScene.useState();\n  return (\n    <Field className={styles.field}>\n      <SearchInput\n        onChange={model.handleSearchChange}\n        onClear={model.clearSearch}\n        value={patternFilter}\n        placeholder=\"Search patterns\"\n      />\n    </Field>\n  );\n}\n","import { GrotError } from '../../../GrotError';\nimport { TextLink } from '@grafana/ui';\nimport React from 'react';\nimport { PATTERNS_MAX_AGE_HOURS } from './PatternsBreakdownScene';\n\nexport function PatternsNotDetected() {\n  return (\n    <GrotError>\n      <div>\n        <p>\n          <strong>Sorry, we could not detect any patterns.</strong>\n        </p>\n        <p>\n          Check back later or reach out to the team in the{' '}\n          <TextLink href=\"https://slack.grafana.com/\" external>\n            Grafana Labs community Slack channel\n          </TextLink>\n        </p>\n        <p>Patterns let you detect similar log lines to include or exclude from your search.</p>\n      </div>\n    </GrotError>\n  );\n}\n\nexport function PatternsTooOld() {\n  return (\n    <GrotError>\n      <div>\n        <p>\n          <strong>Patterns are only available for the most recent {PATTERNS_MAX_AGE_HOURS} hours of data.</strong>\n        </p>\n        <p>\n          See the{' '}\n          <TextLink\n            href=\"https://grafana.com/docs/grafana/latest/explore/simplified-exploration/logs/patterns/\"\n            external\n          >\n            patterns docs\n          </TextLink>{' '}\n          for more info.\n        </p>\n      </div>\n    </GrotError>\n  );\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { DataFrame, dateTime, GrafanaTheme2, LoadingState } from '@grafana/data';\nimport {\n  CustomVariable,\n  SceneComponentProps,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneVariableSet,\n} from '@grafana/scenes';\nimport { Text, useStyles2 } from '@grafana/ui';\nimport { StatusWrapper } from 'Components/ServiceScene/Breakdowns/StatusWrapper';\nimport { VAR_LABEL_GROUP_BY } from 'services/variables';\nimport { ServiceScene } from '../../ServiceScene';\nimport { IndexScene } from '../../../IndexScene/IndexScene';\nimport { PatternsFrameScene } from './PatternsFrameScene';\nimport { PatternsViewTextSearch } from './PatternsViewTextSearch';\nimport { PatternsNotDetected, PatternsTooOld } from './PatternsNotDetected';\nimport { areArraysEqual } from '../../../../services/comparison';\n\nexport interface PatternsBreakdownSceneState extends SceneObjectState {\n  body?: SceneFlexLayout;\n  value?: string;\n  loading?: boolean;\n  error?: boolean;\n  blockingMessage?: string;\n  // The dataframe built from the patterns that we get back from the loki Patterns API\n  patternFrames?: PatternFrame[];\n\n  // Subset of patternFrames, undefined if empty, empty array if search results returned nothing (no data)\n  filteredPatterns?: PatternFrame[];\n  patternFilter: string;\n}\n\nexport type PatternFrame = {\n  dataFrame: DataFrame;\n  pattern: string;\n  sum: number;\n  status?: 'include' | 'exclude';\n};\n\nexport const PATTERNS_MAX_AGE_HOURS = 3;\n\nexport class PatternsBreakdownScene extends SceneObjectBase<PatternsBreakdownSceneState> {\n  constructor(state: Partial<PatternsBreakdownSceneState>) {\n    super({\n      $variables:\n        state.$variables ??\n        new SceneVariableSet({\n          variables: [new CustomVariable({ name: VAR_LABEL_GROUP_BY, defaultToAll: true, includeAll: true })],\n        }),\n      loading: true,\n      patternFilter: '',\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  // parent render\n  public static Component = ({ model }: SceneComponentProps<PatternsBreakdownScene>) => {\n    const { body, loading, blockingMessage, patternFrames, error } = model.useState();\n    const { value: timeRange } = sceneGraph.getTimeRange(model).useState();\n    const styles = useStyles2(getStyles);\n    const timeRangeTooOld = dateTime().diff(timeRange.to, 'hours') >= PATTERNS_MAX_AGE_HOURS;\n\n    return (\n      <div className={styles.container}>\n        <StatusWrapper {...{ isLoading: loading, blockingMessage }}>\n          {!loading && error && (\n            <div className={styles.patternMissingText}>\n              <Text textAlignment=\"center\" color=\"primary\">\n                <p>There are no pattern matches.</p>\n                <p>Pattern matching has not been configured.</p>\n                <p>Patterns let you detect similar log lines and add or exclude them from your search.</p>\n                <p>To see them in action, add the following to your Loki configuration</p>\n                <p>\n                  <code>--pattern-ingester.enabled=true</code>\n                </p>\n              </Text>\n            </div>\n          )}\n\n          {!error && !loading && patternFrames?.length === 0 && timeRangeTooOld && <PatternsTooOld />}\n          {!error && !loading && patternFrames?.length === 0 && !timeRangeTooOld && <PatternsNotDetected />}\n          {!error && !loading && patternFrames && patternFrames.length > 0 && (\n            <div className={styles.content}>{body && <body.Component model={body} />}</div>\n          )}\n        </StatusWrapper>\n      </div>\n    );\n  };\n\n  private onActivate() {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    this.setBody();\n\n    // If the patterns exist already, update the dataframe\n    if (serviceScene.state.$patternsData?.state) {\n      this.onDataChange(serviceScene.state.$patternsData?.state);\n    }\n\n    // Subscribe to changes from pattern API call\n    this._subs.add(serviceScene.state.$patternsData?.subscribeToState(this.onDataChange));\n  }\n\n  private onDataChange = (newState: SceneDataState, prevState?: SceneDataState) => {\n    const newFrames = newState.data?.series;\n    const prevFrames = prevState?.data?.series;\n\n    if (newState.data?.state === LoadingState.Done) {\n      this.setState({\n        loading: false,\n        error: false,\n      });\n\n      if (!areArraysEqual(newFrames, prevFrames)) {\n        this.updatePatternFrames(newFrames);\n      }\n    } else if (newState.data?.state === LoadingState.Loading) {\n      this.setState({\n        loading: true,\n        error: false,\n      });\n    } else if (newState.data?.state === LoadingState.Error) {\n      this.setState({\n        loading: false,\n        error: true,\n      });\n    }\n  };\n\n  private setBody() {\n    this.setState({\n      body: new SceneFlexLayout({\n        direction: 'column',\n        children: [\n          new SceneFlexItem({\n            ySizing: 'content',\n            body: new PatternsViewTextSearch(),\n          }),\n          new SceneFlexItem({\n            body: new PatternsFrameScene(),\n          }),\n        ],\n      }),\n    });\n  }\n\n  private updatePatternFrames(dataFrames?: DataFrame[]) {\n    if (!dataFrames) {\n      return;\n    }\n\n    const patternFrames = this.dataFrameToPatternFrame(dataFrames);\n\n    this.setState({\n      patternFrames,\n    });\n  }\n\n  private dataFrameToPatternFrame(dataFrame: DataFrame[]): PatternFrame[] {\n    const serviceScene = sceneGraph.getAncestor(this, ServiceScene);\n    const appliedPatterns = sceneGraph.getAncestor(serviceScene, IndexScene).state.patterns;\n\n    return dataFrame.map((dataFrame) => {\n      const existingPattern = appliedPatterns?.find((appliedPattern) => appliedPattern.pattern === dataFrame.name);\n\n      const sum: number = dataFrame.meta?.custom?.sum;\n      const patternFrame: PatternFrame = {\n        dataFrame,\n        pattern: dataFrame.name ?? '',\n        sum,\n        status: existingPattern?.type,\n      };\n\n      return patternFrame;\n    });\n  }\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n    }),\n    content: css({\n      flexGrow: 1,\n      display: 'flex',\n      paddingTop: theme.spacing(0),\n    }),\n    controls: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'top',\n      gap: theme.spacing(2),\n    }),\n    controlsRight: css({\n      flexGrow: 0,\n      display: 'flex',\n      justifyContent: 'flex-end',\n    }),\n    controlsLeft: css({\n      display: 'flex',\n      justifyContent: 'flex-left',\n      justifyItems: 'left',\n      width: '100%',\n      flexDirection: 'column',\n    }),\n    patternMissingText: css({\n      padding: theme.spacing(2),\n    }),\n  };\n}\n","import { PageSlugs, ValueSlugs } from '../../services/routing';\nimport { LogsListScene } from './LogsListScene';\nimport { testIds } from '../../services/testIds';\nimport { LabelBreakdownScene } from './Breakdowns/LabelBreakdownScene';\nimport { FieldsBreakdownScene } from './Breakdowns/FieldsBreakdownScene';\nimport { PatternsBreakdownScene } from './Breakdowns/Patterns/PatternsBreakdownScene';\nimport { behaviors, SceneFlexItem, SceneFlexLayout, SceneObject } from '@grafana/scenes';\nimport { LogsVolumePanel } from './LogsVolumePanel';\nimport { DashboardCursorSync } from '@grafana/schema';\n\ninterface ValueBreakdownViewDefinition {\n  displayName: string;\n  value: ValueSlugs;\n  testId: string;\n  getScene: (value: string) => SceneObject;\n}\n\nexport enum TabNames {\n  logs = 'Logs',\n  labels = 'Labels',\n  fields = 'Fields',\n  patterns = 'Patterns',\n}\nexport interface BreakdownViewDefinition {\n  displayName: TabNames;\n  value: PageSlugs;\n  testId: string;\n  getScene: (changeFields: (f: number) => void) => SceneObject;\n}\n\nexport const breakdownViewsDefinitions: BreakdownViewDefinition[] = [\n  {\n    displayName: TabNames.logs,\n    value: PageSlugs.logs,\n    getScene: () => buildLogsListScene(),\n    testId: testIds.exploreServiceDetails.tabLogs,\n  },\n  {\n    displayName: TabNames.labels,\n    value: PageSlugs.labels,\n    getScene: () => buildLabelBreakdownActionScene(),\n    testId: testIds.exploreServiceDetails.tabLabels,\n  },\n  {\n    displayName: TabNames.fields,\n    value: PageSlugs.fields,\n    getScene: (f) => buildFieldsBreakdownActionScene(f),\n    testId: testIds.exploreServiceDetails.tabFields,\n  },\n  {\n    displayName: TabNames.patterns,\n    value: PageSlugs.patterns,\n    getScene: () => buildPatternsScene(),\n    testId: testIds.exploreServiceDetails.tabPatterns,\n  },\n];\nexport const valueBreakdownViews: ValueBreakdownViewDefinition[] = [\n  {\n    displayName: 'Label',\n    value: ValueSlugs.label,\n    getScene: (value: string) => buildLabelValuesBreakdownActionScene(value),\n    testId: testIds.exploreServiceDetails.tabLabels,\n  },\n  {\n    displayName: 'Field',\n    value: ValueSlugs.field,\n    getScene: (value: string) => buildFieldValuesBreakdownActionScene(value),\n    testId: testIds.exploreServiceDetails.tabFields,\n  },\n];\n\nfunction buildPatternsScene() {\n  return new SceneFlexLayout({\n    children: [\n      new SceneFlexItem({\n        body: new PatternsBreakdownScene({}),\n      }),\n    ],\n  });\n}\n\nfunction buildFieldsBreakdownActionScene(changeFieldNumber: (n: number) => void) {\n  return new SceneFlexLayout({\n    $behaviors: [new behaviors.CursorSync({ key: 'sync', sync: DashboardCursorSync.Crosshair })],\n    children: [\n      new SceneFlexItem({\n        body: new FieldsBreakdownScene({ changeFieldCount: changeFieldNumber }),\n      }),\n    ],\n  });\n}\n\nfunction buildFieldValuesBreakdownActionScene(value: string) {\n  return new SceneFlexLayout({\n    $behaviors: [new behaviors.CursorSync({ key: 'sync', sync: DashboardCursorSync.Crosshair })],\n    children: [\n      new SceneFlexItem({\n        body: new FieldsBreakdownScene({ value }),\n      }),\n    ],\n  });\n}\n\nfunction buildLabelValuesBreakdownActionScene(value: string) {\n  return new SceneFlexLayout({\n    $behaviors: [new behaviors.CursorSync({ key: 'sync', sync: DashboardCursorSync.Crosshair })],\n    children: [\n      new SceneFlexItem({\n        body: new LabelBreakdownScene({ value }),\n      }),\n    ],\n  });\n}\n\nfunction buildLogsListScene() {\n  return new SceneFlexLayout({\n    direction: 'column',\n    children: [\n      new SceneFlexItem({\n        body: new LogsVolumePanel({}),\n      }),\n      new SceneFlexItem({\n        minHeight: '470px',\n        height: 'calc(100vh - 500px)',\n        body: new LogsListScene({}),\n      }),\n    ],\n  });\n}\n\nfunction buildLabelBreakdownActionScene() {\n  return new SceneFlexLayout({\n    $behaviors: [new behaviors.CursorSync({ key: 'sync', sync: DashboardCursorSync.Crosshair })],\n    children: [\n      new SceneFlexItem({\n        body: new LabelBreakdownScene({}),\n      }),\n    ],\n  });\n}\n","import {\n  SceneComponentProps,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneTimeRangeLike,\n} from '@grafana/scenes';\nimport { ButtonGroup, Dropdown, IconName, Menu, MenuGroup, ToolbarButton } from '@grafana/ui';\nimport React from 'react';\nimport { config, getAppEvents, getBackendSrv, locationService, reportInteraction } from '@grafana/runtime';\nimport { AppEvents, toUtc, urlUtil } from '@grafana/data';\nimport { copyText } from '../../services/text';\n\ninterface ShortLinkMenuItemData {\n  key: string;\n  label: string;\n  icon: IconName;\n  getUrl: Function;\n  shorten: boolean;\n  absTime: boolean;\n}\n\ninterface ShortLinkGroupData {\n  key: string;\n  label: string;\n  items: ShortLinkMenuItemData[];\n}\n\nexport interface ShareButtonSceneState extends SceneObjectState {\n  lastSelected: ShortLinkMenuItemData;\n  isOpen: boolean;\n  /**\n   * Reference to $timeRange\n   */\n  getSceneTimeRange?: () => SceneTimeRangeLike;\n  /**\n   * Callback on link copy\n   */\n  onCopyLink?: (shortened: boolean, absTime: boolean, url?: string) => void;\n}\n\nexport class ShareButtonScene extends SceneObjectBase<ShareButtonSceneState> {\n  constructor(state: Partial<ShareButtonSceneState>) {\n    super({ isOpen: false, lastSelected: defaultMode, ...state });\n  }\n\n  public setIsOpen(isOpen: boolean) {\n    this.setState({ isOpen });\n  }\n\n  public onCopyLink(shorten: boolean, absTime: boolean, url?: string) {\n    if (shorten) {\n      createAndCopyShortLink(url || global.location.href);\n      reportInteraction('grafana_explore_shortened_link_clicked', { isAbsoluteTime: absTime });\n    } else {\n      copyText(\n        url !== undefined\n          ? `${window.location.protocol}//${window.location.host}${config.appSubUrl}${url}`\n          : global.location.href\n      );\n\n      if (this.state.onCopyLink) {\n        this.state.onCopyLink(shorten, absTime, url);\n      }\n    }\n  }\n\n  static MenuActions = ({ model }: SceneComponentProps<ShareButtonScene>) => {\n    const menuOptions: ShortLinkGroupData[] = [\n      {\n        key: 'normal',\n        label: 'Normal URL links',\n        items: [\n          {\n            key: 'copy-shortened-link',\n            icon: 'link',\n            label: 'Copy shortened URL',\n            getUrl: () => undefined,\n            shorten: true,\n            absTime: false,\n          },\n          {\n            key: 'copy-link',\n            icon: 'link',\n            label: 'Copy URL',\n            getUrl: () => undefined,\n            shorten: false,\n            absTime: false,\n          },\n        ],\n      },\n      {\n        key: 'timesync',\n        label: 'Time-sync URL links (share with time range intact)',\n        items: [\n          {\n            key: 'copy-short-link-abs-time',\n            icon: 'clock-nine',\n            label: 'Copy absolute shortened URL',\n            shorten: true,\n            getUrl: () => {\n              return constructAbsoluteUrl(\n                model.state.getSceneTimeRange !== undefined\n                  ? model.state.getSceneTimeRange()\n                  : sceneGraph.getTimeRange(model)\n              );\n            },\n            absTime: true,\n          },\n          {\n            key: 'copy-link-abs-time',\n            icon: 'clock-nine',\n            label: 'Copy absolute URL',\n            shorten: false,\n            getUrl: () => {\n              return constructAbsoluteUrl(\n                model.state.getSceneTimeRange !== undefined\n                  ? model.state.getSceneTimeRange()\n                  : sceneGraph.getTimeRange(model)\n              );\n            },\n            absTime: true,\n          },\n        ],\n      },\n    ];\n\n    return (\n      <Menu>\n        {menuOptions.map((groupOption) => {\n          return (\n            <MenuGroup key={groupOption.key} label={groupOption.label}>\n              {groupOption.items.map((option) => {\n                return (\n                  <Menu.Item\n                    key={option.key}\n                    label={option.label}\n                    icon={option.icon}\n                    onClick={() => {\n                      const url = option.getUrl();\n                      model.onCopyLink(option.shorten, option.absTime, url);\n                      model.setState({\n                        lastSelected: option,\n                      });\n                    }}\n                  />\n                );\n              })}\n            </MenuGroup>\n          );\n        })}\n      </Menu>\n    );\n  };\n\n  static Component = ({ model }: SceneComponentProps<ShareButtonScene>) => {\n    const { lastSelected, isOpen } = model.useState();\n\n    return (\n      <ButtonGroup>\n        <ToolbarButton\n          tooltip={lastSelected.label}\n          icon={lastSelected.icon}\n          variant={'canvas'}\n          narrow={true}\n          onClick={() => {\n            const url = lastSelected.getUrl();\n            model.onCopyLink(lastSelected.shorten, lastSelected.absTime, url);\n          }}\n          aria-label={'Copy shortened URL'}\n        >\n          <span>Share</span>\n        </ToolbarButton>\n        <Dropdown\n          overlay={<ShareButtonScene.MenuActions model={model} />}\n          placement=\"bottom-end\"\n          onVisibleChange={model.setIsOpen.bind(model)}\n        >\n          <ToolbarButton narrow={true} variant={'canvas'} isOpen={isOpen} aria-label={'Open copy link options'} />\n        </Dropdown>\n      </ButtonGroup>\n    );\n  };\n}\n\nconst defaultMode: ShortLinkMenuItemData = {\n  key: 'copy-link',\n  label: 'Copy shortened URL',\n  icon: 'share-alt',\n  getUrl: () => undefined,\n  shorten: true,\n  absTime: false,\n};\n\n// Adapted from grafana/grafana/public/app/core/utils/shortLinks.ts shortLinks.ts\nfunction buildHostUrl() {\n  return `${window.location.protocol}//${window.location.host}${config.appSubUrl}`;\n}\n\nfunction getRelativeURLPath(url: string) {\n  let path = url.replace(buildHostUrl(), '');\n  return path.startsWith('/') ? path.substring(1, path.length) : path;\n}\n\nexport const createShortLink = async function (path: string) {\n  const appEvents = getAppEvents();\n  try {\n    const shortLink = await getBackendSrv().post(`/api/short-urls`, {\n      path: getRelativeURLPath(path),\n    });\n    return shortLink.url;\n  } catch (err) {\n    console.error('Error when creating shortened link: ', err);\n\n    appEvents.publish({\n      type: AppEvents.alertError.name,\n      payload: ['Error generating shortened link'],\n    });\n  }\n};\n\nexport const createAndCopyShortLink = async (path: string) => {\n  const appEvents = getAppEvents();\n  const shortLink = await createShortLink(path);\n  if (shortLink) {\n    copyText(shortLink);\n    appEvents.publish({\n      type: AppEvents.alertSuccess.name,\n      payload: ['Shortened link copied to clipboard'],\n    });\n  } else {\n    appEvents.publish({\n      type: AppEvents.alertError.name,\n      payload: ['Error generating shortened link'],\n    });\n  }\n};\n\n/**\n * Adapted from /grafana/grafana/public/app/features/explore/utils/links.ts\n * Returns the current URL with absolute time range\n */\nconst constructAbsoluteUrl = (timeRange: SceneTimeRangeLike): string => {\n  const from = toUtc(timeRange.state.value.from);\n  const to = toUtc(timeRange.state.value.to);\n  const location = locationService.getLocation();\n  const searchParams = urlUtil.getUrlSearchParams();\n  searchParams['from'] = from.toISOString();\n  searchParams['to'] = to.toISOString();\n  return urlUtil.renderUrl(location.pathname, searchParams);\n};\n","import { SceneComponentProps, sceneGraph, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Box, Dropdown, Menu, Stack, Tab, TabsBar, ToolbarButton, useStyles2 } from '@grafana/ui';\nimport { getDrilldownSlug, getDrilldownValueSlug, PageSlugs, ValueSlugs } from '../../services/routing';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { getDrillDownTabLink } from '../../services/navigate';\nimport React, { useEffect, useState } from 'react';\nimport { ServiceScene, ServiceSceneCustomState } from './ServiceScene';\nimport { getValueFormat, GrafanaTheme2 } from '@grafana/data';\nimport { css, cx } from '@emotion/css';\nimport { BreakdownViewDefinition, breakdownViewsDefinitions, TabNames } from './BreakdownViews';\nimport { config, usePluginLinks } from '@grafana/runtime';\nimport { getLabelsVariable } from '../../services/variableGetters';\nimport { IndexScene } from '../IndexScene/IndexScene';\nimport { LINE_LIMIT } from '../../services/query';\nimport { ShareButtonScene } from '../IndexScene/ShareButtonScene';\n\nexport interface ActionBarSceneState extends SceneObjectState {\n  maxLines?: number;\n  shareButtonScene?: ShareButtonScene;\n}\n\nexport class ActionBarScene extends SceneObjectBase<ActionBarSceneState> {\n  constructor(state: Partial<ActionBarSceneState>) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    const indexScene = sceneGraph.getAncestor(this, IndexScene);\n    const dataSource = indexScene.state.ds;\n    if (dataSource?.maxLines !== undefined) {\n      this.setState({\n        maxLines: dataSource.maxLines,\n      });\n    }\n\n    if (!this.state.shareButtonScene) {\n      this.setState({\n        shareButtonScene: new ShareButtonScene({}),\n      });\n    }\n  }\n  public static Component = ({ model }: SceneComponentProps<ActionBarScene>) => {\n    const styles = useStyles2(getStyles);\n    let currentBreakdownViewSlug = getDrilldownSlug();\n    let allowNavToParent = false;\n\n    if (!Object.values(PageSlugs).includes(currentBreakdownViewSlug)) {\n      const drilldownValueSlug = getDrilldownValueSlug();\n      allowNavToParent = true;\n      if (drilldownValueSlug === ValueSlugs.field) {\n        currentBreakdownViewSlug = PageSlugs.fields;\n      }\n      if (drilldownValueSlug === ValueSlugs.label) {\n        currentBreakdownViewSlug = PageSlugs.labels;\n      }\n    }\n\n    const serviceScene = sceneGraph.getAncestor(model, ServiceScene);\n    const { loading, $data, logsCount, totalLogsCount, ...state } = serviceScene.useState();\n    const { maxLines } = model.useState();\n\n    const loadingStates = state.loadingStates;\n\n    return (\n      <Box paddingY={0}>\n        <div className={styles.actions}>\n          <Stack gap={1}>\n            {config.featureToggles.appSidecar && <ToolbarExtensionsRenderer serviceScene={serviceScene} />}\n            {model.state.shareButtonScene && (\n              <model.state.shareButtonScene.Component model={model.state.shareButtonScene} />\n            )}\n          </Stack>\n        </div>\n\n        <TabsBar>\n          {breakdownViewsDefinitions.map((tab, index) => {\n            return (\n              <Tab\n                data-testid={tab.testId}\n                key={index}\n                label={tab.displayName}\n                active={currentBreakdownViewSlug === tab.value}\n                counter={loadingStates[tab.displayName] ? undefined : getCounter(tab, state)}\n                suffix={\n                  tab.displayName === TabNames.logs\n                    ? ({ className }) => LogsCount(className, totalLogsCount, logsCount, maxLines ?? LINE_LIMIT)\n                    : undefined\n                }\n                icon={loadingStates[tab.displayName] ? 'spinner' : undefined}\n                href={getDrillDownTabLink(tab.value, serviceScene)}\n                onChangeTab={() => {\n                  if ((tab.value && tab.value !== currentBreakdownViewSlug) || allowNavToParent) {\n                    reportAppInteraction(\n                      USER_EVENTS_PAGES.service_details,\n                      USER_EVENTS_ACTIONS.service_details.action_view_changed,\n                      {\n                        newActionView: tab.value,\n                        previousActionView: currentBreakdownViewSlug,\n                      }\n                    );\n                  }\n                }}\n              />\n            );\n          })}\n        </TabsBar>\n      </Box>\n    );\n  };\n}\nconst getCounter = (tab: BreakdownViewDefinition, state: ServiceSceneCustomState) => {\n  switch (tab.value) {\n    case 'fields':\n      return state.fieldsCount;\n    case 'patterns':\n      return state.patternsCount;\n    case 'labels':\n      return state.labelsCount;\n    default:\n      return undefined;\n  }\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    actions: css({\n      display: 'flex',\n      justifyContent: 'flex-end',\n\n      [theme.breakpoints.up(theme.breakpoints.values.md)]: {\n        position: 'absolute',\n        right: 0,\n        zIndex: 2,\n      },\n    }),\n  };\n}\n\n/**\n * Shows extensions in the toolbar.\n * Shows a single button if there is only one extension or a dropdown if there are multiple.\n * @param props\n * @constructor\n */\nfunction ToolbarExtensionsRenderer(props: { serviceScene: SceneObject }) {\n  const [filters, setFilters] = useState<Array<{ key: string; value: string }>>(\n    getLabelsVariable(props.serviceScene).state.filters\n  );\n  useEffect(() => {\n    const sub = getLabelsVariable(props.serviceScene).subscribeToState((newState) => {\n      setFilters(newState.filters);\n    });\n    return () => {\n      sub.unsubscribe();\n    };\n  }, [props.serviceScene]);\n\n  const [isOpen, setIsOpen] = useState<boolean>(false);\n  const extensions = usePluginLinks({\n    extensionPointId: 'grafana-lokiexplore-app/toolbar-open-related/v1',\n    limitPerPlugin: 3,\n    context: { filters },\n  });\n\n  if (extensions.isLoading || extensions.links.length === 0) {\n    return null;\n  }\n\n  if (extensions.links.length === 1) {\n    const e = extensions.links[0];\n\n    return (\n      <div>\n        <ToolbarButton variant={'canvas'} key={e.id} onClick={(event) => e.onClick?.(event)} icon={e.icon}>\n          Related {e.title}\n        </ToolbarButton>\n      </div>\n    );\n  }\n\n  const menu = (\n    <Menu>\n      {extensions.links.map((link) => {\n        return (\n          <Menu.Item\n            ariaLabel={link.title}\n            icon={link?.icon || 'plug'}\n            key={link.id}\n            label={link.title}\n            onClick={(event) => {\n              link.onClick?.(event);\n            }}\n          />\n        );\n      })}\n    </Menu>\n  );\n\n  return (\n    <Dropdown onVisibleChange={setIsOpen} placement=\"bottom-start\" overlay={menu}>\n      <ToolbarButton aria-label=\"Open related\" variant=\"canvas\" isOpen={isOpen}>\n        Open related\n      </ToolbarButton>\n    </Dropdown>\n  );\n}\n\nfunction LogsCount(\n  className: string | undefined,\n  totalCount: number | undefined,\n  logsCount: number | undefined,\n  maxLines: number\n) {\n  const styles = useStyles2(getLogsCountStyles);\n  const valueFormatter = getValueFormat('short');\n\n  // The instant query (totalCount) doesn't return good results for small result sets, if we're below the max number of lines, use the logs query result instead.\n  if (totalCount === undefined && logsCount !== undefined && logsCount < maxLines) {\n    const formattedCount = valueFormatter(logsCount, 0);\n    return (\n      <span className={cx(className, styles.logsCountStyles)}>\n        {formattedCount.text}\n        {formattedCount.suffix?.trim()}\n      </span>\n    );\n  } else if (totalCount !== undefined) {\n    const formattedTotalCount = valueFormatter(totalCount, 0);\n    return (\n      <span className={cx(className, styles.logsCountStyles)}>\n        {formattedTotalCount.text}\n        {formattedTotalCount.suffix?.trim()}\n      </span>\n    );\n  }\n\n  return <span className={cx(className, styles.emptyCountStyles)}></span>;\n}\n\nfunction getLogsCountStyles(theme: GrafanaTheme2) {\n  return {\n    emptyCountStyles: css({\n      display: 'inline-block',\n      fontSize: theme.typography.bodySmall.fontSize,\n      minWidth: '1em',\n      marginLeft: theme.spacing(1),\n      padding: theme.spacing(0.25, 1),\n    }),\n    logsCountStyles: css({\n      fontSize: theme.typography.bodySmall.fontSize,\n      label: 'counter',\n      marginLeft: theme.spacing(1),\n      borderRadius: theme.spacing(3),\n      backgroundColor: theme.colors.action.hover,\n      padding: theme.spacing(0.25, 1),\n      color: theme.colors.text.secondary,\n      fontWeight: theme.typography.fontWeightMedium,\n    }),\n  };\n}\n","import { locationService } from '@grafana/runtime';\nimport { getLineFiltersVariable } from './variableGetters';\nimport { LineFilterCaseSensitive, LineFilterOp } from './filterTypes';\nimport { ServiceScene } from '../Components/ServiceScene/ServiceScene';\nimport { urlUtil } from '@grafana/data';\nimport { sceneGraph } from '@grafana/scenes';\nimport { IndexScene } from '../Components/IndexScene/IndexScene';\n\nfunction removeEscapeChar(value: string, caseSensitive: boolean) {\n  const charsEscapedByEscapeRegExp = ['^', '$', '.', '*', '+', '?', '(', ')', '[', ']', '{', '}', '|'];\n  if (!caseSensitive) {\n    charsEscapedByEscapeRegExp.push('\\\\');\n  }\n  return value\n    .split('')\n    .filter((char, index, stringArray) => {\n      // We need to differentiate between user entered escape chars, and escape chars added by lodash escapeRegExp to return the same query results in urls from before the line filter regex feature\n      // Since there is no reverse of the escapeRegExp method provided by lodash we're essentially building our own \"unescapeRegExp\"\n      const nextChar = stringArray[index + 1];\n      const isNextCharRegex = charsEscapedByEscapeRegExp.includes(nextChar);\n      return !(char === '\\\\' && isNextCharRegex);\n    })\n    .join('');\n}\n\n/**\n * Migrates old line filter to new variables\n */\nexport function migrateLineFilterV1(serviceScene: ServiceScene) {\n  const search = urlUtil.getUrlSearchParams();\n\n  const deprecatedLineFilterArray = search['var-lineFilter'];\n  if (!Array.isArray(deprecatedLineFilterArray) || !deprecatedLineFilterArray.length) {\n    return;\n  }\n  const deprecatedLineFilter = deprecatedLineFilterArray[0];\n  if (typeof deprecatedLineFilter !== 'string' || !deprecatedLineFilter) {\n    return;\n  }\n\n  const indexScene = sceneGraph.getAncestor(serviceScene, IndexScene);\n  const globalLineFilterVars = getLineFiltersVariable(serviceScene);\n  const caseSensitiveMatches = deprecatedLineFilter?.match(/\\|=.`(.+?)`/);\n\n  if (caseSensitiveMatches && caseSensitiveMatches.length === 2) {\n    indexScene.state.body?.state.lineFilterRenderer?.addActivationHandler(() => {\n      globalLineFilterVars.setState({\n        filters: [\n          {\n            key: LineFilterCaseSensitive.caseSensitive,\n            operator: LineFilterOp.match,\n            value: removeEscapeChar(caseSensitiveMatches[1], true),\n            keyLabel: '0',\n          },\n        ],\n      });\n    });\n  }\n\n  const caseInsensitiveMatches = deprecatedLineFilter?.match(/`\\(\\?i\\)(.+)`/);\n  if (caseInsensitiveMatches && caseInsensitiveMatches.length === 2) {\n    indexScene.state.body?.state.lineFilterRenderer?.addActivationHandler(() => {\n      globalLineFilterVars.updateFilters([\n        {\n          key: LineFilterCaseSensitive.caseInsensitive,\n          operator: LineFilterOp.match,\n          value: removeEscapeChar(caseInsensitiveMatches[1], false),\n          keyLabel: '0',\n        },\n      ]);\n    });\n  }\n\n  // Remove from url without refreshing\n  delete search['var-lineFilter'];\n  locationService.replace(urlUtil.renderUrl(location.pathname, search));\n}\n","import React from 'react';\n\nimport { LoadingState, PanelData } from '@grafana/data';\nimport {\n  QueryRunnerState,\n  SceneComponentProps,\n  SceneDataProvider,\n  SceneDataState,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObject,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneQueryRunner,\n  SceneVariableValueChangedEvent,\n  VariableDependencyConfig,\n} from '@grafana/scenes';\nimport { LoadingPlaceholder } from '@grafana/ui';\nimport { getQueryRunner, getResourceQueryRunner } from 'services/panel';\nimport { buildDataQuery, buildResourceQuery } from 'services/query';\nimport {\n  EMPTY_VARIABLE_VALUE,\n  isAdHocFilterValueUserInput,\n  LEVEL_VARIABLE_VALUE,\n  LOG_STREAM_SELECTOR_EXPR,\n  SERVICE_NAME,\n  SERVICE_UI_LABEL,\n  stripAdHocFilterUserInputPrefix,\n  VAR_DATASOURCE,\n  VAR_FIELDS,\n  VAR_LABELS,\n  VAR_LABELS_EXPR,\n  VAR_LEVELS,\n  VAR_PATTERNS,\n} from 'services/variables';\nimport { getMetadataService } from '../../services/metadata';\nimport { navigateToDrilldownPage, navigateToIndex, navigateToValueBreakdown } from '../../services/navigate';\nimport { areArraysEqual } from '../../services/comparison';\nimport { ActionBarScene } from './ActionBarScene';\nimport { breakdownViewsDefinitions, TabNames, valueBreakdownViews } from './BreakdownViews';\nimport {\n  getDataSourceVariable,\n  getFieldsAndMetadataVariable,\n  getFieldsVariable,\n  getLabelsVariable,\n  getLevelsVariable,\n  getLineFiltersVariable,\n  getMetadataVariable,\n  getPatternsVariable,\n} from '../../services/variableGetters';\nimport { logger } from '../../services/logger';\nimport { IndexScene, showLogsButtonSceneKey } from '../IndexScene/IndexScene';\nimport {\n  getDrilldownSlug,\n  getDrilldownValueSlug,\n  getPrimaryLabelFromUrl,\n  PageSlugs,\n  ValueSlugs,\n} from '../../services/routing';\nimport { replaceSlash } from '../../services/extensions/links';\nimport { ShowLogsButtonScene } from '../IndexScene/ShowLogsButtonScene';\nimport { migrateLineFilterV1 } from '../../services/migrations';\nimport { VariableHide } from '@grafana/schema';\nimport { LEVELS_VARIABLE_SCENE_KEY, LevelsVariableScene } from '../IndexScene/LevelsVariableScene';\nimport { isOperatorInclusive } from '../../services/operatorHelpers';\n\nexport const LOGS_PANEL_QUERY_REFID = 'logsPanelQuery';\nexport const LOGS_COUNT_QUERY_REFID = 'logsCountQuery';\nconst PATTERNS_QUERY_REFID = 'patterns';\nconst DETECTED_LABELS_QUERY_REFID = 'detectedLabels';\nconst DETECTED_FIELDS_QUERY_REFID = 'detectedFields';\n\ntype MakeOptional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\n\ntype ServiceSceneLoadingStates = {\n  [name in TabNames]: boolean;\n};\n\nexport interface ServiceSceneCustomState {\n  labelsCount?: number;\n  patternsCount?: number;\n  fieldsCount?: number;\n  loading?: boolean;\n  totalLogsCount?: number;\n  logsCount?: number;\n}\n\nexport interface ServiceSceneState extends SceneObjectState, ServiceSceneCustomState {\n  body: SceneFlexLayout | undefined;\n  drillDownLabel?: string;\n  $data: SceneDataProvider | undefined;\n  $logsCount: SceneQueryRunner | undefined;\n  $patternsData: SceneQueryRunner | undefined;\n  $detectedLabelsData: SceneQueryRunner | undefined;\n  $detectedFieldsData: SceneQueryRunner | undefined;\n  loadingStates: ServiceSceneLoadingStates;\n}\n\nexport function getLogsPanelFrame(data: PanelData | undefined) {\n  return data?.series.find((series) => series.refId === LOGS_PANEL_QUERY_REFID);\n}\n\nexport function getDetectedLabelsFrame(sceneRef: SceneObject) {\n  const serviceScene = sceneGraph.getAncestor(sceneRef, ServiceScene);\n  return serviceScene.state.$detectedLabelsData?.state.data?.series?.[0];\n}\n\nexport function getDetectedFieldsFrame(sceneRef: SceneObject) {\n  const serviceScene = sceneGraph.getAncestor(sceneRef, ServiceScene);\n  return getDetectedFieldsFrameFromQueryRunnerState(serviceScene.state.$detectedFieldsData?.state);\n}\n\nexport const getDetectedFieldsFrameFromQueryRunnerState = (state?: QueryRunnerState) => {\n  // Only ever one frame in the response\n  return state?.data?.series?.[0];\n};\n\nexport const getDetectedFieldsNamesFromQueryRunnerState = (state: QueryRunnerState) => {\n  // The first field, DETECTED_FIELDS_NAME_FIELD, has the list of names of the detected fields\n  return state.data?.series?.[0]?.fields?.[0];\n};\n\nexport const getDetectedFieldsParsersFromQueryRunnerState = (state: QueryRunnerState) => {\n  // The third field, DETECTED_FIELDS_PARSER_NAME, has the list of parsers of the detected fields\n  return state.data?.series?.[0]?.fields?.[2];\n};\n\nexport class ServiceScene extends SceneObjectBase<ServiceSceneState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_DATASOURCE, VAR_LABELS, VAR_FIELDS, VAR_PATTERNS, VAR_LEVELS],\n  });\n\n  public constructor(\n    state: MakeOptional<\n      ServiceSceneState,\n      | 'body'\n      | '$data'\n      | '$patternsData'\n      | '$detectedLabelsData'\n      | '$detectedFieldsData'\n      | 'loadingStates'\n      | '$logsCount'\n    >\n  ) {\n    super({\n      loadingStates: {\n        [TabNames.patterns]: false,\n        [TabNames.labels]: false,\n        [TabNames.fields]: false,\n        [TabNames.logs]: false,\n      },\n      loading: true,\n      body: state.body ?? buildGraphScene(),\n      $data: getServiceSceneQueryRunner(),\n      $patternsData: getPatternsQueryRunner(),\n      $detectedLabelsData: getDetectedLabelsQueryRunner(),\n      $detectedFieldsData: getDetectedFieldsQueryRunner(),\n      $logsCount: getLogCountQueryRunner(),\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private setSubscribeToLabelsVariable() {\n    const variable = getLabelsVariable(this);\n    if (variable.state.filters.length === 0) {\n      this.redirectToStart();\n      return;\n    }\n    this._subs.add(\n      variable.subscribeToState((newState, prevState) => {\n        if (newState.filters.length === 0) {\n          this.redirectToStart();\n        }\n\n        // If we remove the service name filter, we should redirect to the start\n        let { labelName, labelValue, breakdownLabel } = getPrimaryLabelFromUrl();\n\n        // Before we dynamically pulled label filter keys into the URL, we had hardcoded \"service\" as the primary label slug, we want to keep URLs the same, so overwrite \"service_name\" with \"service\" if that's the primary label\n        if (labelName === SERVICE_UI_LABEL) {\n          labelName = SERVICE_NAME;\n        }\n        const indexScene = sceneGraph.getAncestor(this, IndexScene);\n        const prevRouteMatch = indexScene.state.routeMatch;\n\n        // The \"primary\" label used in the URL is no longer active, pick a new one\n        if (\n          !newState.filters.some(\n            (f) => f.key === labelName && isOperatorInclusive(f.operator) && replaceSlash(f.value) === labelValue\n          )\n        ) {\n          const newPrimaryLabel = newState.filters.find(\n            (f) => isOperatorInclusive(f.operator) && f.value !== EMPTY_VARIABLE_VALUE\n          );\n          if (newPrimaryLabel) {\n            const newPrimaryLabelValue = isAdHocFilterValueUserInput(newPrimaryLabel.value)\n              ? replaceSlash(stripAdHocFilterUserInputPrefix(newPrimaryLabel.value))\n              : replaceSlash(newPrimaryLabel.value);\n            indexScene.setState({\n              routeMatch: {\n                ...prevRouteMatch,\n                params: {\n                  ...prevRouteMatch?.params,\n                  labelName: newPrimaryLabel.key === SERVICE_NAME ? SERVICE_UI_LABEL : newPrimaryLabel.key,\n                  // If there are a bunch of values separated by pipe, like labels that come from explore, let's truncate the value so the slug doesn't get too long\n                  labelValue: newPrimaryLabelValue.split('|')[0],\n                },\n                url: prevRouteMatch?.url ?? '',\n                path: prevRouteMatch?.path ?? '',\n                isExact: prevRouteMatch?.isExact ?? true,\n              },\n            });\n\n            this.resetTabCount();\n\n            if (!breakdownLabel) {\n              navigateToDrilldownPage(getDrilldownSlug(), this);\n            } else {\n              navigateToValueBreakdown(getDrilldownValueSlug(), breakdownLabel, this);\n            }\n          } else {\n            this.redirectToStart();\n          }\n        } else if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.state.$patternsData?.runQueries();\n          this.state.$detectedLabelsData?.runQueries();\n          this.state.$detectedFieldsData?.runQueries();\n          this.state.$logsCount?.runQueries();\n        }\n      })\n    );\n  }\n\n  private redirectToStart() {\n    // Clear ongoing queries\n    this.setState({\n      $data: undefined,\n      $logsCount: undefined,\n      body: undefined,\n      $patternsData: undefined,\n      $detectedLabelsData: undefined,\n      $detectedFieldsData: undefined,\n      patternsCount: undefined,\n      labelsCount: undefined,\n      fieldsCount: undefined,\n      logsCount: undefined,\n      totalLogsCount: undefined,\n    });\n    getMetadataService().setServiceSceneState(this.state);\n    this._subs.unsubscribe();\n\n    // Redirect to root with updated params, which will trigger history push back to index route, preventing empty page or empty service query bugs\n    navigateToIndex();\n  }\n\n  private showVariables() {\n    const levelsVar = sceneGraph.findByKeyAndType(this, LEVELS_VARIABLE_SCENE_KEY, LevelsVariableScene);\n    levelsVar.setState({ visible: true });\n    getFieldsAndMetadataVariable(this).setState({ hide: VariableHide.dontHide });\n  }\n\n  /**\n   * After routing we need to pull any data set to the service scene by other routes from the metadata singleton,\n   * as each route has a different instantiation of this scene\n   * @private\n   */\n  private getMetadata() {\n    const metadataService = getMetadataService();\n    const state = metadataService.getServiceSceneState();\n\n    if (state) {\n      this.setState({\n        ...state,\n      });\n    }\n  }\n\n  private onActivate() {\n    // Hide show logs button\n    const showLogsButton = sceneGraph.findByKeyAndType(this, showLogsButtonSceneKey, ShowLogsButtonScene);\n    showLogsButton.setState({ hidden: true });\n    this.showVariables();\n    this.getMetadata();\n    this.resetBodyAndData();\n\n    this.setBreakdownView();\n\n    // Run queries on activate\n    this.runQueries();\n\n    // Query Subscriptions\n    this._subs.add(this.subscribeToPatternsQuery());\n    this._subs.add(this.subscribeToDetectedLabelsQuery());\n\n    // Fields tab will update its own count, and update count when a query fails\n    this._subs.add(this.subscribeToDetectedFieldsQuery(getDrilldownSlug() !== PageSlugs.fields));\n    this._subs.add(this.subscribeToLogsQuery());\n    this._subs.add(this.subscribeToLogsCountQuery());\n\n    // Variable subscriptions\n    this.setSubscribeToLabelsVariable();\n    this._subs.add(this.subscribeToFieldsVariable());\n    this._subs.add(this.subscribeToMetadataVariable());\n    this._subs.add(this.subscribeToLevelsVariableChangedEvent());\n    this._subs.add(this.subscribeToLevelsVariableFiltersState());\n    this._subs.add(this.subscribeToDataSourceVariable());\n    this._subs.add(this.subscribeToPatternsVariable());\n    this._subs.add(this.subscribeToLineFiltersVariable());\n\n    // Update query runner on manual time range change\n    this._subs.add(this.subscribeToTimeRange());\n\n    // Migrations\n    migrateLineFilterV1(this);\n  }\n\n  private subscribeToPatternsVariable() {\n    return getPatternsVariable(this).subscribeToState((newState, prevState) => {\n      if (newState.value !== prevState.value) {\n        this.state.$detectedFieldsData?.runQueries();\n        this.state.$logsCount?.runQueries();\n      }\n    });\n  }\n\n  private subscribeToLineFiltersVariable() {\n    return getLineFiltersVariable(this).subscribeToEvent(SceneVariableValueChangedEvent, () => {\n      this.state.$logsCount?.runQueries();\n      this.state.$detectedFieldsData?.runQueries();\n    });\n  }\n\n  private subscribeToDataSourceVariable() {\n    return getDataSourceVariable(this).subscribeToState(() => {\n      this.redirectToStart();\n    });\n  }\n\n  private resetTabCount() {\n    this.setState({\n      fieldsCount: undefined,\n      labelsCount: undefined,\n      patternsCount: undefined,\n    });\n\n    getMetadataService().setServiceSceneState(this.state);\n  }\n\n  private subscribeToFieldsVariable() {\n    const fieldsVar = getFieldsVariable(this);\n    return fieldsVar.subscribeToState((newState, prevState) => {\n      if (!areArraysEqual(newState.filters, prevState.filters)) {\n        this.state.$detectedFieldsData?.runQueries();\n        this.state.$logsCount?.runQueries();\n      }\n    });\n  }\n\n  private subscribeToMetadataVariable() {\n    const metadataVar = getMetadataVariable(this);\n    return metadataVar.subscribeToState((newState, prevState) => {\n      if (!areArraysEqual(newState.filters, prevState.filters)) {\n        this.state.$detectedFieldsData?.runQueries();\n        this.state.$logsCount?.runQueries();\n      }\n    });\n  }\n\n  /**\n   * Subscribe to SceneVariableValueChangedEvent and run logs count and detectedFields on update.\n   * In the levels variable renderer we update the ad-hoc filters, but we don't always want to immediately execute queries.\n   */\n  private subscribeToLevelsVariableChangedEvent() {\n    return getLevelsVariable(this).subscribeToEvent(SceneVariableValueChangedEvent, () => {\n      this.state.$detectedFieldsData?.runQueries();\n    });\n  }\n\n  /**\n   * Subscribe to actual filter changes and update the logs count\n   * @private\n   */\n  private subscribeToLevelsVariableFiltersState() {\n    const levelsVariable = getLevelsVariable(this);\n    return levelsVariable.subscribeToState((newState, prevState) => {\n      if (!areArraysEqual(newState.filters, prevState.filters)) {\n        this.state.$logsCount?.runQueries();\n      }\n    });\n  }\n\n  private runQueries() {\n    const slug = getDrilldownSlug();\n    const parentSlug = getDrilldownValueSlug();\n\n    // If we don't have a patterns count in the tabs, or we are activating the patterns scene, run the pattern query\n    if (slug === PageSlugs.patterns || this.state.patternsCount === undefined) {\n      this.state.$patternsData?.runQueries();\n    }\n\n    // If we don't have a detected labels count, or we are activating the labels scene, run the detected labels query\n    if (slug === PageSlugs.labels || parentSlug === ValueSlugs.label || this.state.labelsCount === undefined) {\n      this.state.$detectedLabelsData?.runQueries();\n    }\n\n    // If we don't have a detected fields count, or we are activating the fields scene, run the detected fields query\n    if (slug === PageSlugs.fields || parentSlug === ValueSlugs.field || this.state.fieldsCount === undefined) {\n      this.state.$detectedFieldsData?.runQueries();\n    }\n    if (this.state.logsCount === undefined) {\n      this.state.$logsCount?.runQueries();\n    }\n  }\n\n  private subscribeToPatternsQuery() {\n    return this.state.$patternsData?.subscribeToState((newState) => {\n      this.updateLoadingState(newState, TabNames.patterns);\n      if (newState.data?.state === LoadingState.Done) {\n        const patternsResponse = newState.data.series;\n        if (patternsResponse?.length !== undefined) {\n          // Save the count of patterns to state\n          this.setState({\n            patternsCount: patternsResponse.length,\n          });\n          getMetadataService().setPatternsCount(patternsResponse.length);\n        }\n      }\n    });\n  }\n\n  private subscribeToDetectedLabelsQuery() {\n    return this.state.$detectedLabelsData?.subscribeToState((newState) => {\n      this.updateLoadingState(newState, TabNames.labels);\n      if (newState.data?.state === LoadingState.Done) {\n        const detectedLabelsResponse = newState.data;\n        // Detected labels API call always returns a single frame, with a field for each label\n        const detectedLabelsFields = detectedLabelsResponse.series[0].fields;\n        if (detectedLabelsResponse.series.length !== undefined && detectedLabelsFields.length !== undefined) {\n          const removeSpecialFields = detectedLabelsResponse.series[0].fields.filter(\n            (f) => LEVEL_VARIABLE_VALUE !== f.name\n          );\n\n          this.setState({\n            labelsCount: removeSpecialFields.length + 1, // Add one for detected_level\n          });\n          getMetadataService().setLabelsCount(detectedLabelsFields.length);\n        }\n      }\n    });\n  }\n\n  private updateLoadingState(newState: SceneDataState, key: keyof ServiceSceneLoadingStates) {\n    const loadingStates = this.state.loadingStates;\n    loadingStates[key] = newState.data?.state === LoadingState.Loading;\n    // set loading state to true if any of the queries are loading\n    const loading = Object.values(loadingStates).some((v) => v);\n    this.setState({ loading, loadingStates });\n  }\n\n  private subscribeToLogsQuery() {\n    return this.state.$data?.subscribeToState((newState, prevState) => {\n      this.updateLoadingState(newState, TabNames.logs);\n      if (newState.data?.state === LoadingState.Done || newState.data?.state === LoadingState.Streaming) {\n        const resultCount = newState.data.series[0]?.length ?? 0;\n        if (resultCount !== this.state.logsCount) {\n          this.setState({\n            logsCount: resultCount,\n          });\n        }\n      }\n    });\n  }\n\n  private subscribeToLogsCountQuery() {\n    return this.state.$logsCount?.subscribeToState((newState) => {\n      if (newState.data?.state === LoadingState.Done) {\n        const value: number | undefined = newState.data.series[0]?.fields?.[1]?.values?.[0];\n        this.setState({\n          totalLogsCount: value,\n        });\n      }\n    });\n  }\n\n  private subscribeToDetectedFieldsQuery(updateFieldsCount: boolean) {\n    return this.state.$detectedFieldsData?.subscribeToState((newState) => {\n      this.updateLoadingState(newState, TabNames.fields);\n      if (updateFieldsCount && newState.data?.state === LoadingState.Done) {\n        const detectedFieldsResponse = newState.data;\n        const detectedFieldsFields = detectedFieldsResponse.series[0];\n\n        if (detectedFieldsFields !== undefined && detectedFieldsFields.length !== this.state.fieldsCount) {\n          this.setState({\n            fieldsCount: detectedFieldsFields.length,\n          });\n          getMetadataService().setFieldsCount(detectedFieldsFields.length);\n        }\n      }\n    });\n  }\n\n  private subscribeToTimeRange() {\n    return sceneGraph.getTimeRange(this).subscribeToState(() => {\n      this.state.$patternsData?.runQueries();\n      this.state.$detectedLabelsData?.runQueries();\n      this.state.$detectedFieldsData?.runQueries();\n      this.state.$logsCount?.runQueries();\n    });\n  }\n\n  private resetBodyAndData() {\n    let stateUpdate: Partial<ServiceSceneState> = {};\n\n    if (!this.state.$data) {\n      stateUpdate.$data = getServiceSceneQueryRunner();\n    }\n\n    if (!this.state.$patternsData) {\n      stateUpdate.$patternsData = getPatternsQueryRunner();\n    }\n\n    if (!this.state.$detectedLabelsData) {\n      stateUpdate.$detectedLabelsData = getDetectedLabelsQueryRunner();\n    }\n\n    if (!this.state.$detectedFieldsData) {\n      stateUpdate.$detectedFieldsData = getDetectedFieldsQueryRunner();\n    }\n\n    if (!this.state.$logsCount) {\n      stateUpdate.$logsCount = getLogCountQueryRunner();\n    }\n\n    if (!this.state.body) {\n      stateUpdate.body = buildGraphScene();\n    }\n\n    if (Object.keys(stateUpdate).length) {\n      this.setState(stateUpdate);\n    }\n  }\n\n  public setBreakdownView() {\n    const { body } = this.state;\n    const breakdownView = getDrilldownSlug();\n    const breakdownViewDef = breakdownViewsDefinitions.find((v) => v.value === breakdownView);\n\n    if (!body) {\n      const err = new Error('body is not defined in setBreakdownView!');\n      logger.error(err, { msg: 'ServiceScene setBreakdownView error' });\n      throw err;\n    }\n\n    if (breakdownViewDef) {\n      body.setState({\n        children: [\n          ...body.state.children.slice(0, 1),\n          breakdownViewDef.getScene((length) => {\n            if (breakdownViewDef.value === 'fields') {\n              this.setState({ fieldsCount: length });\n            }\n          }),\n        ],\n      });\n    } else {\n      const valueBreakdownView = getDrilldownValueSlug();\n      const valueBreakdownViewDef = valueBreakdownViews.find((v) => v.value === valueBreakdownView);\n\n      if (valueBreakdownViewDef && this.state.drillDownLabel) {\n        body.setState({\n          children: [...body.state.children.slice(0, 1), valueBreakdownViewDef.getScene(this.state.drillDownLabel)],\n        });\n      } else {\n        logger.error(new Error('not setting breakdown view'), { msg: 'setBreakdownView error' });\n      }\n    }\n  }\n\n  static Component = ({ model }: SceneComponentProps<ServiceScene>) => {\n    const { body } = model.useState();\n    if (body) {\n      return <body.Component model={body} />;\n    }\n\n    return <LoadingPlaceholder text={'Loading...'} />;\n  };\n}\n\nfunction buildGraphScene() {\n  return new SceneFlexLayout({\n    direction: 'column',\n    children: [\n      new SceneFlexItem({\n        ySizing: 'content',\n        body: new ActionBarScene({}),\n      }),\n    ],\n  });\n}\n\nfunction getPatternsQueryRunner() {\n  return getResourceQueryRunner([\n    buildResourceQuery(`{${VAR_LABELS_EXPR}}`, 'patterns', { refId: PATTERNS_QUERY_REFID }),\n  ]);\n}\n\nfunction getDetectedLabelsQueryRunner() {\n  return getResourceQueryRunner([\n    buildResourceQuery(`{${VAR_LABELS_EXPR}}`, 'detected_labels', { refId: DETECTED_LABELS_QUERY_REFID }),\n  ]);\n}\n\nfunction getDetectedFieldsQueryRunner() {\n  return getResourceQueryRunner([\n    buildResourceQuery(LOG_STREAM_SELECTOR_EXPR, 'detected_fields', { refId: DETECTED_FIELDS_QUERY_REFID }),\n  ]);\n}\n\nfunction getServiceSceneQueryRunner() {\n  return getQueryRunner([buildDataQuery(LOG_STREAM_SELECTOR_EXPR, { refId: LOGS_PANEL_QUERY_REFID })]);\n}\n\nfunction getLogCountQueryRunner() {\n  const queryRunner = getQueryRunner(\n    [\n      buildDataQuery(`sum(count_over_time(${LOG_STREAM_SELECTOR_EXPR}[$__auto]))`, {\n        refId: LOGS_COUNT_QUERY_REFID,\n        queryType: 'instant',\n      }),\n    ],\n    { runQueriesMode: 'manual' } // for some reason when this query is set to auto, it doesn't run on time range update, looks like there is different behavior with data providers not in the special $data prop\n  );\n\n  if (queryRunner instanceof SceneQueryRunner) {\n    return queryRunner;\n  }\n  const error = new Error('log count query provider is not query runner!');\n  logger.error(error, { msg: 'getLogCountQueryRunner: invalid return type' });\n  throw error;\n}\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport React from 'react';\nimport { Icon, ToolbarButton, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { getFavoriteLabelValuesFromStorage } from '../../services/store';\nimport { addToFavorites, removeFromFavorites } from '../../services/favorites';\n\nexport interface FavoriteServiceHeaderActionSceneState extends SceneObjectState {\n  labelValue: string;\n  labelName: string;\n  ds: string;\n  hover?: boolean;\n}\n\nexport class FavoriteServiceHeaderActionScene extends SceneObjectBase<FavoriteServiceHeaderActionSceneState> {\n  public static Component = ({ model }: SceneComponentProps<FavoriteServiceHeaderActionScene>) => {\n    const { ds, labelValue, labelName, hover } = model.useState();\n    const isFavorite = getFavoriteLabelValuesFromStorage(ds, labelName).includes(labelValue);\n    const styles = useStyles2((theme) => getStyles(theme, isFavorite, hover));\n    const tooltipCopy = isFavorite ? `Remove  ${labelValue} from favorites` : `Add ${labelValue} to favorites`;\n\n    return (\n      <span className={styles.wrapper}>\n        <ToolbarButton\n          onMouseOver={() => {\n            model.setHover(true);\n          }}\n          onMouseOut={() => {\n            model.setHover(false);\n          }}\n          icon={<Icon name={isFavorite ? 'favorite' : 'star'} size=\"lg\" type={isFavorite ? 'mono' : 'default'} />}\n          color={isFavorite ? 'rgb(235, 123, 24)' : '#ccc'}\n          onClick={() => model.onClick(isFavorite)}\n          name={'star'}\n          aria-label={tooltipCopy}\n          tooltip={tooltipCopy}\n        />\n      </span>\n    );\n  };\n\n  public setHover(hover: boolean) {\n    this.setState({\n      hover,\n    });\n  }\n\n  public onClick(isFavorite: boolean) {\n    if (isFavorite) {\n      removeFromFavorites(this.state.labelName, this.state.labelValue, this);\n    } else {\n      addToFavorites(this.state.labelName, this.state.labelValue, this);\n    }\n  }\n}\n\nfunction getStyles(theme: GrafanaTheme2, isFavorite: boolean, hover = false) {\n  return {\n    wrapper: css({\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'center',\n      alignSelf: 'center',\n    }),\n  };\n}\n","import React from 'react';\n\nimport { SceneComponentProps, SceneObject, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { LinkButton, useStyles2 } from '@grafana/ui';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getDrillDownIndexLink, pushUrlHandler } from '../../services/navigate';\nimport { getLabelsVariable } from '../../services/variableGetters';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { SERVICE_NAME, SERVICE_UI_LABEL } from '../../services/variables';\nimport { FilterOp } from '../../services/filterTypes';\nimport { testIds } from '../../services/testIds';\nimport { addToFavorites } from '../../services/favorites';\n\nexport interface SelectServiceButtonState extends SceneObjectState {\n  labelValue: string;\n  labelName: string;\n}\n\nexport class SelectServiceButton extends SceneObjectBase<SelectServiceButtonState> {\n  public getLink = () => {\n    if (!this.state.labelValue) {\n      return;\n    }\n\n    return getLabelDrilldownLink(this.state.labelName, this.state.labelValue, this);\n  };\n\n  public onClick = () => {\n    selectLabel(this.state.labelName, this.state.labelValue, this);\n  };\n\n  public static Component = ({ model }: SceneComponentProps<SelectServiceButton>) => {\n    const styles = useStyles2(getStyles);\n    const labels = getLabelsVariable(model);\n    // Re-render links on label filter changes\n    labels.useState();\n    const link = model.getLink();\n    return (\n      <LinkButton\n        data-testid={testIds.index.showLogsButton}\n        tooltip={`View logs for ${model.state.labelValue}`}\n        className={styles.button}\n        variant=\"secondary\"\n        size=\"sm\"\n        disabled={!link}\n        href={model.getLink()}\n        onClick={model.onClick}\n      >\n        Show logs\n      </LinkButton>\n    );\n  };\n}\n\n/**\n * Select label tracking and add to favorites\n */\nfunction selectLabel(primaryLabelName: string, primaryLabelValue: string, sceneRef: SceneObject) {\n  reportAppInteraction(USER_EVENTS_PAGES.service_selection, USER_EVENTS_ACTIONS.service_selection.service_selected, {\n    value: primaryLabelValue,\n    label: primaryLabelName,\n  });\n\n  addToFavorites(primaryLabelName, primaryLabelValue, sceneRef);\n}\n\n/**\n * Builds label drilldown link\n */\nexport function getLabelDrilldownLink(primaryLabelName: string, primaryLabelValue: string, sceneRef: SceneObject) {\n  const variable = getLabelsVariable(sceneRef);\n\n  const filteredFilters = variable.state.filters.filter(\n    (f) => !(f.key === primaryLabelName && f.value === primaryLabelValue)\n  );\n\n  const filters = [\n    ...filteredFilters,\n    {\n      key: primaryLabelName,\n      operator: FilterOp.Equal,\n      value: primaryLabelValue,\n    },\n  ];\n\n  if (primaryLabelName === SERVICE_NAME) {\n    primaryLabelName = SERVICE_UI_LABEL;\n  }\n\n  const clonedVar = variable.clone({ filters });\n\n  // In this case, we don't have a ServiceScene created yet, so we call a special function to navigate there for the first time\n  return getDrillDownIndexLink(primaryLabelName, primaryLabelValue, clonedVar.urlSync?.getUrlState());\n}\n\n/**\n * Navigates to drilldown\n */\nexport function goToLabelDrillDownLink(primaryLabelName: string, primaryLabelValue: string, sceneRef: SceneObject) {\n  const link = getLabelDrilldownLink(primaryLabelName, primaryLabelValue, sceneRef);\n  selectLabel(primaryLabelName, primaryLabelValue, sceneRef);\n  pushUrlHandler(link);\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    button: css({\n      alignSelf: 'center',\n    }),\n  };\n}\n","import React from 'react';\nimport { GrotError } from 'Components/GrotError';\nimport { TextLink, Text } from '@grafana/ui';\n\nexport const ConfigureVolumeError = () => {\n  return (\n    <GrotError>\n      <p>Log volume has not been configured.</p>\n      <p>\n        <TextLink href=\"https://grafana.com/docs/loki/latest/reference/api/#query-log-volume\" external>\n          Instructions to enable volume in the Loki config:\n        </TextLink>\n      </p>\n      <Text textAlignment=\"left\">\n        <pre>\n          <code>\n            limits_config:\n            <br />\n            &nbsp;&nbsp;volume_enabled: true\n          </code>\n        </pre>\n      </Text>\n    </GrotError>\n  );\n};\n","import React from 'react';\nimport { GrotError } from 'Components/GrotError';\n\nexport const NoServiceSearchResults = () => {\n  return (\n    <GrotError>\n      <p>No service matched your search.</p>\n    </GrotError>\n  );\n};\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Select, Stack, useStyles2 } from '@grafana/ui';\nimport React from 'react';\nimport { ServiceSelectionScene } from './ServiceSelectionScene';\nimport { ServiceSelectionTabsScene, TabOption } from './ServiceSelectionTabsScene';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { css } from '@emotion/css';\n\nexport interface TabPopoverSceneState extends SceneObjectState {}\n\nexport class TabPopoverScene extends SceneObjectBase<TabPopoverSceneState> {\n  public static Component = ({ model }: SceneComponentProps<TabPopoverScene>) => {\n    const serviceSelectionScene = sceneGraph.getAncestor(model, ServiceSelectionScene);\n    const serviceSelectionTabsScene = sceneGraph.getAncestor(model, ServiceSelectionTabsScene);\n    const { tabOptions, showPopover } = serviceSelectionTabsScene.useState();\n    const popoverStyles = useStyles2(getPopoverStyles);\n\n    const tabOptionsWithIcon: TabOption[] = tabOptions.map((opt) => {\n      return {\n        ...opt,\n        icon: opt.saved ? 'save' : undefined,\n        label: `${opt.label}`,\n      };\n    });\n\n    return (\n      <Stack direction=\"column\" gap={0} role=\"tooltip\">\n        <div className={popoverStyles.card.body}>\n          <Select<string, { options: TabOption[] }>\n            menuShouldPortal={false}\n            width={50}\n            onBlur={() => {\n              serviceSelectionTabsScene.toggleShowPopover();\n            }}\n            autoFocus={true}\n            isOpen={showPopover}\n            placeholder={'Search labels'}\n            options={tabOptionsWithIcon}\n            isSearchable={true}\n            openMenuOnFocus={true}\n            onChange={(option) => {\n              // Add value to variable\n              if (option.value) {\n                // Hide the popover\n                serviceSelectionTabsScene.toggleShowPopover();\n                // Set new tab\n                serviceSelectionScene.setSelectedTab(option.value);\n              }\n            }}\n          />\n        </div>\n      </Stack>\n    );\n  };\n}\n\nconst getPopoverStyles = (theme: GrafanaTheme2) => ({\n  card: {\n    body: css({\n      padding: theme.spacing(1),\n    }),\n    p: css({\n      maxWidth: 300,\n    }),\n  },\n});\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState, SceneQueryRunner } from '@grafana/scenes';\nimport React, { useRef } from 'react';\nimport { Icon, Popover, PopoverController, Tab, TabsBar, Tooltip, useStyles2 } from '@grafana/ui';\nimport { GrafanaTheme2, LoadingState, SelectableValue } from '@grafana/data';\nimport { css, cx } from '@emotion/css';\nimport { SERVICE_NAME, SERVICE_UI_LABEL } from '../../services/variables';\nimport { truncateText } from '../../services/text';\nimport { rest } from 'lodash';\nimport { ServiceSelectionScene } from './ServiceSelectionScene';\nimport { getSceneQueryRunner } from '../../services/panel';\nimport { buildResourceQuery } from '../../services/query';\nimport { TabPopoverScene } from './TabPopoverScene';\nimport { getDataSourceVariable, getServiceSelectionPrimaryLabel } from '../../services/variableGetters';\nimport { getFavoriteTabsFromStorage, removeTabFromLocalStorage } from '../../services/store';\n\nexport interface TabOption extends SelectableValue<string> {\n  label: string;\n  value: string;\n  active?: boolean;\n  saved?: boolean;\n  savedIndex?: number;\n}\n\nexport interface ServiceSelectionTabsSceneState extends SceneObjectState {\n  tabOptions: TabOption[];\n  showPopover: boolean;\n  $labelsData: SceneQueryRunner;\n  popover?: TabPopoverScene;\n}\n\ninterface LabelOptions {\n  label: string;\n  cardinality: number;\n}\n\nexport class ServiceSelectionTabsScene extends SceneObjectBase<ServiceSelectionTabsSceneState> {\n  constructor(state: Partial<ServiceSelectionTabsSceneState>) {\n    super({\n      showPopover: false,\n      $labelsData: getSceneQueryRunner({\n        queries: [buildResourceQuery('', 'detected_labels')],\n        runQueriesMode: 'manual',\n      }),\n      tabOptions: [\n        {\n          label: SERVICE_UI_LABEL,\n          value: SERVICE_NAME,\n          saved: true,\n        },\n      ],\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public static Component = ({ model }: SceneComponentProps<ServiceSelectionTabsScene>) => {\n    // Scene vars\n    const { tabOptions, showPopover, popover, $labelsData } = model.useState();\n    const { data } = $labelsData.useState();\n    const serviceSelectionScene = sceneGraph.getAncestor(model, ServiceSelectionScene);\n    const primaryLabel = getServiceSelectionPrimaryLabel(model);\n    // Re-render when active tab changes, which is stored in the primary label variable\n    primaryLabel.useState();\n\n    // Constants\n    const styles = useStyles2(getTabsStyles);\n    const popoverRef = useRef<HTMLElement>(null);\n    const maxLabelLength = 15;\n\n    return (\n      <TabsBar className={styles.tabs}>\n        {tabOptions\n          .filter((tabLabel) => tabLabel.saved || tabLabel.active || tabLabel.value === SERVICE_NAME)\n          .sort((a, b) => {\n            // Service name goes first\n            if (a.value === SERVICE_NAME || b.value === SERVICE_NAME) {\n              return a.value === SERVICE_NAME ? -1 : 1;\n            }\n\n            // Then sort by the order added to local storage\n            return (a.savedIndex ?? 0) - (b.savedIndex ?? 0);\n          })\n          .map((tabLabel) => {\n            const tab = (\n              <Tab\n                key={tabLabel.value}\n                onChangeTab={() => {\n                  // Set the new active tab\n                  serviceSelectionScene.setSelectedTab(tabLabel.value);\n                }}\n                label={truncateText(tabLabel.label, maxLabelLength, true)}\n                active={tabLabel.active}\n                suffix={\n                  tabLabel.value !== SERVICE_NAME\n                    ? (props) => {\n                        return (\n                          <>\n                            <Tooltip content={'Remove tab'}>\n                              <Icon\n                                onKeyDownCapture={(e) => {\n                                  if (e.key === 'Enter') {\n                                    model.removeSavedTab(tabLabel.value);\n                                  }\n                                }}\n                                onClick={(e) => {\n                                  // Don't bubble up to the tab component, we don't want to select the tab we're removing\n                                  e.stopPropagation();\n                                  model.removeSavedTab(tabLabel.value);\n                                }}\n                                name={'times'}\n                                className={cx(props.className)}\n                              />\n                            </Tooltip>\n                          </>\n                        );\n                      }\n                    : undefined\n                }\n              />\n            );\n\n            if (tabLabel.label.length > maxLabelLength) {\n              return (\n                <Tooltip key={tabLabel.value} content={tabLabel.label}>\n                  {tab}\n                </Tooltip>\n              );\n            } else {\n              return tab;\n            }\n          })}\n        {data?.state === LoadingState.Loading && <Tab label={'Loading tabs'} icon={'spinner'} />}\n\n        {/* Add more tabs tab */}\n        {data?.state === LoadingState.Done && (\n          <span className={styles.addTab}>\n            <Tab onChangeTab={model.toggleShowPopover} label={'Add label'} ref={popoverRef} icon={'plus-circle'} />\n          </span>\n        )}\n\n        {popover && (\n          <PopoverController content={<popover.Component model={popover} />}>\n            {(showPopper, hidePopper, popperProps) => {\n              const blurFocusProps = {\n                onBlur: hidePopper,\n                onFocus: showPopper,\n              };\n\n              return (\n                <>\n                  {popoverRef.current && (\n                    <>\n                      {/* @ts-expect-error @todo upgrade typescript */}\n                      <Popover\n                        {...popperProps}\n                        {...rest}\n                        show={showPopover}\n                        wrapperClassName={styles.popover}\n                        referenceElement={popoverRef.current}\n                        renderArrow={true}\n                        {...blurFocusProps}\n                      />\n                    </>\n                  )}\n                </>\n              );\n            }}\n          </PopoverController>\n        )}\n      </TabsBar>\n    );\n  };\n\n  removeSavedTab = (labelName: string) => {\n    removeTabFromLocalStorage(getDataSourceVariable(this).getValue().toString(), labelName);\n\n    const labels = this.getLabelsFromQueryRunnerState();\n    if (labels) {\n      this.populatePrimaryLabelsVariableOptions(labels);\n    }\n\n    // If the user is closing the active tab, select the default tab\n    const serviceSelectionScene = sceneGraph.getAncestor(this, ServiceSelectionScene);\n    if (serviceSelectionScene.getSelectedTab() === labelName) {\n      serviceSelectionScene.selectDefaultLabelTab();\n    }\n  };\n\n  toggleShowPopover = () => {\n    this.setState({\n      showPopover: !this.state.showPopover,\n    });\n  };\n\n  getLabelsFromQueryRunnerState(state = this.state.$labelsData?.state): LabelOptions[] | undefined {\n    return state.data?.series[0].fields.map((f) => {\n      return {\n        label: f.name,\n        cardinality: f.values[0],\n      };\n    });\n  }\n\n  public populatePrimaryLabelsVariableOptions(labels: LabelOptions[]) {\n    const serviceSelectionScene = sceneGraph.getAncestor(this, ServiceSelectionScene);\n    const selectedTab = serviceSelectionScene.getSelectedTab();\n    const savedTabs = getFavoriteTabsFromStorage(getDataSourceVariable(this).getValue().toString());\n\n    const tabOptions: TabOption[] = labels\n      .map((l) => {\n        const savedIndex = savedTabs.indexOf(l.label);\n        const option: TabOption = {\n          label: l.label === SERVICE_NAME ? SERVICE_UI_LABEL : l.label,\n          value: l.label,\n          active: selectedTab === l.label,\n          saved: savedIndex !== -1,\n          savedIndex,\n        };\n        return option;\n      })\n      .sort((a, b) => {\n        // Sort service first\n        if (a.value === SERVICE_NAME || b.value === SERVICE_NAME) {\n          return a.value === SERVICE_NAME ? -1 : 1;\n        }\n\n        // Then sort alphabetically\n        return a.label < b.label ? -1 : a.label > b.label ? 1 : 0;\n      });\n    this.setState({\n      tabOptions,\n    });\n  }\n\n  private runDetectedLabels() {\n    this.state.$labelsData.runQueries();\n  }\n\n  private runDetectedLabelsSubs() {\n    // Update labels/tabs on time range change\n    this._subs.add(\n      sceneGraph.getTimeRange(this).subscribeToState(() => {\n        this.runDetectedLabels();\n      })\n    );\n\n    // Update labels (tabs) when datasource is changed\n    this._subs.add(\n      getDataSourceVariable(this).subscribeToState(() => {\n        this.runDetectedLabels();\n      })\n    );\n  }\n\n  private onActivate() {\n    // Get labels\n    this.runDetectedLabels();\n\n    this.setState({\n      popover: new TabPopoverScene({}),\n    });\n\n    this.runDetectedLabelsSubs();\n\n    // Update labels (tabs) when datasource is changed\n    this._subs.add(\n      getDataSourceVariable(this).subscribeToState(() => {\n        this.state.$labelsData.runQueries();\n      })\n    );\n\n    this._subs.add(\n      getServiceSelectionPrimaryLabel(this).subscribeToState(() => {\n        const labels = this.getLabelsFromQueryRunnerState(this.state.$labelsData?.state);\n        if (labels) {\n          this.populatePrimaryLabelsVariableOptions(labels);\n        }\n      })\n    );\n\n    this._subs.add(\n      this.state.$labelsData.subscribeToState((newState) => {\n        if (newState.data?.state === LoadingState.Done) {\n          const labels = this.getLabelsFromQueryRunnerState(newState);\n          const serviceSelectionScene = sceneGraph.getAncestor(this, ServiceSelectionScene);\n\n          if (labels) {\n            this.populatePrimaryLabelsVariableOptions(labels);\n          }\n\n          const selectedTab = serviceSelectionScene.getSelectedTab();\n          // If the tab is no longer available, either because the user changed the datasource, or time range, select the default tab\n          if (!labels?.some((label) => label.label === selectedTab)) {\n            serviceSelectionScene.selectDefaultLabelTab();\n          }\n        }\n      })\n    );\n  }\n}\n\nconst getTabsStyles = (theme: GrafanaTheme2) => ({\n  tabs: css({\n    overflowY: 'hidden',\n  }),\n  addTab: css({\n    label: 'add-label-tab',\n    color: theme.colors.primary.text,\n    '& button': {\n      color: theme.colors.primary.text,\n    },\n  }),\n  popover: css({\n    borderRadius: theme.shape.radius.default,\n    boxShadow: theme.shadows.z3,\n    background: theme.colors.background.primary,\n    border: `1px solid ${theme.colors.border.weak}`,\n  }),\n});\n","import React from 'react';\nimport { GrotError } from 'Components/GrotError';\n\nexport const NoServiceVolume = (props: { labelName: string }) => {\n  return (\n    <GrotError>\n      <p>\n        No logs found in <strong>{props.labelName}</strong>.<br />\n        Please adjust time range or select another label.\n      </p>\n    </GrotError>\n  );\n};\n","import { SceneComponentProps, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport { testIds } from '../../services/testIds';\nimport { addToFilters, FilterType } from '../ServiceScene/Breakdowns/AddToFiltersButton';\nimport { VAR_LABELS } from '../../services/variables';\nimport { getLabelsVariable, getValueFromAdHocVariableFilter } from '../../services/variableGetters';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { css } from '@emotion/css';\nimport React from 'react';\nimport { FilterOp } from '../../services/filterTypes';\n\nexport interface AddLabelToFiltersHeaderActionSceneState extends SceneObjectState {\n  name: string;\n  value: string;\n  hidden?: boolean;\n  included: boolean | null;\n}\n\nexport class AddLabelToFiltersHeaderActionScene extends SceneObjectBase<AddLabelToFiltersHeaderActionSceneState> {\n  constructor(state: Omit<AddLabelToFiltersHeaderActionSceneState, 'included'>) {\n    super({\n      ...state,\n      included: null,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this.setState({ ...this.isSelected() });\n    this._subs.add(\n      getLabelsVariable(this).subscribeToState(() => {\n        const selected = this.isSelected();\n        if (this.state.included !== selected.included) {\n          this.setState({ ...selected });\n        }\n      })\n    );\n  }\n\n  isSelected = () => {\n    const variable = getLabelsVariable(this);\n\n    // Check if the filter is already there\n    const filterInSelectedFilters = variable.state.filters.find((f) => {\n      const value = getValueFromAdHocVariableFilter(VAR_LABELS, f);\n      return f.key === this.state.name && value.value === this.state.value;\n    });\n\n    if (!filterInSelectedFilters) {\n      return { included: false };\n    }\n\n    // @todo support regex operator\n    return {\n      included: filterInSelectedFilters.operator === FilterOp.Equal,\n    };\n  };\n\n  public static Component = ({ model }: SceneComponentProps<AddLabelToFiltersHeaderActionScene>) => {\n    const { value, hidden, included } = model.useState();\n\n    if (hidden) {\n      return <></>;\n    }\n\n    const styles = useStyles2(getStyles);\n    return (\n      <span className={styles.wrapper}>\n        <Button\n          tooltip={included === true ? `Remove ${value} from filters` : `Add ${value} to filters`}\n          variant={'secondary'}\n          fill={'outline'}\n          icon={included === true ? 'minus' : 'plus'}\n          size=\"sm\"\n          aria-selected={included === true}\n          className={styles.includeButton}\n          onClick={() => (included === true ? model.onClick('clear') : model.onClick('include'))}\n          data-testid={testIds.exploreServiceDetails.buttonFilterInclude}\n        />\n      </span>\n    );\n  };\n\n  public getFilter() {\n    return { name: this.state.name, value: this.state.value };\n  }\n\n  public onClick = (type: FilterType) => {\n    const filter = this.getFilter();\n\n    addToFilters(filter.name, filter.value, type, this, VAR_LABELS);\n\n    const variable = getLabelsVariable(this);\n    reportAppInteraction(USER_EVENTS_PAGES.service_selection, USER_EVENTS_ACTIONS.service_selection.add_to_filters, {\n      filterType: 'index-filters',\n      key: filter.name,\n      action: type,\n      filtersLength: variable?.state.filters.length || 0,\n    });\n\n    this.setState({ ...this.isSelected() });\n  };\n}\n\nconst getStyles = () => {\n  return {\n    container: css({\n      display: 'flex',\n      justifyContent: 'center',\n    }),\n    includeButton: css({\n      borderRadius: 0,\n    }),\n    wrapper: css({\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'center',\n      alignSelf: 'center',\n    }),\n  };\n};\n","import { SceneComponentProps, sceneGraph, SceneObjectBase, SceneObjectState } from '@grafana/scenes';\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { css } from '@emotion/css';\nimport { IconButton, Pagination, Select, useStyles2 } from '@grafana/ui';\nimport React, { useEffect } from 'react';\nimport { ServiceSelectionScene } from './ServiceSelectionScene';\nimport { setServiceSelectionPageCount } from '../../services/store';\n\nexport interface ServiceSelectionPaginationSceneState extends SceneObjectState {}\n\nexport class ServiceSelectionPaginationScene extends SceneObjectBase<ServiceSelectionPaginationSceneState> {\n  public static PageCount = ({\n    model,\n    totalCount,\n  }: SceneComponentProps<ServiceSelectionPaginationScene> & { totalCount: number }) => {\n    const styles = useStyles2(getPageCountStyles);\n    const serviceSelectionScene = sceneGraph.getAncestor(model, ServiceSelectionScene);\n    const { countPerPage } = serviceSelectionScene.useState();\n    const options = getCountOptionsFromTotal(totalCount);\n    useEffect(() => {\n      const lastOptionValue = options[options.length - 1]?.value ?? countPerPage.toString();\n      if (countPerPage.toString() > lastOptionValue) {\n        serviceSelectionScene.setState({ countPerPage: parseInt(lastOptionValue, 10) });\n      }\n    }, [countPerPage, options, serviceSelectionScene]);\n    return (\n      <span className={styles.searchPageCountWrap}>\n        <span className={styles.searchFieldPlaceholderText}>\n          Showing{' '}\n          <Select\n            className={styles.select}\n            onChange={(value) => {\n              if (value.value) {\n                const countPerPage = parseInt(value.value, 10);\n                serviceSelectionScene.setState({ countPerPage, currentPage: 1 });\n                serviceSelectionScene.updateBody();\n                setServiceSelectionPageCount(countPerPage);\n              }\n            }}\n            options={options}\n            value={countPerPage.toString()}\n          />{' '}\n          of {totalCount}{' '}\n          <IconButton\n            className={styles.icon}\n            aria-label=\"Count info\"\n            name={'info-circle'}\n            tooltip={`${totalCount} labels have values for the selected time range. Total label count may differ`}\n          />\n        </span>\n      </span>\n    );\n  };\n  public static Component = ({\n    model,\n    totalCount,\n  }: SceneComponentProps<ServiceSelectionPaginationScene> & { totalCount: number }) => {\n    const serviceSelectionScene = sceneGraph.getAncestor(model, ServiceSelectionScene);\n    const { countPerPage, currentPage } = serviceSelectionScene.useState();\n    const getStyles = (theme: GrafanaTheme2) => ({\n      pagination: css({\n        float: 'none',\n      }),\n      paginationWrap: css({\n        [theme.breakpoints.up('lg')]: {\n          display: 'none',\n        },\n        [theme.breakpoints.down('lg')]: {\n          display: 'flex',\n          justifyContent: 'flex-end',\n          flex: '1 0 auto',\n        },\n      }),\n      paginationWrapMd: css({\n        [theme.breakpoints.down('lg')]: {\n          display: 'none',\n        },\n        [theme.breakpoints.up('lg')]: {\n          display: 'flex',\n          justifyContent: 'flex-end',\n          flex: '1 0 auto',\n        },\n      }),\n    });\n\n    const styles = useStyles2(getStyles);\n\n    if (totalCount > countPerPage) {\n      return (\n        <>\n          <span className={styles.paginationWrapMd}>\n            <Pagination\n              className={styles.pagination}\n              currentPage={currentPage}\n              numberOfPages={Math.ceil(totalCount / countPerPage)}\n              onNavigate={(toPage) => {\n                serviceSelectionScene.setState({ currentPage: toPage });\n                serviceSelectionScene.updateBody();\n              }}\n            />\n          </span>\n          <span className={styles.paginationWrap}>\n            <Pagination\n              showSmallVersion={true}\n              className={styles.pagination}\n              currentPage={currentPage}\n              numberOfPages={Math.ceil(totalCount / countPerPage)}\n              onNavigate={(toPage) => {\n                serviceSelectionScene.setState({ currentPage: toPage });\n                serviceSelectionScene.updateBody();\n              }}\n            />\n          </span>\n        </>\n      );\n    }\n\n    return null;\n  };\n}\n\nfunction getPageCountStyles(theme: GrafanaTheme2) {\n  return {\n    icon: css({\n      color: theme.colors.text.disabled,\n      marginLeft: theme.spacing.x1,\n    }),\n    searchPageCountWrap: css({\n      display: 'flex',\n      alignItems: 'center',\n    }),\n    select: css({\n      maxWidth: '65px',\n      marginLeft: theme.spacing(1),\n      marginRight: theme.spacing(1),\n    }),\n    searchFieldPlaceholderText: css({\n      fontSize: theme.typography.bodySmall.fontSize,\n      color: theme.colors.text.disabled,\n      alignItems: 'center',\n      display: 'flex',\n      flex: '1 0 auto',\n      textWrapMode: 'nowrap',\n    }),\n  };\n}\n\nexport function getCountOptionsFromTotal(totalCount: number) {\n  const delta = 20;\n  const end = 60;\n  const roundedTotalCount = Math.ceil(totalCount / delta) * delta;\n\n  const options: Array<SelectableValue<string>> = [];\n  for (let count = delta; count <= end && count <= roundedTotalCount; count += delta) {\n    let label = count.toString();\n    if (count < delta) {\n      label = count.toString();\n    } else if (count > totalCount) {\n      label = totalCount.toString();\n    }\n    options.push({\n      value: count.toString(),\n      label,\n    });\n  }\n\n  return options;\n}\n","import { css } from '@emotion/css';\nimport { debounce } from 'lodash';\nimport React from 'react';\nimport {\n  AdHocVariableFilter,\n  DashboardCursorSync,\n  DataFrame,\n  dateTime,\n  GrafanaTheme2,\n  LoadingState,\n  TimeRange,\n} from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  behaviors,\n  DataSourceVariable,\n  PanelBuilders,\n  SceneComponentProps,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectState,\n  SceneObjectUrlSyncConfig,\n  SceneObjectUrlValues,\n  SceneQueryRunner,\n  SceneVariableSet,\n  VizPanel,\n} from '@grafana/scenes';\nimport {\n  DrawStyle,\n  Field,\n  LegendDisplayMode,\n  PanelContext,\n  SeriesVisibilityChangeMode,\n  StackingMode,\n  useStyles2,\n} from '@grafana/ui';\nimport { addTabToLocalStorage, getFavoriteLabelValuesFromStorage, getServiceSelectionPageCount } from 'services/store';\nimport {\n  EXPLORATION_DS,\n  LEVEL_VARIABLE_VALUE,\n  SERVICE_NAME,\n  SERVICE_UI_LABEL,\n  VAR_AGGREGATED_METRICS,\n  VAR_LABELS_REPLICA,\n  VAR_LABELS_REPLICA_EXPR,\n  VAR_PRIMARY_LABEL,\n  VAR_PRIMARY_LABEL_EXPR,\n  VAR_PRIMARY_LABEL_SEARCH,\n} from 'services/variables';\nimport { goToLabelDrillDownLink, SelectServiceButton } from './SelectServiceButton';\nimport {\n  buildDataQuery,\n  buildVolumeQuery,\n  renderLogQLLabelFilters,\n  unwrapWildcardSearch,\n  wrapWildcardSearch,\n} from 'services/query';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from 'services/analytics';\nimport { getQueryRunner, getSceneQueryRunner, setLevelColorOverrides } from 'services/panel';\nimport { ConfigureVolumeError } from './ConfigureVolumeError';\nimport { NoServiceSearchResults } from './NoServiceSearchResults';\nimport { getLevelLabelsFromSeries, toggleLevelVisibility } from 'services/levels';\nimport { ServiceFieldSelector } from '../ServiceScene/Breakdowns/FieldSelector';\nimport { CustomConstantVariable } from '../../services/CustomConstantVariable';\nimport { areArraysEqual } from '../../services/comparison';\nimport {\n  clearServiceSelectionSearchVariable,\n  getAggregatedMetricsVariable,\n  getDataSourceVariable,\n  getLabelsVariable,\n  getLabelsVariableReplica,\n  getServiceSelectionPrimaryLabel,\n  getServiceSelectionSearchVariable,\n  setServiceSelectionPrimaryLabelKey,\n} from '../../services/variableGetters';\nimport { config, locationService } from '@grafana/runtime';\nimport { VariableHide } from '@grafana/schema';\nimport { ToolbarScene } from '../IndexScene/ToolbarScene';\nimport { IndexScene, showLogsButtonSceneKey } from '../IndexScene/IndexScene';\nimport { ServiceSelectionTabsScene } from './ServiceSelectionTabsScene';\nimport { FavoriteServiceHeaderActionScene } from './FavoriteServiceHeaderActionScene';\nimport { pushUrlHandler } from '../../services/navigate';\nimport { NoServiceVolume } from './NoServiceVolume';\nimport { getQueryRunnerFromChildren } from '../../services/scenes';\nimport { AddLabelToFiltersHeaderActionScene } from './AddLabelToFiltersHeaderActionScene';\nimport { ShowLogsButtonScene } from '../IndexScene/ShowLogsButtonScene';\nimport { ServiceSelectionPaginationScene } from './ServiceSelectionPaginationScene';\n\nconst aggregatedMetricsEnabled: boolean | undefined = config.featureToggles.exploreLogsAggregatedMetrics;\n// Don't export AGGREGATED_SERVICE_NAME, we want to rename things so the rest of the application is agnostic to how we got the services\nconst AGGREGATED_SERVICE_NAME = '__aggregated_metric__';\n\n//@todo make start date user configurable, currently hardcoded for experimental cloud release\nexport const AGGREGATED_METRIC_START_DATE = dateTime('2024-08-30', 'YYYY-MM-DD');\n\ninterface ServiceSelectionSceneState extends SceneObjectState {\n  // The body of the component\n  body: SceneCSSGridLayout;\n  // Show logs of a certain level for a given service\n  serviceLevel: Map<string, string[]>;\n  // Logs volume API response as dataframe with SceneQueryRunner\n  $data: SceneQueryRunner;\n  tabs?: ServiceSelectionTabsScene;\n  // Pagination options\n  countPerPage: number;\n  currentPage: number;\n  paginationScene?: ServiceSelectionPaginationScene;\n\n  showPopover: boolean;\n  tabOptions: Array<{\n    label: string;\n    value: string;\n  }>;\n}\n\nfunction renderPrimaryLabelFilters(filters: AdHocVariableFilter[]): string {\n  if (filters.length) {\n    const filter = filters[0];\n    return `${filter.key}${filter.operator}\\`${filter.value}\\``;\n  }\n\n  return '';\n}\n\nconst primaryLabelUrlKey = 'var-primary_label';\nconst datasourceUrlKey = 'var-ds';\n\nexport class ServiceSelectionScene extends SceneObjectBase<ServiceSelectionSceneState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: [primaryLabelUrlKey],\n  });\n\n  constructor(state: Partial<ServiceSelectionSceneState>) {\n    super({\n      body: new SceneCSSGridLayout({ children: [] }),\n      $variables: new SceneVariableSet({\n        variables: [\n          // Service search variable\n          new CustomConstantVariable({\n            name: VAR_PRIMARY_LABEL_SEARCH,\n            label: 'Service',\n            hide: VariableHide.hideVariable,\n            skipUrlSync: true,\n            value: '.+',\n          }),\n          // variable that stores if aggregated metrics are supported for the query\n          new CustomConstantVariable({\n            name: VAR_AGGREGATED_METRICS,\n            label: '',\n            hide: VariableHide.hideLabel,\n            value: SERVICE_NAME,\n            skipUrlSync: true,\n            options: [\n              {\n                value: SERVICE_NAME,\n                label: SERVICE_NAME,\n              },\n              {\n                value: AGGREGATED_SERVICE_NAME,\n                label: AGGREGATED_SERVICE_NAME,\n              },\n            ],\n          }),\n          // The active tab expression, hidden variable\n          new AdHocFiltersVariable({\n            name: VAR_PRIMARY_LABEL,\n            hide: VariableHide.hideLabel,\n            expressionBuilder: (filters) => {\n              return renderPrimaryLabelFilters(filters);\n            },\n            filters: [\n              {\n                key: getSelectedTabFromUrl().key ?? SERVICE_NAME,\n                value: '.+',\n                operator: '=~',\n              },\n            ],\n          }),\n          new AdHocFiltersVariable({\n            name: VAR_LABELS_REPLICA,\n            datasource: EXPLORATION_DS,\n            layout: 'vertical',\n            filters: [],\n            expressionBuilder: renderLogQLLabelFilters,\n            hide: VariableHide.hideVariable,\n            key: 'adhoc_service_filter_replica',\n            skipUrlSync: true,\n          }),\n        ],\n      }),\n      $data: getSceneQueryRunner({\n        queries: [],\n        runQueriesMode: 'manual',\n      }),\n      serviceLevel: new Map<string, string[]>(),\n      // pagination\n      countPerPage: getServiceSelectionPageCount() ?? 20,\n      currentPage: 1,\n\n      showPopover: false,\n      tabOptions: [\n        {\n          label: SERVICE_UI_LABEL,\n          value: SERVICE_NAME,\n        },\n      ],\n      ...state,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public static Component = ({ model }: SceneComponentProps<ServiceSelectionScene>) => {\n    const styles = useStyles2(getStyles);\n    const { body, $data, tabs, paginationScene } = model.useState();\n    const { data } = $data.useState();\n    const selectedTab = model.getSelectedTab();\n\n    const serviceStringVariable = getServiceSelectionSearchVariable(model);\n    const { label, value: searchValue } = serviceStringVariable.useState();\n    const hasSearch = searchValue && searchValue !== '.+';\n\n    const { labelsByVolume, labelsToQuery } = model.getLabels(data?.series);\n    const isLogVolumeLoading =\n      data?.state === LoadingState.Loading || data?.state === LoadingState.Streaming || data === undefined;\n    const volumeApiError = $data.state.data?.state === LoadingState.Error;\n\n    const onSearchChange = (serviceName?: string) => {\n      model.onSearchServicesChange(serviceName);\n    };\n\n    const filterLabel = model.formatPrimaryLabelForUI();\n    let customValue = serviceStringVariable.getValue().toString();\n    if (customValue === '.+') {\n      customValue = '';\n    }\n    const customLabel = unwrapWildcardSearch(customValue);\n\n    return (\n      <div className={styles.container}>\n        <div className={styles.bodyWrapper}>\n          {tabs && <tabs.Component model={tabs} />}\n          <Field className={styles.searchField}>\n            <div className={styles.searchWrapper}>\n              <ServiceFieldSelector\n                initialFilter={{\n                  label: customLabel,\n                  value: customValue,\n                  icon: 'filter',\n                }}\n                isLoading={isLogVolumeLoading}\n                value={customValue ? customValue : label}\n                onChange={(serviceName) => onSearchChange(serviceName)}\n                selectOption={(value: string) => {\n                  goToLabelDrillDownLink(selectedTab, value, model);\n                }}\n                label={filterLabel}\n                options={\n                  labelsToQuery?.map((serviceName) => ({\n                    value: serviceName,\n                    label: serviceName,\n                  })) ?? []\n                }\n              />\n              {!isLogVolumeLoading && (\n                <span className={styles.searchPaginationWrap}>\n                  {paginationScene && (\n                    <ServiceSelectionPaginationScene.PageCount\n                      model={paginationScene}\n                      totalCount={labelsToQuery.length}\n                    />\n                  )}\n                  {paginationScene && (\n                    <ServiceSelectionPaginationScene.Component\n                      model={paginationScene}\n                      totalCount={labelsToQuery.length}\n                    />\n                  )}\n                </span>\n              )}\n            </div>\n          </Field>\n          {/** If we don't have any servicesByVolume, volume endpoint is probably not enabled */}\n          {!isLogVolumeLoading && volumeApiError && <ConfigureVolumeError />}\n          {!isLogVolumeLoading && !volumeApiError && hasSearch && !labelsByVolume?.length && <NoServiceSearchResults />}\n          {!isLogVolumeLoading && !volumeApiError && !hasSearch && !labelsByVolume?.length && (\n            <NoServiceVolume labelName={selectedTab} />\n          )}\n          {!(!isLogVolumeLoading && volumeApiError) && (\n            <div className={styles.body}>\n              <body.Component model={body} />\n              <div className={styles.headingWrapper}>\n                {paginationScene && (\n                  <ServiceSelectionPaginationScene.Component\n                    totalCount={labelsToQuery.length}\n                    model={paginationScene}\n                  />\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  // We could also run model.setState in component, but it is recommended to implement the state-modifying methods in the scene object\n  onSearchServicesChange = debounce((primaryLabelSearch?: string) => {\n    // Set search variable\n    const searchVar = getServiceSelectionSearchVariable(this);\n\n    const newSearchString = primaryLabelSearch ? wrapWildcardSearch(primaryLabelSearch) : '.+';\n    if (newSearchString !== searchVar.state.value) {\n      searchVar.setState({\n        value: primaryLabelSearch ? wrapWildcardSearch(primaryLabelSearch) : '.+',\n        label: primaryLabelSearch ?? '',\n      });\n    }\n\n    const primaryLabelVar = getServiceSelectionPrimaryLabel(this);\n    const filter = primaryLabelVar.state.filters[0];\n\n    // Update primary label with search string\n    if (wrapWildcardSearch(searchVar.state.value.toString()) !== filter.value) {\n      primaryLabelVar.setState({\n        filters: [\n          {\n            ...filter,\n            value: wrapWildcardSearch(searchVar.state.value.toString()),\n          },\n        ],\n      });\n    }\n\n    this.setState({\n      currentPage: 1,\n    });\n\n    reportAppInteraction(\n      USER_EVENTS_PAGES.service_selection,\n      USER_EVENTS_ACTIONS.service_selection.search_services_changed,\n      {\n        searchQuery: primaryLabelSearch,\n      }\n    );\n  }, 500);\n\n  /**\n   * Set changes from the URL to the state of the primary label variable\n   */\n  getUrlState() {\n    const { key } = getSelectedTabFromUrl();\n    const primaryLabelVar = getServiceSelectionPrimaryLabel(this);\n    const filter = primaryLabelVar.state.filters[0];\n\n    if (filter.key && filter.key !== key) {\n      getServiceSelectionPrimaryLabel(this).setState({\n        filters: [\n          {\n            ...filter,\n            key: key ?? filter.key,\n          },\n        ],\n      });\n    }\n\n    return {};\n  }\n\n  /**\n   * Unused, but required\n   * @param values\n   */\n  updateFromUrl(values: SceneObjectUrlValues) {}\n\n  addDatasourceChangeToBrowserHistory(newDs: string) {\n    const location = locationService.getLocation();\n    const search = new URLSearchParams(location.search);\n    const dsUrl = search.get(datasourceUrlKey);\n    if (dsUrl && newDs !== dsUrl) {\n      const currentUrl = location.pathname + location.search;\n      search.set(datasourceUrlKey, newDs);\n      const newUrl = location.pathname + '?' + search.toString();\n      if (currentUrl !== newUrl) {\n        pushUrlHandler(newUrl);\n      }\n    }\n  }\n\n  /**\n   * Attempting to add any change to the primary label variable (i.e. the selected tab) as a browser history event\n   * @param newKey\n   * @param replace\n   */\n  addLabelChangeToBrowserHistory(newKey: string, replace = false) {\n    const { key: primaryLabelRaw, search, location } = getSelectedTabFromUrl();\n    if (primaryLabelRaw) {\n      const primaryLabelSplit = primaryLabelRaw?.split('|');\n      const keyInUrl = primaryLabelSplit?.[0];\n\n      if (keyInUrl !== newKey) {\n        primaryLabelSplit[0] = newKey;\n        search.set(primaryLabelUrlKey, primaryLabelSplit.join('|'));\n        const currentUrl = location.pathname + location.search;\n        const newUrl = location.pathname + '?' + search.toString();\n        if (currentUrl !== newUrl) {\n          if (replace) {\n            locationService.replace(newUrl);\n          } else {\n            pushUrlHandler(newUrl);\n          }\n        }\n      }\n    }\n  }\n\n  getSelectedTab() {\n    return getServiceSelectionPrimaryLabel(this).state.filters[0]?.key;\n  }\n\n  selectDefaultLabelTab() {\n    // Need to update the history before the state with replace instead of push, or we'll get invalid services saved to url state after changing datasource\n    this.addLabelChangeToBrowserHistory(SERVICE_NAME, true);\n    this.setSelectedTab(SERVICE_NAME);\n  }\n\n  setSelectedTab(labelName: string) {\n    addTabToLocalStorage(getDataSourceVariable(this).getValue().toString(), labelName);\n\n    // clear active search\n    clearServiceSelectionSearchVariable(this);\n\n    // Update the primary label variable\n    setServiceSelectionPrimaryLabelKey(labelName, this);\n  }\n\n  // Creates a layout with timeseries panel\n  buildServiceLayout(\n    primaryLabelName: string,\n    primaryLabelValue: string,\n    timeRange: TimeRange,\n    serviceLabelVar: CustomConstantVariable,\n    primaryLabelVar: AdHocFiltersVariable,\n    datasourceVar: DataSourceVariable\n  ) {\n    let splitDuration;\n    if (timeRange.to.diff(timeRange.from, 'hours') >= 4 && timeRange.to.diff(timeRange.from, 'hours') <= 26) {\n      splitDuration = '2h';\n    }\n    const panel = PanelBuilders.timeseries()\n      // If service was previously selected, we show it in the title\n      .setTitle(primaryLabelValue)\n      .setData(\n        getQueryRunner(\n          [\n            buildDataQuery(this.getMetricExpression(primaryLabelValue, serviceLabelVar, primaryLabelVar), {\n              legendFormat: `{{${LEVEL_VARIABLE_VALUE}}}`,\n              splitDuration,\n              refId: `ts-${primaryLabelValue}`,\n            }),\n          ],\n          { runQueriesMode: 'manual' }\n        )\n      )\n      .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n      .setCustomFieldConfig('fillOpacity', 100)\n      .setCustomFieldConfig('lineWidth', 0)\n      .setCustomFieldConfig('pointSize', 0)\n      .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n      .setUnit('short')\n      .setOverrides(setLevelColorOverrides)\n      .setOption('legend', {\n        showLegend: true,\n        calcs: ['sum'],\n        placement: 'right',\n        displayMode: LegendDisplayMode.Table,\n      })\n      .setHeaderActions([\n        new FavoriteServiceHeaderActionScene({\n          ds: datasourceVar.getValue()?.toString(),\n          labelName: primaryLabelName,\n          labelValue: primaryLabelValue,\n        }),\n        new AddLabelToFiltersHeaderActionScene({\n          name: primaryLabelName,\n          value: primaryLabelValue,\n          hidden: this.isAggregatedMetricsActive(),\n        }),\n        new SelectServiceButton({ labelValue: primaryLabelValue, labelName: primaryLabelName }),\n      ])\n      .build();\n\n    panel.setState({\n      extendPanelContext: (_, context) =>\n        this.extendTimeSeriesLegendBus(primaryLabelName, primaryLabelValue, context, panel),\n    });\n\n    const cssGridItem = new SceneCSSGridItem({\n      $behaviors: [new behaviors.CursorSync({ key: 'serviceCrosshairSync', sync: DashboardCursorSync.Crosshair })],\n      body: panel,\n    });\n\n    cssGridItem.addActivationHandler(() => {\n      const runner = getQueryRunnerFromChildren(cssGridItem)[0];\n      // If the query runner has already ran, the scene must be cached, don't re-run as the volume query will be triggered which will execute another panel query\n      if (runner.state.data?.state !== LoadingState.Done) {\n        this.runPanelQuery(cssGridItem);\n      }\n    });\n\n    return cssGridItem;\n  }\n\n  isAggregatedMetricsActive() {\n    const toolbar = this.getQueryOptionsToolbar();\n    return !toolbar?.state.options.aggregatedMetrics.disabled && toolbar?.state.options.aggregatedMetrics.active;\n  }\n\n  getLevelFilterForService = (service: string) => {\n    let serviceLevels = this.state.serviceLevel.get(service) || [];\n    if (serviceLevels.length === 0) {\n      return '';\n    }\n    const filters = serviceLevels.map((level) => {\n      if (level === 'logs') {\n        level = '';\n      }\n      return `${LEVEL_VARIABLE_VALUE}=\\`${level}\\``;\n    });\n    return ` | ${filters.join(' or ')} `;\n  };\n\n  // Creates a layout with logs panel\n  buildServiceLogsLayout = (labelName: string, labelValue: string) => {\n    const levelFilter = this.getLevelFilterForService(labelValue);\n    const cssGridItem = new SceneCSSGridItem({\n      $behaviors: [new behaviors.CursorSync({ sync: DashboardCursorSync.Off })],\n      body: PanelBuilders.logs()\n        // Hover header set to true removes unused header padding, displaying more logs\n        .setHoverHeader(true)\n        .setData(\n          getQueryRunner(\n            [\n              buildDataQuery(this.getLogExpression(labelName, labelValue, levelFilter), {\n                maxLines: 100,\n                refId: `logs-${labelValue}`,\n              }),\n            ],\n            {\n              runQueriesMode: 'manual',\n            }\n          )\n        )\n        .setTitle(labelValue)\n        .setOption('showTime', true)\n        .setOption('enableLogDetails', false)\n        .build(),\n    });\n\n    cssGridItem.addActivationHandler(() => {\n      const runner = getQueryRunnerFromChildren(cssGridItem)[0];\n      // If the query runner has already ran, the scene must be cached, don't re-run as the volume query will be triggered which will execute another panel query\n      if (runner.state.data?.state !== LoadingState.Done) {\n        this.runPanelQuery(cssGridItem);\n      }\n    });\n\n    return cssGridItem;\n  };\n\n  formatPrimaryLabelForUI() {\n    const selectedTab = this.getSelectedTab();\n    return selectedTab === SERVICE_NAME ? SERVICE_UI_LABEL : selectedTab;\n  }\n\n  private setVolumeQueryRunner() {\n    this.setState({\n      $data: getSceneQueryRunner({\n        queries: [\n          buildVolumeQuery(`{${VAR_PRIMARY_LABEL_EXPR}, ${VAR_LABELS_REPLICA_EXPR}}`, 'volume', this.getSelectedTab()),\n        ],\n        runQueriesMode: 'manual',\n      }),\n    });\n\n    // Need to re-init any subscriptions since we changed the query runner\n    this.subscribeToVolume();\n  }\n\n  private doVariablesNeedSync() {\n    const labelsVarPrimary = getLabelsVariable(this);\n    const labelsVarReplica = getLabelsVariableReplica(this);\n\n    const activeTab = this.getSelectedTab();\n    const filteredFilters = labelsVarPrimary.state.filters.filter((f) => f.key !== activeTab);\n\n    return { filters: filteredFilters, needsSync: !areArraysEqual(filteredFilters, labelsVarReplica.state.filters) };\n  }\n\n  private syncVariables() {\n    const labelsVarReplica = getLabelsVariableReplica(this);\n\n    const { filters, needsSync } = this.doVariablesNeedSync();\n    if (needsSync) {\n      labelsVarReplica.setState({ filters });\n    }\n  }\n\n  private onActivate() {\n    this.fixRequiredUrlParams();\n\n    // Sync initial state from primary labels to local replica\n    this.syncVariables();\n\n    // Clear existing volume data on activate or we'll show stale cached data, potentially from a different datasource\n    this.setVolumeQueryRunner();\n\n    // Subscribe to primary labels for further updates\n    this.subscribeToPrimaryLabelsVariable();\n\n    // Subscribe to variables replica\n    this.subscribeToLabelFilterChanges();\n\n    // Subscribe to tab changes (primary label)\n    this.subscribeToActiveTabVariable(getServiceSelectionPrimaryLabel(this));\n\n    if (this.state.$data.state.data?.state !== LoadingState.Done) {\n      this.runVolumeOnActivate();\n    }\n\n    // Update labels on time range change\n    this.subscribeToTimeRange();\n\n    // Update labels on datasource change\n    this.subscribeToDatasource();\n\n    this.subscribeToAggregatedMetricToggle();\n\n    this.subscribeToAggregatedMetricVariable();\n  }\n\n  private runVolumeOnActivate() {\n    if (this.isTimeRangeTooEarlyForAggMetrics()) {\n      this.onUnsupportedAggregatedMetricTimeRange();\n      if (this.state.$data.state.data?.state !== LoadingState.Done) {\n        this.runVolumeQuery();\n      }\n    } else {\n      this.onSupportedAggregatedMetricTimeRange();\n      if (this.state.$data.state.data?.state !== LoadingState.Done) {\n        this.runVolumeQuery();\n      }\n    }\n  }\n\n  private subscribeToAggregatedMetricToggle() {\n    this._subs.add(\n      this.getQueryOptionsToolbar()?.subscribeToState((newState, prevState) => {\n        if (newState.options.aggregatedMetrics.userOverride !== prevState.options.aggregatedMetrics.userOverride) {\n          this.runVolumeQuery(true);\n        }\n      })\n    );\n  }\n\n  private subscribeToDatasource() {\n    this._subs.add(\n      getDataSourceVariable(this).subscribeToState((newState) => {\n        this.addDatasourceChangeToBrowserHistory(newState.value.toString());\n        this.runVolumeQuery();\n      })\n    );\n  }\n\n  private subscribeToActiveTabVariable(primaryLabelVar: AdHocFiltersVariable) {\n    this._subs.add(\n      primaryLabelVar.subscribeToState((newState, prevState) => {\n        if (newState.filterExpression !== prevState.filterExpression) {\n          const newKey = newState.filters[0].key;\n          this.addLabelChangeToBrowserHistory(newKey);\n          // Need to tear down volume query runner to select other labels, as we need the selected tab to parse the volume response\n          const { needsSync } = this.doVariablesNeedSync();\n\n          if (needsSync) {\n            this.syncVariables();\n          } else {\n            this.runVolumeQuery(true);\n          }\n        }\n      })\n    );\n  }\n\n  /**\n   * agg metrics need parser and unwrap, have to tear down and rebuild panels when the variable changes\n   * @private\n   */\n  private subscribeToAggregatedMetricVariable() {\n    this._subs.add(\n      getAggregatedMetricsVariable(this).subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          // Clear the body panels\n          this.setState({\n            body: new SceneCSSGridLayout({ children: [] }),\n          });\n          // And re-init with the new query\n          this.updateBody(true);\n        }\n      })\n    );\n  }\n\n  private subscribeToPrimaryLabelsVariable() {\n    const labelsVarPrimary = getLabelsVariable(this);\n    this._subs.add(\n      labelsVarPrimary.subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.syncVariables();\n        }\n      })\n    );\n  }\n\n  private subscribeToLabelFilterChanges() {\n    const labelsVar = getLabelsVariableReplica(this);\n    this._subs.add(\n      labelsVar.subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.filters, prevState.filters)) {\n          this.runVolumeQuery(true);\n        }\n      })\n    );\n  }\n\n  private subscribeToVolume() {\n    this._subs.add(\n      this.state.$data.subscribeToState((newState, prevState) => {\n        // update body if the data is done loading, and the dataframes have changed\n        if (\n          newState.data?.state === LoadingState.Done &&\n          !areArraysEqual(prevState?.data?.series, newState?.data?.series)\n        ) {\n          this.updateBody(true);\n        }\n      })\n    );\n  }\n\n  private subscribeToTimeRange() {\n    this._subs.add(\n      sceneGraph.getTimeRange(this).subscribeToState(() => {\n        if (this.isTimeRangeTooEarlyForAggMetrics()) {\n          this.onUnsupportedAggregatedMetricTimeRange();\n        } else {\n          this.onSupportedAggregatedMetricTimeRange();\n        }\n        this.runVolumeQuery();\n      })\n    );\n  }\n\n  /**\n   * If the user copies a partial URL we want to prevent throwing runtime errors or running invalid queries, so we set the default tab which will trigger updates to the primary_label\n   * @private\n   */\n  private fixRequiredUrlParams() {\n    // If the selected tab is not in the URL, set the default\n    const { key } = getSelectedTabFromUrl();\n    if (!key) {\n      this.selectDefaultLabelTab();\n    }\n  }\n\n  private isTimeRangeTooEarlyForAggMetrics(): boolean {\n    const timeRange = sceneGraph.getTimeRange(this);\n    return timeRange.state.value.from.isBefore(dateTime(AGGREGATED_METRIC_START_DATE));\n  }\n\n  private onUnsupportedAggregatedMetricTimeRange() {\n    const toolbar = this.getQueryOptionsToolbar();\n    toolbar?.setState({\n      options: {\n        aggregatedMetrics: {\n          ...toolbar?.state.options.aggregatedMetrics,\n          disabled: true,\n        },\n      },\n    });\n  }\n\n  private getQueryOptionsToolbar() {\n    const indexScene = sceneGraph.getAncestor(this, IndexScene);\n    return indexScene.state.controls.find((control) => control instanceof ToolbarScene) as ToolbarScene | undefined;\n  }\n\n  private onSupportedAggregatedMetricTimeRange() {\n    const toolbar = this.getQueryOptionsToolbar();\n    toolbar?.setState({\n      options: {\n        aggregatedMetrics: {\n          ...toolbar?.state.options.aggregatedMetrics,\n          disabled: false,\n        },\n      },\n    });\n  }\n\n  /**\n   * Executes the Volume API call\n   * @param resetQueryRunner - optional param which will replace the query runner state with a new instantiation\n   * @private\n   */\n  private runVolumeQuery(resetQueryRunner = false) {\n    if (resetQueryRunner) {\n      this.setVolumeQueryRunner();\n    }\n\n    this.updateAggregatedMetricVariable();\n    this.state.$data.runQueries();\n  }\n\n  private updateAggregatedMetricVariable() {\n    const serviceLabelVar = getAggregatedMetricsVariable(this);\n    const labelsVar = getLabelsVariable(this);\n    if ((!this.isTimeRangeTooEarlyForAggMetrics() || !aggregatedMetricsEnabled) && this.isAggregatedMetricsActive()) {\n      serviceLabelVar.changeValueTo(AGGREGATED_SERVICE_NAME);\n\n      // Hide combobox and reset filters if aggregated metrics is enabled\n      labelsVar.setState({\n        hide: VariableHide.hideVariable,\n        filters: [],\n      });\n\n      // Hide the show logs button\n      const showLogsButton = sceneGraph.findByKeyAndType(this, showLogsButtonSceneKey, ShowLogsButtonScene);\n      showLogsButton.setState({ hidden: true });\n    } else {\n      serviceLabelVar.changeValueTo(SERVICE_NAME);\n      // Show combobox if not aggregated metrics\n      labelsVar.setState({\n        hide: VariableHide.dontHide,\n      });\n      serviceLabelVar.changeValueTo(SERVICE_NAME);\n\n      // Show the show logs button\n      const showLogsButton = sceneGraph.findByKeyAndType(this, showLogsButtonSceneKey, ShowLogsButtonScene);\n      showLogsButton.setState({ hidden: false });\n    }\n  }\n\n  private updateTabs() {\n    if (!this.state.tabs) {\n      const tabs = new ServiceSelectionTabsScene({});\n      this.setState({\n        tabs,\n      });\n    }\n  }\n\n  private getGridItems(): SceneCSSGridItem[] {\n    return this.state.body.state.children as SceneCSSGridItem[];\n  }\n\n  private getVizPanel(child: SceneCSSGridItem) {\n    return child.state.body instanceof VizPanel ? child.state.body : undefined;\n  }\n\n  /**\n   * Runs logs/volume panel queries if lazy loaded grid item is active\n   * @param child\n   * @private\n   */\n  private runPanelQuery(child: SceneCSSGridItem) {\n    if (child.isActive) {\n      const queryRunners = getQueryRunnerFromChildren(child);\n      if (queryRunners.length === 1) {\n        const queryRunner = queryRunners[0];\n        const query = queryRunner.state.queries[0];\n\n        // If the scene was cached, the time range will still be the same as what was executed in the query\n        const requestTimeRange = queryRunner.state.data?.timeRange;\n        const sceneTimeRange = sceneGraph.getTimeRange(this);\n        const fromDiff = requestTimeRange\n          ? Math.abs(sceneTimeRange.state.value.from.diff(requestTimeRange?.from, 's'))\n          : Infinity;\n        const toDiff = requestTimeRange\n          ? Math.abs(sceneTimeRange.state.value.to.diff(requestTimeRange?.to, 's'))\n          : Infinity;\n\n        const interpolated = sceneGraph.interpolate(this, query.expr);\n        // If we haven't already run this exact same query, run it\n        if (queryRunner.state.key !== interpolated || fromDiff > 0 || toDiff > 0) {\n          queryRunner.setState({\n            key: interpolated,\n          });\n          queryRunner.runQueries();\n        }\n      }\n    }\n  }\n\n  public updateBody(runQueries = false) {\n    const { labelsToQuery } = this.getLabels(this.state.$data.state.data?.series);\n    const selectedTab = this.getSelectedTab();\n    this.updateTabs();\n\n    if (!this.state.paginationScene) {\n      this.setState({\n        paginationScene: new ServiceSelectionPaginationScene({}),\n      });\n    }\n\n    // If no services are to be queried, clear the body\n    if (!labelsToQuery || labelsToQuery.length === 0) {\n      this.state.body.setState({ children: [] });\n    } else {\n      // If we have services to query, build the layout with the services. Children is an array of layouts for each service (1 row with 2 columns - timeseries and logs panel)\n      const newChildren: SceneCSSGridItem[] = [];\n      const existingChildren = this.getGridItems();\n      const timeRange = sceneGraph.getTimeRange(this).state.value;\n      const aggregatedMetricsVariable = getAggregatedMetricsVariable(this);\n      const primaryLabelVar = getServiceSelectionPrimaryLabel(this);\n      const datasourceVariable = getDataSourceVariable(this);\n\n      const start = (this.state.currentPage - 1) * this.state.countPerPage;\n      const end = start + this.state.countPerPage;\n\n      for (const primaryLabelValue of labelsToQuery.slice(start, end)) {\n        const existing = existingChildren.filter((child) => {\n          const vizPanel = this.getVizPanel(child);\n          return vizPanel?.state.title === primaryLabelValue;\n        });\n\n        if (existing.length === 2) {\n          // If we already have grid items for this service, move them over to the new array of children, this will preserve their queryRunners, preventing duplicate queries from getting run\n          newChildren.push(existing[0], existing[1]);\n\n          if (existing[0].isActive && runQueries) {\n            this.runPanelQuery(existing[0]);\n          }\n\n          if (existing[1].isActive && runQueries) {\n            this.runPanelQuery(existing[1]);\n          }\n        } else {\n          const newChildTs = this.buildServiceLayout(\n            selectedTab,\n            primaryLabelValue,\n            timeRange,\n            aggregatedMetricsVariable,\n            primaryLabelVar,\n            datasourceVariable\n          );\n          const newChildLogs = this.buildServiceLogsLayout(selectedTab, primaryLabelValue);\n          // for each service, we create a layout with timeseries and logs panel\n          newChildren.push(newChildTs, newChildLogs);\n        }\n      }\n\n      this.state.body.setState({\n        children: newChildren,\n        isLazy: true,\n        templateColumns: 'repeat(auto-fit, minmax(500px, 1fr) minmax(300px, 70vw))',\n        autoRows: '200px',\n        md: {\n          templateColumns: '1fr',\n          rowGap: 1,\n          columnGap: 1,\n        },\n      });\n    }\n  }\n\n  /**\n   * Redraws service logs after toggling level visibility.\n   */\n  private updateServiceLogs(labelName: string, labelValue: string) {\n    if (!this.state.body) {\n      this.updateBody();\n      return;\n    }\n    const { labelsToQuery } = this.getLabels(this.state.$data.state.data?.series);\n    const serviceIndex = labelsToQuery?.indexOf(labelValue);\n    if (serviceIndex === undefined || serviceIndex < 0) {\n      return;\n    }\n    let newChildren = [...this.getGridItems()];\n    newChildren.splice(serviceIndex * 2 + 1, 1, this.buildServiceLogsLayout(labelName, labelValue));\n    this.state.body.setState({ children: newChildren });\n  }\n\n  private getLogExpression(labelName: string, labelValue: string, levelFilter: string) {\n    return `{${labelName}=\\`${labelValue}\\` , ${VAR_LABELS_REPLICA_EXPR} }${levelFilter}`;\n  }\n\n  private getMetricExpression(\n    labelValue: string,\n    serviceLabelVar: CustomConstantVariable,\n    primaryLabelVar: AdHocFiltersVariable\n  ) {\n    const filter = primaryLabelVar.state.filters[0];\n    if (serviceLabelVar.state.value === AGGREGATED_SERVICE_NAME) {\n      if (filter.key === SERVICE_NAME) {\n        return `sum by (${LEVEL_VARIABLE_VALUE}) (sum_over_time({${AGGREGATED_SERVICE_NAME}=\\`${labelValue}\\` } | logfmt | unwrap count [$__auto]))`;\n      } else {\n        return `sum by (${LEVEL_VARIABLE_VALUE}) (sum_over_time({${AGGREGATED_SERVICE_NAME}=~\\`.+\\` } | logfmt | ${filter.key}=\\`${labelValue}\\` | unwrap count [$__auto]))`;\n      }\n    }\n    return `sum by (${LEVEL_VARIABLE_VALUE}) (count_over_time({ ${filter.key}=\\`${labelValue}\\`, ${VAR_LABELS_REPLICA_EXPR} } [$__auto]))`;\n  }\n\n  private extendTimeSeriesLegendBus = (\n    labelName: string,\n    labelValue: string,\n    context: PanelContext,\n    panel: VizPanel\n  ) => {\n    const originalOnToggleSeriesVisibility = context.onToggleSeriesVisibility;\n\n    context.onToggleSeriesVisibility = (level: string, mode: SeriesVisibilityChangeMode) => {\n      originalOnToggleSeriesVisibility?.(level, mode);\n\n      const allLevels = getLevelLabelsFromSeries(panel.state.$data?.state.data?.series ?? []);\n      const levels = toggleLevelVisibility(level, this.state.serviceLevel.get(labelValue), mode, allLevels);\n      this.state.serviceLevel.set(labelValue, levels);\n\n      this.updateServiceLogs(labelName, labelValue);\n    };\n  };\n\n  private getLabels(series?: DataFrame[]) {\n    const labelsByVolume: string[] = series?.[0]?.fields[0].values ?? [];\n    const dsString = getDataSourceVariable(this).getValue()?.toString();\n    const searchString = getServiceSelectionSearchVariable(this).getValue();\n    const selectedTab = this.getSelectedTab();\n    const labelsToQuery = createListOfLabelsToQuery(labelsByVolume, dsString, String(searchString), selectedTab);\n    return { labelsByVolume, labelsToQuery: labelsToQuery };\n  }\n}\n\n// Create a list of services to query:\n// 1. Filters provided services by searchString\n// 2. Gets favoriteServicesToQuery from localStorage and filters them by searchString\n// 3. Orders them correctly\nfunction createListOfLabelsToQuery(services: string[], ds: string, searchString: string, labelName: string) {\n  if (!services?.length) {\n    return [];\n  }\n\n  if (searchString === '.+') {\n    searchString = '';\n  }\n\n  const favoriteServicesToQuery = getFavoriteLabelValuesFromStorage(ds, labelName).filter(\n    (service) => service.toLowerCase().includes(searchString.toLowerCase()) && services.includes(service)\n  );\n\n  // Deduplicate\n  return Array.from(new Set([...favoriteServicesToQuery, ...services]));\n}\n\nfunction getSelectedTabFromUrl() {\n  const location = locationService.getLocation();\n  const search = new URLSearchParams(location.search);\n  const primaryLabelRaw = search.get(primaryLabelUrlKey);\n  const primaryLabelSplit = primaryLabelRaw?.split('|');\n  const key = primaryLabelSplit?.[0];\n  return { key, search, location };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      flexGrow: 1,\n      position: 'relative',\n    }),\n    headingWrapper: css({\n      marginTop: theme.spacing(1),\n    }),\n    loadingText: css({\n      margin: 0,\n    }),\n    header: css({\n      position: 'absolute',\n      right: 0,\n      top: '4px',\n      zIndex: 2,\n    }),\n    bodyWrapper: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    body: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    searchPaginationWrap: css({\n      label: 'search-pagination-wrap',\n      display: 'flex',\n      alignItems: 'center',\n      flexWrap: 'wrap',\n      flex: '1 0 auto',\n      [theme.breakpoints.down('md')]: {\n        marginTop: theme.spacing(1),\n        width: '100%',\n      },\n    }),\n    searchWrapper: css({\n      label: 'search-wrapper',\n      display: 'flex',\n      alignItems: 'center',\n      flexWrap: 'wrap',\n      [theme.breakpoints.down('md')]: {\n        flexDirection: 'column',\n        alignItems: 'flex-start',\n      },\n    }),\n    searchField: css({\n      marginTop: theme.spacing(1),\n      position: 'relative',\n    }),\n  };\n}\n","import React from 'react';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport { LogsVisualizationType } from 'services/store';\n\n/**\n * The options shared between logs and table panels\n * @param props\n * @constructor\n */\nexport function LogsPanelHeaderActions(props: {\n  vizType: LogsVisualizationType;\n  onChange: (type: LogsVisualizationType) => void;\n}) {\n  return (\n    <RadioButtonGroup\n      options={[\n        {\n          label: 'Logs',\n          value: 'logs',\n          description: 'Show results in logs visualisation',\n        },\n        {\n          label: 'Table',\n          value: 'table',\n          description: 'Show results in table visualisation',\n        },\n      ]}\n      size=\"sm\"\n      value={props.vizType}\n      onChange={props.onChange}\n    />\n  );\n}\n","import { Observable, of } from 'rxjs';\nimport {\n  MultiValueVariable,\n  MultiValueVariableState,\n  renderSelectForVariable,\n  SceneComponentProps,\n  VariableGetOptionsArgs,\n  VariableValueOption,\n  VariableValueSingle,\n} from '@grafana/scenes';\n\nexport interface CustomConstantVariableState extends MultiValueVariableState {\n  value: VariableValueSingle;\n  isMulti?: false;\n}\n\nexport class CustomConstantVariable extends MultiValueVariable<CustomConstantVariableState> {\n  public constructor(initialState: Partial<CustomConstantVariableState>) {\n    super({\n      type: 'custom',\n      value: '',\n      text: '',\n      options: [],\n      name: '',\n      ...initialState,\n    });\n  }\n\n  public getValueOptions(args: VariableGetOptionsArgs): Observable<VariableValueOption[]> {\n    return of(this.state.options);\n  }\n\n  public static Component = ({ model }: SceneComponentProps<MultiValueVariable>) => {\n    return renderSelectForVariable(model);\n  };\n}\n","import { AdHocFilterWithLabels, sceneUtils } from '@grafana/scenes';\nimport { AdHocVariableFilter } from '@grafana/data';\nimport { FilterOp, FilterOpType, LabelFilterOp, NumericFilterOp } from './filterTypes';\nimport { Dictionary, groupBy, trim } from 'lodash';\nimport { EMPTY_VARIABLE_VALUE, isAdHocFilterValueUserInput, stripAdHocFilterUserInputPrefix } from './variables';\nimport { getValueFromFieldsFilter } from './variableGetters';\nimport { isOperatorExclusive, isOperatorInclusive, isOperatorNumeric, isOperatorRegex } from './operatorHelpers';\nimport { narrowFilterOperator } from './narrowing';\nimport { getExpressionBuilderDebug } from './store';\n\ntype Key = string;\ntype Value = string;\ntype CombinedFiltersValues = { operator: LabelFilterOp | NumericFilterOp; values: Value[] };\ntype CombinedFiltersValuesByKey = Record<Key, CombinedFiltersValues>;\ntype CombinedOperatorFilters = Record<Key, Value>;\ntype OperatorFilters = Record<Key, Value[]>;\n\ninterface Options {\n  /**\n   * Sets debug output\n   */\n  debug?: boolean;\n\n  /**\n   * Separator between filters with different keys or operators\n   */\n  filterSeparator?: string;\n\n  /**\n   * Prefix of the logQL expression\n   */\n  prefix?: string;\n\n  /**\n   * Sets if match filters join values together in a regex filter\n   * i.e. multiple filters with operators: '=' | '!=' => '=~' | '!~'\n   */\n  joinMatchFilters: boolean;\n\n  /**\n   * Sets if the values are JSON encoded\n   */\n  decodeFilters: boolean;\n\n  /**\n   * Keys to ignore\n   */\n  ignoreKeys?: string[];\n\n  filterType: 'indexed' | 'field';\n}\n\nexport class ExpressionBuilder {\n  private filters: AdHocFilterWithLabels[];\n  private options: Options;\n  private positiveFilterValueSeparator = 'or';\n  private negativeFilterValueSeparator = '|';\n\n  constructor(\n    filters: AdHocFilterWithLabels[],\n    options: Options = { joinMatchFilters: true, decodeFilters: false, filterType: 'field' }\n  ) {\n    this.filters = filters;\n    this.options = options;\n    if (!this.options.debug) {\n      this.options.debug = getExpressionBuilderDebug();\n    }\n  }\n\n  /**\n   * Joins filters with same keys similar operators\n   * e.g. {level=\"info\"}, {level=\"warn\"} => {level=~\"warn|info\"}\n   */\n  public getJoinedLabelsFilters(): AdHocFilterWithLabels[] {\n    let { equalsFilters, notEqualsFilters, regexEqualFilters, regexNotEqualFilters } = this.getCombinedLabelFilters();\n    const adHocFilters: AdHocFilterWithLabels[] = [];\n    const filters = [equalsFilters, notEqualsFilters, regexEqualFilters, regexNotEqualFilters].filter(\n      (filter) => filter\n    );\n    filters.forEach((operatorFilters) => {\n      const joinedValues = this.joinCombinedFiltersValues(operatorFilters, '|');\n\n      for (const key in operatorFilters) {\n        const filter = operatorFilters[key];\n        const operator = filter.operator;\n        adHocFilters.push({ key, operator, value: joinedValues[key] });\n      }\n    });\n\n    return adHocFilters;\n  }\n\n  /**\n   * Returns logQL expression for AdHocFilterWithLabels[]\n   * Merges multiple include matches into regex\n   */\n  protected getExpr(): string {\n    let {\n      equalsFilters,\n      notEqualsFilters,\n      regexEqualFilters,\n      regexNotEqualFilters,\n      ltFilters,\n      lteFilters,\n      gtFilters,\n      gteFilters,\n    } = this.getCombinedLabelFilters();\n\n    if (this.options.debug) {\n      console.info('combined filters after merge', {\n        equalsFilters,\n        notEqualsFilters,\n        regexEqualFilters,\n        regexNotEqualFilters,\n        ltFilters,\n        lteFilters,\n        gtFilters,\n        gteFilters,\n      });\n    }\n\n    const filtersString = this.buildLabelsLogQLFromFilters({\n      equalsFilters,\n      notEqualsFilters,\n      regexEqualFilters,\n      regexNotEqualFilters,\n      ltFilters,\n      lteFilters,\n      gtFilters,\n      gteFilters,\n    });\n\n    if (filtersString) {\n      // Append prefix if defined\n      return (this.options.prefix ?? '') + filtersString;\n    }\n\n    return '';\n  }\n\n  public getLabelsExpr(options?: Partial<Options>): string {\n    const defaultOptions: Options = { joinMatchFilters: true, decodeFilters: false, filterType: 'indexed' };\n    this.options = { ...defaultOptions, ...options };\n    return this.getExpr();\n  }\n\n  /**\n   * Returns merged filters separated by pipe\n   */\n  public getMetadataExpr(options?: Partial<Options>): string {\n    const defaultOptions: Options = {\n      filterSeparator: ' |',\n      prefix: '| ',\n      joinMatchFilters: false,\n      decodeFilters: false,\n      filterType: 'field',\n    };\n    this.options = { ...defaultOptions, ...options };\n    return this.getExpr();\n  }\n\n  /**\n   * Same as metadata, but only include operators supported\n   */\n  public getLevelsExpr(options?: Partial<Options>): string {\n    const defaultOptions: Options = {\n      filterSeparator: ' |',\n      prefix: '| ',\n      joinMatchFilters: false,\n      decodeFilters: false,\n      filterType: 'field',\n    };\n\n    this.options = { ...defaultOptions, ...options };\n    return this.getExpr();\n  }\n\n  /**\n   * Returns merged filters separated by pipe\n   * JSON encodes value\n   */\n  public getFieldsExpr(options?: Partial<Options>): string {\n    const defaultOptions: Options = {\n      filterSeparator: ' |',\n      prefix: '| ',\n      joinMatchFilters: false,\n      decodeFilters: true,\n      filterType: 'field',\n    };\n    this.options = { ...defaultOptions, ...options };\n    return this.getExpr();\n  }\n\n  /**\n   * Transforms joined field value objects into logQL strings\n   */\n  private buildLabelsLogQLFromFilters({\n    equalsFilters,\n    notEqualsFilters,\n    regexEqualFilters,\n    regexNotEqualFilters,\n    ltFilters,\n    lteFilters,\n    gtFilters,\n    gteFilters,\n  }: {\n    equalsFilters: CombinedFiltersValuesByKey | undefined;\n    notEqualsFilters: CombinedFiltersValuesByKey | undefined;\n    regexEqualFilters: CombinedFiltersValuesByKey | undefined;\n    regexNotEqualFilters: CombinedFiltersValuesByKey | undefined;\n    ltFilters: CombinedFiltersValuesByKey | undefined;\n    lteFilters: CombinedFiltersValuesByKey | undefined;\n    gtFilters: CombinedFiltersValuesByKey | undefined;\n    gteFilters: CombinedFiltersValuesByKey | undefined;\n  }) {\n    let equalFiltersStrings: CombinedOperatorFilters | OperatorFilters;\n    let notEqualsFiltersStrings: CombinedOperatorFilters | OperatorFilters;\n    let regexEqualFiltersStrings: CombinedOperatorFilters | OperatorFilters;\n    let regexNotEqualFiltersStrings: CombinedOperatorFilters | OperatorFilters;\n    let ltFiltersStrings: OperatorFilters;\n    let lteFiltersStrings: OperatorFilters;\n    let gtFiltersStrings: OperatorFilters;\n    let gteFiltersStrings: OperatorFilters;\n\n    // Build the LogQL filters\n    const allFilters: string[] = [];\n\n    if (this.options.joinMatchFilters) {\n      // Join values arrays for all keys with \"|\" char\n      equalFiltersStrings = this.joinCombinedFiltersValues(equalsFilters, '|');\n      notEqualsFiltersStrings = this.joinCombinedFiltersValues(notEqualsFilters, '|');\n      regexEqualFiltersStrings = this.joinCombinedFiltersValues(regexEqualFilters, '|');\n      regexNotEqualFiltersStrings = this.joinCombinedFiltersValues(regexNotEqualFilters, '|');\n\n      allFilters.push(...this.buildJoinedFilters(equalFiltersStrings, LabelFilterOp.Equal));\n      allFilters.push(...this.buildJoinedFilters(notEqualsFiltersStrings, LabelFilterOp.NotEqual));\n      allFilters.push(...this.buildJoinedFilters(regexEqualFiltersStrings, LabelFilterOp.RegexEqual));\n      allFilters.push(...this.buildJoinedFilters(regexNotEqualFiltersStrings, LabelFilterOp.RegexNotEqual));\n    } else {\n      // Do not join filters\n      equalFiltersStrings = this.getFilterValues(equalsFilters);\n      notEqualsFiltersStrings = this.getFilterValues(notEqualsFilters);\n      regexEqualFiltersStrings = this.getFilterValues(regexEqualFilters);\n      regexNotEqualFiltersStrings = this.getFilterValues(regexNotEqualFilters);\n\n      allFilters.push(...this.buildFilter(equalFiltersStrings, LabelFilterOp.Equal));\n      allFilters.push(...this.buildFilter(notEqualsFiltersStrings, LabelFilterOp.NotEqual));\n      allFilters.push(...this.buildFilter(regexEqualFiltersStrings, LabelFilterOp.RegexEqual));\n      allFilters.push(...this.buildFilter(regexNotEqualFiltersStrings, LabelFilterOp.RegexNotEqual));\n    }\n\n    // //Numeric fields are never joined\n    ltFiltersStrings = this.getFilterValues(ltFilters);\n    lteFiltersStrings = this.getFilterValues(lteFilters);\n    gtFiltersStrings = this.getFilterValues(gtFilters);\n    gteFiltersStrings = this.getFilterValues(gteFilters);\n\n    allFilters.push(...this.buildFilter(ltFiltersStrings, NumericFilterOp.lt));\n    allFilters.push(...this.buildFilter(lteFiltersStrings, NumericFilterOp.lte));\n    allFilters.push(...this.buildFilter(gtFiltersStrings, NumericFilterOp.gt));\n    allFilters.push(...this.buildFilter(gteFiltersStrings, NumericFilterOp.gte));\n\n    if (this.options.debug) {\n      console.info('combined filters after stringify', {\n        equalFiltersStrings,\n        notEqualsFiltersStrings,\n        regexEqualFiltersStrings,\n        regexNotEqualFiltersStrings,\n        ltFiltersStrings,\n        lteFiltersStrings,\n        gtFiltersStrings,\n        gteFiltersStrings,\n        allFilters,\n      });\n    }\n\n    // Create the final output string by joining filters with filterSeparator char\n    const allFiltersString = trim(this.combineValues(allFilters, `${this.options.filterSeparator ?? ','} `));\n\n    if (this.options.debug) {\n      console.info('DEBUG labels expr', { allFiltersString });\n    }\n\n    return allFiltersString;\n  }\n\n  /**\n   * Group filter values by key\n   */\n  private getCombinedLabelFilters() {\n    // Group filters by operator and key\n    const {\n      [LabelFilterOp.Equal]: equal,\n      [LabelFilterOp.NotEqual]: notEqual,\n      [LabelFilterOp.RegexEqual]: regexEqual,\n      [LabelFilterOp.RegexNotEqual]: regexNotEqual,\n      [NumericFilterOp.lt]: lt,\n      [NumericFilterOp.lte]: lte,\n      [NumericFilterOp.gt]: gt,\n      [NumericFilterOp.gte]: gte,\n    } = this.groupFiltersByKey(this.filters);\n\n    let equalsFilters: CombinedFiltersValuesByKey | undefined;\n    let notEqualsFilters: CombinedFiltersValuesByKey | undefined;\n    let regexEqualFilters: CombinedFiltersValuesByKey | undefined;\n    let regexNotEqualFilters: CombinedFiltersValuesByKey | undefined;\n\n    let ltFilters: CombinedFiltersValuesByKey | undefined;\n    let lteFilters: CombinedFiltersValuesByKey | undefined;\n    let gtFilters: CombinedFiltersValuesByKey | undefined;\n    let gteFilters: CombinedFiltersValuesByKey | undefined;\n\n    // Escape values and combine filters by key and operator, multiple non-regex operations are returned under a different operator\n    if (this.options.joinMatchFilters) {\n      equalsFilters = this.combineFiltersValues(equal, LabelFilterOp.RegexEqual);\n      notEqualsFilters = this.combineFiltersValues(notEqual, LabelFilterOp.RegexNotEqual);\n      regexEqualFilters = this.combineFiltersValues(regexEqual);\n      regexNotEqualFilters = this.combineFiltersValues(regexNotEqual);\n    } else {\n      equalsFilters = this.combineFiltersValues(equal);\n      notEqualsFilters = this.combineFiltersValues(notEqual);\n      regexEqualFilters = this.combineFiltersValues(regexEqual);\n      regexNotEqualFilters = this.combineFiltersValues(regexNotEqual);\n    }\n\n    // Numeric filters are never combined\n    ltFilters = this.combineFiltersValues(lt);\n    lteFilters = this.combineFiltersValues(lte);\n    gtFilters = this.combineFiltersValues(gt);\n    gteFilters = this.combineFiltersValues(gte);\n\n    if (this.options.debug) {\n      console.info('combined filters', {\n        equalsFilters,\n        notEqualsFilters,\n        regexEqualFilters,\n        regexNotEqualFilters,\n      });\n    }\n\n    if (this.options.joinMatchFilters) {\n      // If we changed the operation, merge the values and remove the stale operator from the object\n      if (equalsFilters) {\n        regexEqualFilters = this.mergeFilters(LabelFilterOp.RegexEqual, equalsFilters, regexEqualFilters);\n        equalsFilters = this.removeStaleOperators(equalsFilters, LabelFilterOp.Equal);\n      }\n      if (notEqualsFilters) {\n        regexNotEqualFilters = this.mergeFilters(LabelFilterOp.RegexNotEqual, notEqualsFilters, regexNotEqualFilters);\n        notEqualsFilters = this.removeStaleOperators(notEqualsFilters, LabelFilterOp.NotEqual);\n      }\n    }\n\n    return {\n      equalsFilters,\n      notEqualsFilters,\n      regexEqualFilters,\n      regexNotEqualFilters,\n      ltFilters,\n      lteFilters,\n      gtFilters,\n      gteFilters,\n    };\n  }\n\n  /**\n   * Transforms values grouped by key to logQL filter strings\n   */\n  private buildFilter(filters: OperatorFilters, operator: LabelFilterOp | NumericFilterOp): string[] {\n    const filterStrings: string[] = [];\n\n    for (const key in filters) {\n      const filtersWithSameOperatorsAndKeys: string[] = [];\n      const values = filters[key];\n      if (isOperatorNumeric(operator)) {\n        values.forEach((value) =>\n          filtersWithSameOperatorsAndKeys.push(this.buildFilterString(key, operator, value, ''))\n        );\n      } else {\n        values.forEach((value) => filtersWithSameOperatorsAndKeys.push(this.buildFilterString(key, operator, value)));\n      }\n\n      if (isOperatorInclusive(operator)) {\n        filterStrings.push(filtersWithSameOperatorsAndKeys.join(` ${this.positiveFilterValueSeparator} `));\n      } else {\n        filterStrings.push(filtersWithSameOperatorsAndKeys.join(` ${this.negativeFilterValueSeparator} `));\n      }\n    }\n\n    return filterStrings;\n  }\n\n  /**\n   * Transforms escaped & concatenated values into strings grouped by key to logQL filter strings\n   */\n  private buildJoinedFilters(equalFiltersStrings: CombinedOperatorFilters, operator: LabelFilterOp) {\n    const filterStrings = [];\n    for (const key in equalFiltersStrings) {\n      filterStrings.push(this.buildFilterString(key, operator, equalFiltersStrings[key]));\n    }\n    return filterStrings;\n  }\n\n  /**\n   * Cleans up CombinedFiltersValuesByKey if the operator was transformed\n   */\n  private removeStaleOperators(filters: CombinedFiltersValuesByKey, expectedOperator: LabelFilterOp) {\n    const result: CombinedFiltersValuesByKey = {};\n    Object.keys(filters).forEach((key) => {\n      if (filters[key].operator === expectedOperator) {\n        result[key] = filters[key];\n      }\n    });\n    return result;\n  }\n\n  /**\n   * Merges filters grouped by key from one operator group to another\n   */\n  private mergeFilters(\n    operatorTo: LabelFilterOp,\n    filtersFrom: CombinedFiltersValuesByKey,\n    filtersTo: CombinedFiltersValuesByKey | undefined\n  ) {\n    const convertedEqualsFilters = Object.keys(filtersFrom)\n      .filter((key) => filtersFrom[key].operator === operatorTo)\n      .map((key) => ({ values: filtersFrom[key].values, key }));\n\n    convertedEqualsFilters.forEach((valuesToMove) => {\n      if (filtersTo === undefined) {\n        filtersTo = { [valuesToMove.key]: { values: [], operator: operatorTo } };\n      }\n      if (filtersTo[valuesToMove.key] === undefined) {\n        filtersTo[valuesToMove.key] = { values: [], operator: operatorTo };\n      }\n      filtersTo[valuesToMove.key].values.push(\n        ...this.mergeCombinedFiltersValues(filtersFrom[valuesToMove.key], operatorTo)\n      );\n    });\n    return filtersTo;\n  }\n\n  /**\n   * Merges values for a single filter key\n   */\n  private mergeCombinedFiltersValues(filtersFrom: CombinedFiltersValues, operatorTo: LabelFilterOp) {\n    const values: string[] = [];\n    if (filtersFrom.operator === operatorTo && filtersFrom.values?.length) {\n      values.push(...filtersFrom.values);\n    }\n    return values;\n  }\n\n  /**\n   * Iterates through all keys in an operator group and combines values with separator\n   */\n  private joinCombinedFiltersValues(\n    filters: CombinedFiltersValuesByKey | undefined,\n    separator: string\n  ): CombinedOperatorFilters {\n    const filterCombinedValues: CombinedOperatorFilters = {};\n    for (const key in filters) {\n      if (!filters[key].values.length) {\n        continue;\n      }\n\n      filterCombinedValues[key] = this.combineValues(filters[key].values, separator);\n    }\n\n    return filterCombinedValues;\n  }\n\n  /**\n   * Iterates through key groups and transforms filter values to key => values object\n   */\n  private getFilterValues(filters: CombinedFiltersValuesByKey | undefined): OperatorFilters {\n    const filterValues: OperatorFilters = {};\n    for (const key in filters) {\n      if (!filters[key].values.length) {\n        continue;\n      }\n\n      filterValues[key] = filters[key].values;\n    }\n\n    return filterValues;\n  }\n\n  /**\n   * Combines an array of values by separator\n   * Completely unnecessary wrapper of join\n   */\n  private combineValues(values: string[], separator: string) {\n    return values.join(`${separator}`);\n  }\n\n  /**\n   * Combines and escapes values with the same operator, note assumes every filter has the same operator\n   * If multipleValuesOperator is set, multiple values will be combined into a single filter to use that operator in the output\n   * @param filtersByKey\n   * @param multipleValuesOperator\n   * @private\n   */\n  private combineFiltersValues(\n    filtersByKey: Dictionary<AdHocFilterWithLabels[]>,\n    multipleValuesOperator?: LabelFilterOp\n  ): CombinedFiltersValuesByKey | undefined {\n    let updatedOperatorAndEscapedValues: CombinedFiltersValuesByKey = {};\n\n    for (const key in filtersByKey) {\n      if (!filtersByKey[key].length) {\n        continue;\n      }\n\n      const currentOperator = narrowFilterOperator(filtersByKey[key][0].operator);\n      const updatedOperator = multipleValuesOperator ?? currentOperator;\n      const firstFilter = filtersByKey[key][0];\n\n      updatedOperatorAndEscapedValues[key] = { values: [], operator: updatedOperator };\n\n      // Only one value for this key\n      if (filtersByKey[key].length === 1) {\n        const filterString = this.escapeFieldValue(\n          firstFilter.operator,\n          firstFilter.value,\n          firstFilter.valueLabels ?? []\n        );\n        updatedOperatorAndEscapedValues[key] = { operator: currentOperator, values: [filterString] };\n\n        if (this.options.debug) {\n          console.info('single value filter', { filter: firstFilter, filterString });\n        }\n      } else {\n        const values = this.escapeFieldValues(key, filtersByKey, updatedOperator);\n        if (updatedOperatorAndEscapedValues[key].operator === undefined) {\n          updatedOperatorAndEscapedValues[key] = { operator: updatedOperator, values };\n        } else {\n          updatedOperatorAndEscapedValues[key].values?.push(...values);\n        }\n      }\n    }\n\n    return updatedOperatorAndEscapedValues;\n  }\n\n  /**\n   * Iterates through all keys in a merged operator group and escapes the values\n   */\n  private escapeFieldValues(\n    key: string,\n    filtersByKey: Dictionary<AdHocFilterWithLabels[]>,\n    updatedOperator: LabelFilterOp | NumericFilterOp\n  ) {\n    // Convert single operator to regex\n    return filtersByKey[key].map((filter) =>\n      this.escapeFieldValue(updatedOperator, filter.value, filter.valueLabels ?? [])\n    );\n  }\n\n  /**\n   * Escape field values:\n   * If value is encoded, decode it\n   * If value is empty, don't escape double quotes\n   * If value is custom user input, strip prefix and don't escape special regex chars\n   */\n  private escapeFieldValue(operator: LabelFilterOp | string, value: string, valueLabels: string[]): string {\n    const isUserInput = isAdHocFilterValueUserInput(value);\n\n    // decode value\n    if (this.options.decodeFilters) {\n      const fieldObject = getValueFromFieldsFilter({ value, valueLabels });\n      value = fieldObject.value;\n    }\n\n    if (value === EMPTY_VARIABLE_VALUE) {\n      if (this.options.debug) {\n        console.info('empty variable value, do not escape');\n      }\n      // Don't encode empty value\n      return value;\n    }\n\n    if (isUserInput) {\n      if (this.options.debug) {\n        console.info('ESCAPE: user input - exact selector', {\n          operator,\n          value,\n          result: sceneUtils.escapeLabelValueInExactSelector(stripAdHocFilterUserInputPrefix(value)),\n        });\n      }\n      return sceneUtils.escapeLabelValueInExactSelector(stripAdHocFilterUserInputPrefix(value));\n    }\n    if (isOperatorRegex(operator)) {\n      if (this.options.debug) {\n        console.info('ESCAPE: regex selector', { operator, value });\n      }\n      return sceneUtils.escapeLabelValueInRegexSelector(value);\n    }\n\n    if (this.options.debug) {\n      console.info('ESCAPE: exact selector', { operator, value });\n    }\n\n    return sceneUtils.escapeLabelValueInExactSelector(value);\n  }\n\n  /**\n   * Builds logQL filter string.\n   * Expects pre-escaped content\n   * @private\n   */\n  private buildFilterString(key: string, operator: LabelFilterOp | string, rawValue: string, quoteChar = '\"') {\n    if (rawValue === EMPTY_VARIABLE_VALUE) {\n      return `${key}${operator}${rawValue}`;\n    }\n\n    const filterString = `${key}${operator}${quoteChar}${rawValue}${quoteChar}`;\n    if (this.options.debug) {\n      console.info('buildDoubleQuotedFilter', { filter: { key, operator, value: rawValue }, filterString });\n    }\n\n    return filterString;\n  }\n\n  /**\n   * Groups all filters by operator and key\n   */\n  private groupFiltersByKey(filters: AdHocVariableFilter[]): Record<FilterOpType, Dictionary<AdHocFilterWithLabels[]>> {\n    let filteredFilters: AdHocVariableFilter[] = filters.filter(\n      (f) => !this.options.ignoreKeys?.includes(f.key) || isOperatorRegex(f.operator)\n    );\n\n    // We need at least one inclusive filter\n    if (this.options.filterType === 'indexed') {\n      if (filteredFilters.length < 1) {\n        filteredFilters = filters;\n      }\n    }\n\n    const positiveMatch = filteredFilters.filter(\n      (filter) => isOperatorInclusive(filter.operator) && !isOperatorRegex(filter.operator)\n    );\n    const positiveRegex = filteredFilters.filter(\n      (filter) => isOperatorInclusive(filter.operator) && isOperatorRegex(filter.operator)\n    );\n    const negativeMatch = filteredFilters.filter(\n      (filter) => isOperatorExclusive(filter.operator) && !isOperatorRegex(filter.operator)\n    );\n    const negativeRegex = filteredFilters.filter(\n      (filter) => isOperatorExclusive(filter.operator) && isOperatorRegex(filter.operator)\n    );\n    const gt = filteredFilters.filter((filter) => filter.operator === FilterOp.gt);\n    const gte = filteredFilters.filter((filter) => filter.operator === FilterOp.gte);\n    const lt = filteredFilters.filter((filter) => filter.operator === FilterOp.lt);\n    const lte = filteredFilters.filter((filter) => filter.operator === FilterOp.lte);\n\n    // Field ops\n    const positiveMatchGroup = groupBy(positiveMatch, (filter) => filter.key);\n    const positiveRegexGroup = groupBy(positiveRegex, (filter) => filter.key);\n    const negativeMatchGroup = groupBy(negativeMatch, (filter) => filter.key);\n    const negativeRegexGroup = groupBy(negativeRegex, (filter) => filter.key);\n\n    // Duration ops\n    const gtGroup = groupBy(gt, (filter) => filter.key);\n    const gteGroup = groupBy(gte, (filter) => filter.key);\n    const ltGroup = groupBy(lt, (filter) => filter.key);\n    const lteGroup = groupBy(lte, (filter) => filter.key);\n\n    return {\n      [FilterOp.Equal]: positiveMatchGroup,\n      [FilterOp.RegexEqual]: positiveRegexGroup,\n      [FilterOp.NotEqual]: negativeMatchGroup,\n      [FilterOp.RegexNotEqual]: negativeRegexGroup,\n      [FilterOp.gt]: gtGroup,\n      [FilterOp.gte]: gteGroup,\n      [FilterOp.lt]: ltGroup,\n      [FilterOp.lte]: lteGroup,\n    };\n  }\n}\n","import { reportInteraction } from '@grafana/runtime';\nimport pluginJson from '../plugin.json';\n\n// Helper function to create a unique interaction name for analytics\nconst createInteractionName = (page: UserEventPagesType, action: string) => {\n  return `${pluginJson.id.replace(/-/g, '_')}_${page}_${action}`;\n};\n\n// Runs reportInteraction with a standardized interaction name\nexport const reportAppInteraction = (\n  page: UserEventPagesType,\n  action: UserEventActionType,\n  properties?: Record<string, unknown>\n) => {\n  reportInteraction(createInteractionName(page, action), properties);\n};\n\nexport const USER_EVENTS_PAGES = {\n  service_selection: 'service_selection',\n  service_details: 'service_details',\n  all: 'all',\n} as const;\n\ntype UserEventPagesType = keyof typeof USER_EVENTS_PAGES;\ntype UserEventActionType =\n  | keyof (typeof USER_EVENTS_ACTIONS)['service_selection']\n  | keyof (typeof USER_EVENTS_ACTIONS)['service_details']\n  | keyof (typeof USER_EVENTS_ACTIONS)['all'];\n\nexport const USER_EVENTS_ACTIONS = {\n  [USER_EVENTS_PAGES.service_selection]: {\n    // Searching for service using search input. Props: searchQueryLength, containsLevel\n    search_services_changed: 'search_services_changed',\n    // Selecting service. Props: service\n    service_selected: 'service_selected',\n    // Toggling aggregated metrics on/off\n    aggregated_metrics_toggled: 'aggregated_metrics_toggled',\n    add_to_filters: 'add_to_filters',\n  },\n  [USER_EVENTS_PAGES.service_details]: {\n    open_in_explore_clicked: 'open_in_explore_clicked',\n    // Selecting action view tab (logs/labels/fields/patterns). Props: newActionView, previousActionView\n    action_view_changed: 'action_view_changed',\n    // Clicking on \"Include\" button in time series panels. Used in multiple views. The view type is passed as a parameter. Props: filterType, key, isFilterDuplicate, filtersLength\n    add_to_filters_in_breakdown_clicked: 'add_to_filters_in_breakdown_clicked',\n    // Clicking on \"Select\" button button in time series panels. Used in multiple views.The view type is passed as a parameter. Props: field, previousField, view\n    select_field_in_breakdown_clicked: 'select_field_in_breakdown_clicked',\n    // Clicking on one of the levels in the Logs Volume panel\n    level_in_logs_volume_clicked: 'level_in_logs_volume_clicked',\n    label_in_panel_summary_clicked: 'label_in_panel_summary_clicked',\n    // Changing layout type (e.g. single/grid/rows). Used in multiple views. The view type is passed as a parameter. Props: layout, view\n    layout_type_changed: 'layout_type_changed',\n    // Changing search string in logs. Props: searchQuery\n    search_string_in_logs_changed: 'search_string_in_logs_changed',\n    search_string_in_variables_changed: 'search_string_in_variables_changed',\n    // Removing a pattern (e.g. include/exclude) from the list. Props: includePatternsLength, excludePatternsLength, type\n    pattern_removed: 'pattern_removed',\n    // Selecting a pattern (e.g. include/exclude) from the list. Props: includePatternsLength, excludePatternsLength, type\n    pattern_selected: 'pattern_selected',\n    // Clicking on a pattern field in the pattern name.\n    pattern_field_clicked: 'pattern_field_clicked',\n    // Toggling between logs/table view\n    logs_visualization_toggle: 'logs_visualization_toggle',\n    // Filter (include, exclude) from log details\n    logs_detail_filter_applied: 'logs_detail_filter_applied',\n    // Popover menu filter\n    logs_popover_line_filter: 'logs_popover_line_filter',\n    // Toggle displayed fields\n    logs_toggle_displayed_field: 'logs_toggle_displayed_field',\n    // Clear all displayed fields\n    logs_clear_displayed_fields: 'logs_clear_displayed_fields',\n    // Value breakdown sort change\n    value_breakdown_sort_change: 'value_breakdown_sort_change',\n    // Wasm not supported\n    wasm_not_supported: 'wasm_not_supported',\n    change_viz_type: 'change_viz_type',\n  },\n  [USER_EVENTS_PAGES.all]: {\n    interval_too_long: 'interval_too_long',\n    open_in_explore_menu_clicked: 'open_in_explore_menu_clicked',\n  },\n} as const;\n","import _ from 'lodash';\n\n/**\n * Order doesn't matter, converts to sets, deep compare via lodash isEqual\n * @param arr1\n * @param arr2\n */\n\nexport const areArraysEqual = (arr1: any[] | undefined, arr2: any[] | undefined) => {\n  // If one array is undefined, and the other is empty, they will cast to the same set.\n  if (typeof arr1 !== typeof arr2) {\n    return false;\n  }\n  const set1 = new Set(arr1);\n  const set2 = new Set(arr2);\n\n  // Save us from running the isEqual check if the set sizes are different\n  if (set1.size !== set2.size) {\n    return false;\n  }\n\n  return _.isEqual(set1, set2);\n};\n\nexport const areArraysStrictlyEqual = (arr1: any[] | undefined, arr2: any[] | undefined) => {\n  // If one array is undefined, and the other is empty, they will cast to the same set.\n  if (typeof arr1 !== typeof arr2) {\n    return false;\n  }\n  return _.isEqual(arr1, arr2);\n};\n","import { MetricExpr, parser, Selector } from '@grafana/lezer-logql';\nimport { LokiQuery } from './lokiQuery';\nimport { getNodesFromQuery } from './logqlMatchers';\nimport { SceneDataQueryRequest } from './datasourceTypes';\n\nexport function isQueryWithNode(query: string, nodeType: number): boolean {\n  let isQueryWithNode = false;\n  const tree = parser.parse(query);\n  tree.iterate({\n    enter: ({ type }): false | void => {\n      if (type.id === nodeType) {\n        isQueryWithNode = true;\n        return false;\n      }\n    },\n  });\n  return isQueryWithNode;\n}\n\nexport function isLogsQuery(query: string): boolean {\n  // As a safeguard we are checking for a length of 2, because at least the query should be `{}`\n  return query.trim().length > 2 && !isQueryWithNode(query, MetricExpr);\n}\n\nexport function isLogsRequest(request: SceneDataQueryRequest) {\n  return request.targets.find((query) => isLogsQuery(query.expr)) !== undefined;\n}\n\nexport function isInstantQuery(request: SceneDataQueryRequest) {\n  return request.targets.find((query) => query.queryType === 'instant');\n}\n\nexport function requestSupportsSharding(request: SceneDataQueryRequest) {\n  if (isLogsRequest(request)) {\n    return false;\n  }\n  if (isInstantQuery(request)) {\n    return false;\n  }\n  for (let i = 0; i < request.targets.length; i++) {\n    if (request.targets[i].expr?.includes('avg_over_time')) {\n      return false;\n    }\n  }\n  return true;\n}\n\nconst SHARDING_PLACEHOLDER = '__stream_shard_number__';\nexport const addShardingPlaceholderSelector = (query: string) => {\n  return query.replace('}', `, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`);\n};\n\nexport const interpolateShardingSelector = (queries: LokiQuery[], shards?: number[]) => {\n  if (shards === undefined || shards.length === 0) {\n    return queries.map((query) => ({\n      ...query,\n      expr: query.expr.replace(`, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`, '}'),\n    }));\n  }\n\n  let shardValue = shards.join('|');\n\n  // -1 means empty shard value\n  if (shardValue === '-1' || shards.length === 1) {\n    shardValue = shardValue === '-1' ? '' : shardValue;\n    return queries.map((query) => ({\n      ...query,\n      expr: query.expr.replace(`, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`, `, __stream_shard__=\"${shardValue}\"}`),\n    }));\n  }\n\n  return queries.map((query) => ({\n    ...query,\n    expr: query.expr.replace(new RegExp(`${SHARDING_PLACEHOLDER}`, 'g'), shardValue),\n  }));\n};\n\nexport const getSelectorForShardValues = (query: string) => {\n  const selector = getNodesFromQuery(query, [Selector]);\n  if (selector.length > 0) {\n    return query\n      .substring(selector[0].from, selector[0].to)\n      .replace(`, __stream_shard__=~\"${SHARDING_PLACEHOLDER}\"}`, '}');\n  }\n  return '';\n};\n","import {\n  closestIdx,\n  DataFrame,\n  DataFrameType,\n  DataQueryResponse,\n  DataQueryResponseData,\n  Field,\n  FieldType,\n  QueryResultMetaStat,\n} from '@grafana/data';\nimport { logger } from './logger';\n\nexport function combineResponses(currentResult: DataQueryResponse | null, newResult: DataQueryResponse) {\n  if (!currentResult) {\n    return cloneQueryResponse(newResult);\n  }\n\n  newResult.data.forEach((newFrame) => {\n    const currentFrame = currentResult.data.find((frame) => shouldCombine(frame, newFrame));\n    if (!currentFrame) {\n      currentResult.data.push(cloneDataFrame(newFrame));\n      return;\n    }\n    mergeFrames(currentFrame, newFrame);\n  });\n\n  const mergedErrors = [...(currentResult.errors ?? []), ...(newResult.errors ?? [])];\n\n  // we make sure to have `.errors` as undefined, instead of empty-array\n  // when no errors.\n\n  if (mergedErrors.length > 0) {\n    currentResult.errors = mergedErrors;\n  }\n\n  // the `.error` attribute is obsolete now,\n  // but we have to maintain it, otherwise\n  // some grafana parts do not behave well.\n  // we just choose the old error, if it exists,\n  // otherwise the new error, if it exists.\n  const mergedError = currentResult.error ?? newResult.error;\n  if (mergedError != null) {\n    currentResult.error = mergedError;\n  }\n\n  const mergedTraceIds = [...(currentResult.traceIds ?? []), ...(newResult.traceIds ?? [])];\n  if (mergedTraceIds.length > 0) {\n    currentResult.traceIds = mergedTraceIds;\n  }\n\n  return currentResult;\n}\n\n/**\n * Given two data frames, merge their values. Overlapping values will be added together.\n */\nexport function mergeFrames(dest: DataFrame, source: DataFrame) {\n  const destTimeField = dest.fields.find((field) => field.type === FieldType.time);\n  const destIdField = dest.fields.find((field) => field.type === FieldType.string && field.name === 'id');\n  const sourceTimeField = source.fields.find((field) => field.type === FieldType.time);\n  const sourceIdField = source.fields.find((field) => field.type === FieldType.string && field.name === 'id');\n\n  if (!destTimeField || !sourceTimeField) {\n    logger.error(new Error(`Time fields not found in the data frames`));\n    return;\n  }\n\n  const sourceTimeValues = sourceTimeField?.values.slice(0) ?? [];\n  const totalFields = Math.max(dest.fields.length, source.fields.length);\n\n  for (let i = 0; i < sourceTimeValues.length; i++) {\n    const destIdx = resolveIdx(destTimeField, sourceTimeField, i);\n\n    const entryExistsInDest = compareEntries(destTimeField, destIdField, destIdx, sourceTimeField, sourceIdField, i);\n\n    for (let f = 0; f < totalFields; f++) {\n      // For now, skip undefined fields that exist in the new frame\n      if (!dest.fields[f]) {\n        continue;\n      }\n      // Index is not reliable when frames have disordered fields, or an extra/missing field, so we find them by name.\n      // If the field has no name, we fallback to the old index version.\n      const sourceField = findSourceField(dest.fields[f], source.fields, f);\n      if (!sourceField) {\n        continue;\n      }\n      // Same value, accumulate\n      if (entryExistsInDest) {\n        if (dest.fields[f].type === FieldType.time) {\n          // Time already exists, skip\n          continue;\n        } else if (dest.fields[f].type === FieldType.number) {\n          // Number, add\n          dest.fields[f].values[destIdx] = (dest.fields[f].values[destIdx] ?? 0) + sourceField.values[i];\n        } else if (dest.fields[f].type === FieldType.other) {\n          // Possibly labels, combine\n          if (typeof sourceField.values[i] === 'object') {\n            dest.fields[f].values[destIdx] = {\n              ...dest.fields[f].values[destIdx],\n              ...sourceField.values[i],\n            };\n          } else if (sourceField.values[i] != null) {\n            dest.fields[f].values[destIdx] = sourceField.values[i];\n          }\n        } else {\n          // Replace value\n          dest.fields[f].values[destIdx] = sourceField.values[i];\n        }\n      } else if (sourceField.values[i] !== undefined) {\n        // Insert in the `destIdx` position\n        dest.fields[f].values.splice(destIdx, 0, sourceField.values[i]);\n        if (sourceField.nanos) {\n          dest.fields[f].nanos = dest.fields[f].nanos ?? new Array(dest.fields[f].values.length - 1).fill(0);\n          dest.fields[f].nanos?.splice(destIdx, 0, sourceField.nanos[i]);\n        }\n      }\n    }\n  }\n\n  dest.length = dest.fields[0].values.length;\n\n  dest.meta = {\n    ...dest.meta,\n    stats: getCombinedMetadataStats(dest.meta?.stats ?? [], source.meta?.stats ?? []),\n  };\n}\n\nfunction resolveIdx(destField: Field, sourceField: Field, index: number) {\n  const idx = closestIdx(sourceField.values[index], destField.values);\n  if (idx < 0) {\n    return 0;\n  }\n  if (sourceField.values[index] === destField.values[idx] && sourceField.nanos != null && destField.nanos != null) {\n    return sourceField.nanos[index] > destField.nanos[idx] ? idx + 1 : idx;\n  }\n  if (sourceField.values[index] > destField.values[idx]) {\n    return idx + 1;\n  }\n  return idx;\n}\n\nfunction compareEntries(\n  destTimeField: Field,\n  destIdField: Field | undefined,\n  destIndex: number,\n  sourceTimeField: Field,\n  sourceIdField: Field | undefined,\n  sourceIndex: number\n) {\n  const sameTimestamp = compareNsTimestamps(destTimeField, destIndex, sourceTimeField, sourceIndex);\n  if (!sameTimestamp) {\n    return false;\n  }\n  if (destIdField == null || sourceIdField == null) {\n    return true;\n  }\n  // Log frames, check indexes\n  return (\n    destIdField.values[destIndex] !== undefined && destIdField.values[destIndex] === sourceIdField.values[sourceIndex]\n  );\n}\n\nfunction compareNsTimestamps(destField: Field, destIndex: number, sourceField: Field, sourceIndex: number) {\n  if (destField.nanos && sourceField.nanos) {\n    return (\n      destField.values[destIndex] !== undefined &&\n      destField.values[destIndex] === sourceField.values[sourceIndex] &&\n      destField.nanos[destIndex] !== undefined &&\n      destField.nanos[destIndex] === sourceField.nanos[sourceIndex]\n    );\n  }\n  return destField.values[destIndex] !== undefined && destField.values[destIndex] === sourceField.values[sourceIndex];\n}\n\nfunction findSourceField(referenceField: Field, sourceFields: Field[], index: number) {\n  const candidates = sourceFields.filter((f) => f.name === referenceField.name);\n\n  if (candidates.length === 1) {\n    return candidates[0];\n  }\n\n  return sourceFields[index];\n}\n\nconst TOTAL_BYTES_STAT = 'Summary: total bytes processed';\n// This is specific for Loki\nfunction getCombinedMetadataStats(\n  destStats: QueryResultMetaStat[],\n  sourceStats: QueryResultMetaStat[]\n): QueryResultMetaStat[] {\n  // in the current approach, we only handle a single stat\n  const destStat = destStats.find((s) => s.displayName === TOTAL_BYTES_STAT);\n  const sourceStat = sourceStats.find((s) => s.displayName === TOTAL_BYTES_STAT);\n\n  if (sourceStat != null && destStat != null) {\n    return [{ value: sourceStat.value + destStat.value, displayName: TOTAL_BYTES_STAT, unit: destStat.unit }];\n  }\n\n  // maybe one of them exist\n  const eitherStat = sourceStat ?? destStat;\n  if (eitherStat != null) {\n    return [eitherStat];\n  }\n\n  return [];\n}\n\n/**\n * Deep clones a DataQueryResponse\n */\nexport function cloneQueryResponse(response: DataQueryResponse): DataQueryResponse {\n  const newResponse = {\n    ...response,\n    data: response.data.map(cloneDataFrame),\n  };\n  return newResponse;\n}\n\nfunction cloneDataFrame(frame: DataQueryResponseData): DataQueryResponseData {\n  return {\n    ...frame,\n    fields: frame.fields.map((field: Field) => ({\n      ...field,\n      values: field.values,\n    })),\n  };\n}\n\nfunction shouldCombine(frame1: DataFrame, frame2: DataFrame): boolean {\n  if (frame1.refId !== frame2.refId) {\n    return false;\n  }\n  if (frame1.name != null && frame2.name != null && frame1.name !== frame2.name) {\n    return false;\n  }\n\n  const frameType1 = frame1.meta?.type;\n  const frameType2 = frame2.meta?.type;\n\n  if (frameType1 !== frameType2) {\n    // we do not join things that have a different type\n    return false;\n  }\n\n  // metric range query data\n  if (frameType1 === DataFrameType.TimeSeriesMulti) {\n    return compareLabels(frame1, frame2);\n  }\n\n  // logs query data\n  // logs use a special attribute in the dataframe's \"custom\" section\n  // because we do not have a good \"frametype\" value for them yet.\n  const customType1 = frame1.meta?.custom?.frameType;\n  const customType2 = frame2.meta?.custom?.frameType;\n  // Legacy frames have this custom type\n  if (customType1 === 'LabeledTimeValues' && customType2 === 'LabeledTimeValues') {\n    return true;\n  } else if (customType1 === customType2) {\n    // Data plane frames don't\n    return true;\n  }\n\n  // should never reach here\n  return false;\n}\n\nfunction compareLabels(frame1: DataFrame, frame2: DataFrame) {\n  const field1 = frame1.fields.find((f) => f.type === FieldType.number);\n  const field2 = frame2.fields.find((f) => f.type === FieldType.number);\n  if (field1 === undefined || field2 === undefined) {\n    // should never happen\n    return false;\n  }\n  // undefined == null\n  if (frame1.name == null) {\n    frame1.name = JSON.stringify(field1.labels);\n  }\n  if (frame2.name == null) {\n    frame2.name = JSON.stringify(field2.labels);\n  }\n  return frame1.name === frame2.name;\n}\n","import pluginJson from '../plugin.json';\nimport { Observable, Subscriber, Subscription } from 'rxjs';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { DataQueryRequest, DataQueryResponse, LoadingState, QueryResultMetaStat } from '@grafana/data';\nimport { addShardingPlaceholderSelector, getSelectorForShardValues, interpolateShardingSelector } from './logql';\nimport { combineResponses } from './combineResponses';\nimport { LokiDatasource, LokiQuery } from './lokiQuery';\nimport { logger } from './logger';\nimport { isValidQuery } from './logqlMatchers';\n\n/**\n * Query splitting by stream shards.\n * Query splitting was introduced in Loki to optimize querying for long intervals and high volume of data,\n * dividing a big request into smaller sub-requests, combining and displaying the results as they arrive.\n *\n * This approach, inspired by the time-based query splitting, takes advantage of the __stream_shard__\n * internal label, representing how data is spread into different sources that can be queried individually.\n *\n * The main entry point of this module is runShardSplitQuery(), which prepares the query for execution and\n * passes it to splitQueriesByStreamShard() to begin the querying loop.\n *\n * splitQueriesByStreamShard() has the following structure:\n * - Creates and returns an Observable to which the UI will subscribe\n * - Requests the __stream_shard__ values of the selected service:\n *   . If there are no shard values, it falls back to the standard querying approach of the data source in runNonSplitRequest()\n *   . If there are shards:\n *     - It sorts them by value, descending. Higher shard numbers correspond with the least volume.\n *     - It defines an initial group size, roughly Math.sqrt(amountOfShards).\n *     - It begins the querying loop with runNextRequest().\n * - runNextRequest() will create a group of groupSize shards from the nth shard (cycle), and has the following internal structure:\n *   . groupShardRequests() returns an array of shards from cycle to cycle + groupSize.\n *   . interpolateShardingSelector() will update the stream selector with the shard numbers in the current group.\n *   . After query execution:\n *     - If the response is successful:\n *       . It will add new data to the response with combineResponses()\n *       . Using the data and meta data of the response, updateGroupSizeFromResponse() will increase or decrease the group size.\n *       . nextRequest() will use the current cycle and group size to determine the next request or complete execution with done().\n *     - If the response is unsuccessful:\n *       . If the response is not a query error, and the group size bigger than 1, it will decrease the group size.\n *       . If the group size is already 1, it will retry the request up to 4 times.\n *       . If there are retry attempts, it will retry the current cycle, or else stop querying.\n * - Once all request groups have been executed, it will be done().\n */\n\nexport function runShardSplitQuery(datasource: LokiDatasource, request: DataQueryRequest<LokiQuery>) {\n  const queries = datasource\n    .interpolateVariablesInQueries(request.targets, request.scopedVars)\n    .filter((query) => query.expr)\n    .map((target) => ({\n      ...target,\n      expr: addShardingPlaceholderSelector(target.expr),\n    }));\n\n  return splitQueriesByStreamShard(datasource, request, queries);\n}\n\nfunction splitQueriesByStreamShard(\n  datasource: LokiDatasource,\n  request: DataQueryRequest<LokiQuery>,\n  splittingTargets: LokiQuery[]\n) {\n  let shouldStop = false;\n  let mergedResponse: DataQueryResponse = { data: [], state: LoadingState.Streaming, key: uuidv4() };\n  let subquerySubscription: Subscription | null = null;\n  let retriesMap = new Map<number, number>();\n  let retryTimer: ReturnType<typeof setTimeout> | null = null;\n\n  const runNextRequest = (\n    subscriber: Subscriber<DataQueryResponse>,\n    cycle: number,\n    shards: number[],\n    groupSize: number\n  ) => {\n    let nextGroupSize = groupSize;\n    let retrying = false;\n\n    if (subquerySubscription != null) {\n      subquerySubscription.unsubscribe();\n      subquerySubscription = null;\n    }\n\n    const done = () => {\n      mergedResponse.state = shouldStop ? LoadingState.Error : LoadingState.Done;\n      subscriber.next(mergedResponse);\n      subscriber.complete();\n    };\n\n    if (shouldStop) {\n      done();\n      return;\n    }\n\n    const nextRequest = () => {\n      const nextCycle = Math.min(cycle + groupSize, shards.length);\n      if (cycle < shards.length && nextCycle <= shards.length) {\n        runNextRequest(subscriber, nextCycle, shards, nextGroupSize);\n        return;\n      }\n      done();\n    };\n\n    const retry = (errorResponse?: DataQueryResponse) => {\n      try {\n        if (errorResponse && !isRetriableError(errorResponse)) {\n          return false;\n        }\n      } catch (e) {\n        logger.error(e, {\n          msg: 'sharding retry error',\n          error: errorResponse?.error?.message ?? '',\n          errors: errorResponse?.errors?.map((e) => e.message).join(' | ') ?? '',\n          traces: errorResponse?.traceIds?.join('|') ?? '',\n        });\n        shouldStop = true;\n        return false;\n      }\n\n      if (groupSize > 1) {\n        groupSize = Math.floor(Math.sqrt(groupSize));\n        debug(`Possible time out, new group size ${groupSize}`);\n        retrying = true;\n        runNextRequest(subscriber, cycle, shards, groupSize);\n        return true;\n      }\n\n      const retries = retriesMap.get(cycle) ?? 0;\n      if (retries > 3) {\n        shouldStop = true;\n        return false;\n      }\n\n      retriesMap.set(cycle, retries + 1);\n\n      retryTimer = setTimeout(() => {\n        logger.info(`Retrying ${cycle} (${retries + 1})`);\n        runNextRequest(subscriber, cycle, shards, groupSize);\n        retryTimer = null;\n      }, 1500 * Math.pow(2, retries)); // Exponential backoff\n\n      retrying = true;\n\n      return true;\n    };\n\n    const shardsToQuery = groupShardRequests(shards, cycle, groupSize);\n    debug(`Querying ${shardsToQuery.join(', ')}`);\n    const subRequest = { ...request, targets: interpolateShardingSelector(splittingTargets, shardsToQuery) };\n    // Request may not have a request id\n    if (request.requestId) {\n      subRequest.requestId = `${request.requestId}_shard_${cycle}_${groupSize}`;\n    }\n\n    // @ts-expect-error\n    subquerySubscription = datasource.runQuery(subRequest).subscribe({\n      next: (partialResponse: DataQueryResponse) => {\n        if ((partialResponse.errors ?? []).length > 0 || partialResponse.error != null) {\n          if (retry(partialResponse)) {\n            return;\n          }\n        }\n        nextGroupSize = constrainGroupSize(\n          cycle + groupSize,\n          updateGroupSizeFromResponse(partialResponse, groupSize),\n          shards.length\n        );\n        if (nextGroupSize !== groupSize) {\n          debug(`New group size ${nextGroupSize}`);\n        }\n        mergedResponse = combineResponses(mergedResponse, partialResponse);\n      },\n      complete: () => {\n        if (retrying) {\n          return;\n        }\n        // Prevent flashing \"no data\"\n        if (mergedResponse.data.length) {\n          subscriber.next(mergedResponse);\n        }\n        nextRequest();\n      },\n      error: (error: unknown) => {\n        logger.error(error, { msg: 'failed to shard' });\n        subscriber.next(mergedResponse);\n        if (retry()) {\n          return;\n        }\n        nextRequest();\n      },\n    });\n  };\n\n  const runNonSplitRequest = (subscriber: Subscriber<DataQueryResponse>) => {\n    subquerySubscription = datasource.query(request).subscribe({\n      next: (partialResponse: DataQueryResponse) => {\n        mergedResponse = partialResponse;\n      },\n      complete: () => {\n        subscriber.next(mergedResponse);\n      },\n      error: (error: unknown) => {\n        logger.error(error, { msg: 'runNonSplitRequest subscription error' });\n        subscriber.error(mergedResponse);\n      },\n    });\n  };\n\n  const response = new Observable<DataQueryResponse>((subscriber) => {\n    const selector = getSelectorForShardValues(splittingTargets[0].expr);\n\n    if (!isValidQuery(selector)) {\n      debug(`Skipping invalid selector: ${selector}`);\n      subscriber.complete();\n      return;\n    }\n\n    datasource.languageProvider\n      .fetchLabelValues('__stream_shard__', {\n        timeRange: request.range,\n        streamSelector: selector ? selector : undefined,\n      })\n      .then((values: string[]) => {\n        const shards = values.map((value) => parseInt(value, 10));\n        if (!shards || !shards.length) {\n          logger.warn(`Shard splitting not supported. Issuing a regular query.`);\n          runNonSplitRequest(subscriber);\n        } else {\n          shards.sort((a, b) => b - a);\n          debug(`Querying ${shards.join(', ')} shards`);\n          runNextRequest(subscriber, 0, shards, getInitialGroupSize(shards));\n        }\n      })\n      .catch((e: unknown) => {\n        logger.error(e, { msg: 'failed to fetch label values for __stream_shard__' });\n        runNonSplitRequest(subscriber);\n      });\n    return () => {\n      shouldStop = true;\n      if (retryTimer) {\n        clearTimeout(retryTimer);\n      }\n      if (subquerySubscription != null) {\n        subquerySubscription.unsubscribe();\n        subquerySubscription = null;\n      }\n    };\n  });\n\n  return response;\n}\n\nfunction updateGroupSizeFromResponse(response: DataQueryResponse, currentSize: number) {\n  if (!response.data.length) {\n    // Empty response, increase group size\n    return currentSize + 1;\n  }\n\n  const metaExecutionTime: QueryResultMetaStat | undefined = response.data[0].meta?.stats?.find(\n    (stat: QueryResultMetaStat) => stat.displayName === 'Summary: exec time'\n  );\n\n  if (metaExecutionTime) {\n    const executionTime = Math.round(metaExecutionTime.value);\n    debug(`${metaExecutionTime.value}`);\n    // Positive scenarios\n    if (executionTime <= 1) {\n      return Math.floor(currentSize * 1.5);\n    } else if (executionTime < 6) {\n      return Math.ceil(currentSize * 1.1);\n    }\n\n    // Negative scenarios\n    if (currentSize === 1) {\n      return currentSize;\n    } else if (executionTime < 20) {\n      return Math.ceil(currentSize * 0.9);\n    } else {\n      return Math.floor(currentSize / 2);\n    }\n  }\n\n  return currentSize;\n}\n\n/**\n * Prevents the group size for ever being more than maxFactor% of the pending shards.\n */\nfunction constrainGroupSize(cycle: number, groupSize: number, shards: number) {\n  const maxFactor = 0.7;\n  return Math.min(groupSize, Math.max(Math.floor((shards - cycle) * maxFactor), 1));\n}\n\nfunction groupShardRequests(shards: number[], start: number, groupSize: number) {\n  if (start === shards.length) {\n    return [-1];\n  }\n  return shards.slice(start, start + groupSize);\n}\n\nfunction getInitialGroupSize(shards: number[]) {\n  return Math.floor(Math.sqrt(shards.length));\n}\n\nfunction isRetriableError(errorResponse: DataQueryResponse) {\n  const message = errorResponse.errors\n    ? (errorResponse.errors[0].message ?? '').toLowerCase()\n    : errorResponse.error?.message ?? '';\n  if (message.includes('timeout')) {\n    return true;\n  } else if (message.includes('parse error')) {\n    // If the error is a parse error, we want to signal to stop querying.\n    throw new Error(message);\n  }\n  return false;\n}\n\n// Enable to output debugging logs\nconst DEBUG_ENABLED = Boolean(localStorage.getItem(`${pluginJson.id}.sharding_debug_enabled`));\nfunction debug(message: string) {\n  if (!DEBUG_ENABLED) {\n    return;\n  }\n  console.log(message);\n}\n","import {\n  createDataFrame,\n  DataFrame,\n  DataQueryRequest,\n  DataQueryResponse,\n  Field,\n  FieldType,\n  LoadingState,\n  TestDataSourceResponse,\n} from '@grafana/data';\nimport { config, DataSourceWithBackend, getDataSourceSrv } from '@grafana/runtime';\nimport { RuntimeDataSource, sceneUtils } from '@grafana/scenes';\nimport { DataQuery } from '@grafana/schema';\nimport { Observable, Subscriber } from 'rxjs';\nimport { getDataSource } from './scenes';\nimport { DetectedFieldsResponse, DetectedLabelsResponse } from './fields';\nimport { FIELDS_TO_REMOVE, LABELS_TO_REMOVE, sortLabelsByCardinality } from './filters';\nimport { SERVICE_NAME } from './variables';\nimport { runShardSplitQuery } from './shardQuerySplitting';\nimport { requestSupportsSharding } from './logql';\nimport { LokiDatasource, LokiQuery } from './lokiQuery';\nimport { SceneDataQueryRequest, SceneDataQueryResourceRequest, VolumeRequestProps } from './datasourceTypes';\nimport { logger } from './logger';\nimport { PLUGIN_ID } from './plugin';\nimport { sanitizeStreamSelector } from './query';\n\nexport const WRAPPED_LOKI_DS_UID = 'wrapped-loki-ds-uid';\n\ntype TimeStampOfVolumeEval = number;\ntype VolumeCount = string;\ntype VolumeValue = [TimeStampOfVolumeEval, VolumeCount];\ntype VolumeResult = {\n  metric: {\n    service_name?: string;\n    __aggregated_metric__?: string;\n    [index: string]: string | undefined;\n  };\n  value: VolumeValue;\n};\n\ntype IndexVolumeResponse = {\n  data: {\n    result: VolumeResult[];\n  };\n};\n\ntype LabelsResponse = {\n  status: string;\n  data: string[];\n};\n\ntype SampleTimeStamp = number;\ntype SampleCount = number;\ntype PatternSample = [SampleTimeStamp, SampleCount];\n\nexport interface LokiPattern {\n  pattern: string;\n  samples: PatternSample[];\n}\n\ntype PatternsResponse = {\n  data: LokiPattern[];\n};\n\nexport const DETECTED_FIELDS_NAME_FIELD = 'name';\n\nexport const DETECTED_FIELDS_CARDINALITY_NAME = 'cardinality';\n\nexport const DETECTED_FIELDS_PARSER_NAME = 'parser';\n\nexport const DETECTED_FIELDS_TYPE_NAME = 'type';\n\nexport class WrappedLokiDatasource extends RuntimeDataSource<DataQuery> {\n  constructor(pluginId: string, uid: string) {\n    super(pluginId, uid);\n  }\n\n  query(request: SceneDataQueryRequest): Promise<DataQueryResponse> | Observable<DataQueryResponse> {\n    return new Observable<DataQueryResponse>((subscriber) => {\n      if (!request.scopedVars?.__sceneObject) {\n        throw new Error('Scene object not found in request');\n      }\n\n      getDataSourceSrv()\n        .get(getDataSource(request.scopedVars.__sceneObject.valueOf()))\n        .then(async (ds) => {\n          if (!(ds instanceof DataSourceWithBackend) || !('interpolateString' in ds) || !('getTimeRangeParams' in ds)) {\n            throw new Error('Invalid datasource!');\n          }\n\n          // override the target datasource to Loki\n          request.targets = request.targets?.map((target) => {\n            target.datasource = ds;\n            return target;\n          });\n\n          const targetsSet = new Set();\n          request.targets.forEach((target) => {\n            targetsSet.add(target.resource ?? '');\n          });\n\n          if (targetsSet.size !== 1) {\n            throw new Error('A request cannot contain queries to multiple endpoints');\n          }\n\n          const requestType = request.targets[0].resource;\n\n          switch (requestType) {\n            case 'volume': {\n              await this.getVolume(request, ds, subscriber);\n              break;\n            }\n            case 'patterns': {\n              await this.getPatterns(request, ds, subscriber);\n              break;\n            }\n            case 'detected_labels': {\n              await this.getDetectedLabels(request, ds, subscriber);\n              break;\n            }\n            case 'detected_fields': {\n              await this.getDetectedFields(request, ds, subscriber);\n              break;\n            }\n            case 'labels': {\n              await this.getLabels(request, ds, subscriber);\n              break;\n            }\n            default: {\n              this.getData(request, ds, subscriber);\n              break;\n            }\n          }\n        });\n    });\n  }\n\n  private getData(request: SceneDataQueryRequest, ds: LokiDatasource, subscriber: Subscriber<DataQueryResponse>) {\n    const shardingEnabled = config.featureToggles.exploreLogsShardSplitting;\n\n    const updatedRequest = {\n      ...request,\n      targets: ds.interpolateVariablesInQueries(request.targets, request.scopedVars).map((target) => ({\n        ...target,\n        resource: undefined,\n        expr: sanitizeStreamSelector(target.expr),\n      })),\n    };\n\n    // Query the datasource and return either observable or promise\n    const dsResponse =\n      requestSupportsSharding(updatedRequest) === false || !shardingEnabled\n        ? ds.query(updatedRequest)\n        : runShardSplitQuery(ds, updatedRequest);\n    dsResponse.subscribe(subscriber);\n\n    return subscriber;\n  }\n\n  private async getPatterns(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: LokiDatasource,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    const targets = request.targets.filter((target) => {\n      return target.resource === 'patterns';\n    });\n\n    if (targets.length !== 1) {\n      throw new Error('Patterns query can only have a single target!');\n    }\n    const { interpolatedTarget, expression } = this.interpolate(ds, targets, request);\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    try {\n      const dsResponse = ds.getResource(\n        'patterns',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n          step: request.interval,\n        },\n        {\n          requestId: request.requestId ?? 'patterns',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n      const response: PatternsResponse = await dsResponse;\n      const lokiPatterns = response?.data;\n\n      let maxValue = -Infinity;\n      let minValue = 0;\n\n      const frames: DataFrame[] =\n        lokiPatterns?.map((pattern: LokiPattern) => {\n          const timeValues: number[] = [];\n          const countValues: number[] = [];\n          let sum = 0;\n          pattern.samples.forEach(([time, count]) => {\n            timeValues.push(time * 1000);\n            countValues.push(count);\n            if (count > maxValue) {\n              maxValue = count;\n            }\n            if (count < minValue) {\n              minValue = count;\n            }\n            if (count > maxValue) {\n              maxValue = count;\n            }\n            if (count < minValue) {\n              minValue = count;\n            }\n            sum += count;\n          });\n          return createDataFrame({\n            refId: interpolatedTarget.refId,\n            name: pattern.pattern,\n            fields: [\n              {\n                name: 'time',\n                type: FieldType.time,\n                values: timeValues,\n                config: {},\n              },\n              {\n                name: pattern.pattern,\n                type: FieldType.number,\n                values: countValues,\n                config: {},\n              },\n            ],\n            meta: {\n              preferredVisualisationType: 'graph',\n              custom: {\n                sum,\n              },\n            },\n          });\n        }) ?? [];\n\n      frames.sort((a, b) => (b.meta?.custom?.sum as number) - (a.meta?.custom?.sum as number));\n      subscriber.next({ data: frames, state: LoadingState.Done });\n    } catch (e) {\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    return subscriber;\n  }\n\n  private interpolate(\n    ds: LokiDatasource,\n    targets: Array<LokiQuery & SceneDataQueryResourceRequest>,\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>\n  ) {\n    const targetsInterpolated = ds.interpolateVariablesInQueries(targets, request.scopedVars);\n    if (!targetsInterpolated.length) {\n      throw new Error('Datasource failed to interpolate query!');\n    }\n    const interpolatedTarget = targetsInterpolated[0];\n    const expression = sanitizeStreamSelector(interpolatedTarget.expr);\n    return { interpolatedTarget, expression };\n  }\n\n  private async getDetectedLabels(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: LokiDatasource,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    const targets = request.targets.filter((target) => {\n      return target.resource === 'detected_labels';\n    });\n\n    if (targets.length !== 1) {\n      throw new Error('Detected labels query can only have a single target!');\n    }\n\n    let { interpolatedTarget, expression } = this.interpolate(ds, targets, request);\n\n    // Detected_labels is a bit different then other queries that interpolate the labels variable, it can be empty, but if it is empty it must be completely empty or we'll get the \"queries require at least one regexp or equality\" error from Loki\n    if (expression === `{}`) {\n      expression = '';\n    }\n\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    try {\n      const response = await ds.getResource<DetectedLabelsResponse>(\n        'detected_labels',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n        },\n        {\n          requestId: request.requestId ?? 'detected_labels',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n\n      const labels = response.detectedLabels\n        ?.filter((label) => !LABELS_TO_REMOVE.includes(label.label))\n        ?.sort((a, b) => sortLabelsByCardinality(a, b));\n\n      const detectedLabelFields: Array<Partial<Field>> = labels?.map((label) => {\n        return {\n          name: label.label,\n          values: [label.cardinality],\n        };\n      });\n\n      const dataFrame = createDataFrame({\n        refId: interpolatedTarget.refId,\n        fields: detectedLabelFields ?? [],\n      });\n\n      subscriber.next({ data: [dataFrame], state: LoadingState.Done });\n    } catch (e) {\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    return subscriber;\n  }\n\n  private async getDetectedFields(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: LokiDatasource,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    const targets = request.targets.filter((target) => {\n      return target.resource === 'detected_fields';\n    });\n\n    if (targets.length !== 1) {\n      throw new Error('Detected fields query can only have a single target!');\n    }\n\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    const { interpolatedTarget, expression } = this.interpolate(ds, targets, request);\n\n    try {\n      const response = await ds.getResource<DetectedFieldsResponse>(\n        'detected_fields',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n        },\n        {\n          requestId: request.requestId ?? 'detected_fields',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n\n      const nameField: Field = { name: DETECTED_FIELDS_NAME_FIELD, type: FieldType.string, values: [], config: {} };\n      const cardinalityField: Field = {\n        name: DETECTED_FIELDS_CARDINALITY_NAME,\n        type: FieldType.number,\n        values: [],\n        config: {},\n      };\n      const parserField: Field = { name: DETECTED_FIELDS_PARSER_NAME, type: FieldType.string, values: [], config: {} };\n      const typeField: Field = { name: DETECTED_FIELDS_TYPE_NAME, type: FieldType.string, values: [], config: {} };\n\n      response.fields?.forEach((field) => {\n        if (!FIELDS_TO_REMOVE.includes(field.label)) {\n          nameField.values.push(field.label);\n          cardinalityField.values.push(field.cardinality);\n          parserField.values.push(field.parsers?.length ? field.parsers.join(', ') : 'structuredMetadata');\n          typeField.values.push(field.type);\n        }\n      });\n\n      const dataFrame = createDataFrame({\n        refId: interpolatedTarget.refId,\n        fields: [nameField, cardinalityField, parserField, typeField],\n      });\n\n      subscriber.next({ data: [dataFrame], state: LoadingState.Done });\n    } catch (e) {\n      logger.error(e, { msg: 'Detected fields error' });\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    return subscriber;\n  }\n\n  //@todo doesn't work with multiple queries\n  private async getVolume(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest & VolumeRequestProps>,\n    ds: LokiDatasource,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    if (request.targets.length !== 1) {\n      throw new Error('Volume query can only have a single target!');\n    }\n\n    const target = request.targets[0];\n    const primaryLabel = target.primaryLabel;\n    if (!primaryLabel) {\n      throw new Error('Primary label is required for volume queries!');\n    }\n\n    const targetsInterpolated = ds.interpolateVariablesInQueries([target], request.scopedVars);\n    const expression = sanitizeStreamSelector(targetsInterpolated[0].expr.replace('.*.*', '.+'));\n\n    subscriber.next({ data: [], state: LoadingState.Loading });\n\n    try {\n      const volumeResponse: IndexVolumeResponse = await ds.getResource(\n        'index/volume',\n        {\n          query: expression,\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n          limit: 5000,\n        },\n        {\n          requestId: request.requestId ?? 'volume',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n      volumeResponse?.data.result.sort((lhs: VolumeResult, rhs: VolumeResult) => {\n        const lVolumeCount: VolumeCount = lhs.value[1];\n        const rVolumeCount: VolumeCount = rhs.value[1];\n        return Number(rVolumeCount) - Number(lVolumeCount);\n      });\n\n      // Scenes will only emit dataframes from the SceneQueryRunner, so for now we need to convert the API response to a dataframe\n      const df = createDataFrame({\n        fields: [\n          {\n            // @todo rename\n            name: SERVICE_NAME,\n            values: volumeResponse?.data.result?.map((r) => {\n              return r.metric[primaryLabel];\n            }),\n          },\n          { name: 'volume', values: volumeResponse?.data.result?.map((r) => Number(r.value[1])) },\n        ],\n      });\n\n      subscriber.next({ data: [df] });\n    } catch (e) {\n      logger.error(e);\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    subscriber.complete();\n\n    return subscriber;\n  }\n\n  private async getLabels(\n    request: DataQueryRequest<LokiQuery & SceneDataQueryResourceRequest>,\n    ds: LokiDatasource,\n    subscriber: Subscriber<DataQueryResponse>\n  ) {\n    if (request.targets.length !== 1) {\n      throw new Error('Volume query can only have a single target!');\n    }\n\n    try {\n      const labelsResponse: LabelsResponse = await ds.getResource(\n        'labels',\n        {\n          start: request.range.from.utc().toISOString(),\n          end: request.range.to.utc().toISOString(),\n        },\n        {\n          requestId: request.requestId ?? 'labels',\n          headers: {\n            'X-Query-Tags': `Source=${PLUGIN_ID}`,\n          },\n        }\n      );\n\n      // Scenes will only emit dataframes from the SceneQueryRunner, so for now we need to convert the API response to a dataframe\n      const df = createDataFrame({\n        fields: [{ name: 'labels', values: labelsResponse?.data }],\n      });\n      subscriber.next({ data: [df], state: LoadingState.Done });\n    } catch (e) {\n      subscriber.next({ data: [], state: LoadingState.Error });\n    }\n\n    subscriber.complete();\n\n    return subscriber;\n  }\n\n  testDatasource(): Promise<TestDataSourceResponse> {\n    return Promise.resolve({ status: 'success', message: 'Data source is working', title: 'Success' });\n  }\n}\n\nfunction init() {\n  sceneUtils.registerRuntimeDataSource({\n    dataSource: new WrappedLokiDatasource('wrapped-loki-ds', WRAPPED_LOKI_DS_UID),\n  });\n}\n\nexport default init;\n","import {\n  DETECTED_FIELD_AND_METADATA_VALUES_EXPR,\n  DETECTED_LEVELS_VALUES_EXPR,\n  JSON_FORMAT_EXPR,\n  LEVEL_VARIABLE_VALUE,\n  LOGS_FORMAT_EXPR,\n  MIXED_FORMAT_EXPR,\n  VAR_FIELDS_AND_METADATA,\n  VAR_FIELDS_EXPR,\n  VAR_LABELS_EXPR,\n  VAR_LEVELS,\n  VAR_LINE_FILTERS_EXPR,\n  VAR_METADATA_EXPR,\n  VAR_PATTERNS_EXPR,\n} from './variables';\nimport { SceneObject } from '@grafana/scenes';\nimport { getParserFromFieldsFilters } from './fields';\nimport { getFieldsVariable } from './variableGetters';\nimport { UIVariableFilterType } from '../Components/ServiceScene/Breakdowns/AddToFiltersButton';\nimport { logger } from './logger';\n\n/**\n * Crafts count over time query that excludes empty values for stream selector name\n * Will only add parsers if there are filters that require them.\n * @param sceneRef\n * @param streamSelectorName - the name of the stream selector we are aggregating by\n * @param excludeEmpty - if true, the query will exclude empty values for the given streamSelectorName\n */\nexport function getTimeSeriesExpr(sceneRef: SceneObject, streamSelectorName: string, excludeEmpty = true): string {\n  const fieldsVariable = getFieldsVariable(sceneRef);\n\n  let metadataExpressionToAdd = '';\n  if (excludeEmpty) {\n    // `LEVEL_VARIABLE_VALUE` is a special case where we don't want to add this to the stream selector\n    if (streamSelectorName === LEVEL_VARIABLE_VALUE) {\n      metadataExpressionToAdd = `| ${LEVEL_VARIABLE_VALUE} != \"\"`;\n    }\n  }\n\n  const fieldFilters = fieldsVariable.state.filters;\n  const parser = getParserFromFieldsFilters(fieldsVariable);\n\n  // if we have fields, we also need to add parsers\n  if (fieldFilters.length) {\n    if (parser === 'mixed') {\n      return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTERS_EXPR} ${MIXED_FORMAT_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n    }\n    if (parser === 'json') {\n      return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTERS_EXPR} ${JSON_FORMAT_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n    }\n    if (parser === 'logfmt') {\n      return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTERS_EXPR} ${LOGS_FORMAT_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n    }\n  }\n  return `sum(count_over_time({${VAR_LABELS_EXPR}} ${metadataExpressionToAdd} ${VAR_METADATA_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTERS_EXPR} ${VAR_FIELDS_EXPR} [$__auto])) by (${streamSelectorName})`;\n}\n\n/**\n * Get expressions for UI variables\n * @param variableType\n */\nexport function getFieldsTagValuesExpression(variableType: UIVariableFilterType) {\n  switch (variableType) {\n    case VAR_LEVELS:\n      return DETECTED_LEVELS_VALUES_EXPR;\n    case VAR_FIELDS_AND_METADATA:\n      return DETECTED_FIELD_AND_METADATA_VALUES_EXPR;\n    default:\n      const error = new Error(`Unknown variable type: ${variableType}`);\n      logger.error(error, {\n        variableType,\n        msg: `getFieldsTagValuesExpression: Unknown variable type: ${variableType}`,\n      });\n      throw error;\n  }\n}\n","import { sceneGraph, SceneObject } from '@grafana/scenes';\nimport { IndexScene } from '../Components/IndexScene/IndexScene';\nimport { FavoriteServiceHeaderActionScene } from '../Components/ServiceSelectionScene/FavoriteServiceHeaderActionScene';\nimport { ServiceSelectionScene } from '../Components/ServiceSelectionScene/ServiceSelectionScene';\nimport { getDataSourceVariable } from './variableGetters';\nimport { addToFavoriteLabelValueInStorage, removeFromFavoritesInStorage } from './store';\n\nexport function rerenderFavorites(sceneRef: SceneObject) {\n  // Find all FavoriteServiceHeaderActionScene and re-render\n  const indexScene = sceneGraph.getAncestor(sceneRef, IndexScene);\n  const favoriteServiceHeaderActionScene = sceneGraph.findAllObjects(\n    indexScene,\n    (o) => o instanceof FavoriteServiceHeaderActionScene\n  );\n  favoriteServiceHeaderActionScene.forEach((s) => s.forceRender());\n\n  // Find the ServiceFieldSelector's parent (currently service selection scene) and force re-render so dropdown has correct order\n  // @todo move ServiceFieldSelector to new scene\n  const serviceSelectionScene = sceneGraph.findDescendents(indexScene, ServiceSelectionScene);\n  serviceSelectionScene.forEach((s) => s.forceRender());\n}\n\nexport function addToFavorites(labelName: string, labelValue: string, sceneRef: SceneObject) {\n  const ds = getDataSourceVariable(sceneRef).getValue();\n  addToFavoriteLabelValueInStorage(ds, labelName, labelValue);\n  rerenderFavorites(sceneRef);\n}\n\nexport function removeFromFavorites(labelName: string, labelValue: string, sceneRef: SceneObject) {\n  const ds = getDataSourceVariable(sceneRef).getValue();\n  removeFromFavoritesInStorage(ds, labelName, labelValue);\n  rerenderFavorites(sceneRef);\n}\n","import { DataFrame, Field, ReducerID } from '@grafana/data';\nimport { DrawStyle, StackingMode } from '@grafana/ui';\nimport {\n  AdHocFiltersVariable,\n  PanelBuilders,\n  SceneCSSGridItem,\n  SceneDataTransformer,\n  SceneObject,\n} from '@grafana/scenes';\nimport { AddToFiltersButton, InterpolatedFilterType } from 'Components/ServiceScene/Breakdowns/AddToFiltersButton';\nimport {\n  DetectedFieldType,\n  LEVEL_VARIABLE_VALUE,\n  LogsQueryOptions,\n  ParserType,\n  VAR_FIELDS,\n  VAR_LABELS,\n  VAR_LEVELS,\n  VAR_METADATA,\n} from './variables';\nimport { setLevelColorOverrides } from './panel';\nimport { map, Observable } from 'rxjs';\nimport { SortBy, SortByScene } from '../Components/ServiceScene/Breakdowns/SortByScene';\nimport { getDetectedFieldsFrame } from '../Components/ServiceScene/ServiceScene';\nimport { getLogsStreamSelector, getValueFromFieldsFilter } from './variableGetters';\nimport { logger } from './logger';\nimport { PanelMenu } from '../Components/Panels/PanelMenu';\nimport { getLabelTypeFromFrame } from './lokiQuery';\nimport { LabelType } from './fieldsTypes';\n\nexport type DetectedLabel = {\n  label: string;\n  cardinality: number;\n};\n\nexport type DetectedLabelsResponse = {\n  detectedLabels: DetectedLabel[];\n};\n\nexport type DetectedField = {\n  label: string;\n  cardinality: number;\n  type: string;\n  parsers: string[] | null;\n};\n\nexport type DetectedFieldsResponse = {\n  fields: DetectedField[];\n};\n\nconst getReducerId = (sortBy: SortBy) => {\n  if (sortBy) {\n    const values: string[] = Object.values(ReducerID);\n    if (values.includes(sortBy)) {\n      return sortBy;\n    }\n  }\n  return undefined;\n};\n\n/**\n * Extracts the ExtractedFieldsType from the string returned on the detected_fields api parser field value\n * @param parserString\n */\nexport function extractParserFromString(parserString?: string): ParserType {\n  switch (parserString) {\n    case 'json':\n      return 'json';\n    case 'logfmt':\n      return 'logfmt';\n    case '': // Structured metadata is empty\n      return 'structuredMetadata';\n    case 'structuredMetadata': // Structured metadata is empty\n      return 'structuredMetadata';\n    default: // if we get a parser with multiple\n      return 'mixed';\n  }\n}\n\nexport function extractFieldTypeFromString(fieldString?: string): DetectedFieldType {\n  switch (fieldString) {\n    case 'int':\n    case 'float':\n    case 'duration':\n    case 'boolean':\n    case 'bytes':\n      return fieldString;\n    default:\n      return 'string';\n  }\n}\n\nexport function extractParserFromArray(parsers?: string[]): ParserType {\n  const parsersSet = new Set(parsers?.map((v) => v.toString()) ?? []);\n\n  // Structured metadata doesn't change the parser we use, so remove it\n  parsersSet.delete('structuredMetadata');\n\n  // get unique values\n  const parsersArray = Array.from(parsersSet);\n\n  if (parsersArray.length === 1) {\n    return extractParserFromString(parsersArray[0]);\n  }\n\n  // If the set size is zero, we only had structured metadata detected as a parser\n  if (parsersSet.size === 0) {\n    return 'structuredMetadata';\n  }\n\n  // Otherwise if there was more then one value, return mixed parser\n  return 'mixed';\n}\n\nexport function getParserForField(fieldName: string, sceneRef: SceneObject): ParserType | undefined {\n  const detectedFieldsFrame = getDetectedFieldsFrame(sceneRef);\n  const parserField: Field<string> | undefined = detectedFieldsFrame?.fields[2];\n  const namesField: Field<string> | undefined = detectedFieldsFrame?.fields[0];\n\n  const index = namesField?.values.indexOf(fieldName);\n  const parser =\n    index !== undefined && index !== -1 ? extractParserFromString(parserField?.values?.[index] ?? '') : undefined;\n\n  if (parser === undefined) {\n    logger.warn('missing parser, using mixed format for', { fieldName });\n    return 'mixed';\n  }\n  return parser;\n}\n\nexport function getFilterBreakdownValueScene(\n  getTitle: (df: DataFrame) => string,\n  style: DrawStyle,\n  variableName: typeof VAR_FIELDS | typeof VAR_LABELS | typeof VAR_METADATA,\n  sortByScene: SortByScene,\n  labelKey?: string\n) {\n  return (frame: DataFrame, frameIndex: number) => {\n    const reducerID = getReducerId(sortByScene.state.sortBy);\n    const panel = PanelBuilders.timeseries()\n      .setOption('legend', { showLegend: false })\n      .setCustomFieldConfig('fillOpacity', 9)\n      .setTitle(getTitle(frame))\n      // 11.5\n      // .setShowMenuAlways(true)\n      .setData(\n        new SceneDataTransformer({\n          transformations: [() => selectFrameTransformation(frame)],\n        })\n      )\n      .setOverrides(setLevelColorOverrides)\n      .setMenu(new PanelMenu({ investigationOptions: { frame, fieldName: getTitle(frame), labelName: labelKey } }))\n      .setHeaderActions([\n        new AddToFiltersButton({ frame, variableName, hideExclude: labelKey === LEVEL_VARIABLE_VALUE }),\n      ]);\n\n    if (style === DrawStyle.Bars) {\n      panel\n        .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n        .setCustomFieldConfig('fillOpacity', 100)\n        .setCustomFieldConfig('lineWidth', 0)\n        .setCustomFieldConfig('pointSize', 0)\n        .setOverrides(setLevelColorOverrides)\n        .setCustomFieldConfig('drawStyle', DrawStyle.Bars);\n    }\n\n    if (reducerID) {\n      panel.setOption('legend', {\n        showLegend: true,\n        calcs: [reducerID],\n      });\n      // These will only have a single series, no need to show the title twice\n      panel.setDisplayName(' ');\n    }\n\n    return new SceneCSSGridItem({\n      body: panel.build(),\n    });\n  };\n}\n\nexport function selectFrameTransformation(frame: DataFrame) {\n  return (source: Observable<DataFrame[]>) => {\n    return source.pipe(\n      map(() => {\n        return [frame];\n      })\n    );\n  };\n}\n\n/**\n * Returns the variable to use when adding filters in a panel.\n * @param frame\n * @param key\n * @param sceneRef\n */\nexport function getVariableForLabel(\n  frame: DataFrame | undefined,\n  key: string,\n  sceneRef: SceneObject\n): InterpolatedFilterType {\n  const labelType = frame ? getLabelTypeFromFrame(key, frame) : LabelType.Parsed;\n\n  if (labelType) {\n    // Use the labelType from the dataframe\n    return getFilterTypeFromLabelType(labelType, key);\n  }\n\n  // If the dataframe doesn't have labelTypes, check if the detected_fields response returned a parser.\n  const parserForThisField = getParserForField(key, sceneRef);\n  if (parserForThisField === 'structuredMetadata') {\n    return VAR_METADATA;\n  }\n\n  logger.warn('unable to determine label variable, falling back to parsed field', {\n    key,\n    parserForThisField: parserForThisField ?? '',\n  });\n\n  return VAR_FIELDS;\n}\n\nexport function getFilterTypeFromLabelType(type: LabelType, key: string): InterpolatedFilterType {\n  switch (type) {\n    case LabelType.Indexed: {\n      return VAR_LABELS;\n    }\n    case LabelType.Parsed: {\n      return VAR_FIELDS;\n    }\n    case LabelType.StructuredMetadata: {\n      // Structured metadata is either a special level variable, or a field variable\n      if (key === LEVEL_VARIABLE_VALUE) {\n        return VAR_LEVELS;\n      }\n      return VAR_METADATA;\n    }\n    default: {\n      const err = new Error(`Invalid label type for ${key}`);\n      logger.error(err, { type, msg: `Invalid label type for ${key}` });\n      throw err;\n    }\n  }\n}\n\nexport function getParserFromFieldsFilters(fields: AdHocFiltersVariable): ParserType {\n  const parsers = fields.state.filters.map((filter) => {\n    return getValueFromFieldsFilter(filter).parser;\n  });\n\n  return extractParserFromArray(parsers);\n}\n\nexport function isAvgField(fieldType: DetectedFieldType | undefined) {\n  return fieldType === 'duration' || fieldType === 'bytes' || fieldType === 'float';\n}\n\nexport function buildFieldsQuery(optionValue: string, options: LogsQueryOptions) {\n  if (options.fieldType && ['bytes', 'duration'].includes(options.fieldType)) {\n    return (\n      `avg_over_time(${getLogsStreamSelector(options)} | unwrap ` +\n      options.fieldType +\n      `(${optionValue}) | __error__=\"\" [$__auto]) by ()`\n    );\n  } else if (options.fieldType && options.fieldType === 'float') {\n    return (\n      `avg_over_time(${getLogsStreamSelector(options)} | unwrap ` + optionValue + ` | __error__=\"\" [$__auto]) by ()`\n    );\n  } else {\n    return `sum by (${optionValue}) (count_over_time(${getLogsStreamSelector(options)} [$__auto]))`;\n  }\n}\n\n/**\n * Returns the DetectedFieldType if available for a specific label\n * @param optionValue\n * @param detectedFieldsFrame\n */\nexport function getDetectedFieldType(optionValue: string, detectedFieldsFrame?: DataFrame) {\n  const namesField: Field<string> | undefined = detectedFieldsFrame?.fields[0];\n  const typesField: Field<string> | undefined = detectedFieldsFrame?.fields[3];\n  const index = namesField?.values.indexOf(optionValue);\n  return index !== undefined && index !== -1 ? extractFieldTypeFromString(typesField?.values?.[index]) : undefined;\n}\n\nexport function buildFieldsQueryString(\n  optionValue: string,\n  fieldsVariable: AdHocFiltersVariable,\n  detectedFieldsFrame?: DataFrame\n) {\n  const parserField: Field<string> | undefined = detectedFieldsFrame?.fields[2];\n  const namesField: Field<string> | undefined = detectedFieldsFrame?.fields[0];\n  const typesField: Field<string> | undefined = detectedFieldsFrame?.fields[3];\n  const index = namesField?.values.indexOf(optionValue);\n\n  const parserForThisField =\n    index !== undefined && index !== -1 ? extractParserFromString(parserField?.values?.[index]) : 'mixed';\n\n  const optionType =\n    index !== undefined && index !== -1 ? extractFieldTypeFromString(typesField?.values?.[index]) : undefined;\n\n  // Get the parser from the json payload of each filter\n  const parsers = fieldsVariable.state.filters.map((filter) => {\n    const index = namesField?.values.indexOf(filter.key);\n    const parserFromFilterValue = getValueFromFieldsFilter(filter);\n    if (parserFromFilterValue.parser) {\n      return parserFromFilterValue.parser;\n    }\n\n    // Then fallback to check the latest response\n    const parser =\n      index !== undefined && index !== -1\n        ? extractParserFromString(parserField?.values?.[index] ?? 'mixed')\n        : undefined;\n    return parser ?? 'mixed';\n  });\n\n  const parser = extractParserFromArray([...parsers, parserForThisField]);\n\n  let fieldExpressionToAdd = '';\n  let structuredMetadataToAdd = '';\n\n  if (parserForThisField === 'structuredMetadata') {\n    structuredMetadataToAdd = `| ${optionValue}!=\"\"`;\n    // Structured metadata\n  } else {\n    fieldExpressionToAdd = `| ${optionValue}!=\"\"`;\n  }\n\n  // is option structured metadata\n  const options: LogsQueryOptions = {\n    structuredMetadataToAdd,\n    fieldExpressionToAdd,\n    parser: parser,\n    fieldType: optionType,\n  };\n\n  return buildFieldsQuery(optionValue, options);\n}\n\n// copied from /grafana/grafana/public/app/plugins/datasource/loki/datasource.ts:1204\nexport function lokiRegularEscape<T>(value: T) {\n  if (typeof value === 'string') {\n    return value.replace(/'/g, \"\\\\\\\\'\");\n  }\n  return value;\n}\n","import { DetectedLabel } from './fields';\nimport {\n  ALL_VARIABLE_VALUE,\n  isAdHocFilterValueUserInput,\n  LEVEL_VARIABLE_VALUE,\n  stripAdHocFilterUserInputPrefix,\n} from './variables';\nimport { VariableValueOption } from '@grafana/scenes';\n\n// We want to show labels with cardinality 1 at the end of the list because they are less useful\n// And then we want to sort by cardinality - from lowest to highest\nexport function sortLabelsByCardinality(a: DetectedLabel, b: DetectedLabel) {\n  if (a.cardinality === 1) {\n    return 1;\n  }\n  if (b.cardinality === 1) {\n    return -1;\n  }\n  return a.cardinality - b.cardinality;\n}\n\n// Creates label options by taking all labels and if LEVEL_VARIABLE_VALUE is not in the list, it is added at the beginning.\n// It also adds 'All' option at the beginning\nexport function getLabelOptions(labels: string[]) {\n  const options = [...labels];\n  if (!labels.includes(LEVEL_VARIABLE_VALUE)) {\n    options.unshift(LEVEL_VARIABLE_VALUE);\n  }\n\n  const labelOptions: VariableValueOption[] = options.map((label) => ({\n    label,\n    value: String(label),\n  }));\n\n  return [{ label: 'All', value: ALL_VARIABLE_VALUE }, ...labelOptions];\n}\nexport const LEVEL_INDEX_NAME = 'level';\nexport const FIELDS_TO_REMOVE = ['level_extracted', LEVEL_VARIABLE_VALUE, LEVEL_INDEX_NAME];\n\nexport const LABELS_TO_REMOVE = ['__aggregated_metric__', '__stream_shard__'];\nexport function getFieldOptions(labels: string[]) {\n  const options = [...labels];\n  const labelOptions: VariableValueOption[] = options.map((label) => ({\n    label,\n    value: String(label),\n  }));\n\n  return [{ label: 'All', value: ALL_VARIABLE_VALUE }, ...labelOptions];\n}\n\n// Since \"meta\" is not saved in the URL state, it's ephemeral and can only be used for wip keys, but we can differentiate fields from metadata if the value is not encoded (and therefore different then the label)\nexport function isFilterMetadata(filter: { value: string; valueLabels?: string[] }) {\n  const value = isAdHocFilterValueUserInput(filter.value)\n    ? stripAdHocFilterUserInputPrefix(filter.value)\n    : filter.value;\n  return value === filter.valueLabels?.[0];\n}\n","import { AdHocFiltersVariable, SceneObject } from '@grafana/scenes';\nimport { LEVEL_VARIABLE_VALUE, VAR_FIELDS, VAR_LABELS, VAR_METADATA } from './variables';\nimport { getParserForField, getParserFromFieldsFilters } from './fields';\nimport { buildDataQuery } from './query';\nimport {\n  getFieldsAndMetadataVariable,\n  getFieldsVariable,\n  getLabelsVariable,\n  getLogsStreamSelector,\n  getMetadataVariable,\n  getValueFromFieldsFilter,\n} from './variableGetters';\nimport { addToFilters, FilterType } from '../Components/ServiceScene/Breakdowns/AddToFiltersButton';\nimport { isOperatorExclusive, isOperatorInclusive } from './operatorHelpers';\nimport { getLabelValueFromDataFrame } from './levels';\nimport { DataFrame } from '@grafana/data';\n\nexport const LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\n\nexport function buildLabelsQuery(sceneRef: SceneObject, optionValue: string, optionName: string) {\n  let labelExpressionToAdd = '';\n  let structuredMetadataToAdd = '';\n\n  const fields = getFieldsVariable(sceneRef);\n  const parser = getParserFromFieldsFilters(fields);\n\n  if (optionName && optionName !== LEVEL_VARIABLE_VALUE) {\n    labelExpressionToAdd = ` ,${optionName} != \"\"`;\n  } else if (optionName && optionName === LEVEL_VARIABLE_VALUE) {\n    structuredMetadataToAdd = ` | ${optionName} != \"\"`;\n  }\n\n  return buildDataQuery(\n    `sum(count_over_time(${getLogsStreamSelector({\n      labelExpressionToAdd,\n      structuredMetadataToAdd,\n      parser,\n    })} [$__auto])) by (${optionValue})`,\n    { legendFormat: `{{${optionValue}}}`, refId: 'LABEL_BREAKDOWN_VALUES' }\n  );\n}\n\nexport function getLabelsFromSeries(series: DataFrame[]): string[] {\n  const labels = series.map((dataFrame) => getLabelValueFromDataFrame(dataFrame));\n  return labels.flatMap((f) => (f ? [f] : []));\n}\n\nexport function toggleFieldFromFilter(key: string, value: string, sceneRef: SceneObject): FilterType {\n  const fieldsAndMetadataVariable = getFieldsAndMetadataVariable(sceneRef);\n  const empty = fieldsAndMetadataVariable.state.filters.length === 0;\n  const detectedFieldType = getParserForField(key, sceneRef);\n  const isMetadata = detectedFieldType === 'structuredMetadata';\n\n  const filterExists = fieldsAndMetadataVariable.state.filters.find((filter) => {\n    if (isMetadata) {\n      return isOperatorInclusive(filter.operator) && filter.value === value;\n    }\n    return isOperatorInclusive(filter.operator) && getValueFromFieldsFilter(filter).value === value;\n  });\n\n  if (empty || !filterExists) {\n    addToFilters(key, value, 'include', sceneRef, isMetadata ? VAR_METADATA : VAR_FIELDS);\n    return 'include';\n  } else {\n    addToFilters(key, value, 'toggle', sceneRef, isMetadata ? VAR_METADATA : VAR_FIELDS);\n    return 'toggle';\n  }\n}\n\nexport function toggleLabelFromFilter(key: string, value: string, sceneRef: SceneObject): FilterType {\n  const labelsVariable = getLabelsVariable(sceneRef);\n  const empty = labelsVariable.state.filters.length === 0;\n  const filterExists = labelsVariable.state.filters.find(\n    (filter) => filter.value === value && isOperatorInclusive(filter.operator)\n  );\n\n  if (empty || !filterExists) {\n    addToFilters(key, value, 'include', sceneRef, VAR_LABELS);\n    return 'include';\n  } else {\n    addToFilters(key, value, 'toggle', sceneRef, VAR_LABELS);\n    return 'toggle';\n  }\n}\n\nexport function getVisibleLabels(key: string, allLabels: string[], sceneRef: SceneObject) {\n  const labelsVariable = getLabelsVariable(sceneRef);\n  return getVisibleFilters(key, allLabels, labelsVariable);\n}\n\nexport function getVisibleFields(key: string, allLabels: string[], sceneRef: SceneObject) {\n  const fieldsVariable = getFieldsVariable(sceneRef);\n  return getVisibleFilters(key, allLabels, fieldsVariable);\n}\n\nexport function getVisibleMetadata(key: string, allLabels: string[], sceneRef: SceneObject) {\n  const metadataVariable = getMetadataVariable(sceneRef);\n  return getVisibleFilters(key, allLabels, metadataVariable);\n}\n\nexport function getVisibleFilters(key: string, allLabels: string[], variable: AdHocFiltersVariable) {\n  const inclusiveFilters = variable.state.filters\n    .filter((filter) => filter.key === key && isOperatorInclusive(filter.operator))\n    .map((filter) => (variable.state.name === VAR_FIELDS ? getValueFromFieldsFilter(filter).value : filter.value));\n  const exclusiveLabels = variable.state.filters\n    .filter((filter) => filter.key === key && isOperatorExclusive(filter.operator))\n    .map((filter) => (variable.state.name === VAR_FIELDS ? getValueFromFieldsFilter(filter).value : filter.value));\n\n  return allLabels.filter((label) => {\n    if (exclusiveLabels.includes(label)) {\n      return false;\n    }\n    return inclusiveFilters.length === 0 || inclusiveFilters.includes(label);\n  });\n}\n","import { DataFrame } from '@grafana/data';\nimport { SeriesVisibilityChangeMode } from '@grafana/ui';\nimport { LEVEL_VARIABLE_VALUE, VAR_LEVELS } from './variables';\nimport { SceneObject } from '@grafana/scenes';\nimport { addToFilters, FilterType } from 'Components/ServiceScene/Breakdowns/AddToFiltersButton';\nimport { getLevelsVariable } from './variableGetters';\n\nimport { isOperatorExclusive, isOperatorInclusive } from './operatorHelpers';\n\n/**\n * Given a set of `visibleLevels` in a panel, it returns a list of the new visible levels\n * after applying the visibility change in `mode`.\n */\nexport function toggleLevelVisibility(\n  level: string,\n  visibleLevels: string[] | undefined,\n  mode: SeriesVisibilityChangeMode,\n  allLevels: string[]\n) {\n  if (mode === SeriesVisibilityChangeMode.ToggleSelection) {\n    const levels = visibleLevels ?? [];\n    if (levels.length === 1 && levels.includes(level)) {\n      return [];\n    }\n    return [level];\n  }\n  /**\n   * When the behavior is `AppendToSelection` and the filter is empty, we initialize it\n   * with all levels because the user is excluding this level in their action.\n   */\n  let levels = !visibleLevels?.length ? allLevels : visibleLevels;\n  if (levels.includes(level)) {\n    return levels.filter((existingLevel) => existingLevel !== level);\n  }\n\n  return [...levels, level];\n}\n\nexport function getLevelLabelsFromSeries(series: DataFrame[]) {\n  return series.map((dataFrame) => getLabelValueFromDataFrame(dataFrame) ?? 'logs');\n}\n\nexport function getLabelValueFromDataFrame(frame: DataFrame) {\n  const labels = frame.fields[1]?.labels;\n\n  if (!labels) {\n    return null;\n  }\n\n  const keys = Object.keys(labels);\n  if (keys.length === 0) {\n    return null;\n  }\n\n  return labels[keys[0]];\n}\n\n/*\n * From the current state of the levels filter, return the level names that\n * the user wants to see.\n */\nexport function getVisibleLevels(allLevels: string[], sceneRef: SceneObject) {\n  const levelsFilter = getLevelsVariable(sceneRef);\n  const wantedLevels = levelsFilter.state.filters\n    .filter((filter) => isOperatorInclusive(filter.operator))\n    .map((filter) => filter.value.split('|').map(normalizeLevelName))\n    .join('|');\n  const unwantedLevels = levelsFilter.state.filters\n    .filter((filter) => isOperatorExclusive(filter.operator))\n    .map((filter) => filter.value.split('|').map(normalizeLevelName))\n    .join('|');\n  return allLevels.filter((level) => {\n    if (unwantedLevels.includes(level)) {\n      return false;\n    }\n    return wantedLevels.length === 0 || wantedLevels.includes(level);\n  });\n}\n\nfunction normalizeLevelName(level: string) {\n  if (level === '\"\"') {\n    return 'logs';\n  }\n  return level;\n}\n\n/**\n * Toggle a level from the filter state.\n * If the filter is empty, it's added.\n * If the filter exists but it's different, it's replaced.\n * If the filter exists, it's removed.\n */\nexport function toggleLevelFromFilter(level: string, sceneRef: SceneObject): FilterType {\n  const levelFilter = getLevelsVariable(sceneRef);\n  const empty = levelFilter.state.filters.length === 0;\n  const filterExists = levelFilter.state.filters.find(\n    (filter) => filter.value === level && isOperatorInclusive(filter.operator)\n  );\n\n  if (level === 'logs') {\n    level = '\"\"';\n  }\n\n  if (empty || !filterExists) {\n    addToFilters(LEVEL_VARIABLE_VALUE, level, 'include', sceneRef, VAR_LEVELS);\n    return 'include';\n  } else {\n    addToFilters(LEVEL_VARIABLE_VALUE, level, 'toggle', sceneRef, VAR_LEVELS);\n    return 'toggle';\n  }\n}\n","import {\n  arrayToDataFrame,\n  DataFrame,\n  DataFrameType,\n  DataTopic,\n  Field,\n  FieldCache,\n  FieldType,\n  FieldWithIndex,\n  Labels,\n} from '@grafana/data';\n\n// these are like Labels, but their values can be\n// arbitrary structures, not just strings\nexport type LogFrameLabels = Record<string, unknown>;\n\n// the attributes-access is a little awkward, but it's necessary\n// because there are multiple,very different dataFrame-representations.\nexport type LogsFrame = {\n  timeField: FieldWithIndex;\n  bodyField: FieldWithIndex;\n  timeNanosecondField: FieldWithIndex | null;\n  severityField: FieldWithIndex | null;\n  idField: FieldWithIndex | null;\n  getLogFrameLabels: () => LogFrameLabels[] | null; // may be slow, so we only do it when asked for it explicitly\n  getLogFrameLabelsAsLabels: () => Labels[] | null; // temporarily exists to make the labels=>attributes migration simpler\n  getLabelFieldName: () => string | null;\n  extraFields: FieldWithIndex[];\n  raw: DataFrame;\n};\n\nfunction getField(cache: FieldCache, name: string, fieldType: FieldType): FieldWithIndex | undefined {\n  const field = cache.getFieldByName(name);\n  if (field === undefined) {\n    return undefined;\n  }\n\n  return field.type === fieldType ? field : undefined;\n}\n\nexport const DATAPLANE_TIMESTAMP_NAME = 'timestamp';\nexport const DATAPLANE_BODY_NAME = 'body';\nexport const DATAPLANE_SEVERITY_NAME = 'severity';\nexport const DATAPLANE_ID_NAME = 'id';\nexport const DATAPLANE_LABELS_NAME = 'labels';\n\nexport function logFrameLabelsToLabels(logFrameLabels: LogFrameLabels): Labels {\n  const result: Labels = {};\n\n  Object.entries(logFrameLabels).forEach(([k, v]) => {\n    result[k] = typeof v === 'string' ? v : JSON.stringify(v);\n  });\n\n  return result;\n}\n\nexport function parseLogsFrame(frame: DataFrame): LogsFrame | null {\n  if (frame.meta?.type === DataFrameType.LogLines) {\n    return parseDataplaneLogsFrame(frame);\n  } else {\n    return parseLegacyLogsFrame(frame);\n  }\n}\n\nexport function parseDataplaneLogsFrame(frame: DataFrame): LogsFrame | null {\n  const cache = new FieldCache(frame);\n\n  const timestampField = getField(cache, DATAPLANE_TIMESTAMP_NAME, FieldType.time);\n  const bodyField = getField(cache, DATAPLANE_BODY_NAME, FieldType.string);\n\n  // these two are mandatory\n  if (timestampField === undefined || bodyField === undefined) {\n    return null;\n  }\n\n  const severityField = getField(cache, DATAPLANE_SEVERITY_NAME, FieldType.string) ?? null;\n  const idField = getField(cache, DATAPLANE_ID_NAME, FieldType.string) ?? null;\n  const labelsField = getField(cache, DATAPLANE_LABELS_NAME, FieldType.other) ?? null;\n\n  const labels = labelsField === null ? null : labelsField.values;\n\n  const extraFields = cache.fields.filter(\n    (_, i) =>\n      i !== timestampField.index &&\n      i !== bodyField.index &&\n      i !== severityField?.index &&\n      i !== idField?.index &&\n      i !== labelsField?.index\n  );\n\n  return {\n    raw: frame,\n    timeField: timestampField,\n    bodyField,\n    severityField,\n    idField,\n    getLogFrameLabels: () => labels,\n    timeNanosecondField: null,\n    getLogFrameLabelsAsLabels: () => (labels !== null ? labels.map(logFrameLabelsToLabels) : null),\n    getLabelFieldName: () => (labelsField !== null ? labelsField.name : null),\n    extraFields,\n  };\n}\n\n// Copied from https://github.com/grafana/grafana/blob/main/public/app/features/logs/legacyLogsFrame.ts\nexport function parseLegacyLogsFrame(frame: DataFrame): LogsFrame | null {\n  const cache = new FieldCache(frame);\n  const timeField = cache.getFirstFieldOfType(FieldType.time);\n  const bodyField = cache.getFirstFieldOfType(FieldType.string);\n\n  // these two are mandatory\n  if (timeField === undefined || bodyField === undefined) {\n    return null;\n  }\n\n  const timeNanosecondField = cache.getFieldByName('tsNs') ?? null;\n  const severityField = cache.getFieldByName('level') ?? null;\n  const idField = cache.getFieldByName('id') ?? null;\n\n  // extracting the labels is done very differently for old-loki-style and simple-style\n  // dataframes, so it's a little awkward to handle it,\n  // we both need to on-demand extract the labels, and also get teh labelsField,\n  // but only if the labelsField is used.\n  const [labelsField, getL] = makeLabelsGetter(cache, bodyField, frame);\n\n  const extraFields = cache.fields.filter(\n    (_, i) =>\n      i !== timeField.index &&\n      i !== bodyField.index &&\n      i !== timeNanosecondField?.index &&\n      i !== severityField?.index &&\n      i !== idField?.index &&\n      i !== labelsField?.index\n  );\n\n  return {\n    timeField,\n    bodyField,\n    timeNanosecondField,\n    severityField,\n    idField,\n    getLogFrameLabels: getL,\n    getLogFrameLabelsAsLabels: getL,\n    getLabelFieldName: () => labelsField?.name ?? null,\n    extraFields,\n    raw: frame,\n  };\n}\n\n// if the frame has \"labels\" field with type \"other\", adjust the behavior.\n// we also have to return the labels-field (if we used it),\n// to be able to remove it from the unused-fields, later.\nfunction makeLabelsGetter(\n  cache: FieldCache,\n  lineField: Field,\n  frame: DataFrame\n): [FieldWithIndex | null, () => Labels[] | null] {\n  // If we have labels field with type \"other\", use that\n  const labelsField = cache.getFieldByName('labels');\n  if (labelsField !== undefined && labelsField.type === FieldType.other) {\n    const values = labelsField.values.map(logFrameLabelsToLabels);\n    return [labelsField, () => values];\n  } else {\n    // Otherwise we use the labels on the line-field, and make an array with it\n    return [null, () => makeLabelsArray(lineField, frame.length)];\n  }\n}\n\n// take the labels from the line-field, and \"stretch\" it into an array\n// with the length of the frame (so there are the same labels for every row)\nfunction makeLabelsArray(lineField: Field, length: number): Labels[] | null {\n  const lineLabels = lineField.labels;\n  if (lineLabels !== undefined) {\n    const result = new Array(length);\n    result.fill(lineLabels);\n    return result;\n  } else {\n    return null;\n  }\n}\n\nexport function getTimeName(logsFrame?: LogsFrame) {\n  return logsFrame?.timeField.name ?? DATAPLANE_TIMESTAMP_NAME;\n}\n\nexport function getBodyName(logsFrame?: LogsFrame | null): string {\n  return logsFrame?.bodyField.name ?? DATAPLANE_BODY_NAME;\n}\n\nexport function getIdName(logsFrame?: LogsFrame): string {\n  return logsFrame?.idField?.name ?? DATAPLANE_ID_NAME;\n}\n\nexport function getSeriesVisibleRange(series: DataFrame[]) {\n  let start = 0;\n  let end = 0;\n\n  const timeField = series[0]?.fields.find((field) => field.type === FieldType.time);\n  if (timeField) {\n    const values = [...timeField.values].sort();\n    const oldestFirst = values[0] < values[values.length - 1];\n    start = oldestFirst ? values[0] : values[values.length - 1];\n    end = oldestFirst ? values[values.length - 1] : values[0];\n  }\n  return { start, end };\n}\n\nexport const VISIBLE_RANGE_NAME = 'Visible range';\nexport function getVisibleRangeFrame(start: number, end: number) {\n  const frame = arrayToDataFrame([\n    {\n      time: start,\n      timeEnd: end,\n      isRegion: true,\n      text: 'Range from oldest to newest logs in display',\n      color: 'rgba(58, 113, 255, 0.3)',\n    },\n  ]);\n  frame.name = VISIBLE_RANGE_NAME;\n  frame.meta = {\n    dataTopic: DataTopic.Annotations,\n  };\n\n  return frame;\n}\n\nexport function isEmptyLogsResult(series: DataFrame[]) {\n  return series.length === 0 || series[0].fields[0].values.length === 0;\n}\n","import { ServiceSceneCustomState } from '../Components/ServiceScene/ServiceScene';\n\nlet metadataService: MetadataService;\n\nexport function initializeMetadataService(): void {\n  if (!metadataService) {\n    metadataService = new MetadataService();\n  }\n}\n\n/**\n * Singleton class for sharing state across drilldown routes with common parent scene\n */\nexport class MetadataService {\n  private serviceSceneState: ServiceSceneCustomState | undefined = undefined;\n  public getServiceSceneState() {\n    return this.serviceSceneState;\n  }\n\n  public setPatternsCount(count: number) {\n    if (!this.serviceSceneState) {\n      this.serviceSceneState = {};\n    }\n\n    this.serviceSceneState.patternsCount = count;\n  }\n\n  public setLabelsCount(count: number) {\n    if (!this.serviceSceneState) {\n      this.serviceSceneState = {};\n    }\n\n    this.serviceSceneState.labelsCount = count;\n  }\n\n  public setFieldsCount(count: number) {\n    if (!this.serviceSceneState) {\n      this.serviceSceneState = {};\n    }\n\n    this.serviceSceneState.fieldsCount = count;\n  }\n\n  public setServiceSceneState(state: ServiceSceneCustomState) {\n    this.serviceSceneState = {\n      patternsCount: state.patternsCount,\n      labelsCount: state.labelsCount,\n      fieldsCount: state.fieldsCount,\n      loading: state.loading,\n      logsCount: state.logsCount,\n      totalLogsCount: state.totalLogsCount,\n    };\n  }\n}\n\nexport function getMetadataService(): MetadataService {\n  return metadataService;\n}\n","import { ServiceScene } from '../Components/ServiceScene/ServiceScene';\nimport { IndexScene } from '../Components/IndexScene/IndexScene';\nimport { ALL_VARIABLE_VALUE } from './variables';\nimport { getMetadataService } from './metadata';\nimport { locationService } from '@grafana/runtime';\nimport { buildServicesUrl, DRILLDOWN_URL_KEYS, PageSlugs, ROUTES, ValueSlugs } from './routing';\nimport { sceneGraph } from '@grafana/scenes';\nimport { UrlQueryMap, urlUtil } from '@grafana/data';\nimport { replaceSlash } from './extensions/links';\nimport { prefixRoute } from './plugin';\n\nlet previousRoute: string | undefined = undefined;\n\nfunction buildValueBreakdownUrl(label: string, newPath: ValueSlugs, labelValue: string, labelName = 'service') {\n  if (label === ALL_VARIABLE_VALUE && newPath === ValueSlugs.label) {\n    return prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.labels}`);\n  } else if (label === ALL_VARIABLE_VALUE && newPath === ValueSlugs.field) {\n    return prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.fields}`);\n  } else {\n    return prefixRoute(\n      `${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${newPath}/${replaceSlash(label)}`\n    );\n  }\n}\n\nexport function buildDrilldownPageUrl(path: PageSlugs | string, extraQueryParams?: UrlQueryMap): string {\n  return urlUtil.renderUrl(path, buildDrilldownPageRoute(extraQueryParams));\n}\n\nexport function buildDrilldownPageRoute(extraQueryParams?: UrlQueryMap): UrlQueryMap {\n  return {\n    ...Object.entries(urlUtil.getUrlSearchParams()).reduce<UrlQueryMap>((acc, [key, value]) => {\n      if (DRILLDOWN_URL_KEYS.includes(key)) {\n        acc[key] = value;\n      }\n\n      return acc;\n    }, {}),\n    ...extraQueryParams,\n  };\n}\n\nexport function getValueBreakdownLink(newPath: ValueSlugs, label: string, serviceScene: ServiceScene) {\n  const indexScene = sceneGraph.getAncestor(serviceScene, IndexScene);\n  const urlLabelName = indexScene.state.routeMatch?.params.labelName;\n  const urlLabelValue = indexScene.state.routeMatch?.params.labelValue;\n\n  if (urlLabelName && urlLabelValue) {\n    let urlPath = buildValueBreakdownUrl(label, newPath, urlLabelValue, urlLabelName);\n    const fullUrl = buildDrilldownPageUrl(urlPath);\n\n    // If we're going to navigate, we need to share the state between this instantiation of the service scene\n    if (serviceScene) {\n      const metadataService = getMetadataService();\n      metadataService.setServiceSceneState(serviceScene.state);\n    }\n\n    return fullUrl;\n  }\n\n  return '';\n}\n\n/**\n * Navigate to value breakdown url\n * @param newPath\n * @param label\n * @param serviceScene\n */\nexport function navigateToValueBreakdown(newPath: ValueSlugs, label: string, serviceScene: ServiceScene) {\n  const link = getValueBreakdownLink(newPath, label, serviceScene);\n  if (link) {\n    pushUrlHandler(link);\n  }\n}\n\n/**\n * The case for initial navigation from the service selection to the service index is a special case, as we don't yet have a serviceScene constructed to pull the selected service.\n * This function will route users to the initial (logs) page from the service selection view, which will populate the service scene state with the selected service string.\n * @param labelName\n * @param labelValue\n */\nexport function getDrillDownIndexLink(labelName: string, labelValue: string, labelFilters?: UrlQueryMap) {\n  const breakdownUrl = buildDrilldownPageUrl(ROUTES.logs(labelValue, labelName), labelFilters);\n  return breakdownUrl;\n}\n\nexport function getDrillDownTabLink(path: PageSlugs, serviceScene: ServiceScene, extraQueryParams?: UrlQueryMap) {\n  const indexScene = sceneGraph.getAncestor(serviceScene, IndexScene);\n  const urlLabelValue = indexScene.state.routeMatch?.params.labelValue;\n  const urlLabelName = indexScene.state.routeMatch?.params.labelName;\n\n  if (urlLabelValue) {\n    const fullUrl = prefixRoute(`${PageSlugs.explore}/${urlLabelName}/${replaceSlash(urlLabelValue)}/${path}`);\n    return buildDrilldownPageUrl(fullUrl, extraQueryParams);\n  }\n  return '';\n}\n\n/**\n * Navigates to the drilldown page specified by the path slug\n *\n * @param path\n * @param serviceScene\n * @param extraQueryParams\n */\nexport function navigateToDrilldownPage(path: PageSlugs, serviceScene: ServiceScene, extraQueryParams?: UrlQueryMap) {\n  const drilldownLink = getDrillDownTabLink(path, serviceScene, extraQueryParams);\n\n  if (drilldownLink) {\n    // If we're going to navigate, we need to share the state between this instantiation of the service scene\n    if (serviceScene) {\n      const metadataService = getMetadataService();\n      metadataService.setServiceSceneState(serviceScene.state);\n    }\n\n    pushUrlHandler(drilldownLink);\n    return;\n  }\n}\n\nexport function pushUrlHandler(newUrl: string) {\n  previousRoute = newUrl;\n  locationService.push(newUrl);\n}\n\nexport function addCurrentUrlToHistory() {\n  // Add the current url to browser history before the state is changed so the user can revert their change.\n  const location = locationService.getLocation();\n  locationService.push(location.pathname + location.search);\n}\n\n/**\n * Navigate to the services selection url\n */\nexport function navigateToIndex() {\n  const location = locationService.getLocation();\n  const serviceUrl = buildServicesUrl(ROUTES.explore());\n  const currentUrl = location.pathname + location.search;\n  const search = locationService.getSearch();\n\n  if (serviceUrl === currentUrl || currentUrl.includes(serviceUrl)) {\n    return;\n  }\n\n  if (!search.get('var-filters')) {\n    // If we don't have filters, we don't want to keep this url in browser history since this is fired AFTER the url props are made invalid, push the previous route and replace it\n    if (previousRoute) {\n      locationService.replace(previousRoute);\n    }\n    locationService.push(serviceUrl);\n  } else {\n    pushUrlHandler(serviceUrl);\n  }\n}\n","import { QueryRunnerState, sceneGraph, SceneQueryRunner } from '@grafana/scenes';\n\nexport class LogsSceneQueryRunner extends SceneQueryRunner {\n  constructor(initialState: QueryRunnerState) {\n    super(initialState);\n  }\n\n  public runQueries() {\n    const timeRange = sceneGraph.getTimeRange(this);\n\n    // We don't want to subscribe to time range changes, or we'll get duplicate queries\n    // this.subscribeToTimeRangeChanges(timeRange);\n\n    // @todo can we make runWithTimeRange protected? (https://github.com/grafana/scenes/pull/866)\n    // Hack to call private method\n    this['runWithTimeRange'](timeRange);\n  }\n}\n","import {\n  DataFrame,\n  FieldColorModeId,\n  FieldConfig,\n  FieldMatcherID,\n  FieldType,\n  getFieldDisplayName,\n} from '@grafana/data';\nimport {\n  FieldConfigBuilder,\n  FieldConfigBuilders,\n  FieldConfigOverridesBuilder,\n  PanelBuilders,\n  QueryRunnerState,\n  SceneDataProvider,\n  SceneDataTransformer,\n  SceneObject,\n  SceneQueryRunner,\n  VizPanel,\n} from '@grafana/scenes';\nimport { map, Observable } from 'rxjs';\nimport { HideSeriesConfig, LogsSortOrder } from '@grafana/schema';\nimport { WRAPPED_LOKI_DS_UID } from './datasource';\nimport { LogsSceneQueryRunner } from './LogsSceneQueryRunner';\nimport { DrawStyle, StackingMode } from '@grafana/ui';\nimport { getLevelLabelsFromSeries, getVisibleLevels } from './levels';\nimport { LokiQuery, LokiQueryDirection } from './lokiQuery';\nimport { LOGS_COUNT_QUERY_REFID, LOGS_PANEL_QUERY_REFID } from '../Components/ServiceScene/ServiceScene';\nimport { getLogsPanelSortOrderFromStore, getLogsPanelSortOrderFromURL } from 'Components/ServiceScene/LogOptionsScene';\nimport { getLabelsFromSeries, getVisibleFields, getVisibleLabels, getVisibleMetadata } from './labels';\nimport { getParserForField } from './fields';\n\nconst UNKNOWN_LEVEL_LOGS = 'logs';\nexport function setLevelColorOverrides(overrides: FieldConfigOverridesBuilder<FieldConfig>) {\n  overrides.matchFieldsWithName('info').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-green',\n  });\n  overrides.matchFieldsWithName('debug').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-blue',\n  });\n  overrides.matchFieldsWithName('error').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-red',\n  });\n  overrides.matchFieldsWithName('warn').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'semi-dark-orange',\n  });\n  overrides.matchFieldsWithName('logs').overrideColor({\n    mode: 'fixed',\n    fixedColor: 'darkgray',\n  });\n}\n\nexport function setLogsVolumeFieldConfigs(\n  builder: ReturnType<typeof PanelBuilders.timeseries> | ReturnType<typeof FieldConfigBuilders.timeseries>\n) {\n  return builder\n    .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n    .setCustomFieldConfig('fillOpacity', 100)\n    .setCustomFieldConfig('lineWidth', 0)\n    .setCustomFieldConfig('pointSize', 0)\n    .setCustomFieldConfig('axisSoftMin', 0)\n    .setCustomFieldConfig('drawStyle', DrawStyle.Bars)\n    .setOverrides(setLevelColorOverrides);\n}\n\nexport function setValueSummaryFieldConfigs(\n  builder: ReturnType<typeof PanelBuilders.timeseries> | ReturnType<typeof FieldConfigBuilders.timeseries>\n) {\n  return builder\n    .setCustomFieldConfig('stacking', { mode: StackingMode.Normal })\n    .setCustomFieldConfig('fillOpacity', 100)\n    .setCustomFieldConfig('lineWidth', 0)\n    .setCustomFieldConfig('pointSize', 0)\n    .setCustomFieldConfig('drawStyle', DrawStyle.Bars);\n}\n\ninterface TimeSeriesFieldConfig extends FieldConfig {\n  hideFrom: HideSeriesConfig;\n}\n\nexport function setLabelSeriesOverrides(labels: string[], overrideConfig: FieldConfigOverridesBuilder<FieldConfig>) {\n  overrideConfig\n    .match({\n      id: FieldMatcherID.byNames,\n      options: {\n        mode: 'exclude',\n        names: labels,\n        prefix: 'All except:',\n        readOnly: true,\n      },\n    })\n    .overrideCustomFieldConfig<TimeSeriesFieldConfig, 'hideFrom'>('hideFrom', {\n      legend: false,\n      tooltip: false,\n      viz: true,\n    });\n\n  // Setting __systemRef to hideSeriesFrom, allows the override to be changed by interacting with the viz\n  const overrides = overrideConfig.build();\n  // @ts-expect-error\n  overrides[overrides.length - 1].__systemRef = 'hideSeriesFrom';\n}\n\n/**\n * Sets labels series visibility in the panel\n */\nexport function syncLevelsVisibleSeries(panel: VizPanel, series: DataFrame[], sceneRef: SceneObject) {\n  const focusedLevels = getVisibleLevels(getLevelLabelsFromSeries(series), sceneRef);\n  const config = setLogsVolumeFieldConfigs(FieldConfigBuilders.timeseries()).setOverrides(\n    setLabelSeriesOverrides.bind(null, focusedLevels)\n  );\n  if (config instanceof FieldConfigBuilder) {\n    panel.onFieldConfigChange(config.build(), true);\n  }\n}\n\n/**\n * @todo unit test\n * Set levels series visibility in the panel\n */\nexport function syncLabelsValueSummaryVisibleSeries(\n  key: string,\n  panel: VizPanel,\n  series: DataFrame[],\n  sceneRef: SceneObject\n) {\n  const allLabels = getLabelsFromSeries(series);\n  const focusedLabels = getVisibleLabels(key, allLabels, sceneRef);\n\n  const config = setValueSummaryFieldConfigs(FieldConfigBuilders.timeseries());\n  if (focusedLabels.length) {\n    config.setOverrides(setLabelSeriesOverrides.bind(null, focusedLabels));\n  }\n  if (config instanceof FieldConfigBuilder) {\n    panel.onFieldConfigChange(config.build(), true);\n  }\n}\n\n/**\n * Set fields series visibility in the panel\n */\nexport function syncFieldsValueSummaryVisibleSeries(\n  key: string,\n  panel: VizPanel,\n  series: DataFrame[],\n  sceneRef: SceneObject\n) {\n  const allLabels = getLabelsFromSeries(series);\n  const detectedFieldType = getParserForField(key, sceneRef);\n\n  const focusedLabels =\n    detectedFieldType === 'structuredMetadata'\n      ? getVisibleMetadata(key, allLabels, sceneRef)\n      : getVisibleFields(key, allLabels, sceneRef);\n\n  const config = setValueSummaryFieldConfigs(FieldConfigBuilders.timeseries());\n\n  if (focusedLabels.length) {\n    config.setOverrides(setLabelSeriesOverrides.bind(null, focusedLabels));\n  }\n  if (config instanceof FieldConfigBuilder) {\n    panel.onFieldConfigChange(config.build(), true);\n  }\n}\n\nfunction setColorByDisplayNameTransformation() {\n  return (source: Observable<DataFrame[]>) => {\n    return source.pipe(\n      map((data: DataFrame[]) => {\n        return data.map((frame, frameIndex) => {\n          return {\n            ...frame,\n            fields: frame.fields.map((f, fieldIndex) => {\n              // Time fields do not have color config\n              if (f.type === FieldType.time) {\n                return f;\n              }\n              const displayName = getFieldDisplayName(f, frame, data);\n              return {\n                ...f,\n                config: {\n                  ...f.config,\n                  displayName,\n                  color: {\n                    mode: FieldColorModeId.PaletteClassicByName,\n                  },\n                },\n              };\n            }),\n          };\n        });\n      })\n    );\n  };\n}\n\nexport function sortLevelTransformation() {\n  return (source: Observable<DataFrame[]>) => {\n    return source.pipe(\n      map((data: DataFrame[]) => {\n        return data\n          .map((d) => {\n            if (d.fields.length < 2) {\n              return d;\n            }\n            if (!d.fields[1].config.displayNameFromDS) {\n              d.fields[1].config.displayNameFromDS = UNKNOWN_LEVEL_LOGS;\n            }\n            return d;\n          })\n          .sort((a, b) => {\n            if (a.fields.length < 2 || b.fields.length < 2) {\n              return 0;\n            }\n            const aName: string | undefined = a.fields[1].config.displayNameFromDS;\n            const aVal = aName?.includes('error') ? 4 : aName?.includes('warn') ? 3 : aName?.includes('info') ? 2 : 1;\n            const bName: string | undefined = b.fields[1].config.displayNameFromDS;\n            const bVal = bName?.includes('error') ? 4 : bName?.includes('warn') ? 3 : bName?.includes('info') ? 2 : 1;\n            return aVal - bVal;\n          });\n      })\n    );\n  };\n}\n\nexport function getResourceQueryRunner(queries: LokiQuery[]) {\n  return new LogsSceneQueryRunner({\n    datasource: { uid: WRAPPED_LOKI_DS_UID },\n    queries: queries,\n  });\n}\n\nexport function getQueryRunner(queries: LokiQuery[], queryRunnerOptions?: Partial<QueryRunnerState>) {\n  // if there's a legendFormat related to any `level` like label, we want to\n  // sort the output equally. That's purposefully not `LEVEL_VARIABLE_VALUE`,\n  // such that the `detected_level` graph looks the same as a graph for the\n  // `level` label.\n\n  const hasLevel = queries.find((query) => query.legendFormat?.toLowerCase().includes('level'));\n  const isLogPanelQuery = queries.find(\n    (query) => query.refId === LOGS_PANEL_QUERY_REFID || query.refId === LOGS_COUNT_QUERY_REFID\n  );\n\n  if (hasLevel) {\n    return new SceneDataTransformer({\n      $data: getSceneQueryRunner({\n        datasource: { uid: WRAPPED_LOKI_DS_UID },\n        queries: queries,\n        ...queryRunnerOptions,\n      }),\n      transformations: [sortLevelTransformation],\n    });\n  }\n\n  if (!isLogPanelQuery) {\n    return new SceneDataTransformer({\n      $data: getSceneQueryRunner({\n        datasource: { uid: WRAPPED_LOKI_DS_UID },\n        queries: queries,\n        ...queryRunnerOptions,\n      }),\n      transformations: [setColorByDisplayNameTransformation],\n    });\n  } else {\n    queries = queries.map((query) => ({\n      ...query,\n      get direction() {\n        const sortOrder = getLogsPanelSortOrderFromURL() || getLogsPanelSortOrderFromStore();\n        return sortOrder === LogsSortOrder.Descending ? LokiQueryDirection.Backward : LokiQueryDirection.Forward;\n      },\n    }));\n  }\n\n  return getSceneQueryRunner({\n    datasource: { uid: WRAPPED_LOKI_DS_UID },\n    queries: queries,\n    ...queryRunnerOptions,\n  });\n}\n\nexport function getSceneQueryRunner(queryRunnerOptions?: Partial<QueryRunnerState>) {\n  return new SceneQueryRunner({\n    datasource: { uid: WRAPPED_LOKI_DS_UID },\n    queries: [],\n    ...queryRunnerOptions,\n  });\n}\n\nexport function getQueryRunnerFromProvider(provider: SceneDataProvider): SceneQueryRunner {\n  if (provider instanceof SceneQueryRunner) {\n    return provider;\n  }\n\n  if (provider.state.$data instanceof SceneQueryRunner) {\n    return provider.state.$data;\n  }\n\n  throw new Error('SceneDataProvider is missing SceneQueryRunner');\n}\n","import pluginJson from '../plugin.json';\n\n// jest tests struggle with import order when importing from the plugin.json, moving methods that use the plugin_id to its own file makes it simpler to import when mocking\nexport const PLUGIN_ID = pluginJson.id;\nexport const PLUGIN_BASE_URL = `/a/${PLUGIN_ID}`;\n\n// Prefixes the route with the base URL of the plugin\nexport function prefixRoute(route: string): string {\n  return `${PLUGIN_BASE_URL}/${route}`;\n}\n","import { AdHocVariableFilter, SelectableValue } from '@grafana/data';\nimport {\n  addAdHocFilterUserInputPrefix,\n  AdHocFiltersWithLabelsAndMeta,\n  FieldValue,\n  VAR_DATASOURCE_EXPR,\n} from './variables';\nimport { LokiQuery } from './lokiQuery';\nimport { SceneDataQueryResourceRequest, SceneDataQueryResourceRequestOptions } from './datasourceTypes';\nimport { PLUGIN_ID } from './plugin';\nimport { AdHocFilterWithLabels, sceneUtils } from '@grafana/scenes';\nimport { LineFilterCaseSensitive, LineFilterOp } from './filterTypes';\nimport { sortLineFilters } from '../Components/IndexScene/LineFilterVariablesScene';\nimport { ExpressionBuilder } from './ExpressionBuilder';\n\n/**\n * Builds the resource query\n * @param expr string to be interpolated and executed in the resource request\n * @param resource\n * @param queryParamsOverrides\n * @param primaryLabel\n */\nexport const buildResourceQuery = (\n  expr: string,\n  resource: SceneDataQueryResourceRequestOptions,\n  queryParamsOverrides?: Partial<LokiQuery>,\n  primaryLabel?: string\n): LokiQuery & SceneDataQueryResourceRequest & { primaryLabel?: string } => {\n  return {\n    ...defaultQueryParams,\n    resource,\n    refId: resource,\n    ...queryParamsOverrides,\n    datasource: { uid: VAR_DATASOURCE_EXPR },\n    expr,\n    primaryLabel,\n  };\n};\n/**\n * Builds a loki data query\n * @param expr\n * @param queryParamsOverrides\n * @returns LokiQuery\n */\nexport const buildDataQuery = (expr: string, queryParamsOverrides?: Partial<LokiQuery>): LokiQuery => {\n  return {\n    ...defaultQueryParams,\n    ...queryParamsOverrides,\n    expr,\n  };\n};\n\nconst defaultQueryParams = {\n  refId: 'A',\n  queryType: 'range',\n  editorMode: 'code',\n  supportingQueryType: PLUGIN_ID,\n};\n\nexport const buildVolumeQuery = (\n  expr: string,\n  resource: 'volume' | 'patterns' | 'detected_labels' | 'detected_fields' | 'labels',\n  primaryLabel: string,\n  queryParamsOverrides?: Record<string, unknown>\n): LokiQuery & SceneDataQueryResourceRequest => {\n  return buildResourceQuery(expr, resource, { ...queryParamsOverrides }, primaryLabel);\n};\n\nexport function renderLogQLLabelFilters(filters: AdHocFilterWithLabels[], ignoreKeys?: string[]) {\n  const filtersTransformer = new ExpressionBuilder(filters);\n  return filtersTransformer.getLabelsExpr({ ignoreKeys });\n}\n\nexport function onAddCustomAdHocValue(item: SelectableValue<string>): {\n  value: string | undefined;\n  valueLabels: string[];\n} {\n  if (item.value) {\n    return {\n      value: addAdHocFilterUserInputPrefix(item.value),\n      valueLabels: [item.label ?? item.value],\n    };\n  }\n\n  return {\n    value: item.value,\n    valueLabels: [item.label ?? item.value ?? ''],\n  };\n}\n\nexport function onAddCustomFieldValue(\n  item: SelectableValue<string> & { isCustom?: boolean },\n  filter: AdHocFiltersWithLabelsAndMeta\n): { value: string | undefined; valueLabels: string[] } {\n  const field: FieldValue = {\n    value: item.value ?? '',\n    parser: filter?.meta?.parser ?? 'mixed',\n  };\n\n  // metadata is not encoded\n  if (field.parser === 'structuredMetadata') {\n    return {\n      value: addAdHocFilterUserInputPrefix(field.value),\n      valueLabels: [item.label ?? field.value],\n    };\n  }\n\n  return {\n    value: addAdHocFilterUserInputPrefix(JSON.stringify(field)),\n    valueLabels: [item.label ?? field.value],\n  };\n}\n\nexport function renderLevelsFilter(filters: AdHocVariableFilter[], ignoreKeys?: string[]) {\n  const filterTransformer = new ExpressionBuilder(filters);\n  return filterTransformer.getLevelsExpr({ ignoreKeys });\n}\n\nexport function renderLogQLMetadataFilters(filters: AdHocVariableFilter[], ignoreKeys?: string[]) {\n  const filterTransformer = new ExpressionBuilder(filters);\n  return filterTransformer.getMetadataExpr({ ignoreKeys });\n}\n\nexport function renderLogQLFieldFilters(filters: AdHocVariableFilter[], ignoreKeys?: string[]) {\n  const filterTransformer = new ExpressionBuilder(filters);\n  return filterTransformer.getFieldsExpr({ ignoreKeys });\n}\n\nexport function escapeDoubleQuotedLineFilter(filter: AdHocFilterWithLabels) {\n  // Is not regex\n  if (filter.operator === LineFilterOp.match || filter.operator === LineFilterOp.negativeMatch) {\n    if (filter.key === LineFilterCaseSensitive.caseInsensitive) {\n      return sceneUtils.escapeLabelValueInRegexSelector(filter.value);\n    } else {\n      return sceneUtils.escapeLabelValueInExactSelector(filter.value);\n    }\n  } else {\n    return sceneUtils.escapeLabelValueInExactSelector(filter.value);\n  }\n}\n\n/**\n * Builds line filter as a double-quoted LogQL string\n * Expects pre-escaped values\n */\nfunction buildLogQlLineFilter(filter: AdHocFilterWithLabels, value: string) {\n  // Change operator if needed and insert caseInsensitive flag\n  if (filter.key === LineFilterCaseSensitive.caseInsensitive) {\n    if (filter.operator === LineFilterOp.negativeRegex || filter.operator === LineFilterOp.negativeMatch) {\n      return `${LineFilterOp.negativeRegex} \"(?i)${value}\"`;\n    }\n    return `${LineFilterOp.regex} \"(?i)${value}\"`;\n  }\n\n  return `${filter.operator} \"${value}\"`;\n}\n\n/**\n * Converts line filter ad-hoc filters to LogQL\n *\n * the filter key is LineFilterCaseSensitive\n * the filter operator is LineFilterOp\n * the value is the user input\n */\nexport function renderLogQLLineFilter(filters: AdHocFilterWithLabels[]) {\n  sortLineFilters(filters);\n  return filters\n    .map((filter) => {\n      if (filter.value === '') {\n        return '';\n      }\n\n      const value = escapeDoubleQuotedLineFilter(filter);\n      return buildLogQlLineFilter(filter, value);\n    })\n    .join(' ');\n}\nexport function wrapWildcardSearch(input: string) {\n  if (input === '.+') {\n    return input;\n  } else if (input.substring(0, 6) !== '(?i).*') {\n    return `(?i).*${input}.*`;\n  }\n\n  return input;\n}\n\nexport function unwrapWildcardSearch(input: string) {\n  if (input.substring(0, 6) === '(?i).*' && input.slice(-2) === '.*') {\n    return input.slice(6).slice(0, -2);\n  }\n\n  return input;\n}\n\nexport function sanitizeStreamSelector(expression: string) {\n  return expression.replace(/\\s*,\\s*}/, '}');\n}\n\n// default line limit; each data source can define it's own line limit too\nexport const LINE_LIMIT = 1000;\n","import { UrlQueryMap, urlUtil } from '@grafana/data';\nimport {\n  SERVICE_NAME,\n  SERVICE_UI_LABEL,\n  VAR_DATASOURCE,\n  VAR_FIELD_GROUP_BY,\n  VAR_FIELDS,\n  VAR_LABEL_GROUP_BY,\n  VAR_LABELS,\n  VAR_LEVELS,\n  VAR_LINE_FILTER,\n  VAR_LINE_FILTERS,\n  VAR_METADATA,\n  VAR_PATTERNS,\n} from './variables';\nimport { locationService } from '@grafana/runtime';\nimport { RouteMatch, RouteProps } from '../Components/Pages';\nimport { replaceSlash } from './extensions/links';\nimport { SceneObject } from '@grafana/scenes';\nimport { getLabelsVariable } from './variableGetters';\nimport { logger } from './logger';\nimport { PLUGIN_BASE_URL, prefixRoute } from './plugin';\n\nexport enum PageSlugs {\n  explore = 'explore',\n  logs = 'logs',\n  labels = 'labels',\n  patterns = 'patterns',\n  fields = 'fields',\n}\nexport enum ValueSlugs {\n  field = 'field',\n  label = 'label',\n}\n\nexport type ParentDrilldownSlugs =\n  | PageSlugs.explore\n  | PageSlugs.fields\n  | PageSlugs.logs\n  | PageSlugs.labels\n  | PageSlugs.patterns;\nexport type ChildDrilldownSlugs = ValueSlugs.field | ValueSlugs.label;\n\nexport const ROUTES = {\n  explore: () => prefixRoute(PageSlugs.explore),\n  logs: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.logs}`),\n  fields: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.fields}`),\n  patterns: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.patterns}`),\n  labels: (labelValue: string, labelName = 'service') =>\n    prefixRoute(`${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${PageSlugs.labels}`),\n};\n\nexport const SUB_ROUTES = {\n  label: (labelValue: string, labelName = 'service', breakdownLabelName: string) =>\n    prefixRoute(\n      `${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${ValueSlugs.label}/${breakdownLabelName}`\n    ),\n  field: (labelValue: string, labelName = 'service', breakdownLabelName: string) =>\n    prefixRoute(\n      `${PageSlugs.explore}/${labelName}/${replaceSlash(labelValue)}/${ValueSlugs.field}/${breakdownLabelName}`\n    ),\n};\n\nexport const ROUTE_DEFINITIONS: Record<keyof typeof PageSlugs, string> = {\n  explore: prefixRoute(PageSlugs.explore),\n  logs: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.logs}`),\n  fields: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.fields}`),\n  patterns: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.patterns}`),\n  labels: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${PageSlugs.labels}`),\n};\n\nexport const CHILD_ROUTE_DEFINITIONS: Record<keyof typeof ValueSlugs, string> = {\n  field: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${ValueSlugs.field}/:breakdownLabel`),\n  label: prefixRoute(`${PageSlugs.explore}/:labelName/:labelValue/${ValueSlugs.label}/:breakdownLabel`),\n};\n\nexport const EXPLORATIONS_ROUTE = `${PLUGIN_BASE_URL}/${PageSlugs.explore}`;\n\n// For redirect back to service, we just want to keep datasource, and timerange\nexport const SERVICE_URL_KEYS = ['from', 'to', `var-${VAR_DATASOURCE}`, `var-${VAR_LABELS}`];\n//@todo why patterns and var-patterns?\nexport const DRILLDOWN_URL_KEYS = [\n  'from',\n  'to',\n  'mode',\n  'urlColumns',\n  'visualizationType',\n  'selectedLine',\n  'displayedFields',\n  'panelState',\n  VAR_PATTERNS,\n  `var-${VAR_PATTERNS}`,\n  `var-${VAR_DATASOURCE}`,\n  `var-${VAR_LABELS}`,\n  `var-${VAR_FIELDS}`,\n  `var-${VAR_LEVELS}`,\n  `var-${VAR_FIELD_GROUP_BY}`,\n  `var-${VAR_LABEL_GROUP_BY}`,\n  `var-${VAR_DATASOURCE}`,\n  `var-${VAR_LINE_FILTER}`,\n  `var-${VAR_METADATA}`,\n  `var-${VAR_LINE_FILTERS}`,\n];\n\nexport function getDrilldownSlug() {\n  const location = locationService.getLocation();\n  const slug = location.pathname.slice(location.pathname.lastIndexOf('/') + 1, location.pathname.length);\n  return slug as PageSlugs;\n}\n\n/**\n * The \"primary\" label, is the replacement for the service_name paradigm\n * It must be an indexed label with an include filter\n * Note: Will return the label as it exists in the url, so \"service_name\" will be returned as \"service\", we'll need to adjust for this case if we want to support URLs from before this change\n */\nexport function getPrimaryLabelFromUrl(): RouteProps {\n  const location = locationService.getLocation();\n  const startOfUrl = '/a/grafana-lokiexplore-app/explore';\n  const endOfUrl = location.pathname.slice(location.pathname.indexOf(startOfUrl) + startOfUrl.length + 1);\n  const routeParams = endOfUrl.split('/');\n\n  let labelName = routeParams[0];\n  const labelValue = routeParams[1];\n  const breakdownLabel = routeParams[3];\n  // Keep urls the same\n  if (labelName === SERVICE_NAME) {\n    labelName = SERVICE_UI_LABEL;\n  }\n  return { labelName, labelValue, breakdownLabel };\n}\n\nexport function getDrilldownValueSlug() {\n  const location = locationService.getLocation();\n  const locationArray = location.pathname.split('/');\n  const slug = locationArray[locationArray.length - 2];\n  return slug as ValueSlugs;\n}\n\nexport function buildServicesUrl(path: string, extraQueryParams?: UrlQueryMap): string {\n  return urlUtil.renderUrl(path, buildServicesRoute(extraQueryParams));\n}\nexport function extractValuesFromRoute(routeMatch: RouteMatch): RouteProps {\n  return {\n    labelName: routeMatch.params.labelName,\n    labelValue: routeMatch.params.labelValue,\n    breakdownLabel: routeMatch.params.breakdownLabel,\n  };\n}\n\nexport function buildServicesRoute(extraQueryParams?: UrlQueryMap): UrlQueryMap {\n  return {\n    ...Object.entries(urlUtil.getUrlSearchParams()).reduce<UrlQueryMap>((acc, [key, value]) => {\n      if (SERVICE_URL_KEYS.includes(key)) {\n        acc[key] = value;\n      }\n\n      return acc;\n    }, {}),\n    ...extraQueryParams,\n  };\n}\n\n/**\n * Compare slugs against variable filters and log discrepancies\n * These don't cause errors or render empty UIs, but shouldn't be possible when routing within the app\n * If we see these logged in production it indicates we're navigating users incorrectly\n * @param sceneRef\n */\nexport function checkPrimaryLabel(sceneRef: SceneObject) {\n  const labelsVariable = getLabelsVariable(sceneRef);\n  let { labelName, labelValue } = getPrimaryLabelFromUrl();\n  if (labelName === SERVICE_UI_LABEL) {\n    labelName = SERVICE_NAME;\n  }\n  const primaryLabel = labelsVariable.state.filters.find((filter) => filter.key === labelName);\n  if (!primaryLabel) {\n    const location = locationService.getLocation();\n\n    logger.info('invalid primary label name in url', {\n      labelName,\n      url: `${location.pathname}${location.search}`,\n    });\n  }\n\n  const primaryLabelValue = labelsVariable.state.filters.find((filter) => replaceSlash(filter.value) === labelValue);\n  if (!primaryLabelValue) {\n    const location = locationService.getLocation();\n\n    logger.info('invalid primary label value in url', {\n      labelValue,\n      url: `${location.pathname}${location.search}`,\n    });\n  }\n}\n","import { urlUtil } from '@grafana/data';\nimport { config, getDataSourceSrv } from '@grafana/runtime';\nimport { sceneGraph, SceneObject, SceneObjectUrlValues, SceneQueryRunner, SceneTimePicker } from '@grafana/scenes';\nimport {\n  LOG_STREAM_SELECTOR_EXPR,\n  PRETTY_LOG_STREAM_SELECTOR_EXPR,\n  VAR_DATASOURCE_EXPR,\n  VAR_LABELS_EXPR,\n} from './variables';\nimport { EXPLORATIONS_ROUTE } from './routing';\nimport { IndexScene } from 'Components/IndexScene/IndexScene';\nimport { logger } from './logger';\nimport { LokiDatasource } from './lokiQuery';\n\nexport function getExplorationFor(model: SceneObject): IndexScene {\n  return sceneGraph.getAncestor(model, IndexScene);\n}\n\nexport function getUrlForValues(values: SceneObjectUrlValues) {\n  return urlUtil.renderUrl(EXPLORATIONS_ROUTE, values);\n}\n\nexport function getDataSource(sceneObject: SceneObject) {\n  return sceneGraph.interpolate(sceneObject, VAR_DATASOURCE_EXPR);\n}\n\nexport function getQueryExpr(exploration: SceneObject) {\n  return sceneGraph.interpolate(exploration, LOG_STREAM_SELECTOR_EXPR).replace(/\\s+/g, ' ');\n}\n\nexport function getPrettyQueryExpr(exploration: SceneObject) {\n  return sceneGraph.interpolate(exploration, PRETTY_LOG_STREAM_SELECTOR_EXPR).replace(/\\s+/g, ' ');\n}\n\nexport function getPatternExpr(exploration: SceneObject) {\n  return sceneGraph.interpolate(exploration, VAR_LABELS_EXPR).replace(/\\s+/g, ' ');\n}\n\nexport function getColorByIndex(index: number) {\n  const visTheme = config.theme2.visualization;\n  return visTheme.getColorByName(visTheme.palette[index % 8]);\n}\n\nexport async function getLokiDatasource(sceneObject: SceneObject) {\n  const ds = (await getDataSourceSrv().get(VAR_DATASOURCE_EXPR, { __sceneObject: { value: sceneObject } })) as\n    | LokiDatasource\n    | undefined;\n  return ds;\n}\n\nexport function isDefined<T>(value: T | null | undefined): value is T {\n  return value !== null && value !== undefined;\n}\n\nexport function getQueryRunnerFromChildren(sceneObject: SceneObject) {\n  return sceneGraph.findDescendents(sceneObject, SceneQueryRunner);\n}\n\ninterface SceneType<T> extends Function {\n  new (...args: never[]): T;\n}\n\nexport function findObjectOfType<T extends SceneObject>(\n  scene: SceneObject,\n  check: (obj: SceneObject) => boolean,\n  returnType: SceneType<T>\n) {\n  const obj = sceneGraph.findObject(scene, check);\n  if (obj instanceof returnType) {\n    return obj;\n  } else if (obj !== null) {\n    logger.warn(`invalid return type: ${returnType.toString()}`);\n  }\n\n  return null;\n}\n\nexport function getTimePicker(scene: IndexScene) {\n  return scene.state.controls?.find((s) => s instanceof SceneTimePicker) as SceneTimePicker;\n}\n","import uFuzzy from '@leeoniya/ufuzzy';\nimport { debounce as debounceLodash } from 'lodash';\n\nconst uf = new uFuzzy({\n  intraMode: 1,\n  intraIns: 1,\n  intraSub: 1,\n  intraTrn: 1,\n  intraDel: 1,\n});\n\nexport function fuzzySearch(haystack: string[], query: string, callback: (data: string[][]) => void) {\n  const [idxs, info, order] = uf.search(haystack, query, 0, 1e5);\n\n  let haystackOrder: string[] = [];\n  let matchesSet: Set<string> = new Set();\n  if (idxs && order) {\n    /**\n     * get the fuzzy matches for highlighting\n     * @param part\n     * @param matched\n     */\n    const mark = (part: string, matched: boolean) => {\n      if (matched) {\n        matchesSet.add(part);\n      }\n    };\n\n    // Iterate to create the order of needles(queries) and the matches\n    for (let i = 0; i < order.length; i++) {\n      let infoIdx = order[i];\n\n      /** Evaluate the match, get the matches for highlighting */\n      uFuzzy.highlight(haystack[info.idx[infoIdx]], info.ranges[infoIdx], mark);\n      /** Get the order */\n      haystackOrder.push(haystack[info.idx[infoIdx]]);\n    }\n\n    callback([haystackOrder, [...matchesSet]]);\n  } else if (!query) {\n    callback([]);\n  }\n}\n\nexport const debouncedFuzzySearch = debounceLodash(fuzzySearch, 300);\n","import { ChangepointDetector } from '@bsull/augurs/changepoint';\nimport { OutlierDetector, OutlierOutput } from '@bsull/augurs/outlier';\nimport { DataFrame, doStandardCalcs, fieldReducers, FieldType, outerJoinDataFrames, ReducerID } from '@grafana/data';\nimport { getLabelValueFromDataFrame } from './levels';\nimport { memoize } from 'lodash';\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from './analytics';\nimport { logger } from './logger';\n\nexport const DEFAULT_SORT_BY = 'changepoint';\n\nexport const sortSeries = memoize(\n  (series: DataFrame[], sortBy: string, direction: string) => {\n    if (sortBy === 'alphabetical') {\n      return sortSeriesByName(series, direction);\n    }\n\n    if (sortBy === 'outliers') {\n      initOutlierDetector(series);\n    }\n\n    const reducer = (dataFrame: DataFrame) => {\n      // ML & Wasm sorting options\n      try {\n        if (sortBy === 'changepoint') {\n          return calculateDataFrameChangepoints(dataFrame);\n        } else if (sortBy === 'outliers') {\n          return calculateOutlierValue(series, dataFrame);\n        }\n      } catch (e) {\n        logger.error(e, { msg: 'failed to sort' });\n\n        // ML sorting panicked, fallback to stdDev\n        sortBy = ReducerID.stdDev;\n      }\n      const fieldReducer = fieldReducers.get(sortBy);\n      const value =\n        fieldReducer.reduce?.(dataFrame.fields[1], true, true) ?? doStandardCalcs(dataFrame.fields[1], true, true);\n      return value[sortBy] ?? 0;\n    };\n\n    const seriesCalcs = series.map((dataFrame) => ({\n      value: reducer(dataFrame),\n      dataFrame: dataFrame,\n    }));\n\n    seriesCalcs.sort((a, b) => {\n      if (a.value !== undefined && b.value !== undefined) {\n        return b.value - a.value;\n      }\n      return 0;\n    });\n\n    if (direction === 'asc') {\n      seriesCalcs.reverse();\n    }\n\n    return seriesCalcs.map(({ dataFrame }) => dataFrame);\n  },\n  (series: DataFrame[], sortBy: string, direction: string) => {\n    const firstTimestamp = series.length > 0 ? series[0].fields[0].values[0] : 0;\n    const lastTimestamp =\n      series.length > 0\n        ? series[series.length - 1].fields[0].values[series[series.length - 1].fields[0].values.length - 1]\n        : 0;\n    const firstValue = series.length > 0 ? getLabelValueFromDataFrame(series[0]) : '';\n    const lastValue = series.length > 0 ? getLabelValueFromDataFrame(series[series.length - 1]) : '';\n    // This still isn't good enough, if the dataframe returns the same number of fields, with the same start and end values, we'll fail to update the UI\n    const allSeriesKey = series.map(\n      (frame) =>\n        frame.length +\n        '_' +\n        frame.fields.map((field) => field.name + '_' + field.values[0] + '_' + field.values[field.values.length - 1])\n    );\n    return `${firstValue}_${lastValue}_${firstTimestamp}_${lastTimestamp}_${series.length}_${allSeriesKey}_${sortBy}_${direction}`;\n  }\n);\n\nexport const calculateDataFrameChangepoints = (data: DataFrame) => {\n  if (!wasmSupported()) {\n    throw new Error('WASM not supported, fall back to stdDev');\n  }\n\n  const fields = data.fields.filter((f) => f.type === FieldType.number);\n\n  const dataPoints = fields[0].values.length;\n\n  let samplingStep = Math.floor(dataPoints / 100) || 1;\n  if (samplingStep > 1) {\n    // Avoiding \"big\" steps for more accuracy\n    samplingStep = Math.ceil(samplingStep / 2);\n  }\n\n  const sample = fields[0].values.filter((_, i) => i % samplingStep === 0);\n\n  const values = new Float64Array(sample);\n  const points = ChangepointDetector.defaultArgpcp().detectChangepoints(values);\n\n  return points.indices.length;\n};\n\nexport const sortSeriesByName = (series: DataFrame[], direction: string) => {\n  const sortedSeries = [...series];\n  sortedSeries.sort((a, b) => {\n    const valueA = getLabelValueFromDataFrame(a);\n    const valueB = getLabelValueFromDataFrame(b);\n    if (!valueA || !valueB) {\n      return 0;\n    }\n    return valueA?.localeCompare(valueB) ?? 0;\n  });\n  if (direction === 'desc') {\n    sortedSeries.reverse();\n  }\n  return sortedSeries;\n};\n\nconst initOutlierDetector = (series: DataFrame[]) => {\n  if (!wasmSupported()) {\n    return;\n  }\n\n  // Combine all frames into one by joining on time.\n  const joined = outerJoinDataFrames({ frames: series });\n  if (!joined) {\n    return;\n  }\n\n  // Get number fields: these are our series.\n  const joinedSeries = joined.fields.filter((f) => f.type === FieldType.number);\n  const points = joinedSeries.flatMap((series) => new Float64Array(series.values));\n\n  try {\n    const detector = OutlierDetector.dbscan({ sensitivity: 0.4 }).preprocess(points);\n    outliers = detector.detect();\n  } catch (e) {\n    logger.error(e, { msg: 'initOutlierDetector: OutlierDetector error' });\n  }\n};\n\nlet outliers: OutlierOutput | undefined = undefined;\n\nexport const calculateOutlierValue = (series: DataFrame[], data: DataFrame): number => {\n  if (!wasmSupported()) {\n    throw new Error('WASM not supported, fall back to stdDev');\n  }\n  if (!outliers) {\n    throw new Error('Initialize outlier detector first');\n  }\n\n  const index = series.indexOf(data);\n  if (outliers.seriesResults[index].isOutlier) {\n    return outliers.seriesResults[index].outlierIntervals.length;\n  }\n\n  return 0;\n};\n\nexport const wasmSupported = () => {\n  const support = typeof WebAssembly === 'object';\n\n  if (!support) {\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.wasm_not_supported);\n  }\n\n  return support;\n};\n","import pluginJson from '../plugin.json';\nimport { SortBy, SortDirection } from '../Components/ServiceScene/Breakdowns/SortByScene';\nimport { SceneObject, VariableValue } from '@grafana/scenes';\nimport { getDataSourceName, getServiceName } from './variableGetters';\nimport { logger } from './logger';\nimport { SERVICE_NAME } from './variables';\nimport { Options } from '@grafana/schema/dist/esm/raw/composable/logs/panelcfg/x/LogsPanelCfg_types.gen';\nimport { unknownToStrings } from './narrowing';\nimport { AvgFieldPanelType, CollapsablePanelText } from '../Components/Panels/PanelMenu';\n\nconst FAVORITE_PRIMARY_LABEL_VALUES_LOCALSTORAGE_KEY = `${pluginJson.id}.services.favorite`;\nconst FAVORITE_PRIMARY_LABEL_NAME_LOCALSTORAGE_KEY = `${pluginJson.id}.primarylabels.tabs.favorite`;\nconst DS_LOCALSTORAGE_KEY = `${pluginJson.id}.datasource`;\n\n// This should be a string, but we'll accept anything and return an empty array if it's not a string\nexport function getFavoriteLabelValuesFromStorage(dsKey: string | unknown, labelName: string): string[] {\n  if (!dsKey || typeof dsKey !== 'string') {\n    return [];\n  }\n  const key = createPrimaryLabelLocalStorageKey(dsKey, labelName);\n  let labelValues: string[] = [];\n  try {\n    labelValues = unknownToStrings(JSON.parse(localStorage.getItem(key) || '[]'));\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(labelValues)) {\n    labelValues = [];\n  }\n  return labelValues;\n}\n\n// This should be a string, but we'll accept anything and return early\nexport function addToFavoriteLabelValueInStorage(dsKey: string | unknown, labelName: string, labelValue: string) {\n  if (!dsKey || typeof dsKey !== 'string') {\n    return;\n  }\n  const key = createPrimaryLabelLocalStorageKey(dsKey, labelName);\n  let services: string[] = [];\n  try {\n    services = unknownToStrings(JSON.parse(localStorage.getItem(key) || '[]'));\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n\n  // We want to put this service at the top of the list and remove any duplicates\n  const servicesToStore = services.filter((service: string) => service !== labelValue);\n  servicesToStore.unshift(labelValue);\n\n  localStorage.setItem(key, JSON.stringify(servicesToStore));\n}\n\nexport function removeFromFavoritesInStorage(dsKey: VariableValue, labelName: string, labelValue: string) {\n  if (!dsKey || !labelName || !labelValue || typeof dsKey !== 'string') {\n    return;\n  }\n  const key = createPrimaryLabelLocalStorageKey(dsKey, labelName);\n  let services: string[] = [];\n  try {\n    services = unknownToStrings(JSON.parse(localStorage.getItem(key) || '[]'));\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n  const servicesToStore = services.filter((service: string) => service !== labelValue);\n  localStorage.setItem(key, JSON.stringify(servicesToStore));\n}\n\nexport function addTabToLocalStorage(dsKey: string, labelName: string) {\n  if (!dsKey || !labelName) {\n    return;\n  }\n\n  const key = createTabsLocalStorageKey(dsKey);\n\n  let services: string[] = [];\n  try {\n    services = unknownToStrings(JSON.parse(localStorage.getItem(key) || '[]'));\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing saved tabs from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n\n  if (services.indexOf(labelName) === -1) {\n    // We want to put this service at the top of the list and remove any duplicates\n    const servicesToStore = services.filter((tabName: string) => tabName !== labelName);\n    servicesToStore.unshift(labelName);\n\n    localStorage.setItem(key, JSON.stringify(servicesToStore));\n  }\n}\n\nexport function removeTabFromLocalStorage(dsKey: string, labelName: string) {\n  if (!dsKey || !labelName) {\n    return;\n  }\n  const key = createTabsLocalStorageKey(dsKey);\n  let services: string[] = [];\n  try {\n    services = unknownToStrings(JSON.parse(localStorage.getItem(key) || '[]'));\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(services)) {\n    services = [];\n  }\n  const servicesToStore = services.filter((tabName: string) => tabName !== labelName);\n  localStorage.setItem(key, JSON.stringify(servicesToStore));\n}\n\nexport function getFavoriteTabsFromStorage(dsKey: string | unknown): string[] {\n  if (!dsKey || typeof dsKey !== 'string') {\n    return [];\n  }\n  const key = createTabsLocalStorageKey(dsKey);\n  let tabNames: string[] = [];\n  try {\n    tabNames = unknownToStrings(JSON.parse(localStorage.getItem(key) || '[]'));\n  } catch (e) {\n    logger.error(e, { msg: 'Error parsing favorite services from local storage' });\n  }\n\n  if (!Array.isArray(tabNames)) {\n    tabNames = [];\n  }\n  return tabNames;\n}\n\nfunction createPrimaryLabelLocalStorageKey(ds: string, labelName: string) {\n  if (labelName === SERVICE_NAME) {\n    labelName = '';\n  } else {\n    labelName = `_${labelName}`;\n  }\n  return `${FAVORITE_PRIMARY_LABEL_VALUES_LOCALSTORAGE_KEY}_${ds}${labelName}`;\n}\n\nfunction createTabsLocalStorageKey(ds: string) {\n  return `${FAVORITE_PRIMARY_LABEL_NAME_LOCALSTORAGE_KEY}_${ds}`;\n}\n\nexport function getLastUsedDataSourceFromStorage(): string | undefined {\n  return localStorage.getItem(DS_LOCALSTORAGE_KEY) ?? undefined;\n}\n\nexport function addLastUsedDataSourceToStorage(dsKey: string) {\n  localStorage.setItem(DS_LOCALSTORAGE_KEY, dsKey);\n}\n\nconst SORT_BY_LOCALSTORAGE_KEY = `${pluginJson.id}.values.sort`;\nexport function getSortByPreference(\n  target: string,\n  defaultSortBy: SortBy,\n  defaultDirection: SortDirection\n): { sortBy: SortBy | ''; direction: SortDirection } {\n  const preference = localStorage.getItem(`${SORT_BY_LOCALSTORAGE_KEY}.${target}.by`) ?? '';\n  const parts = preference.split('.');\n  if (!parts[0] || !parts[1]) {\n    return { sortBy: defaultSortBy, direction: defaultDirection };\n  }\n  const sortBy = parts[0] as SortBy;\n  const direction = parts[1] as SortDirection;\n  return { sortBy, direction };\n}\n\nexport function setSortByPreference(target: string, sortBy: string, direction: string) {\n  // Prevent storing empty values\n  if (sortBy && direction) {\n    localStorage.setItem(`${SORT_BY_LOCALSTORAGE_KEY}.${target}.by`, `${sortBy}.${direction}`);\n  }\n}\n\nfunction getExplorationPrefix(sceneRef: SceneObject) {\n  const ds = getDataSourceName(sceneRef);\n  const serviceName = getServiceName(sceneRef);\n  return `${ds}.${serviceName}`;\n}\n\nexport function getDisplayedFields(sceneRef: SceneObject) {\n  const PREFIX = getExplorationPrefix(sceneRef);\n  const storedFields = localStorage.getItem(`${pluginJson.id}.${PREFIX}.logs.fields`);\n  if (storedFields) {\n    return JSON.parse(storedFields);\n  }\n  return [];\n}\n\nexport function setDisplayedFields(sceneRef: SceneObject, fields: string[]) {\n  const PREFIX = getExplorationPrefix(sceneRef);\n  localStorage.setItem(`${pluginJson.id}.${PREFIX}.logs.fields`, JSON.stringify(fields));\n}\n\n// Log panel options\nconst LOG_OPTIONS_LOCALSTORAGE_KEY = `${pluginJson.id}.logs.option`;\nexport function getLogOption<T>(option: keyof Options, defaultValue: T) {\n  const localStorageResult = localStorage.getItem(`${LOG_OPTIONS_LOCALSTORAGE_KEY}.${option}`);\n  return localStorageResult ? localStorageResult : defaultValue;\n}\n\nexport function setLogOption(option: keyof Options, value: string | number | boolean) {\n  let storedValue = value.toString();\n  if (typeof value === 'boolean' && !value) {\n    storedValue = '';\n  }\n  localStorage.setItem(`${LOG_OPTIONS_LOCALSTORAGE_KEY}.${option}`, storedValue);\n}\n\n// Logs volume options\nconst LOGS_VOLUME_LOCALSTORAGE_KEY = 'grafana.explore.logs.logsVolume';\nexport function setLogsVolumeOption(option: 'collapsed', value: string | undefined) {\n  const key = `${LOGS_VOLUME_LOCALSTORAGE_KEY}.${option}`;\n  if (value === undefined) {\n    localStorage.removeItem(key);\n    return;\n  }\n  localStorage.setItem(key, value);\n}\n\nexport function getLogsVolumeOption(option: 'collapsed') {\n  return Boolean(localStorage.getItem(`${LOGS_VOLUME_LOCALSTORAGE_KEY}.${option}`));\n}\n\n// Log visualization options\nexport type LogsVisualizationType = 'logs' | 'table';\n\nconst VISUALIZATION_TYPE_LOCALSTORAGE_KEY = 'grafana.explore.logs.visualisationType';\nexport function getLogsVisualizationType(): LogsVisualizationType {\n  const storedType = localStorage.getItem(VISUALIZATION_TYPE_LOCALSTORAGE_KEY) ?? '';\n  switch (storedType) {\n    case 'table':\n    case 'logs':\n      return storedType;\n    default:\n      return 'logs';\n  }\n}\n\nexport function setLogsVisualizationType(type: string) {\n  localStorage.setItem(VISUALIZATION_TYPE_LOCALSTORAGE_KEY, type);\n}\n\n// Line filter options\nconst LINE_FILTER_OPTIONS_LOCALSTORAGE_KEY = `${pluginJson.id}.linefilter.option`;\nexport function setLineFilterCase(caseSensitive: boolean) {\n  let storedValue = caseSensitive.toString();\n  if (!caseSensitive) {\n    storedValue = '';\n  }\n\n  localStorage.setItem(`${LINE_FILTER_OPTIONS_LOCALSTORAGE_KEY}.caseSensitive`, storedValue);\n}\n\nexport function setLineFilterRegex(regex: boolean) {\n  let storedValue = regex.toString();\n  if (!regex) {\n    storedValue = '';\n  }\n\n  localStorage.setItem(`${LINE_FILTER_OPTIONS_LOCALSTORAGE_KEY}.regex`, storedValue);\n}\n\nexport function setLineFilterExclusive(exclusive: boolean) {\n  let storedValue = exclusive.toString();\n  if (!exclusive) {\n    storedValue = '';\n  }\n\n  localStorage.setItem(`${LINE_FILTER_OPTIONS_LOCALSTORAGE_KEY}.exclusive`, storedValue);\n}\n\nexport function getLineFilterCase(defaultValue: boolean): boolean {\n  const storedValue = localStorage.getItem(`${LINE_FILTER_OPTIONS_LOCALSTORAGE_KEY}.caseSensitive`);\n  return storedValue === 'true' ? true : defaultValue;\n}\n\nexport function getLineFilterRegex(defaultValue: boolean): boolean {\n  const storedValue = localStorage.getItem(`${LINE_FILTER_OPTIONS_LOCALSTORAGE_KEY}.regex`);\n  return storedValue === 'true' ? true : defaultValue;\n}\n\nexport function getLineFilterExclusive(defaultValue: boolean): boolean {\n  const storedValue = localStorage.getItem(`${LINE_FILTER_OPTIONS_LOCALSTORAGE_KEY}.exclusive`);\n  return storedValue === 'true' ? true : defaultValue;\n}\n\n// Panel options\nconst PANEL_OPTIONS_LOCALSTORAGE_KEY = `${pluginJson.id}.panel.option`;\nexport interface PanelOptions {\n  panelType: AvgFieldPanelType;\n  collapsed: CollapsablePanelText;\n}\nexport function getPanelOption<K extends keyof PanelOptions, V extends PanelOptions[K]>(\n  option: K,\n  values: V[]\n): V | null {\n  const result = localStorage.getItem(`${PANEL_OPTIONS_LOCALSTORAGE_KEY}.${option}`);\n  if (result !== null) {\n    return values.find((v) => result === v) ?? null;\n  }\n\n  return null;\n}\n\nexport function setPanelOption<K extends keyof PanelOptions, V extends PanelOptions[K]>(option: K, value: V) {\n  localStorage.setItem(`${PANEL_OPTIONS_LOCALSTORAGE_KEY}.${option}`, value);\n}\n\nconst EXPRESSION_BUILDER_DEBUG_LOCALSTORAGE_KEY = `${pluginJson.id}.expressionBuilder.debug`;\nexport function getExpressionBuilderDebug() {\n  const value = localStorage.getItem(EXPRESSION_BUILDER_DEBUG_LOCALSTORAGE_KEY);\n  return !!value;\n}\n\nconst SERVICE_SELECTION_PAGE_COUNT_KEY = `${pluginJson.id}.serviceSelection.pageCount`;\n\nexport function getServiceSelectionPageCount(): number | undefined {\n  const value = localStorage.getItem(SERVICE_SELECTION_PAGE_COUNT_KEY);\n  return value ? parseInt(value, 10) : undefined;\n}\nexport function setServiceSelectionPageCount(pageCount: number) {\n  localStorage.setItem(SERVICE_SELECTION_PAGE_COUNT_KEY, pageCount.toString(10));\n}\n","export const testIds = {\n  appConfig: {\n    container: 'data-testid ac-container',\n    apiKey: 'data-testid ac-api-key',\n    apiUrl: 'data-testid ac-api-url',\n    submit: 'data-testid ac-submit-form',\n  },\n  exploreServiceSearch: {\n    search: 'data-testid search-services',\n  },\n  header: {\n    refreshPicker: 'data-testid RefreshPicker run button',\n  },\n  variables: {\n    datasource: {\n      label: 'data-testid Dashboard template variables submenu Label Data source',\n    },\n    combobox: {},\n    serviceName: {\n      label: 'data-testid Dashboard template variables submenu Label Labels',\n    },\n    levels: {\n      inputWrap: 'data-testid detected_level filter variable',\n    },\n  },\n  breakdowns: {\n    labels: {},\n    fields: {},\n    common: {\n      sortByFunction: 'data-testid SortBy function',\n      sortByDirection: 'data-testid SortBy direction',\n      filterButtonGroup: 'data-testid filter-button-group',\n      filterButton: 'data-testid filter-button',\n      filterSelect: 'data-testid filter-select',\n      filterNumericPopover: {\n        removeButton: 'data-testid filter-numeric-remove',\n        submitButton: 'data-testid filter-numeric-submit',\n        cancelButton: 'data-testid filter-numeric-cancel',\n        inputGreaterThan: 'data-testid filter-numeric-gt',\n        inputGreaterThanUnit: 'data-testid filter-numeric-gtu',\n        inputGreaterThanInclusive: 'data-testid filter-numeric-gte',\n\n        inputLessThan: 'data-testid filter-numeric-lt',\n        inputLessThanUnit: 'data-testid filter-numeric-ltu',\n        inputLessThanInclusive: 'data-testid filter-numeric-lte',\n      },\n    },\n  },\n\n  index: {\n    showLogsButton: 'data-testid Show logs',\n    addNewLabelTab: 'data-testid Tab Add label',\n    searchLabelValueInput: 'data-testid search-services-input',\n    aggregatedMetricsMenu: 'data-testid aggregated-metrics-menu',\n    aggregatedMetricsToggle: 'data-testid aggregated-metrics-toggle',\n    header: {\n      showLogsButton: 'data-testid Show logs header',\n    },\n  },\n\n  exploreServiceDetails: {\n    searchLogs: 'data-testid search-logs',\n    openExplore: 'data-testid open-explore',\n    tabPatterns: 'data-testid tab-patterns',\n    tabLogs: 'data-testid tab-logs',\n    tabFields: 'data-testid tab-fields',\n    tabLabels: 'data-testid tab-labels',\n    buttonRemovePattern: 'data-testid button-remove-pattern',\n    buttonFilterInclude: 'data-testid button-filter-include',\n    buttonFilterExclude: 'data-testid button-filter-exclude',\n  },\n  patterns: {\n    tableWrapper: 'data-testid table-wrapper',\n    buttonIncludedPattern: 'data-testid button-included-pattern',\n    buttonExcludedPattern: 'data-testid button-excluded-pattern',\n  },\n  logsPanelHeader: {\n    header: 'data-testid Panel header Logs',\n    radio: 'data-testid radio-button',\n  },\n  table: {\n    wrapper: 'data-testid table-wrapper',\n    inspectLine: 'data-testid inspect',\n    rawLogLine: 'data-testid raw-log-line',\n  },\n};\n","import { locationService } from '@grafana/runtime';\nimport { logger } from './logger';\nimport { dateTime, LogRowModel, TimeRange } from '@grafana/data';\n\nexport const copyText = (string: string) => {\n  if (navigator.clipboard && window.isSecureContext) {\n    navigator.clipboard.writeText(string);\n  } else {\n    const el = document.createElement('textarea');\n    el.value = string;\n    document.body.appendChild(el);\n    el.select();\n    document.execCommand('copy');\n    document.body.removeChild(el);\n  }\n};\n\nexport enum UrlParameterType {\n  From = 'from',\n  To = 'to',\n}\n\ntype PermalinkDataType =\n  | {\n      id?: string;\n      row?: number;\n    }\n  | {\n      logs: {\n        id: string;\n        displayedFields: string[];\n      };\n    };\n\nexport const generateLogShortlink = (paramName: string, data: PermalinkDataType, timeRange: TimeRange) => {\n  const location = locationService.getLocation();\n  const searchParams = new URLSearchParams(location.search);\n\n  searchParams.set(UrlParameterType.From, timeRange.from.toISOString());\n  searchParams.set(UrlParameterType.To, timeRange.to.toISOString());\n  searchParams.set(paramName, JSON.stringify(data));\n\n  // @todo can encoding + as %20 break other stuff? Can label names or values have + in them that we don't want encoded? Should we just update values?\n  // + encoding for whitespace is for application/x-www-form-urlencoded, which appears to be the default encoding for URLSearchParams, replacing + with %20 to keep urls meant for the browser from breaking\n  const searchString = searchParams.toString().replace(/\\+/g, '%20');\n  return window.location.origin + location.pathname + '?' + searchString;\n};\n\nexport function capitalizeFirstLetter(input: string) {\n  if (input.length) {\n    return input?.charAt(0).toUpperCase() + input.slice(1);\n  }\n\n  logger.warn('invalid string argument');\n  return input;\n}\n\nexport function truncateText(input: string, length: number, ellipsis: boolean) {\n  return input.substring(0, length) + (ellipsis && input.length > length ? '' : '');\n}\n\nexport function resolveRowTimeRangeForSharing(row: LogRowModel): TimeRange {\n  // With infinite scrolling, we cannot rely on the time picker range, so we use a time range around the shared log line.\n  const from = dateTime(row.timeEpochMs - 1);\n  const to = dateTime(row.timeEpochMs + 1);\n\n  const range = {\n    from,\n    to,\n    raw: {\n      from,\n      to,\n    },\n  };\n\n  return range;\n}\n","import {\n  AdHocFiltersVariable,\n  CustomVariable,\n  DataSourceVariable,\n  sceneGraph,\n  SceneObject,\n  SceneVariableState,\n} from '@grafana/scenes';\nimport { CustomConstantVariable } from './CustomConstantVariable';\nimport {\n  AdHocFieldValue,\n  FieldValue,\n  isAdHocFilterValueUserInput,\n  JSON_FORMAT_EXPR,\n  LOGS_FORMAT_EXPR,\n  LogsQueryOptions,\n  MIXED_FORMAT_EXPR,\n  SERVICE_NAME,\n  stripAdHocFilterUserInputPrefix,\n  VAR_AGGREGATED_METRICS,\n  VAR_DATASOURCE,\n  VAR_FIELD_GROUP_BY,\n  VAR_FIELDS,\n  VAR_FIELDS_AND_METADATA,\n  VAR_FIELDS_EXPR,\n  VAR_LABEL_GROUP_BY,\n  VAR_LABELS,\n  VAR_LABELS_EXPR,\n  VAR_LABELS_REPLICA,\n  VAR_LEVELS,\n  VAR_LEVELS_EXPR,\n  VAR_LINE_FILTER,\n  VAR_LINE_FILTERS,\n  VAR_LINE_FILTERS_EXPR,\n  VAR_METADATA,\n  VAR_METADATA_EXPR,\n  VAR_PATTERNS,\n  VAR_PATTERNS_EXPR,\n  VAR_PRIMARY_LABEL,\n  VAR_PRIMARY_LABEL_SEARCH,\n} from './variables';\nimport { AdHocVariableFilter } from '@grafana/data';\nimport { logger } from './logger';\nimport { narrowFieldValue, NarrowingError } from './narrowing';\nimport { isFilterMetadata } from './filters';\nimport { AdHocFilterTypes, InterpolatedFilterType } from '../Components/ServiceScene/Breakdowns/AddToFiltersButton';\n\nexport function getLogsStreamSelector(options: LogsQueryOptions) {\n  const {\n    labelExpressionToAdd = '',\n    structuredMetadataToAdd = '',\n    fieldExpressionToAdd = '',\n    parser = undefined,\n  } = options;\n\n  switch (parser) {\n    case 'structuredMetadata':\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_LEVELS_EXPR} ${VAR_METADATA_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTERS_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n    case 'json':\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_LEVELS_EXPR} ${VAR_METADATA_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTERS_EXPR} ${JSON_FORMAT_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n    case 'logfmt':\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_LEVELS_EXPR} ${VAR_METADATA_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTERS_EXPR} ${LOGS_FORMAT_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n    default:\n      return `{${VAR_LABELS_EXPR}${labelExpressionToAdd}} ${structuredMetadataToAdd} ${VAR_LEVELS_EXPR} ${VAR_METADATA_EXPR} ${VAR_PATTERNS_EXPR} ${VAR_LINE_FILTERS_EXPR} ${MIXED_FORMAT_EXPR} ${fieldExpressionToAdd} ${VAR_FIELDS_EXPR}`;\n  }\n}\n\nexport function getPatternsVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_PATTERNS, scene);\n  if (!(variable instanceof CustomVariable)) {\n    throw new Error('VAR_PATTERNS not found');\n  }\n  return variable;\n}\n\nexport function getLabelsVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_LABELS, scene);\n}\n\nexport function getLabelsVariableReplica(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_LABELS_REPLICA, scene);\n}\n\nexport function getMetadataVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_METADATA, scene);\n}\n\n// Combined fields and metadata, editable in the UI, changes to this variable flow into FIELDS and METADATA\nexport function getFieldsAndMetadataVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_FIELDS_AND_METADATA, scene);\n}\n\nexport function getFieldsVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_FIELDS, scene);\n}\n\nexport function getLevelsVariable(scene: SceneObject) {\n  return getAdHocFiltersVariable(VAR_LEVELS, scene);\n}\n\nexport function getLineFilterVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_LINE_FILTER, scene);\n  if (!(variable instanceof AdHocFiltersVariable)) {\n    throw new Error('VAR_LINE_FILTER not found');\n  }\n  return variable;\n}\n\nexport function getLabelGroupByVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_LABEL_GROUP_BY, scene);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('VAR_LABEL_GROUP_BY not found');\n  }\n  return variable;\n}\n\nexport function getAggregatedMetricsVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_AGGREGATED_METRICS, scene);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('SERVICE_LABEL_VAR not found');\n  }\n  return variable;\n}\n\nexport function getFieldGroupByVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_FIELD_GROUP_BY, scene);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('VAR_FIELD_GROUP_BY not found');\n  }\n  return variable;\n}\n\nexport function getDataSourceVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_DATASOURCE, scene);\n  if (!(variable instanceof DataSourceVariable)) {\n    throw new Error('VAR_DATASOURCE not found');\n  }\n  return variable;\n}\n\nexport function getLineFiltersVariable(scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_LINE_FILTERS, scene);\n  if (!(variable instanceof AdHocFiltersVariable)) {\n    throw new Error('VAR_LINE_FILTERS not found');\n  }\n  return variable;\n}\n\nexport function getAdHocFiltersVariable(variableName: AdHocFilterTypes, scene: SceneObject) {\n  const variable = sceneGraph.lookupVariable(variableName, scene);\n\n  if (!(variable instanceof AdHocFiltersVariable)) {\n    throw new Error(`Could not get AdHocFiltersVariable ${variableName}. Variable not found.`);\n  }\n  return variable;\n}\n\nexport function getServiceSelectionSearchVariable(sceneRef: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_PRIMARY_LABEL_SEARCH, sceneRef);\n  if (!(variable instanceof CustomConstantVariable)) {\n    throw new Error('VAR_PRIMARY_LABEL_SEARCH not found');\n  }\n  return variable;\n}\n\nexport function clearServiceSelectionSearchVariable(sceneRef: SceneObject) {\n  getServiceSelectionSearchVariable(sceneRef).setState({\n    value: '.+',\n    label: '',\n  });\n}\n\nexport function getServiceSelectionPrimaryLabel(sceneRef: SceneObject) {\n  const variable = sceneGraph.lookupVariable(VAR_PRIMARY_LABEL, sceneRef);\n  if (!(variable instanceof AdHocFiltersVariable)) {\n    throw new Error('VAR_PRIMARY_LABEL not found');\n  }\n  return variable;\n}\n\nexport function setServiceSelectionPrimaryLabelKey(key: string, sceneRef: SceneObject) {\n  getServiceSelectionPrimaryLabel(sceneRef).setState({\n    filters: [\n      {\n        // the value is replaced by the value in VAR_PRIMARY_LABEL_SEARCH if a search is active, so we just need to set the filter key (label name)\n        value: '.+',\n        operator: '=~',\n        key: key,\n      },\n    ],\n  });\n}\n\nexport function getUrlParamNameForVariable(variableName: string) {\n  return `var-${variableName}`;\n}\n\n/**\n * Parses an adHoc filter and returns the encoded value and parser\n * @param filter\n * @param variableName - only used for debugging\n */\nexport function getValueFromFieldsFilter(\n  filter: { value: string; valueLabels?: string[] },\n  variableName: string = VAR_FIELDS\n): FieldValue {\n  if (isFilterMetadata(filter)) {\n    return {\n      value: filter.value,\n      parser: 'structuredMetadata',\n    };\n  }\n\n  try {\n    const encodedValue = isAdHocFilterValueUserInput(filter.value)\n      ? stripAdHocFilterUserInputPrefix(filter.value)\n      : filter.value;\n    const fieldValue = narrowFieldValue(JSON.parse(encodedValue));\n    if (fieldValue !== false) {\n      return fieldValue;\n    } else {\n      throw new NarrowingError('getValueFromFieldsFilter: invalid filter value!');\n    }\n  } catch (e) {\n    if (e instanceof NarrowingError) {\n      logger.error(e, { msg: `getValueFromFieldsFilter: Failed to validate ${variableName}`, value: filter.value });\n    } else {\n      logger.error(e, { msg: `getValueFromFieldsFilter: Failed to parse ${variableName}`, value: filter.value });\n    }\n\n    // If the user has a URL from before 0.1.4 where detected_fields changed the format of the fields value to include the parser, fall back to mixed parser if we have a value\n    if (filter.value) {\n      return {\n        value: filter.value,\n        parser: 'mixed',\n      };\n    }\n    throw e;\n  }\n}\n\nexport function getValueFromAdHocVariableFilter(\n  variableName: InterpolatedFilterType,\n  filter?: AdHocVariableFilter\n): AdHocFieldValue {\n  if (variableName === VAR_FIELDS && filter) {\n    return getValueFromFieldsFilter(filter);\n  }\n\n  return {\n    value: filter?.value,\n  };\n}\n\nexport function getServiceName(scene: SceneObject) {\n  const labelsVariable = getLabelsVariable(scene);\n  return getServiceNameFromVariableState(labelsVariable.state);\n}\n\nexport function getServiceNameFromVariableState(\n  adHocFiltersVariableState: SceneVariableState & { filters: AdHocVariableFilter[] }\n) {\n  const serviceName = adHocFiltersVariableState.filters\n    .filter((filter) => filter.key === SERVICE_NAME)\n    .map((filter) => filter.value);\n\n  if (!serviceName) {\n    throw new Error('Service present in filters selected');\n  }\n  return serviceName[0];\n}\n\nexport function getDataSourceName(scene: SceneObject) {\n  const dsVariable = getDataSourceVariable(scene);\n  return dsVariable.getValue();\n}\n","import { AdHocFiltersVariable, sceneGraph, SceneObject, SceneVariable } from '@grafana/scenes';\nimport { CustomConstantVariable } from './CustomConstantVariable';\nimport { SERVICE_NAME, SERVICE_UI_LABEL, VAR_LABELS } from './variables';\nimport { IndexScene } from '../Components/IndexScene/IndexScene';\nimport { getPrimaryLabelFromUrl } from './routing';\nimport { FilterOp } from './filterTypes';\nimport { includeOperators, numericOperators, operators } from './operators';\nimport { isOperatorInclusive } from './operatorHelpers';\n\nexport function getVariablesThatCanBeCleared(indexScene: IndexScene) {\n  const variables = sceneGraph.getVariables(indexScene);\n  let variablesToClear: SceneVariable[] = [];\n\n  for (const variable of variables.state.variables) {\n    if (variable instanceof AdHocFiltersVariable && variable.state.filters.length) {\n      variablesToClear.push(variable);\n    }\n    if (variable instanceof CustomConstantVariable && variable.state.value && variable.state.name !== 'logsFormat') {\n      variablesToClear.push(variable);\n    }\n  }\n  return variablesToClear;\n}\n\nexport function clearVariables(sceneRef: SceneObject) {\n  // clear patterns: needs to happen first, or it won't work as patterns is split into a variable and a state, and updating the variable triggers a state update\n  const indexScene = sceneGraph.getAncestor(sceneRef, IndexScene);\n  indexScene.setState({\n    patterns: [],\n  });\n\n  const variablesToClear = getVariablesThatCanBeCleared(indexScene);\n\n  variablesToClear.forEach((variable) => {\n    if (variable instanceof AdHocFiltersVariable && variable.state.key === 'adhoc_service_filter') {\n      let { labelName } = getPrimaryLabelFromUrl();\n      // getPrimaryLabelFromUrl returns the label name that exists in the URL, which is \"service\" not \"service_name\"\n      if (labelName === SERVICE_UI_LABEL) {\n        labelName = SERVICE_NAME;\n      }\n      variable.setState({\n        filters: variable.state.filters.filter((filter) => filter.key === labelName),\n      });\n    } else if (variable instanceof AdHocFiltersVariable) {\n      variable.setState({\n        filters: [],\n      });\n    } else if (variable instanceof CustomConstantVariable) {\n      variable.setState({\n        value: '',\n        text: '',\n      });\n    }\n  });\n}\n\nexport const operatorFunction = function (variable: AdHocFiltersVariable) {\n  const wip = variable.state._wip;\n\n  // If there is already a non-regex inclusion operator for this key, don't allow exclusion\n  if (wip && variable.state.filters.some((filter) => filter.key === wip.key && filter.operator === FilterOp.Equal)) {\n    return includeOperators;\n  }\n\n  const isLabelsVar = variable.state.name === VAR_LABELS;\n  const inclusiveOperatorCount = variable.state.filters.filter((filter) => isOperatorInclusive(filter.operator)).length;\n  const isEditingOnlyFilter = !wip?.key && inclusiveOperatorCount === 1;\n  const isAddingFirstFilter = wip?.key && inclusiveOperatorCount < 1;\n\n  // Should not be able to exclude the only operator\n  if (isLabelsVar && (isEditingOnlyFilter || isAddingFirstFilter)) {\n    return includeOperators;\n  }\n\n  // Only fields or metadata can have field types?\n  if (wip?.meta) {\n    const meta: Record<string, string> = wip.meta;\n    const type = meta.type;\n\n    if (type === 'float' || type === 'bytes' || type === 'duration') {\n      return numericOperators;\n    }\n  }\n\n  return operators;\n};\n"],"names":["FilterButton","props","isExcluded","isIncluded","onInclude","onExclude","onClear","titles","buttonFill","hideExclude","styles","useStyles2","getStyles","div","className","container","Button","variant","fill","size","aria-selected","includeButton","onClick","data-testid","testIds","exploreServiceDetails","buttonFilterInclude","title","include","excludeButton","exclude","buttonFilterExclude","theme","css","display","justifyContent","borderRadius","borderRight","undefined","shape","radius","default","borderLeft","graphicContainer","margin","graphic","width","height","padding","spacing","text","alignItems","wrap","GrotError","children","useTheme2","SVG","src","isDark","Text","textAlignment","color","element","InterceptBanner","Alert","alert","severity","onRemove","a","target","href","rel","br","flex","GiveFeedbackButton","wrapper","feedback","Icon","name","marginLeft","gap","position","top","alignSelf","colors","secondary","fontSize","typography","bodySmall","link","CustomVariableValueSelectors","SceneObjectBase","model","variablesSetState","sceneGraph","getVariables","useState","variables","state","length","filter","variable","includes","map","VariableValueSelectWrapper","key","layout","Component","PatternTag","pattern","expanded","setExpanded","onMouseLeave","Tag","getPatternPreview","tag","aria-label","buttonRemovePattern","removeButton","PREVIEW_WIDTH","sm","lg","Math","round","window","innerWidth","substringLength","substring","fontFamily","cursor","overflow","borderTopRightRadius","borderBottomRightRadius","backgroundColor","main","border","boxSizing","textOverflow","paddingLeft","paddingRight","PatternControls","patterns","includePatterns","type","excludePatterns","onRemovePattern","addCurrentUrlToHistory","pat","reportAppInteraction","USER_EVENTS_PAGES","service_details","USER_EVENTS_ACTIONS","pattern_removed","includePatternsLength","excludePatternsLength","patternsContainer","weight","buttonIncludedPattern","p","buttonExcludedPattern","flexWrap","VariableLayoutScene","firstRowWrapper","label","breakpoints","down","flexDirection","bodyContainer","flexGrow","minHeight","maxWidth","body","controlsFirstRowContainer","controlsRowContainer","controlsContainer","filters","filtersWrap","controlsWrapper","marginTop","timeRangeDatasource","timeRange","controls","textAlign","rotateIcon","svg","transform","indexScene","getAncestor","IndexScene","layoutScene","LayoutScene","lineFilterRenderer","levelsRenderer","cx","control","SceneFlexLayout","CONTROLS_VARS_DATASOURCE","CONTROLS_VARS_FIELDS_COMBINED","setState","interceptBannerStorageKey","PLUGIN_ID","onActivate","this","LineFilterVariablesScene","LevelsVariableScene","variableLayout","dismiss","interceptDismissed","localStorage","setItem","constructor","super","getItem","addActivationHandler","bind","contentScene","logger","warn","getDetectedFieldValuesTagValuesProvider","expr","sceneRef","variableType","datasourceUnknownType","getDataSourceSrv","get","getDataSource","DataSourceWithBackend","error","Error","languageProvider","values","fetchDetectedLabelValues","options","limit","throwError","requestOptions","showErrorAlert","results","isArray","VAR_LEVELS","replace","currentFilters","valuesToRemove","forEach","value","valueLabels","isOperatorRegex","operator","split","v","push","filteredResults","meta","parser","valueDecoded","getValueFromFieldsFilter","JSON","stringify","r","msg","e","getLabelsTagValuesProvider","datasource_","datasource","getTagValues","filtersFiltered","existingFilters","oldFiltersFiltered","f","isOperatorInclusive","some","tagValuesFilterAdHocFilters","ExpressionBuilder","getJoinedLabelsFilters","getDataSourceVariable","result","FilterOp","Equal","favoriteValuesArray","getFavoriteLabelValuesFromStorage","getValue","toString","favoriteValuesSet","Set","sort","b","has","getLabelsTagKeysProvider","getTagKeys","tagKeys","filteredResult","Array","LABELS_TO_REMOVE","getFieldsKeysProvider","scopedVars","fetchDetectedFieldsFn","fetchDetectedFields","opts","queryOptions","field","LEVEL_VARIABLE_VALUE","VAR_FIELDS_AND_METADATA","parsers","group","interpolateString","interpolatedExpr","range","getDefaultTimeRange","rangeParams","getTimeRangeParams","start","end","params","query","Promise","resolve","reject","getResource","fields","console","MAP","KEYCODE_MAP","SHIFT_MAP","$","_","SPECIAL_ALIASES","option","command","return","escape","plus","mod","test","navigator","platform","REVERSE_MAP","i","characterFromEvent","event","character","String","fromCharCode","which","shiftKey","toLowerCase","isModifier","pickBestAction","modifiers","action","keyNumber","parseInt","hasOwnProperty","getReverseMap","getKeyInfo","combination","keys","keysFromString","belongsTo","ancestor","document","parentNode","mousetrap","el","_callbacks","_directMap","_sequenceLevels","_resetTimer","_ignoreNextKeyup","_ignoreNextKeypress","_nextExpectedAction","_globalCallbacks","_resetSequences","doNotReset","activeSequences","_getMatches","sequenceName","level","callback","matches","seq","metaKey","ctrlKey","modifiers1","modifiers2","join","deleteCombo","combo","deleteSequence","splice","_fireCallback","sequence","srcElement","HTMLElement","stopCallback","preventDefault","returnValue","stopPropagation","cancelBubble","_handleKey","callbacks","maxLevel","processedSequenceCallback","max","suffixPrefixIndex","lastIndexOf","sequencePrefix","slice","Object","entries","startsWith","ignoreThisKeypress","_handleKeyEvent","rawEvent","KeyboardEvent","repeat","keyCode","handleKey","altKey","eventModifiers","_resetSequenceTimer","clearTimeout","setTimeout","_bindSequence","_increaseSequence","nextAction","_callbackAndReset","wrappedCallback","_bindSingle","info","eventLike","callbackInfo","_bindMultiple","combinations","self","unbind","bindGlobal","unbindGlobal","trigger","reset","indexOf","composedPath","initialEventTarget","Boolean","tagName","isContentEditable","args","addKeycodes","object","addEventListener","KeybindingSet","addBinding","item","evt","onTrigger","_binds","removeAll","appEvents","getAppEvents","handleZoomOut","scene","timePicker","getTimePicker","onZoom","handleTimeRangeShift","direction","onMoveBackward","onMoveForward","toggleVizPanelLegend","vizPanel","optionsWithLegend","legend","showLegend","onOptionsChange","CopyTimeEvent","BusEventBase","PasteTimeEvent","BusEventWithPayload","getCopiedTimeRange","raw","clipboard","readText","unknownRange","parse","narrowTimeRange","isError","NoLokiSplash","h3","locationUtil","assureBaseUrl","up","marginBottom","showLogsButtonSceneKey","stateUpdate","drillDownLabel","setVariableProviders","findByKeyAndType","ShowLogsButtonScene","hidden","routeMatch","breakdownLabel","getDrilldownSlug","PageSlugs","explore","ServiceSelectionScene","ServiceScene","setTagProviders","updatePatterns","getPatternsVariable","resetVariablesIfNotInUrl","getFieldsVariable","getUrlParamNameForVariable","VAR_FIELDS","getLevelsVariable","_subs","add","subscribeToState","newState","getTimeRange","limitMaxInterval","subscribeToEvent","subscribeToPasteTimeEvent","fieldFilters","metadataFilters","getMetadataVariable","fieldsAndMetadataVariable","getFieldsAndMetadataVariable","updateFilters","subscribeToCombinedFieldsVariable","clearKeyBindings","keybindings","vizPanelKey","panelAttentionSubscription","subscribe","SetPanelAttentionEvent","payload","panelId","withFocusedPanel","fn","findObject","o","isActive","VizPanel","findAllObjects","withAllPanels","url","getExploreLink","locationService","activeScene","__grafanaSceneContext","publish","updateUrl","publishEvent","onRefresh","toAbsolute","unsubscribe","setupKeyboardShortcuts","setLabelsProviders","labelsVar","getLabelsVariable","_getOperators","operatorFunction","getTagKeysProvider","getTagValuesProvider","prevState","jsonData","plugin","interval","maxInterval","rangeUtil","intervalToSeconds","timeRangeInterval","to","diff","from","defaultRange","SceneTimeRange","DEFAULT_TIME_RANGE","AppEvents","alertWarning","attempted_duration_seconds","configured_max_interval","levelsVariable","fieldsCombinedVariable","getLevelsTagValuesProvider","getLevelsTagKeysProvider","getCombinedFieldsTagKeysProvider","getCombinedFieldsTagValuesProvider","currentKey","metadataVar","fieldVar","uninterpolatedExpression","getFieldsTagValuesExpression","otherFiltersString","renderVariableFilters","otherMetadataString","VAR_METADATA","PENDING_FIELDS_EXPR","PENDING_METADATA_EXPR","interpolate","interpolated","renderLogQLFieldFilters","renderLogQLMetadataFilters","urlParamName","location","getLocation","URLSearchParams","search","patternsVariable","patternsLine","renderPatternFilters","changeValueTo","getUrlState","updateFromUrl","getLastUsedDataSourceFromStorage","variablesScene","unsub","initialDatasourceUid","initialFilters","labelVariable","AdHocFiltersVariable","VAR_LABELS","EXPLORATION_DS","allowCustomValue","expressionBuilder","renderLogQLLabelFilters","hide","VariableHide","dontHide","onAddCustomValue","onAddCustomAdHocValue","operators","fieldsVariable","applyMode","hideVariable","metadataVariable","onAddCustomFieldValue","skipUrlSync","renderLevelsFilter","supportsMultiValueOperators","lineFiltersVariable","VAR_LINE_FILTERS","renderLogQLLineFilter","lineFilterOperators","dsVariable","DataSourceVariable","VAR_DATASOURCE","pluginId","dsValue","addLastUsedDataSourceToStorage","SceneVariableSet","CustomVariable","VAR_PATTERNS","VAR_LINE_FILTER","CustomConstantVariable","VAR_LOGS_FORMAT","MIXED_FORMAT_EXPR","getVariableSet","SceneFlexItem","disabled","SceneTimePicker","SceneRefreshPicker","config","featureToggles","exploreLogsAggregatedMetrics","ToolbarScene","isOpen","$timeRange","$variables","_urlSync","SceneObjectUrlSyncConfig","areArraysEqual","isFilterMetadata","copiedRange","newRange","convertRawToRange","sceneTimeRange","getLokiDatasource","then","ds","LoadingPlaceholder","LEVELS_VARIABLE_SCENE_KEY","onFilterChange","SceneVariableValueChangedEvent","levelsVar","selected","isLoading","visible","levelsKeys","response","skipPublish","forcePublish","filterOptions","opt","filterOpt","onChangeOptions","openSelect","onCloseMenu","syncLevelsVariable","levelsVariableScene","obj","levels","inputWrap","ControlsLabel","MultiSelect","prefix","placeholder","onChange","onOpenMenu","onFocus","menuShouldPortal","isClearable","blurInputOnSelect","closeMenuOnSelect","openMenuOnFocus","showAllSelectedWhenOpen","hideSelectedOptions","val","LineFilterVariable","focus","setFocus","getLineFilterStyles","span","titleWrap","IconButton","collapseWrap","LineFilterEditor","collapseBtn","tooltip","isFilterExclusive","LineFilterOp","negativeMatch","negativeRegex","updateFilter","existingFilter","filterUpdate","debounced","updateVariableLineFilter","updateVariableDebounced","handleEnter","lineFilter","onRegexToggle","newOperator","match","regex","onToggleExclusive","onCaseSensitiveToggle","caseSensitive","LineFilterCaseSensitive","caseInsensitive","onInputChange","removeFilter","getLineFiltersVariable","otherFilters","keyLabel","search_string_in_variables_changed","searchQueryLength","containsLevel","debounce","sortLineFilters","lineFiltersWrap","lineFilterVar","exclusive","setExclusive","hasPositiveFilter","getLink","positiveFilter","find","getDrillDownIndexLink","button","LinkButton","index","header","showLogsButton","AGGREGATED_METRICS_USER_OVERRIDE_LOCALSTORAGE_KEY","pluginJson","userOverride","active","aggregatedMetrics","toggleAggregatedMetricsOverride","service_selection","aggregated_metrics_toggled","enabled","onToggleOpen","popover","background","primary","boxShadow","shadows","z3","weak","zIndex","marginRight","heading","fontWeight","fontWeightMedium","paddingBottom","gridTemplateColumns","rowGap","columnGap","Dropdown","overlay","AGGREGATED_METRIC_START_DATE","toLocaleString","Switch","aggregatedMetricsToggle","placement","onVisibleChange","ToolbarButton","icon","aggregatedMetricsMenu","getServicesScene","EmbeddedScene","makeIndexPage","SceneAppPage","prefixRoute","PageLayoutType","Custom","preserveUrlKeys","SERVICE_URL_KEYS","routePath","getScene","drilldowns","ROUTE_DEFINITIONS","logs","getPage","parent","makeBreakdownPage","defaultRoute","labels","CHILD_ROUTE_DEFINITIONS","makeBreakdownValuePage","ValueSlugs","makeRedirectPage","PLUGIN_BASE_URL","hideFromBreadcrumbs","$behaviors","navigateToIndex","slug","labelName","labelValue","extractValuesFromRoute","capitalizeFirstLetter","ROUTES","DRILLDOWN_URL_KEYS","getParentPage","SUB_ROUTES","AddToInvestigationButton","queries","getQueries","context","getContext","data","getData","queryRunner","findObjectOfType","SceneQueryRunner","frame","getFilter","q","legendFormat","getFieldConfig","panel","frames","series","fieldConfig","properties","id","existingOverride","overrides","matcher","displayNameFromDS","displayName","unshift","fieldName","uid","ctx","origin","logoPath","links","usePluginLinks","extensionPointId","ExtensionPoints","MetricInvestigation","description","filterNameAndValueObj","ADD_TO_INVESTIGATION_MENU_TEXT","ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT","ADD_TO_INVESTIGATION_MENU_GROUP_TEXT","AvgFieldPanelType","CollapsablePanelText","PanelMenu","addItem","setItems","items","addInvestigationsLink","iconClassName","onExploreLinkClickTracking","shortcut","viz","VizPanelMenu","investigationsButton","investigationOptions","getLabelName","activate","panelType","collapsible","addVisualizationHeader","menu","collapsed","newCollapsableState","vizPanelFlexLayout","setValueSummaryHeight","setPanelOption","addCollapsableItem","gridItem","SceneCSSGridItem","clone","$data","headerActions","PanelBuilders","timeseries","setOverrides","setLevelColorOverrides","histogram","setMenu","setTitle","setHeaderActions","setData","build","newPanelType","fieldsAggregatedBreakdownScene","FieldsAggregatedBreakdownScene","rebuildAvgFields","onSwitchVizTypeTracking","addHistogramItem","exploreLogsVizPanelMenu","addToInvestigationButton","getInvestigationLink","existingMenuItems","existingAddToExplorationLink","onAddToInvestigationClick","subscribeToAddToInvestigation","getQueryRunnerFromChildren","breakdownScene","FieldValuesBreakdownScene","LabelValuesBreakdownScene","queryProvider","uninterpolatedExpr","open","getQueryExpr","trimEnd","displayedFields","getDisplayedFields","visualisationType","getLogsVisualizationType","columns","urlColumns","unknownToStrings","columnsParam","getUrlColumns","exploreState","toURLRange","refId","panelsState","labelFieldName","DATAPLANE_LABELS_NAME","subUrl","appSubUrl","urlUtil","renderUrl","panes","schemaVersion","onExploreLinkClick","all","open_in_explore_menu_clicked","newVizType","change_viz_type","addToInvestigation","getPluginLinkExtensions","extensions","getPanelWrapperStyles","panelWrapper","opacity","visibility","shade","AddFilterEvent","source","ClearFilterEvent","addAdHocFilter","addToFilters","clearFilters","getUIAdHocVariable","fieldValue","getValueFromAdHocVariableFilter","getNumericOperatorType","op","gt","gte","lt","lte","removeNumericFilter","resolveVariableTypeForField","operatorType","NotEqual","addNumericFilter","valueObject","getParserForField","addToFavorites","valueLabel","filterExists","validateVariableNameForField","variableName","getDetectedLabelsFrame","AddToFiltersButton","setFilterState","filterInSelectedFilters","isMetadata","add_to_filters_in_breakdown_clicked","filterType","filtersLength","getAdHocFiltersVariable","BreakdownSearchReset","recentFilters","BreakdownSearchScene","filterValues","LabelBreakdownScene","FieldsBreakdownScene","cacheKey","byFrameRepeater","findDescendents","ByFrameRepeater","child","filterByString","typeofBody","onValueFilterChange","clearValueFilter","SearchInput","performRepeat","newChildren","sortedSeries","sortSeries","sortBy","seriesIndex","layoutChild","getLayoutChild","unfilteredChildren","layoutSwitcher","LayoutSwitcher","singleGraphParent","VALUE_SUMMARY_PANEL_KEY","SceneDataTransformer","transformations","limitFramesByName","pipe","newFrames","getLabelValue","typeofPanel","typeofGraphParent","iterateFrames","haystack","fuzzySearch","filterFrames","filterSummaryChart","filterFn","buildNoResultsScene","clearFilter","prevData","LoadingState","Done","Streaming","SceneReactObject","reactNode","alertContainer","noResultsAlert","clearButton","minWidth","EmptyLayoutScene","emptyStateStyles","FieldSelector","setSelected","selectableOptions","InlineField","selectWrapper","Select","select","ServiceFieldSelector","selectOption","initialFilter","customOption","setCustomOption","allOptions","selectedOption","serviceSceneSelectWrapper","exploreServiceSearch","__isNew__","actionMeta","prevInputValue","wrapWildcardSearch","input","x1","Selector","getTagKey","groupByVariable","getFieldGroupByVariable","buildQuery","buildQueryRunner","onValuesDataQueryChange","runQuery","setSubscriptions","getQueryRunner","runQueriesMode","tagKey","detectedFieldsFrame","getDetectedFieldsFrame","queryString","buildFieldsQueryString","filterExpression","removeFieldLabelFromVariableInterpolation","expression","buildDataQuery","getParserForThisField","setFieldParserSubscriptions","setMetadataParserSubscriptions","getSceneQueryRunner","rebuildQuery","runQueries","queryRunners","getQueryParser","fieldsVar","setErrorState","errors","err","status","strong","message","traceId","optionValue","getSortByPreference","DEFAULT_SORT_BY","fieldsBreakdownScene","layouts","LabelsMenu","ValueSummaryPanelScene","ValuesMenu","SceneCSSGridLayout","templateColumns","FIELDS_BREAKDOWN_GRID_TEMPLATE_COLUMNS","autoRows","isLazy","getFilterBreakdownValueScene","DrawStyle","Bars","Line","getParserFromFieldsFilters","parserForFields","getParserForFields","updateChildren","newParser","getDetectedFieldsFrameFromQueryRunnerState","newNamesField","getDetectedFieldsNamesFromQueryRunnerState","newParsersField","getDetectedFieldsParsersFromQueryRunnerState","cardinalityMap","calculateCardinalityMap","newFieldsSet","updatedChildren","fieldType","getDetectedFieldType","dataTransformer","getQueryRunnerForPanel","delete","buildChildren","sortChildren","subscribeToPanel","aPanel","bPanel","aCardinality","Map","cardinality","set","serviceScene","fieldsCount","updateFieldCount","$detectedFieldsData","onDetectedFieldsChange","subscribeToFieldsVar","newParsers","oldParsers","extractParserFromArray","detectedFieldsState","childrenClones","getResultsStream","isHidden","activeLayout","getActiveGridLayouts","getPanelOption","panels","isAvgField","newChild","buildChild","ALL_VARIABLE_VALUE","SelectLabelActionScene","hideValueDrilldown","setCustomFieldConfig","mode","StackingMode","Normal","setSeriesLimit","MAX_NUMBER_OF_TIME_SERIES","l","activeLayoutChildren","activePanels","changeFieldCount","loading","$detectedLabelsData","SortCriteriaChanged","handleSortByChange","variableChanged","getPrimaryLabelFromUrl","newService","prevService","oldState","updateOptions","checkPrimaryLabel","dataFrame","getVariablesThatCanBeCleared","NoMatchingLabelsScene","clearCallback","clearVariables","getFieldOptions","updateBody","VAR_FIELD_GROUP_BY","defaultToAll","includeAll","SortByScene","_variableDependency","VariableDependencyConfig","variableNames","value_breakdown_sort_change","criteria","onFieldSelectorChange","select_field_in_breakdown_clicked","previousField","getValueText","view","sortByDirection","navigateToValueBreakdown","labelsMenuWrapper","valuesMenuWrapper","blockingMessage","StatusWrapper","content","textDecoration","paddingTop","LabelsAggregatedBreakdownScene","$detectedLabels","update","updateQueriesOnFieldsVariableChange","getPanelByIndex","detectedLabelsFrame","newLabels","getLabelGroupByVariable","layoutObj","existingLabels","newLabelsSet","detectedLabels","LABEL_BREAKDOWN_GRID_TEMPLATE_COLUMNS","buildLabelsQuery","setHoverHeader","onDetectedLabelsDataChange","onLabelsVariableChange","onGroupByVariableChange","SERVICE_UI_LABEL","SERVICE_NAME","newPrimaryLabel","prevPrimaryLabel","getLabelOptions","hasAllValue","VAR_LABEL_GROUP_BY","previousLabel","VAR_LABEL_GROUP_BY_EXPR","removeValueLabelFromVariableInterpolation","setEmptyStates","setErrorStates","errorIndex","displayed","showErrorToast","getActiveLayout","repeater","variableState","labelBreakdownScene","bodyOpts","levelColor","errorArray","displayError","activeLayoutContainsNoPanels","alertError","renderError","onLayoutChange","layout_type_changed","Field","RadioButtonGroup","findIndex","setCollapsible","setCollapsed","buildValueSummaryPanel","getValueSummaryHeight","extendPanelContext","extendTimeSeriesLegendBus","maxHeight","syncLevelsVisibleSeries","syncLabelsValueSummaryVisibleSeries","syncFieldsValueSummaryVisibleSeries","getFieldsVariableLegendSyncSubscription","sceneFlexItem","isLevel","initLegendOptions","getLabelsVariableLegendSyncSubscription","getQuerySubscription","onToggleSeriesVisibility","toggleLevelFromFilter","toggleLabelFromFilter","toggleFieldFromFilter","label_in_panel_summary_clicked","collapsableState","suffix","rest","Input","suffixWrapper","clearIcon","DisplayDurationUnits","DisplayByteUnits","NumericFilterPopoverScene","gtFilter","ltFilter","extractedValue","extractValueFromString","gtu","unit","ltu","Number","hasExistingFilter","onSubmit","togglePopover","units","onInputKeydown","formDisabled","inputString","inputType","durationValue","durationValueLength","isNaN","bytesValue","byteValueLength","getUnitOptions","popoverStyles","getPopoverStyles","subTitle","selectLabelActionScene","ClickOutsideWrapper","useCapture","Stack","role","card","fieldWrap","FieldSet","fieldset","breakdowns","common","filterNumericPopover","inputGreaterThanInclusive","horizontal","inclusiveField","inclusiveInput","inputGreaterThan","onKeyDownCapture","autoFocus","currentTarget","numberInput","Label","inputGreaterThanUnit","unitFieldLabel","selectInput","inputLessThanInclusive","inputLessThan","inputLessThanUnit","buttons","submitButton","cancelButton","numberFieldLabel","switchFieldLabel","INCLUDE_VALUE","EXCLUDE_VALUE","NUMERIC_FILTER_VALUE","getVariable","getExistingFilter","EMPTY_VARIABLE_VALUE","onClickExcludeEmpty","onClickIncludeEmpty","onClickNumericFilter","selectedValue","calculateSparsity","newLogsPanelState","showPopover","logsPanelData","getLogsPanelFrame","hasNumericFilters","hasSparseFilters","logLinesWithLabelCount","reduce","acc","percentage","existingFilterValue","detectedFieldFrame","getViewValuesLink","getValueBreakdownLink","SelectableValueComponent","getSelectableValueComponentStyles","popoverRef","useRef","filterButtonDisabled","hasOtherFilter","selectedOptionValue","hasExistingNumericFilter","numericSelected","includeSelected","sparseIncludeOption","component","sparseExcludeOption","numericFilterOption","defaultOption","ButtonGroup","filterButtonGroup","filterButton","ref","ButtonSelect","filterSelect","buttonSelect","PopoverController","showPopper","hidePopper","popperProps","blurFocusProps","onBlur","current","Popover","show","wrapperClassName","referenceElement","renderArrow","left","warning","pxToRem","borderTopLeftRadius","borderBottomLeftRadius","sortingOptions","ReducerID","stdDev","sum","min","fieldReducers","selectOptions","filterReducerOptions","onCriteriaChange","setSortByPreference","onDirectionChange","sortByValue","htmlFor","sortByFunction","isSearchable","inputId","ENABLED_PERCENTILES","ext","getLabelValueFromDataFrame","statusMessage","fontStyle","getFocusStyles","outline","outlineOffset","canvas","transitionTimingFunction","transitionDuration","transitionProperty","getIconButtonBefore","hoverSize","transitions","handleMotion","RegexIconButton","maxContrast","Tooltip","viewBox","xmlns","x","y","dominantBaseline","textAnchor","gridSize","x0_5","hover","colorManipulator","alpha","LineFilterCaseSensitivityButton","LineFilterInput","rows","INITIAL_INPUT_WIDTH","onSubmitLineFilter","onClearLineFilter","setWidth","resize","useEffect","searchLogs","inputNoBorderRight","onKeyUp","buttonWrap","removeBtn","submit","exclusiveBtn","LogOptionsScene","handleWrapLinesChange","getLogsPanelScene","wrapLogMessage","setLogOption","getLogsListScene","setLogsVizOption","prettifyLogMessage","onChangeLogsSortOrder","sortOrder","LogsListScene","LogsPanelScene","clearDisplayedFields","logs_clear_displayed_fields","getLogsPanelSortOrderFromStore","getLogOption","LogsSortOrder","Descending","getLogsPanelSortOrderFromURL","decodedSortOrder","narrowLogsSortOrder","onChangeVisualizationType","visualizationType","wrapLines","buttonGroupWrapper","transparent","Ascending","LogsPanelHeaderActions","vizType","tableColumnCustomWidths","LogLineState","TableColumnsContext","createContext","columnWidthMap","setColumnWidthMap","filteredColumns","setColumns","setFilteredColumns","setVisible","bodyState","setBodyState","clearSelectedLine","TableColumnContextProvider","initialColumns","logsFrame","setUrlColumns","setUrlTableBodyState","urlTableBodyState","showColumnManagementDrawer","isColumnManagementActive","removeExtraColumns","initialColumnWidths","existingWidths","narrowRecordStringNumber","NarrowingError","getColumnWidthsFromLocalStorage","setColumnWidthMapState","handleSetColumns","useCallback","newColumns","activeColumns","colA","colB","getActiveColumns","handleSetBodyState","logLineState","handleSetVisible","isVisible","pendingLabelState","newColumnsArray","pa","pb","timeField","bodyField","defaultColumns","getDefaultColumns","col","pendingColumns","getTimeName","percentOfLinesWithLabel","Infinity","getBodyName","setDefaultColumns","Provider","labelTypes","columnsToSet","useTableColumnContext","useContext","TableCellContext","cellIndex","numberOfMenuItems","setActiveCellIndex","TableCellContextProvider","cellActive","setCellActive","handleCellActive","useTableCellContext","TableHeaderContext","isHeaderMenuActive","setHeaderMenuActive","TableHeaderContextProvider","handleisHeaderMenuActive","useTableHeaderContext","LogsColumnSearch","searchValue","setSearchValue","dispatcher","newColumnsWithMeta","numberOfResults","searchResultCount","reportInteraction","resultCount","searchWrap","needle","debouncedFuzzySearch","LogsTableEmptyFields","empty","LogsTableNavField","dragIcon","labelCount","appearance","contentWrap","customWidthWrap","checkboxLabel","whiteSpace","Checkbox","checked","showCount","omit","draggable","LogsTableActiveFields","reorderColumn","valueFilter","toggleColumn","dragging","columnWrapper","getLogsFieldsStyles","labelKeys","renderTitle","DragDropContext","onDragEnd","destination","Droppable","droppableId","provided","droppableProps","innerRef","la","lb","sortLabels","Draggable","draggableId","snapshot","isDragging","draggableProps","dragHandleProps","collator","Intl","Collator","sensitivity","LogsTableAvailableFields","borderBottom","compare","LogsTableMultiSelect","sidebarWrap","overflowY","scrollbarWidth","columnHeaderButton","columnHeader","h6","clear","filteredColumnsWithMeta","columnsWithMeta","getReorderColumn","sourceIndex","destinationIndex","ColumnSelectionDrawerWrap","columnName","logContext","logError","c","priorActiveCount","column","columnAction","columnCount","columnFilterEvent","pendingFilteredLabelState","isDefaultField","DefaultCellWrapComponent","CellWrapInnerComponent","onMouseOut","onMouseIn","rowIndex","cellState","overflowX","onMouseEnter","initialState","addFilter","selectedLine","QueryContext","QueryContextProvider","useQueryContext","CellContextMenu","pillType","menuItemsWrap","menuItem","showColumn","path","fillRule","clipRule","d","fillOpacity","LEVEL_NAME","DefaultPill","mappings","getFieldMappings","isPillActive","activePillWrap","pillWrap","pill","menuItemText","FieldType","time","LineActionIcons","clipboardButton","lineHeight","inspectButton","verticalAlign","iconWrapper","z2","inspect","logId","idField","lineValue","isInspecting","setIsInspecting","getText","generateLogShortlink","row","table","inspectLine","tooltipPlacement","tabIndex","ClipboardButton","Modal","onDismiss","pre","ButtonRow","DefaultCellComponent","getCellLinks","displayValue","number","linkWrapper","hasLinks","React","formattedValueToString","fieldIndex","showColumns","renderValue","getLinks","DataLinksContextMenu","api","openMenu","LogLinePillValue","activePill","valueWrap","menuActive","onClickAdd","LogLinePill","templateSrv","getTemplateSrv","useMemo","other","originalField","isDerivedField","originalFrame","getLinksSupplier","subFieldName","addFieldToColumns","stopScroll","scrollTo","scrollLeft","Scroller","scrollerRef","scroller","scrollRight","onPointerDown","behavior","onPointerUp","scrollWidth","RawLogLineText","rawLogLine","bgColor","fontFamilyMonospace","LogLineCellComponent","isHover","setIsHover","untransformedField","rawValue","isDerived","untransformedValue","string","renderLabels","isAuto","auto","hasLabels","ScrollSyncPane","LogsTableHeader","isFirstColumn","isLine","logLineButton","tableHeaderMenu","leftAlign","rightAlign","defaultContentWrapper","isBodyField","onLogTextToggle","defaultContent","LogsTableHeaderWrap","hideColumn","pendingColumnState","columnIndex","cols","headerProps","linkWrap","openColumnManagementDrawer","slideLeft","reverse","slideRight","autoColumnWidths","TableAndContext","GrafanaTable","onColumnResize","onResize","initialSortBy","desc","initialRowIndex","cellHeight","TableCellHeight","Sm","footerOptions","reducer","countRows","Table","timeZone","section","tableWrap","tableFrame","setTableFrame","localSelectedLine","prepareTableFrame","frameWithOverrides","applyFieldOverrides","replaceVariables","defaults","custom","guessLogsFieldTypeForField","filterable","headerComponent","getInitialFieldWidth","cellOptions","getTableCellOptions","prepare","isFieldLokiLabels","typeInfo","DataFrameType","LogLines","isFieldDataplaneLabels","flatMap","format","keepTime","labelFiltersTransform","labelFilters","labelFiltersInclude","indexByName","includeByName","getOrganizeFieldsTransform","buildColumnsWithMeta","specialFields","extraFields","getDefaultStateOrganizeFieldsTransform","transformedDataFrame","lastValueFrom","transformDataFrame","getIdName","lineIndex","cleanLineIndex","Drawer","onClose","ScrollSync","vertical","proportional","fieldDisplayName","guessLogsFieldTypeForValue","critical","crit","eror","debug","trace","MappingType","ValueToText","cellComponent","TableCellDisplayMode","tableWidth","numberOfFields","extraPadding","columnMeta","maxLength","iso8601Regex","TableWrap","panelWrapSize","setPanelWrapSize","useResizeObserver","panelWrap","clientWidth","clientHeight","getTimeZone","getColumnsFromProps","fieldNames","previouslySelected","getLogFrameLabelsAsLabels","numberOfLogLines","labelMap","fieldLabels","setObj","valueSet","getCardinalityMapFromLabels","cardinalityCount","fromEntries","normalize","mapLabelsToInitialState","specialFieldArray","addSpecialLabelsState","setSpecialFieldMeta","total","ceil","guessFieldTypeFromValue","TableProvider","parseLogsFrame","LogsTableScene","parentModel","tableLogLineState","timeRangeValue","PanelChrome","loadingState","actions","setVisualizationType","getVariableForLabel","areArraysStrictlyEqual","LineFilterScene","getLineFilterVariable","updateInputState","updateVariable","getLineFilterCase","getLineFilterRegex","getLineFilterExclusive","cancel","setLineFilterExclusive","flush","thisFilter","clearVariable","handleChange","setLineFilterCase","setLineFilterRegex","getFilterKey","getOperator","search_string_in_logs_changed","decodedUrlColumns","unknownTableRow","narrowSelectedTableRow","decodedSelectedTableRow","decodedVisualizationType","narrowLogsVisualizationType","searchParams","setStateFromUrl","updateLogsPanel","selectedLineUrl","urlColumnsUrl","vizTypeUrl","displayedFieldsUrl","getVizPanel","logsPanelScene","xSizing","lineFilterScenes","lineFilterScene","logs_visualization_toggle","setLogsVisualizationType","contain","CopyLinkButton","copied","setCopied","timeoutId","handleClick","LogsPanelError","decodedWrapLogMessage","getLogsPanel","handleLogsError","isEmptyLogsResult","handleNoData","clearLogsError","logsCount","getTitle","errorResponse","statusText","errorMessage","showLogsError","logsVolumeCollapsedByError","getLogsVolumeOption","logsVolume","logsVolumePanelKey","LogsVolumePanel","getParentScene","formattedCount","valueFormatter","getValueFormat","trim","setOption","handleLabelFilterClick","handleLabelFilterOutClick","handleIsFilterLabelActive","handleFilterStringClick","handleFilterOutStringClick","onClickShowField","onClickHideField","getPrettyQueryExpr","updateVisibleRange","handleShareLogLineClick","handleLabelFilter","logs_detail_filter_applied","setDisplayedFields","logs_toggle_displayed_field","displayedField","newLogs","rowId","resolveRowTimeRangeForSharing","copyText","metadata","hasKeyValueFilter","fieldFilter","hasKeyValueFilterField","lineFiltersVar","logs_popover_line_filter","selectionLength","LogsVolumeActions","TemporaryExemptionsButton","usePluginComponent","streamSelector","dataSourceUid","contextHints","updateContainerHeight","totalLogsCount","formattedTotalCount","maxLines","LINE_LIMIT","calcs","displayMode","LegendDisplayMode","List","setUnit","getTimeSeriesExpr","setLogsVolumeFieldConfigs","setLogsVolumeOption","annotations","displayVisibleRange","containerLayout","innerHeight","updatedLogSeries","visibleRange","getSeriesVisibleRange","getVisibleRangeFrame","levelFilter","level_in_logs_volume_clicked","onPatternClick","filteredPatterns","staleIndex","pattern_selected","logsStatsRow","logsStatsRowActive","logsStatsRowLabel","logsStatsRowValue","logsStatsRowCount","logsStatsRowPercent","logsStatsRowBar","logsStatsRowInnerBar","PatternFieldLabelStatsRow","count","proportion","style","percent","barStyle","logsStats","wordBreak","logsStatsHeader","medium","logsStatsTitle","logsStatsClose","logsStatsBody","PatternFieldLabelStats","stats","topRows","activeRow","otherRows","otherCount","combinedRows","stat","PatternNameLabel","exploration","patternIndices","indices","currentIndex","extractPatternIndices","setStats","statsError","setStatsError","previousQueryRef","previousTimeRangeRef","handlePatternClick","pattern_field_clicked","patternExtractor","_value","constructQuery","currentTimeRange","requestId","intervalMs","targets","timezone","app","startTime","fieldCount","fieldStatsMap","toArray","fieldStats","convertResultToStats","parts","part","Toggletip","onOpen","Spinner","emphasize","PatternsLogsSampleScene","queryWithFilters","LOG_STREAM_SELECTOR_EXPR","replacePatternsInQuery","queryRunnerWithFilters","onQueryWithFiltersResult","pendingPattern","VAR_PATTERNS_EXPR","removePatternFromFilterExclusion","patternsViewTableScene","PatternsViewTableScene","patternsNotMatchingFilters","setWarningMessage","noticeFlexItem","getNoticeFlexItem","vizFlexItem","getVizFlexItem","getFlexItemChildren","excludeThisPatternFromFiltering","patternsThatDontMatchCurrentFilters","filterVariable","onQueryError","every","traceIds","request","panelFlexItem","queryWithoutFilters","PATTERNS_SAMPLE_SELECTOR_EXPR","queryRunnerWithoutFilters","PatternsTableExpandedRow","tableViz","expandedRows","rowScene","newRowScene","SCALED_UNITS","appliedPatterns","getColumnStyles","cell","panelData","original","dataNode","SceneDataNode","timeSeries","TooltipDisplayMode","None","AxisPlacement","Hidden","setDisplayMode","tableTimeSeriesWrap","tableTimeSeries","sortType","scaledUnits","countTextWrap","toFixed","getTablePatternTextStyles","tablePatternTextDefault","getExplorationFor","disableGrow","existingPattern","appliedPattern","includeLink","excludeLink","undoLink","patternFrames","legendSyncPatterns","logExploration","patternFrame","getTableStyles","patternsFrameScene","PatternsFrameScene","patternFramesRaw","previousValue","tableData","buildTableData","buildColumns","tableWrapper","InteractiveTable","getRowId","renderExpandedRow","theme2","overflowWrap","th","navbarFixed","pointerEvents","palette","visualization","newFrame","$patternsData","prevFrame","patternsBreakdownScene","PatternsBreakdownScene","patternFilter","forEachChild","getTimeseriesDataNode","getSingleViewLayout","originalOnToggleSeriesVisibility","override","patternsToShow","names","getTimeSeries","asTable","setLinks","targetBlank","fixedColor","overrideToFixedColor","logsByServiceScene","PatternsViewTextSearch","onSearchResult","setFilteredPatterns","patternFramesOverride","filteredPatternFrames","clearSearch","handleSearchChange","setEmptySearch","PatternsNotDetected","TextLink","external","PatternsTooOld","PATTERNS_MAX_AGE_HOURS","setBody","onDataChange","ySizing","updatePatternFrames","dataFrames","dataFrameToPatternFrame","prevFrames","Loading","controlsRight","controlsLeft","justifyItems","patternMissingText","timeRangeTooOld","dateTime","code","TabNames","breakdownViewsDefinitions","testId","tabLogs","behaviors","sync","DashboardCursorSync","Crosshair","tabLabels","buildFieldsBreakdownActionScene","changeFieldNumber","tabFields","tabPatterns","valueBreakdownViews","buildLabelValuesBreakdownActionScene","buildFieldValuesBreakdownActionScene","ShareButtonScene","setIsOpen","onCopyLink","shorten","absTime","createAndCopyShortLink","global","isAbsoluteTime","protocol","host","lastSelected","defaultMode","MenuActions","menuOptions","getUrl","constructAbsoluteUrl","getSceneTimeRange","Menu","groupOption","MenuGroup","Item","narrow","getRelativeURLPath","createShortLink","getBackendSrv","post","shortLink","alertSuccess","toUtc","getUrlSearchParams","toISOString","pathname","ActionBarScene","dataSource","shareButtonScene","currentBreakdownViewSlug","allowNavToParent","drilldownValueSlug","getDrilldownValueSlug","loadingStates","Box","paddingY","appSidecar","ToolbarExtensionsRenderer","TabsBar","tab","Tab","counter","getCounter","totalCount","getLogsCountStyles","logsCountStyles","emptyCountStyles","LogsCount","getDrillDownTabLink","onChangeTab","action_view_changed","newActionView","previousActionView","patternsCount","labelsCount","md","right","setFilters","sub","limitPerPlugin","ariaLabel","removeEscapeChar","charsEscapedByEscapeRegExp","char","stringArray","nextChar","isNextCharRegex","LOGS_PANEL_QUERY_REFID","LOGS_COUNT_QUERY_REFID","setSubscribeToLabelsVariable","redirectToStart","prevRouteMatch","replaceSlash","$logsCount","newPrimaryLabelValue","isAdHocFilterValueUserInput","stripAdHocFilterUserInputPrefix","isExact","resetTabCount","navigateToDrilldownPage","getMetadataService","setServiceSceneState","showVariables","getServiceSceneState","getMetadata","resetBodyAndData","setBreakdownView","subscribeToPatternsQuery","subscribeToDetectedLabelsQuery","subscribeToDetectedFieldsQuery","subscribeToLogsQuery","subscribeToLogsCountQuery","subscribeToFieldsVariable","subscribeToMetadataVariable","subscribeToLevelsVariableChangedEvent","subscribeToLevelsVariableFiltersState","subscribeToDataSourceVariable","subscribeToPatternsVariable","subscribeToLineFiltersVariable","subscribeToTimeRange","deprecatedLineFilterArray","deprecatedLineFilter","globalLineFilterVars","caseSensitiveMatches","caseInsensitiveMatches","migrateLineFilterV1","parentSlug","updateLoadingState","patternsResponse","setPatternsCount","detectedLabelsResponse","detectedLabelsFields","removeSpecialFields","setLabelsCount","updateFieldsCount","detectedFieldsFields","setFieldsCount","getServiceSceneQueryRunner","getPatternsQueryRunner","getDetectedLabelsQueryRunner","getDetectedFieldsQueryRunner","getLogCountQueryRunner","buildGraphScene","breakdownView","breakdownViewDef","valueBreakdownView","valueBreakdownViewDef","getResourceQueryRunner","buildResourceQuery","VAR_LABELS_EXPR","queryType","FavoriteServiceHeaderActionScene","setHover","isFavorite","removeFromFavorites","tooltipCopy","onMouseOver","SelectServiceButton","getLabelDrilldownLink","selectLabel","primaryLabelName","primaryLabelValue","service_selected","clonedVar","urlSync","ConfigureVolumeError","NoServiceSearchResults","TabPopoverScene","serviceSelectionScene","serviceSelectionTabsScene","ServiceSelectionTabsScene","tabOptions","tabOptionsWithIcon","saved","toggleShowPopover","setSelectedTab","getLabelsFromQueryRunnerState","$labelsData","populatePrimaryLabelsVariableOptions","selectedTab","getSelectedTab","savedTabs","getFavoriteTabsFromStorage","savedIndex","runDetectedLabels","runDetectedLabelsSubs","getServiceSelectionPrimaryLabel","selectDefaultLabelTab","removeSavedTab","removeTabFromLocalStorage","getTabsStyles","tabs","tabLabel","truncateText","addTab","NoServiceVolume","AddLabelToFiltersHeaderActionScene","isSelected","included","add_to_filters","ServiceSelectionPaginationScene","getPageCountStyles","searchPageCountWrap","searchFieldPlaceholderText","textWrapMode","PageCount","countPerPage","roundedTotalCount","getCountOptionsFromTotal","lastOptionValue","currentPage","setServiceSelectionPageCount","pagination","float","paginationWrap","paginationWrapMd","Pagination","numberOfPages","onNavigate","toPage","showSmallVersion","aggregatedMetricsEnabled","AGGREGATED_SERVICE_NAME","primaryLabelUrlKey","datasourceUrlKey","getSelectedTabFromUrl","addDatasourceChangeToBrowserHistory","newDs","dsUrl","currentUrl","newUrl","pushUrlHandler","addLabelChangeToBrowserHistory","newKey","primaryLabelRaw","primaryLabelSplit","addTabToLocalStorage","clearServiceSelectionSearchVariable","setServiceSelectionPrimaryLabelKey","buildServiceLayout","serviceLabelVar","primaryLabelVar","datasourceVar","splitDuration","getMetricExpression","isAggregatedMetricsActive","cssGridItem","runner","runPanelQuery","toolbar","getQueryOptionsToolbar","formatPrimaryLabelForUI","setVolumeQueryRunner","buildVolumeQuery","VAR_PRIMARY_LABEL_EXPR","VAR_LABELS_REPLICA_EXPR","subscribeToVolume","doVariablesNeedSync","labelsVarPrimary","labelsVarReplica","getLabelsVariableReplica","activeTab","filteredFilters","needsSync","syncVariables","fixRequiredUrlParams","subscribeToPrimaryLabelsVariable","subscribeToLabelFilterChanges","subscribeToActiveTabVariable","runVolumeOnActivate","subscribeToDatasource","subscribeToAggregatedMetricToggle","subscribeToAggregatedMetricVariable","isTimeRangeTooEarlyForAggMetrics","onUnsupportedAggregatedMetricTimeRange","runVolumeQuery","onSupportedAggregatedMetricTimeRange","getAggregatedMetricsVariable","isBefore","resetQueryRunner","updateAggregatedMetricVariable","updateTabs","getGridItems","requestTimeRange","fromDiff","abs","toDiff","labelsToQuery","getLabels","paginationScene","existingChildren","aggregatedMetricsVariable","datasourceVariable","existing","newChildTs","newChildLogs","buildServiceLogsLayout","serviceIndex","getLogExpression","labelsByVolume","dsString","searchString","getServiceSelectionSearchVariable","services","favoriteServicesToQuery","service","createListOfLabelsToQuery","getServiceSelectionPageCount","VAR_PRIMARY_LABEL_SEARCH","VAR_AGGREGATED_METRICS","hideLabel","VAR_PRIMARY_LABEL","renderPrimaryLabelFilters","VAR_LABELS_REPLICA","serviceLevel","onSearchServicesChange","primaryLabelSearch","searchVar","search_services_changed","searchQuery","getLevelFilterForService","serviceLevels","Off","allLevels","getLevelLabelsFromSeries","toggleLevelVisibility","updateServiceLogs","headingWrapper","loadingText","bodyWrapper","searchPaginationWrap","searchWrapper","searchField","serviceStringVariable","hasSearch","isLogVolumeLoading","volumeApiError","filterLabel","customValue","customLabel","unwrapWildcardSearch","serviceName","onSearchChange","goToLabelDrillDownLink","MultiValueVariable","getValueOptions","of","renderSelectForVariable","equalsFilters","notEqualsFilters","regexEqualFilters","regexNotEqualFilters","getCombinedLabelFilters","adHocFilters","operatorFilters","joinedValues","joinCombinedFiltersValues","ltFilters","lteFilters","gtFilters","gteFilters","filtersString","buildLabelsLogQLFromFilters","getLabelsExpr","joinMatchFilters","decodeFilters","getExpr","filterSeparator","equalFiltersStrings","notEqualsFiltersStrings","regexEqualFiltersStrings","regexNotEqualFiltersStrings","ltFiltersStrings","lteFiltersStrings","gtFiltersStrings","gteFiltersStrings","allFilters","buildJoinedFilters","LabelFilterOp","RegexEqual","RegexNotEqual","getFilterValues","buildFilter","NumericFilterOp","allFiltersString","combineValues","equal","notEqual","regexEqual","regexNotEqual","groupFiltersByKey","combineFiltersValues","mergeFilters","removeStaleOperators","filterStrings","filtersWithSameOperatorsAndKeys","isOperatorNumeric","buildFilterString","positiveFilterValueSeparator","negativeFilterValueSeparator","expectedOperator","operatorTo","filtersFrom","filtersTo","valuesToMove","mergeCombinedFiltersValues","separator","filterCombinedValues","filtersByKey","multipleValuesOperator","updatedOperatorAndEscapedValues","currentOperator","narrowFilterOperator","updatedOperator","firstFilter","filterString","escapeFieldValue","escapeFieldValues","isUserInput","sceneUtils","escapeLabelValueInExactSelector","escapeLabelValueInRegexSelector","quoteChar","ignoreKeys","positiveMatch","positiveRegex","isOperatorExclusive","positiveMatchGroup","groupBy","positiveRegexGroup","negativeMatchGroup","negativeRegexGroup","gtGroup","gteGroup","ltGroup","lteGroup","getExpressionBuilderDebug","page","createInteractionName","open_in_explore_clicked","wasm_not_supported","interval_too_long","arr1","arr2","set1","set2","requestSupportsSharding","nodeType","isQueryWithNode","iterate","enter","MetricExpr","isLogsQuery","isLogsRequest","isInstantQuery","SHARDING_PLACEHOLDER","addShardingPlaceholderSelector","interpolateShardingSelector","shards","shardValue","RegExp","resolveIdx","destField","sourceField","idx","closestIdx","nanos","compareEntries","destTimeField","destIdField","destIndex","sourceTimeField","sourceIdField","sameTimestamp","compareNsTimestamps","findSourceField","referenceField","sourceFields","candidates","TOTAL_BYTES_STAT","getCombinedMetadataStats","destStats","sourceStats","destStat","s","sourceStat","eitherStat","cloneDataFrame","runShardSplitQuery","interpolateVariablesInQueries","splittingTargets","shouldStop","mergedResponse","uuidv4","subquerySubscription","retriesMap","retryTimer","runNextRequest","subscriber","cycle","groupSize","nextGroupSize","retrying","done","next","complete","nextRequest","nextCycle","retry","isRetriableError","traces","floor","sqrt","retries","pow","shardsToQuery","groupShardRequests","subRequest","partialResponse","constrainGroupSize","currentSize","metaExecutionTime","executionTime","updateGroupSizeFromResponse","currentResult","newResult","currentFrame","frame1","frame2","frameType1","TimeSeriesMulti","field1","field2","compareLabels","customType1","frameType","customType2","shouldCombine","dest","sourceTimeValues","totalFields","destIdx","entryExistsInDest","mergeFrames","mergedErrors","mergedError","mergedTraceIds","combineResponses","runNonSplitRequest","Observable","selector","getNodesFromQuery","getSelectorForShardValues","isValidQuery","fetchLabelValues","getInitialGroupSize","catch","splitQueriesByStreamShard","DEBUG_ENABLED","log","WRAPPED_LOKI_DS_UID","DETECTED_FIELDS_NAME_FIELD","DETECTED_FIELDS_CARDINALITY_NAME","DETECTED_FIELDS_PARSER_NAME","DETECTED_FIELDS_TYPE_NAME","WrappedLokiDatasource","RuntimeDataSource","__sceneObject","valueOf","targetsSet","resource","getVolume","getPatterns","getDetectedLabels","getDetectedFields","shardingEnabled","exploreLogsShardSplitting","updatedRequest","sanitizeStreamSelector","interpolatedTarget","dsResponse","utc","step","headers","lokiPatterns","maxValue","minValue","timeValues","countValues","samples","createDataFrame","preferredVisualisationType","targetsInterpolated","sortLabelsByCardinality","detectedLabelFields","nameField","cardinalityField","parserField","typeField","FIELDS_TO_REMOVE","primaryLabel","volumeResponse","lhs","rhs","lVolumeCount","rVolumeCount","df","metric","labelsResponse","testDatasource","registerRuntimeDataSource","streamSelectorName","excludeEmpty","metadataExpressionToAdd","VAR_METADATA_EXPR","VAR_LINE_FILTERS_EXPR","VAR_FIELDS_EXPR","JSON_FORMAT_EXPR","LOGS_FORMAT_EXPR","DETECTED_LEVELS_VALUES_EXPR","DETECTED_FIELD_AND_METADATA_VALUES_EXPR","rerenderFavorites","forceRender","addToFavoriteLabelValueInStorage","removeFromFavoritesInStorage","getReducerId","extractParserFromString","parserString","extractFieldTypeFromString","fieldString","parsersSet","parsersArray","namesField","sortByScene","labelKey","frameIndex","reducerID","selectFrameTransformation","setDisplayName","labelType","getLabelTypeFromFrame","LabelType","Parsed","Indexed","StructuredMetadata","getFilterTypeFromLabelType","parserForThisField","typesField","optionType","parserFromFilterValue","fieldExpressionToAdd","structuredMetadataToAdd","getLogsStreamSelector","buildFieldsQuery","labelOptions","optionName","labelExpressionToAdd","getLabelsFromSeries","labelsVariable","getVisibleLabels","allLabels","getVisibleFilters","getVisibleFields","getVisibleMetadata","inclusiveFilters","exclusiveLabels","visibleLevels","SeriesVisibilityChangeMode","ToggleSelection","existingLevel","getVisibleLevels","levelsFilter","wantedLevels","normalizeLevelName","unwantedLevels","getField","cache","getFieldByName","DATAPLANE_TIMESTAMP_NAME","DATAPLANE_BODY_NAME","DATAPLANE_SEVERITY_NAME","DATAPLANE_ID_NAME","logFrameLabelsToLabels","logFrameLabels","k","FieldCache","timestampField","severityField","labelsField","getLogFrameLabels","timeNanosecondField","getLabelFieldName","parseDataplaneLogsFrame","getFirstFieldOfType","getL","lineField","lineLabels","makeLabelsArray","makeLabelsGetter","parseLegacyLogsFrame","oldestFirst","VISIBLE_RANGE_NAME","arrayToDataFrame","timeEnd","isRegion","dataTopic","DataTopic","Annotations","metadataService","initializeMetadataService","MetadataService","serviceSceneState","previousRoute","buildDrilldownPageUrl","extraQueryParams","buildDrilldownPageRoute","newPath","urlLabelName","urlLabelValue","urlPath","buildValueBreakdownUrl","fullUrl","drilldownLink","serviceUrl","buildServicesUrl","getSearch","LogsSceneQueryRunner","UNKNOWN_LEVEL_LOGS","matchFieldsWithName","overrideColor","builder","setValueSummaryFieldConfigs","setLabelSeriesOverrides","overrideConfig","FieldMatcherID","byNames","readOnly","overrideCustomFieldConfig","__systemRef","focusedLevels","FieldConfigBuilders","FieldConfigBuilder","onFieldConfigChange","focusedLabels","setColorByDisplayNameTransformation","getFieldDisplayName","FieldColorModeId","PaletteClassicByName","sortLevelTransformation","aName","aVal","bName","queryRunnerOptions","hasLevel","isLogPanelQuery","LokiQueryDirection","Backward","Forward","route","queryParamsOverrides","defaultQueryParams","VAR_DATASOURCE_EXPR","editorMode","supportingQueryType","addAdHocFilterUserInputPrefix","getLevelsExpr","getMetadataExpr","getFieldsExpr","escapeDoubleQuotedLineFilter","buildLogQlLineFilter","breakdownLabelName","routeParams","startOfUrl","locationArray","buildServicesRoute","sceneObject","PRETTY_LOG_STREAM_SELECTOR_EXPR","check","returnType","uf","uFuzzy","intraMode","intraIns","intraSub","intraTrn","intraDel","idxs","order","haystackOrder","matchesSet","mark","matched","infoIdx","highlight","ranges","debounceLodash","memoize","sortSeriesByName","initOutlierDetector","fieldReducer","calculateDataFrameChangepoints","calculateOutlierValue","doStandardCalcs","seriesCalcs","firstTimestamp","lastTimestamp","firstValue","lastValue","allSeriesKey","wasmSupported","dataPoints","samplingStep","sample","Float64Array","ChangepointDetector","defaultArgpcp","detectChangepoints","valueA","valueB","localeCompare","joined","outerJoinDataFrames","points","detector","OutlierDetector","dbscan","preprocess","outliers","detect","seriesResults","isOutlier","outlierIntervals","support","WebAssembly","FAVORITE_PRIMARY_LABEL_VALUES_LOCALSTORAGE_KEY","FAVORITE_PRIMARY_LABEL_NAME_LOCALSTORAGE_KEY","DS_LOCALSTORAGE_KEY","dsKey","createPrimaryLabelLocalStorageKey","labelValues","servicesToStore","createTabsLocalStorageKey","tabName","tabNames","SORT_BY_LOCALSTORAGE_KEY","defaultSortBy","defaultDirection","getExplorationPrefix","getDataSourceName","getServiceName","PREFIX","storedFields","LOG_OPTIONS_LOCALSTORAGE_KEY","defaultValue","storedValue","LOGS_VOLUME_LOCALSTORAGE_KEY","removeItem","VISUALIZATION_TYPE_LOCALSTORAGE_KEY","storedType","LINE_FILTER_OPTIONS_LOCALSTORAGE_KEY","PANEL_OPTIONS_LOCALSTORAGE_KEY","EXPRESSION_BUILDER_DEBUG_LOCALSTORAGE_KEY","SERVICE_SELECTION_PAGE_COUNT_KEY","pageCount","appConfig","apiKey","apiUrl","refreshPicker","combobox","addNewLabelTab","searchLabelValueInput","openExplore","logsPanelHeader","radio","isSecureContext","writeText","createElement","appendChild","execCommand","removeChild","paramName","charAt","toUpperCase","ellipsis","timeEpochMs","VAR_LEVELS_EXPR","lookupVariable","encodedValue","narrowFieldValue","adHocFiltersVariableState","getServiceNameFromVariableState","variablesToClear","wip","_wip","includeOperators","isLabelsVar","inclusiveOperatorCount","isEditingOnlyFilter","isAddingFirstFilter","numericOperators"],"sourceRoot":""}